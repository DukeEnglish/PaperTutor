Scalable Mechanism Design for Multi-Agent Path Finding
PaulFriedrich∗1,2, YulunZhang∗3, MichaelCurry1,2,4, LudwigDierks2,5,
StephenMcAleer3, JiaoyangLi3, TuomasSandholm3,6 and SvenSeuken1,2
1ETHAICenter
2UniversityofZurich
3CarnegieMellonUniversity
4HarvardUniversity
5UniversityofIllinoisatChicago
6OptimizedMarkets,StrategyRobot,StrategicMachine
paul@ifi.uzh.ch,yulunzhang@cmu.edu
Abstract Most MAPF research assumes that the goals and costs of
theagentsareknowntotheMAPFalgorithmandfocuseson
Multi-Agent Path Finding (MAPF) involves deter-
findingcomputationallyefficientwaystoobtainsolutionsthat
mining paths for multiple agents to travel simul-
minimize aggregated agent costs, called optimal solutions.
taneously through a shared area toward particular
However, it may be in an agent’s interest to misreport this
goal locations. This problem is computationally
information to the algorithm: for example, she may wish to
complex,especiallywhendealingwithlargenum-
exaggerate her cost of a delay to ensure that the algorithm
bers of agents, as is common in realistic applica-
favoursheroveranagentthatreportedalowercostwhenre-
tions like autonomous vehicle coordination. Find-
solving a potential conflict. The MAPF algorithm may not
inganoptimalsolutionisoftencomputationallyin- have access to the agents’ true values and costs since they
feasible,makingtheuseofapproximatealgorithms
couldbemisreported. Inthatcase,thereisnoguaranteethat
essential. Adding to the complexity, agents might
itfindsasolutionwhichmaximizesthetruesocialwelfare.
act in a self-interested and strategic way, possibly
Thefieldofmechanismdesigndealswithexactlythisprob-
misrepresentingtheirgoalstotheMAPFalgorithm
lem: designing systems for efficiently allocating scarce re-
if it benefits them. Although the field of mech-
sources,whileensuringthattheyarestrategyproof andindi-
anism design offers tools to align incentives, us-
vidually rational. These desirable properties guarantee that
ing these tools without careful consideration can
the agents are incentivized to report their private informa-
failwhenonlyhavingaccesstoapproximatelyopti-
tiontruthfullytothemechanism,andthatparticipatinginthe
maloutcomes.Sinceapproximationsarecrucialfor
mechanismwillalwaysbenefiteachagent,respectively.
scalableMAPFalgorithms,thisposesasignificant
The celebrated Vickrey-Clarke-Groves (VCG) mecha-
challenge. Inthiswork, weintroducetheproblem
nism [Vickrey, 1961; Clarke, 1971; Groves, 1973] achieves
of scalable mechanism design for MAPF and pro-
this goal in principle. It first chooses an allocation that per-
posethreestrategyproofmechanisms,twoofwhich
fectlymaximizeswelfaregivenagents’reportedpreferences,
even use approximate MAPF algorithms. We test
andthenchargessidepaymentstoeachagent. Viaacareful
our mechanisms on realistic MAPF domains with
choice of payments, VCG ensures that there is no incentive
problemsizesrangingfromdozenstohundredsof
foragentstolieabouttheirpreferences.
agents. Our findings indicate that they improve
However,mechanismdesignhassofareithernotbeenap-
welfarebeyondasimplebaseline.
plied to large-scale routing problems or has bypassed path
finding,e.g.,viacongestionpricinginroaddomains[Behesh-
1 Introduction tian et al., 2020]. To understand why this is the case, note
that even classic full-information MAPF problems are com-
There are numerous emerging domains of large-scale re-
putationallyextremelychallenging. Findinganoptimalsolu-
source allocation problems, such as allocating road capacity
tionisNP-hard[GeftandHalperin,2022]. Thestate-of-the-
tocars, or3Dairspacetounmannedaerialvehicles(UAVs),
artMAPFalgorithmproducingoptimalsolutionsisconflict-
where multi-agent path finding (MAPF) is required to cal-
basedsearch(CBS)[Sharonetal.,2015].CBSfirstgenerates
culate a valid allocation. In realistically-sized instances of
an individual shortest path for each agent and then resolves
suchproblems,pathsmustbecalculatedforlargenumbersof
conflicts iteratively, building a constraint tree in a best-first-
agentssimultaneously.Suchcomputationallychallengingdo-
searchmanner. Itsworst-caseruntimescalesexponentiallyin
mainsareincreasinglyofreal-worldimportance.FutureUAV
the number of agents, and identifying why certain scenarios
trafficinurbanareasfromparceldeliveriesaloneisprojected
are computationally feasible to optimally solve while others
to require managing tens of thousands of concurrent flight
arenot,isanopenareaofresearch[Gordonetal.,2021].
paths[Dooleetal.,2020].
Much of the MAPF literature therefore employs (bound-
*Theseauthorscontributedequally. edly)suboptimalalgorithmsorevencountsfindinganyfeasi-
4202
naJ
03
]IA.sc[
1v44071.1042:viXrablepathassignmentasasuccess. Whilethereexistanumber in-rangepropertyenablestheuseofsuboptimalMAPFalgo-
ofsuboptimalMAPFalgorithmsthatworkverywellinprac- rithms in strategyproof mechanisms. In experiments across
ticeaslongasagenttypesarefullyknown[Bareretal.,2014; large MAPF benchmarks, we show that such mechanisms
Li et al., 2020], most are unsuitable for a mechanism with show a significant computational speedup compared to so-
self-interested agents. This is because VCG-based mecha- lutionsrelyingonoptimalMAPFalgorithms,andoutperform
nismsrelyonanoptimalassignmentbeingfound—iftheas- ana¨ıvestrategyproofbaselineintermsofagentwelfare.
signmentisonlyapproximatelyoptimal,theresultingmecha-
nismisgenerallynolongerstrategyproof[Sandholm,2002]. 2 RelatedWork
Inthispaper,weshowhowwecandesignsuboptimalbut
Mechanism design is used in a wide range of domains
morescalableMAPFalgorithmsthataremadestrategyproof
where goods must be allocated to self-interested agents.
through VCG-based payments by ensuring that they choose
Example domains which have seen high-profile implemen-
optimallyfromsomerestricted,fixedsetofoutcomes.Thisis
called the maximal-in-range (MIR) property [Nisan and Ro- tations include electricity markets [Cramton, 2017], spec-
nen, 2007], which guarantees that charging VCG payments trum auctions [Cramton, 1997], course allocation at univer-
sities [Soumalias et al., 2023; Budish, 2011; Othman et al.,
resultsinnoincentivetolie.
2010], vaccine allocation [Castillo et al., 2021] and large-
The rest of this paper is organized as follows. After giv-
scale sourcing auctions, for instance for transportation ser-
inganoverviewofrelatedwork(Section2),weintroduceour
vices[Sandholm,2013]. Givensomechosenallocationrule,
formulation of the non-cooperative MAPF problem and il-
dependingontherule’sstructure,itmaybepossibletodesign
lustratetheapproachofpairinganoptimalMAPFalgorithm
apaymentrulesuchthateveryagenthasadominantstrategy
withVCGpaymentstoachievestrategyproofness(Section3).
toreportherpreferencestruthfully,nomatterwhattheother
In Section 4, we first show how this approach applied to
agentsreport[Myerson,1981].
the optimal CBS algorithm results in a welfare-maximizing
Mechanism design where the allocated goods are paths
and strategyproof mechanism, which we call the payment-
usuallyfailstocaptureimportantcharacteristicsoftheMAPF
CBS(PCBS)mechanism.
domain.Ridesharing[Maetal.,2022]matchesriderslooking
As we are interested in significantly larger problems, we
togofromAtoBwithdriversandalignsincentivesforboth
successively restrict the search space to increase scalability.
sideswithpayments. Roadpricing[Beheshtianetal.,2020]
WefocusontheclassofprioritizedMAPFalgorithms[Silver,
facilitatestheoptimallyefficientmovementofagentsthrough
2005]. Instead of searching for a jointly optimal allocation,
a transportation network by charging higher payments for
these algorithms search through a space of priority order-
travel in areas with high congestion. Both approaches leave
ings. Theyplanpathsforagentssequentially,suchthateach
the decision on what route to take up to individual agents,
plannedpathavoidsallpathsthatbelongtoagentswithhigher
meaning that collisions are not considered and cannot be
priority. They are fast and efficient in practice, but have no
prevented. UAV traffic management (UTM) [Seuken et al.,
(bounded) suboptimality guarantees, and one can construct
2022] is an emerging domain that combines heterogeneous,
MAPFinstancesthatcannotbesolvedbythem.
self-interested agents with explicit path allocations. Recent
Withthisrestriction,wefirstintroducetheexhaustive-PBS
workinUTMfocusesonresolvingconflictsbetweenagents,
(EPBS) mechanism, which uses an allocation rule based on
butoffloadscomputationalcosttotheagentbyrequiringher
anadaptedversionofpriority-basedsearch(PBS)[Maetal.,
to produce and submit her intended movement paths to the
2019]. Itconstructsapriorityordering,thatis,astrictpartial
mechanismbeforehand[Duchampetal.,2019].
orderonthesetofagents,byiterativelyaddingabinarypri-
PriorresearchthatexplicitlymodelstheMAPFdomainhas
orityrelationandre-planningaccordinglyforpairsofagents
mostly focused on the cooperative case [Stern et al., 2019],
which conflict. By exhaustively expanding the PBS search
with work on the non-cooperative case just emerging and
tree,EPBSfulfillstheMIRproperty. EPBSillustrateshowa
focusing on auction-based mechanisms. Das et al. [2021]
suboptimal MAPF algorithm can be made strategyproof us-
assume a 2D grid topology with intersection vertices and
ing MIR and our variation of VCG payments, which can be
solvetheonlineproblem byrunningseparateVCGauctions
calculatedwithoutadditionalcomputationalcost.
ateachintersection. Amiretal. [2015]modelpathsas”bun-
In a second step, we further restrict the search space to
dles” of vertices, and use an iterative combinatorial auction
a fixed number of randomly drawn total priority orderings.
mechanismcallediBundletosellnon-collidingpathstoself-
The resulting mechanism, which we call Monte-Carlo pri-
interestedagentsinawaythatachievesstrategyproofnessat
oritized planning (MCPP), chooses the welfare-maximizing
thecostofpoorscalability.Gautieretal.[2022]buildontheir
allocation among those resulting from applying prioritized
workwithasuboptimalmechanismthatachievesacomputa-
planning(PP)[ErdmannandLozano-Perez,1987]totheran-
tionalspeed-upatthecostoflosingstrategyproofness. Chan-
domly drawn orderings. In addition to being strategyproof
draetal. [2023]1stickclosertotheMAPFdomainwiththeir
throughthecombinationoftheMIRpropertywithourVCG-
formulation, and provide a planning mechanism that sim-
basedpayments,MCPPcantradeoffoptimalityandscalabil-
itybyvaryingthenumberofsampledpriorityorderings.
1While the paper claims strategyproofnes, the relevant analy-
In summary, we present three strategyproof path alloca-
sis is restricted to myopic agents only considering the next edge.
tion mechanisms that do not rely on computationally costly Given that they employ sequential auctions for moving multiple
combinatorialauctionsandmodelself-interestedagentsinthe edges (with heuristic value estimation for individual bids), incen-
standardMAPFsetting.Weprovethatapplyingthemaximal- tivesdonottranslatetothefullMAPFproblem.plifies the strategy space by only having conflicting agents Wedefinetwotypesofconflict:Avertexconflict i,j,v,t
⟨ ⟩
bidformovementpriorityindecentralized,repeatVCGauc- occurswhenagentsiandj attempttooccupyvertexv V
∈
tions. We go a step further by reducing bid complexity for at the same timestep t; and an edge conflict i,j,u,v,t oc-
⟨ ⟩
agents from valuing paths or priorities to merely providing curs when agents i and j attempt to traverse the same edge
values for a successful arrival and for their time. Further- (u,v) E inoppositedirectionsatthesametimestept(or,
∈
more, we improve on the high computational complexity of moreprecisely,fromtimestept 1totimestept). Afeasible
−
(VCG) auction-based approaches while still achieving their assignment is a set of conflict-free paths d = π ,...,π ,
1 n
{ }
desiredstrategyproofnessbyusingmorescalable,established one for each agent. An optimal assignment is an assign-
MAPFalgorithms. Lastly, weusetheclassicMAPFformu- ment d∗ that produces the maximum social welfare, d∗ =
lationfortheallocationproblemanddonotassumeanyaddi- argmax (cid:80) v c (πd),subjecttothefeasibilityconstraint.
d i i − i i
tionaltopologyonourgrids. PrioritizedMAPFresearchhas Thus we enhance the standard MAPF problem formulation,
usedrandomizationtogenerateinitialorderingsthatarethen whichaimstominimizeflowtimeormakespan, meaningthe
modifiedbythealgorithm[Bennewitzetal.,2002].However, sumorthemaximumofarrivaltimesofallagentsattheirgoal
unlikeours,thislineofresearchdoesnotconsiderincentives vertices respectively. Both effectively model all agents as
orproducestrategyproofmechanisms. havingavalueofzeroandcostfortimeofone,andcouldbe
accommodatedbyourmechanismsatnoruntimecost. Since
3 ProblemSetup theyalsoremovetheabilityforagentstomisreportandthus
theneedforstrategyproofness,weomittheirdiscussion.
Weconsidertheproblemofassigningpathsthroughagraph
In contrast to the classic MAPF problem, we assume that
(V,E) to n self-interested agents. For example, for UAV
agents’typesareprivateandnotaprioriknowntothemech-
airspace assignment, each agent is an individual UAV oper-
anismthatassignsthepaths. Instead, eachagentreportsher
ator,whilethegraphrepresentstheassignableairspace.
typetothemechanism. Wedenotebyτˆ = (τˆ ,...,τˆ )aset
1 n
Eachagentihasastartvertexs andagoalvertexg that
i i of reported types that serve as the mechanism input, and by
shewantstoreachasquicklyaspossible. Timeisdiscretized
π(τˆ) the path assignment that the mechanism outputs. We
into timesteps indexed by t. At each timestep, every agent
assume agents are self-interested and may misreport a type
can either move to an adjacent vertex or wait at its current
τˆ = τ in such a way as to ensure that the mechanism se-
i i
vertex,bothofwhichincurscostc . Additionally,eachagent ̸
i lects an outcome that is favorable to them. A (social) wel-
hassomevaluev forarrivingathergoalvertexg . Wealso
i i fare optimizing mechanism, for instance, finds the outcome
callthe4-tupleτ =(s ,g ,c ,v )theagent’stype. Apathπ
i i i i i i which maximizes the sum of reported agent welfare. This
foragentiisasequenceofverticesthatarepairwiseadjacent
outcome may be arbitrarily suboptimal for other individual
oridentical(indicatingawaitaction). Atthestart,agentscan
agents(hurtingegalitariansocialwelfare,thatis,fairness)or
waitataprivatelocation(thegaragevertex)foranumberof
thepopulationasawhole(hurtingsocialwelfare,thatis,ef-
timesteps where they do not conflict with other agents and
ficiency). Weassumethatagentsdonotmisreporttheirstart
from which the only movement option is to their start ver-
andgoalvertices,astheywouldhavenegativeinfinitewelfare
texs . Apathbeginsatthegarageortheagent’sstartvertex
i forreceivingapaththatdoesnottakethemfromtheirstartto
s and ends at her goal vertex g . The cost of a path c(π )
i i i theirgoal,reducingtheagent’sstrategicchoicestoc andv .
i i
is defined as c π . The welfare of an agent represents her
i i Toalignincentives,weassumethemechanismmaycharge
| |
satisfaction with a path which she is assigned and is given
payment p (τˆ) to agent i upon assigning them a path. Con-
i
byhervalueforarrivalminuscostoftravelingalongthepath,
sequently,anagent’sutilityisgivenbythewelfareofheras-
w (π )=v c (π ).Thesumofallagents’welfareiscalled
i i i i i signmentminusthepaymentsheischarged,
−
socialwelfare. Torepresentthewelfareofallagentsexclud-
(cid:0) (cid:1)
ingi,wewritew −i =(cid:80) j̸=iw j(π j). u i(τˆ)=v i −c i π i(τˆ) −p i(τˆ).
Onceanagentreacheshergoal,shedisappearsandhergoal In a slight abuse of notation, we also write u (τˆ,τˆ ) for
i i −i
vertex becomes free for other agents. We further allow for theutilityresultingfromagentireportingτˆ ifthesetofre-
i
t ah ne ea mss pig tynm pae tn hto df oea sn ne om tp ct ay rrp yat ah nπ yi v= alu∅ et oo ra cn oy sa t.g 2en Ot. uS ru ac ph
-
p ano yrts τˆfro ,m anth ye ar ge em na ti ini wng illag ree pn ots rtis thτˆ e−i t. yW pee τˆass thu am te mth aa xt imgi iv ze en
s
−i i
proach is agnostic to agents remaining at their goal vertices her utility u (τˆ,τˆ ). To facilitate our analysis, we restrict
i i −i
after they complete their paths3. Our mechanisms could be ourattentiontostrategyproof(SP)mechanisms,whereitisa
appliedtocostfunctionswhichdependoninformationother dominantstrategyforagentstoreporttheirtruetypeτ ,inde-
i
than |π i |, as long as costs are independent of other agents’ pendentofthereportsoftheotheragentsτˆ −i.
assignments. Ifc i dependsonotheragents’assignments,all Additionally,wefocusonindividuallyrational(IR)mech-
algorithms stop being well-defined, as they use single-agent anisms, that is, mechanisms that guarantee every agent
bestpathsthatnolongerexistinisolation. (weakly)positiveutilityu (τˆ) 0. Suchmechanismsguar-
i
≥
anteethatagentsareincentivizedtoparticipateinthemecha-
2Emptypathsareonlyrequiredtoensurethatindividuallyratio-
nism,astheycannotloseutilitydoingso[Krishna,2009].
nalassignmentsforallagentsexist. Ifexistenceisnotrequired,all
ourresultsholdwithoutemptypaths. Summary Weaimtofindamechanismthat,givenasetof
3Thisandthegaragevertexassumptionsdecreasethelikelihood reports,outputsanassignmentwithavalidpath(ornopath)
ofsolutionsrequiringtheassignmentofemptypaths. Thetheoreti- for each agent, such that it maximizes welfare and that the
calpropertiesofourmechanismsarenotimpacted. mechanismisstrategyproof andindividuallyrational.3.1 MechanismDesignDesiderataforMAPF agent i will choose not to move at all. Formally, we define
We now explore how to achieve two key desiderata: strate- c i(π i) := min(v i,c i π i ) such that an agent’s welfare be-
| |
gyproofnessandindividualrationality. comesw i := v i c i(π i) = max(0,v i c i π i ). Ifanagent
− − | |
Formechanismssuchasourpayment-CBS(PCBS)which isassignedapathforwhichshewouldhavenegativewelfare
findoptimalallocations,strategyproofnesscanbeguaranteed anddecidesnottotakethatpathduetoindividualrationality,
bychargingagentsVCGpayments. However,forsuboptimal ouradjustmentsetsherwelfaretozero. Then
mechanismssuchasourexhaustive-PBS(EPBS)andMonte- (cid:88) (cid:88)
d∗ =argmax wˆ (d)=argmax wˆ (d)=d∗ ,
Carlo prioritized planning (MCPP), an additional property i i −i
d∈S d∈S
calledmaximal-in-rangehastobesatisfied.Weshowthatthis i j̸=i
property is sufficient to guarantee strategyproofness when
whichimpliesthatp =0,andsincew =0alsou =0.
i i i
combinedwithavariationonVCGpayments,whichwecall
VCG-basedpayments. Lemma1. Let(f,p)beamechanismconsistingofapathal-
locationrulef thatsatisfiesMIRwithrangeSandtheVCG-
Definition 1. An allocation rule f satisfies the maximal-in-
basedpaymentrulep. Then(f,p)isstrategyproof.
range property (MIR), if there exists a fixed subset S (the
“range”)ofallpossibleallocations suchthatforallpossible The full proof is in the appendix and follows Nisan and
reportsofmisreportableinformatioD nτˆ=(τˆ ,...,τˆ ),theal- Ronen’s(2007)lineofargumentsusingourdomain-specific
1 n
locationrulechoosestheoutcomeintherangeSwhichleads adaptations.
to the highest reported welfare (“the outcome which maxi- Lemma 2. Let (f,p) be a mechanism consisting of a path
mizesreportedwelfareoverS”). Inotherwords,iff allocation rule f and the VCG-based payment rule p. Let
(cid:88)n c i(π i)=max(v i,c i |π i |)asabove. Then
S : τˆ:f(τˆ)=argmax wˆ (d).
i (i) Themechanism(f,p)isindividuallyrational.
∃ ⊆D ∀
d∈S
i=1
(ii) Forallagentsiandreportedtypesτˆ,p (τˆ) 0.
i
Our EPBS and MCPP mechanisms use VCG payments Thatis,themechanismhasnonegativepaym≥ ents.
with one variation. Let d∗ be the assignment which maxi-
Thefullproofisintheappendix.
mizessocialwelfarewithinthemechanism’sallocationrule’s
range S, that is, d∗ :=argmax (cid:80) vˆ cˆ(πd). The A welfare-maximizing MAPF algorithm fulfills MIR as
d∈S i i − i i longastwoconditionsaremet. First,anagentcannotchange
VCG approach also requires calculating the counterfactual
assignmentd∗ whichmaximizessocialwelfareinthehypo- the range of assignments explored by the MAPF algorithm
−i by misreporting. Second, the MAPF algorithm breaks ties
theticalprobleminstancewhereagentiisnotpresent.
between equal-length paths in a way that is independent of
Definition2. TheVCG-basedpaymentrulechargestoagent
theagents’reports(weassumethisfromnowon). Together,
ithedifferenceintotalreportedwelfareofallagentsexclud-
theyensurethatthemechanismconstructsthesamerangefor
ing i of the factual and counterfactual welfare-maximizing
allpossibleagentreports.
assignment, Standard approximate MAPF algorithms like EECBS [Li
p (τˆ)=wˆ (d∗ ) wˆ (d∗). etal.,2020]maybeanaturalfirsttargetinsearchofscalabil-
i −i −i − −i ity. Yet,none,toourknowledge,fulfilltheMIRproperty,as
Intuitively, the payment represents the amount by which theirsearchtreeexpansionmakesuseofheuristicsthatagents
agent i’s presence has caused a worse assignment and low- caninfluencebymisreportingtheircost. Bothofoursubopti-
ered social welfare for all other agents, also called agent malmechanismsusepriority-basedallocationrules.Weshow
i’s externality. Typically, calculating d∗ requires solving that this class of MAPF algorithms can be altered in natural
−i
the underlying optimization problem once per agent for an waystoachieveMIRandthusstrategyproofness.
altered problem instance where that agent is not present.
This is extremely costly in the MAPF domain. Our EPBS 4 Mechanisms
and MCPP mechanisms use a slightly different d∗ , which
−i
sidestepsthisrequirementandensuresthatpaymentsarenon- WepresentthreemechanismsthatsolvetheclassicalMAPF
positive. TheytakeallassignmentswithintheirrangeS, set problemformulationforself-interestedagents. Allthreeful-
agenti’svalueandcostto0butleavetheassignment’spaths fillthemechanismdesigndesiderataofstrategyproofness,in-
unchanged(i.e.,agenti’spathisstillpresent),andselectthe dividualrationalityandnonegativepayments.
soalteredassignmentwiththehighestwelfare. Equivalently,
d∗ =argmax (cid:80) vˆ cˆ(πd). All counterfactual as- 4.1 Payment-CBS(PCBS)
−i d∈S j̸=i i − i i
signments are thus drawn from the range that was already PCBSconstitutesouroptimalbenchmarkmechanism. Given
exploredwhenfindingd∗,avoidingcostlyrecalculation. reported agent types, it first finds a reported social welfare
To ensure individual rationality, or non-negative utilities maximizing allocation d∗ using conflict-based search
forallagents,ourmechanismswillnotassignpathstoagents (CBS) [Sharon et al., 2015∈], aD nd then charges agents VCG
if the path’s cost exceeds the agent’s value. If an agent payments. AsitfulfillsthedefinitionofaVCGmechanism,
is assigned a path whose cost is greater than the value the it is strategyproof (see Proof of Lemma 1 in the appendix),
agent would gain from completing it, i.e., if c π > v , and by Lemma 2 it is individually rational and charges no
i i i
| |
we cap the agent’s cost for that path at v and assume that negativepayments.
iWhileEPBSandMCPPcomputealloutcomeswithintheir its parent node and does not need to access a data structure
rangebeforeselectingthewelfare-maximalone,PCBSdoes thatissharedwithnodesotherthanitsownfuturechildren.
not. TofindtheVCG-basedpaymentforanagent,CBSmust
Proposition1. EPBSisstrategyproof.
be run on the setting excluding that agent in order to obtain
the counterfactual d∗ . In total, the mechanism runs CBS
−i Proof. EPBSusesalexicographicorderingofagents(which
once to find the optimal allocation d∗ and again for each
weassumetobefixed)andtheirreportsofstart-andgoalver-
i=1,...,ntocomputep . However,theserunscouldoccur
i tices(whichweassumetonotbemisreportable)forexploring
in parallel, reducing PCBS’s real runtime to that of regular
assignments. Givenasetofagenttypesthatvaryonlyinmis-
CBS’ (given sufficiently many CPUs). While it thus shares
reportable information, namely cost c and value v , EPBS
i i
a level of limited scalability with the main optimal, strate-
constructsthesamesearchtreefromeachset,resultinginthe
gyproof benchmark of iBundle [Amir et al., 2014], PCBS
samesetofleafnodesthatcontaincollision-freeassignments
eliminatesiBundle’sprohibitivecommunicationcomplexity.
. Thereforethissetofassignmentsfulfillsthedefinition
PBS
D
ofEPBS’srange. SinceEPBSchoosesthewelfaremaximiz-
4.2 Exhaustive-PBS(EPBS)
ing assignment over , it fulfills MIR and is thus made
PBS
D
Our EPBS mechanism, derived from priority-based search strategyproofbyitspaymentsaccordingtoLemma1.
(PBS)[Maetal.,2019],illustrateshowasuboptimalMAPF
Corollary 1. EPBS is individually rational and has non-
algorithmcanbeadaptedtofulfilltheMIRproperty. Itcon-
negativepayments.
structs a priority ordering, meaning a strict partial order on
the set of agents using a two-stage algorithm. Starting from ProofasadirectconsequenceofLemma2.
an empty priority ordering and a set of individually optimal
but colliding paths, it builds a search tree where each node 4.3 Monte-CarloPrioritizedPlanning(MCPP)
contains a priority ordering, a movement plan and its cost,
MCPP demonstrates how MIR allows for creating strate-
andalistofitscollisions. Ititerativelyexpandsanode,picks
gyproofMAPFmechanismsthatscaletothetheoreticalopti-
acollision betweentwoagents andresolvesit byexpanding
mum, atthecostofsuboptimality. Oursolutionutilizespri-
intotwochildnodes,whicheachaddoneofthetwopossible
oritized planning (PP) [Erdmann and Lozano-Perez, 1987].
priorityrelationsbetweenthetwoagentstoitspriorityorder-
In contrast to (E)PBS, PP takes as an input a total priority
ing,ensuringthatthepriorityorderingstaystransitive. Paths
ordering andexpandsitintoasetofconflict-freepathsby
arere-plannedusingthenewpriorityorderingwithasingle- ≻
sequentially assigning each agent (starting with the highest
agentlow-levelsearchsuchasA∗,collisionsaretrackedand
priorityone)theshortestpossiblepaththatavoidsallagents
welfare is calculated, and the next node is expanded. Once
of higher priority. In this way, calculating one assignment
allleafnodesarecollision-free,EPBSterminatesandreturns
takesonlynlow-levelpathfindingsearches.
the highest welfare leaf node’s allocation. In contrast, PBS
Our MCPP mechanism selects a subset O of all possi-
uses depth-first-search, expanding the highest welfare node
ble total priority orderings in a way that is independent of
andterminatingonceasinglenodeiscollision-free.
agent reports, then runs prioritized planning on that subset
Toachievewelfare-maximizingallocationswithcertainty,
and charges VCG-based payments. Concretely, MCPP ran-
wewouldinprincipleneedtosearchthrough, andconstruct
domly samples m total priority orderings from the space of
assignments for, all possible priority orderings. Using the
m!possibleones. Wecandirectlytradeoffcomputationalef-
MIRproperty,wereducethesizeofoursearchspacetojust
ficiency and optimality by restricting the range of sampled
the leaves of EPBS’s search tree. The search tree’s depth is
orderings O. Increasing m increases the probability of O
(n2),aseachnodeexpansionaddsonepairofagentstothe
containingorderingsthatgeneratenear-optimalassignments,
O
priorityorderingandnobranchcanaddthesamepairtwice.
and thus the expected welfare of MCPP. We avoid the usu-
Whilefindingtheallocationd∗intheworstcasethusscales
ally costly computation of counterfactual outcomes for the
exponentiallywiththenumberofagents,byfullyexpanding VCGpayments,asthecounterfactuald∗ isselectedfromthe
itssearchtreeEPBScalculatesalloutcomeswithinitsrange −i
range ,whichisalreadyfullyexploredduringthefinding
O
in one go. Due to the variation we make in defining VCG- ofd∗.D
ThecomputationalcostofMCPPthereforescaleslin-
based payments, the range includes all counterfactuals d∗ .
−i early with the number of agents and the number of samples
Thus,torunthemechanism,meaningtofindd∗andcalculate
mthatareselected,adrasticimprovementovertheexponen-
allpaymentsp ,thesearchtreeneedstobeconstructedonly
i tialscalingofPCBS,EPBSandauction-basedstrategyproof
once.4 Building this tree could be parallelized to some de-
MAPF mechanisms. As the sampled orderings are indepen-
gree[S´wiechowskietal.,2023](althoughwehavenotdone
dent,theirmoutcomescouldbecalculatedinparallel,result-
sointhiswork),aseachnewchildnode’spathreplanningtask inginarealruntimeforMCPPofjustncallsofA∗.
basedonitsuniqueorderingrequiresonlytheinformationin
Proposition2. MCPPisstrategyproof.
4Herewetouchonafundamentalquestioninalgorithmicmech-
Proof. MCPP generates a subset O of priority orderings
anismdesignposedby[NisanandRonen, 2001]: Howoftendoes
without considering agent reports. Since each ordering
oneneedtosolvetheunderlyingoptimizationproblemtoobtainn
≻
agents’VCGpayments?HershbergerandSuri[2001]provethatthe in O corresponds to a unique path assignment d ≻, the set
answerisoneinthedomainoffindingashortestpathinanetwork O = d ≻ O fulfillsthedefinitionofMCPP’srange.
D { | ≻∈ }
whereedgeswithcostsrepresentself-interestedagents. As MCPP chooses the welfare-maximising assignment over,itfulfillsMIRandisthusmadestrategyproofbyitspay- bySternetal. [2019]. Weincludetheso-calledFirst-Come-
≻
D
mentsaccordingtoLemma1. First-Serve (FCFS) allocation rule, which runs prioritized
planning on a single randomly sampled priority ordering as
Corollary 2. MCPP is individually rational and has non-
a lower bound for achieved welfare and runtime, and does
negativepayments.
notincludepayments. Wesamplethecostandvalueofeach
ProofasadirectconsequenceofLemma2. agent independently from a uniform distribution between 0
Remark. If there is public knowledge about agents, we can and1. MCPPusesasamplesizeofm = 100,exceptinFig-
alsoincorporateit. Forexample,ifitisknownthatanagent ure1. Eachrunusesasetof100instances. Wesetaruntime
generallyhashighcostsacrossallprobleminstances,wecan limitforallmechanismsat3600secondsfortherandom-32-
improvetheexpectedwelfareofthemechanismbyrestricting 32-20anddens312dmaps,and5400secondsforthedens520d
Otototalordersthatassignthatagentahighpriority. and Paris-1-256 maps. Success rate refers to the fraction of
runsthatfinishwithinthetimelimit. Runtimeforindividual
runsthatdonotfinishwithinthelimit,issettothelimit. The
Mechanism1:MCPP
main results do not use parallelized implementations of our
Input: Agentreports(τ 1,...,τ n)andnumberof mechanisms. Our code is implemented in C++ and was ran
samplesm N on a single machine with 2x12-core Intel Xeon E5-2650v4
∈
Output: Conflict-freepaths(π 1,...,π n)and and128GBofRAM.Thesourcecodeisincludedinthesup-
payments(p 1,...,p n) plementalmaterial.
Allocationrule: PrioritizedPlanning
DrawasetOofmtotalpriorityorderingsindependent
1 5.2 Results
fromagentreports.
for Odo
2 ≻∈ Figure1comparesthesuccessrate,runtimeandwelfareover
d PP( )
≻ ← ≻ FCFSofMCPPwithdifferentsamplesizesmontherandom-
returnSetofassignments d ≻ O = O,each 32-32-20 map. It demonstrates MCPP’s ability to trade off
{ |≻∈ } D
assignmentcontainsconflict-freepaths(π 1,...,π n) scalabilitywithsolutionqualityasafunctionofsamplesize.
w(d)
(cid:80) (cid:0)
v
c(πd)(cid:1)
foralld As the number of agents and thus congestion increases, the
3 ← i i − i ∈DO
d∗ argmax w(d),thewelfaremaximising averageruntimeoffindingsingleshortestpathsdoestoo(for
4 as← signmentovd∈ erDO all mechanisms solving MAPF!), causing MCPP’s apparent
O
D superlinearscaling.
Paymentrule: VCG-basedpayments
Figure 2 compares our three mechanisms and FCFS on
foragentsi=1,...,ndo
5
w (d)
(cid:80) (cid:0)
v
c(πd)(cid:1)
foralld
thestandardMAPFmetricsofruntimeandsuccessrate,and
−i ← j̸=i j − j ∈DO shows their achieved mean welfare over all instances as the
d∗ argmax w (d)
−i ← d∈DO −i ratio when divided over FCFS’s welfare. If a mechanism
p w (d∗ ) w (d∗)
i ← −i −i − −i for a given map and number of agents fails to solve all in-
Assigneachagentithepathπ d∗ stances,wedonotplottheirwelfare.Allmechanisms,includ-
6 i
Chargeeachagentithepaymen∈ tp ing FCFS which does not use payments, are strategyproof.
7 i
FCFS, being essentially 1-sample MCPP without payments,
serves as the baseline with fastest runtime and lowest wel-
fare. PCBS, using the optimal CBS algorithm, shows the
5 Experiments highest welfare but fails to scale to larger instances within
Our experiments verify that our mechanisms’ behavior fol- our time limit. EPBS, using the suboptimal PBS algorithm,
lowsourclaimsonoptimality,scalability,andpayments. Our scalessimilarly. Wewouldexpecttoseemoredifferentiation
benchmarks are strategyproof mechanisms whose allocation inachievedwelfareofthesetwomechanismsatsettingswith
rule solves classical MAPF, iBundle [Amir et al., 2015] be- moreagentsandthusmorecollisions,whereallocationdeci-
ing the most advanced competition. We could not obtain its sions have a bigger impact on welfare. To observe this be-
reference implementation to be able to accurately compare haviour, one could parallelize PCBS, EPBS and MCPP (see
runtimes. In the original benchmarks [Amir et al., 2014], Section 4) or increase the runtime limit. The figure demon-
iBundle shows similar scalability as CBS. As our PCBS, if strates the exceptional scalability of MCPP compared to the
parallelized,hasidenticaltimecomplexityasCBS,thecom- search-basedPCBSandEPBSwhileimprovingoverthewel-
parison can be extrapolated. We also do not compare scala- fare baseline. The magnitude of welfare difference between
bility against SOTA approximate MAPF algorithms, as they themechanismsdependsonthechoiceofcostandvaluedis-
arenotstrategyproofandfeaturestructuresunsuitedforagent tributions and can be increased at will by e.g. employing
cost-weightedsocialwelfareobjectives. highervariancedistributions(seeappendix).
Figure 3 shows the size of the VCG-based payments for
5.1 ExperimentSetup
a fixed mechanism, map and number of agents. We observe
Weevaluatepayment-CBS(PCBS),exhaustive-PBS(EPBS) thatpaymentsareindeednon-negative, andoverwhelmingly
and Monte-Carlo prioritized planning (MCPP) on four 2D zeroorverysmall. Thisindicatesthatinthissetting, agents
maps selected from the commonly used MAPF benchmarks causefewexternalitiestoothers.First-Come-First-Serve Monte Carlo PP (10) Monte Carlo PP (50) Monte Carlo PP (100)
1.0 1.06
2000
1.04
0.5
1000
1.02
0.0 0 1.00
25 620 1215 1810 2405 3000 25 620 1215 1810 2405 3000 25 620 1215 1810 2405 3000
Number of Agents Number of Agents Number of Agents
Figure1:Successrate,runtime,andratio-to-baselineofsocialwelfare(SW)ofMonteCarloPPwithm∈{10,50,100}samples.
First-Come-First-Serve Monte Carlo PP Exhaustive PBS PCBS
1.0 1.0 1.0 1.0
0.5 0.5 0.5 0.5
0.0 0.0 0.0 0.0
5 10 15 20 25 30 35 40 620 1215 1810 2405 3000 5 10 15 20 25 30 35 40 220 415 610 805 1000 5 10 15 20 25 30 35 40 320 615 910 1205 1500 5 10 15 20 25 30 35 40 320 615 910 1205 1500
Number of Agents Number of Agents Number of Agents Number of Agents
1500
4000
1000
2000 2000
500 2000
0 0 0 0
5 10 15 20 25 30 35 40 620 1215 1810 2405 3000 5 10 15 20 25 30 35 40 220 415 610 805 1000 5 10 15 20 25 30 35 40 320 615 910 1205 1500 5 10 15 20 25 30 35 40 320 615 910 1205 1500
Number of Agents Number of Agents Number of Agents Number of Agents
1.06 1.03 1.0010
1.0010
1.04 1.02
1.0005 1.0005
1.02 1.01
1.00 1.00 1.0000 1.0000
5 10 15 20 25 30 35 40 620 1215 1810 2405 3000 5 10 15 20 25 30 35 40 220 415 610 805 1000 5 10 15 20 25 30 35 40 320 615 910 120 15 500 5 10 15 20 25 30 35 40 320 615 910 1205 1500
Number of Agents Number of Agents Number of Agents Number of Agents
random-32-32-20 den312d Paris 1 256 den520d
Figure2: Successrate,runtime,andratio-to-baselineofsocialwelfare(SW)forPCBS,EPBS,MCPPandFCFS(thebaseline). Solidlines
indicate the average value over 100 instances, while the shaded area is the 95% confidence interval. Maximum agent numbers are 3000
for random-32-32-20, 1000 for den312d and 1500 for Paris 1 256 and den520d. Agent numbers between 5 and 40 are shown in higher
granularitythanbetween40andthemaximumtoillustratescalingdifferences.
6 Conclusion
Histogram of Payments
Weintroducedadomainthatbridgesthegapbetweenmech-
105
anism design and MAPF, where paths are allocated in the
104 standard MAPF formulation but agents might make self-
interestedmisreportsoftheircostsandvalues.
103
Wepresentedthreemechanisms–PCBS,EPBSandMCPP
102 – that are strategyproof, individually rational and have no
negativepayments,andwhichcombineMAPFallocational-
101 gorithmswithaVCG-basedpaymentrule.
We showed how using the maximal-in-range (MIR) prop-
0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8
Payments erty, suboptimal MAPF allocation mechanisms like EPBS
andMCPPcanbemadestrategyproof.
Figure 3: Size of payments for the MCPP mechanism, on the
FutureresearchcouldfindmorescalableMAPFalgorithms
random-32-32-20 map at n = 1810 agents. Frequency in the y-
thatfulfillMIRorinvestigateimprovingthewelfareofsubop-
axisisscaledlogarithmically.
timalMIR-fulfillingMAPFalgorithmsbyadjustingtherange
usingnon-misreportableagenttypeinformation.
emitnuR
SFCF
/w
viD
WS
etaR
sseccuS
etaR
sseccuS
ycneuqerF
emitnuR
SFCF
/w
viD
WS
etaR
sseccuS
emitnuR
emitnuR
etaR
sseccuS
SFCF
/w
viD
WS
SFCF
/w
viD
WS
emitnuR
SFCF
/w
viD
WS
etaR
sseccuSReferences [Dooleetal.,2020] Malik Doole, Joost Ellerbroek, and
[Amiretal.,2014] OfraAmir,GuniSharon,andRoniStern. JaccoHoekstra. Estimationoftrafficdensityfromdrone-
baseddeliveryinverylowlevelurbanairspace. Journalof
An empirical evaluation of a combinatorial auction for
AirTransportManagement,88:101862,2020.
solving multi-agent pathfinding problems. Technical Re-
portTR-05-14,HarvardUniversity,2014. [Duchampetal.,2019] Vincent Duchamp, Billy Josefsson,
Tatiana Polishchuk, Valentin Polishchuk, Rau´l Sa´ez, and
[Amiretal.,2015] OfraAmir,GuniSharon,andRoniStern.
RichardWiren. AirTrafficDeconflictionUsingSumCol-
Multi-agent pathfinding as a combinatorial auction. In
oring. In2019IEEE/AIAA38thDigitalAvionicsSystems
Proceedings of the AAAI Conference on Artificial Intelli-
Conference(DASC),pages1–6,September2019.
gence,volume29,2015.
[ErdmannandLozano-Perez,1987] Michael Erdmann and
[Bareretal.,2014] Max Barer, Guni Sharon, Roni Stern,
Tomas Lozano-Perez. On multiple moving objects. Al-
andArielFelner.Suboptimalvariantsoftheconflict-based
gorithmica,2:477–521,1987.
searchalgorithmforthemulti-agentpathfindingproblem.
InProceedingsoftheInternationalSymposiumonCombi- [Gautieretal.,2022] Anna Gautier, Alex Stephens, Bruno
natorialSearch,volume5,pages19–27,2014. Lacerda, NickHawes, andMichaelJWooldridge. Nego-
tiated path planning for non-cooperative multi-robot sys-
[Beheshtianetal.,2020] ArashBeheshtian,RRichardGed-
tems. InAAMAS,pages472–480,2022.
des,OmidMRouhani,KaraMKockelman,AxelOcken-
fels, Peter Cramton, and Wooseok Do. Bringing the ef- [GeftandHalperin,2022] Tzvika Geft and Dan Halperin.
ficiency of electricity market mechanisms to multimodal Refined hardness of distance-optimal multi-agent path
mobility across congested transportation systems. Trans- finding. arXivpreprintarXiv:2203.07416,2022.
portation Research Part A: Policy and Practice, 131:58– [Gordonetal.,2021] Ofir Gordon, Yuval Filmus, and Oren
69,2020. Salzman. Revisiting the complexity analysis of conflict-
[Bennewitzetal.,2002] Maren Bennewitz, Wolfram Bur- based search: New computational techniques and im-
gard, andSebastianThrun. Findingandoptimizingsolv- provedbounds. InProceedingsoftheInternationalSym-
able priority schemes for decoupled path planning tech- posium on Combinatorial Search, volume 12, pages 64–
niques for teams of mobile robots. Robotics and Au- 72,2021.
tonomousSystems,41(2):89–99,2002. [Groves,1973] Theodore Groves. Incentives in teams.
[Budish,2011] Eric Budish. The combinatorial assign- Econometrica: JournaloftheEconometricSociety,pages
617–631,1973.
ment problem: Approximate competitive equilibrium
from equal incomes. Journal of Political Economy, [HershbergerandSuri,2001] John Hershberger and Sub-
119(6):1061–1103,2011. hash Suri. Vickrey prices and shortest paths: What is an
[Castilloetal.,2021] Juan Camilo Castillo, Amrita Ahuja, edge worth? In Proceedings 42nd IEEE symposium on
foundations of computer science, pages 252–259. IEEE,
SusanAthey,ArthurBaker,EricBudish,TasneemChipty,
2001.
Rachel Glennerster, Scott Duke Kominers, Michael Kre-
mer,GregLarson,JeanLee,CanicePrendergast,Christo- [Krishna,2009] Vijay Krishna. Auction theory. Academic
pher M. Snyder, Alex Tabarrok, Brandon Joel Tan, and press,2009.
Witold Wiecek. Market design to accelerate COVID-19 [Lietal.,2020] Jiaoyang Li, Wheeler Ruml, and Sven
vaccine supply. Science, 371(6534):1107–1109, March Koenig. Eecbs: A bounded-suboptimal search for multi-
2021. agentpathfinding. ArXiv,abs/2010.01367,2020.
[Chandraetal.,2023] Rohan Chandra, Rahul Maligi, Arya [Maetal.,2019] HangMa,DanielHarabor,PeterJ.Stuckey,
Anantula,andJoydeepBiswas. Socialmapf: Optimaland JiaoyangLi,andSvenKoenig. Searchingwithconsistent
efficientmulti-agentpathfindingwithstrategicagentsfor prioritizationformulti-agentpathfinding. InProceedings
socialnavigation. IEEERoboticsandAutomationLetters, of the AAAI Conference on Artificial Intelligence (AAAI),
2023. pages7643–7650,2019.
[Clarke,1971] EdwardHClarke.Multipartpricingofpublic [Maetal.,2022] Hongyao Ma, Fei Fang, and David C.
goods. PublicChoice,pages17–33,1971. Parkes. Spatio-Temporal Pricing for Ridesharing Plat-
[Cramton,1997] Peter Cramton. The FCC spectrum auc- forms. Operations Research, 70(2):1025–1041, March
tions:Anearlyassessment.JournalofEconomics&Man- 2022.
agementStrategy,6(3):431–495,1997. [Myerson,1981] RogerBMyerson.Optimalauctiondesign.
[Cramton,2017] Peter Cramton. Electricity market design. MathematicsofOperationsResearch,6(1):58–73,1981.
OxfordReviewofEconomicPolicy,33(4):589–612,2017. [NisanandRonen,2001] NoamNisanandAmirRonen. Al-
[Dasetal.,2021] SankarNarayanDas,SwapravaNath,and gorithmic mechanism design. Games and Economic Be-
havior,35(1-2):166–196,apr2001.
Indranil Saha. Omcorp: An online mechanism for com-
petitiverobotprioritization.InProceedingsoftheInterna- [NisanandRonen,2007] Noam Nisan and Amir Ronen.
tionalConferenceonAutomatedPlanningandScheduling, Computationallyfeasiblevcgmechanisms. JournalofAr-
volume31,pages112–121,2021. tificialIntelligenceResearch,29:19–47,2007.[Othmanetal.,2010] Abraham Othman, Tuomas Sand-
holm,andEricBudish. Findingapproximatecompetitive
equilibria: efficientandfaircourseallocation. InAAMAS,
volume10,pages873–880,2010.
[Sandholm,2002] Tuomas Sandholm. emediator: A next
generationelectroniccommerceserver.ComputationalIn-
telligence, 18(4):656–676, 2002. Special issue on Agent
Technology for Electronic Commerce. Early versions:
In Proceedings of the International Conference on Au-
tonomous Agents (AGENTS), Barcelona, Spain, June 3-
8,2000;InProceedingsoftheAAAI-99WorkshoponAI
inElectronicCommerce,p.46-55;WashingtonUniversity
CStechreportJanuary1999.
[Sandholm,2013] TuomasSandholm. Very-large-scalegen-
eralized combinatorial multi-attribute auctions: Lessons
from conducting $60 billion of sourcing. In Nir Vulkan,
AlvinE.Roth,andZvikaNeeman,editors,TheHandbook
of Market Design, chapter 14. Oxford University Press,
2013.
[Seukenetal.,2022] SvenSeuken,PaulFriedrich,andLud-
wig Dierks. Market Design for Drone Traffic Manage-
ment. Proceedings of the AAAI Conference on Artificial
Intelligence,36(11):12294–12300,June2022.
[Sharonetal.,2015] Guni Sharon, Roni Stern, Ariel Fel-
ner, and Nathan R. Sturtevant. Conflict-based search for
optimal multi-agent pathfinding. Artificial Intelligence,
219:40–66,2015.
[Silver,2005] DavidSilver.Cooperativepathfinding.InPro-
ceedings of the aaai conference on artificial intelligence
and interactive digital entertainment, volume 1, pages
117–122,2005.
[Soumaliasetal.,2023] Ermis Soumalias, Behnoosh Za-
manlooy, Jakob Weissteiner, and Sven Seuken. Machine
Learning-poweredCourseAllocation,2023.
[Sternetal.,2019] Roni Stern, Nathan R. Sturtevant, Ariel
Felner, Sven Koenig, Hang Ma, Thayne T. Walker,
Jiaoyang Li, Dor Atzmon, Liron Cohen, T. K. Satish
Kumar, Eli Boyarski, and Roman Bartak. Multi-agent
pathfinding: Definitions, variants,andbenchmarks. Sym-
posiumonCombinatorialSearch(SoCS),pages151–158,
2019.
[S´wiechowskietal.,2023] Maciej S´wiechowski, Konrad
Godlewski,BartoszSawicki,andJacekMan´dziuk. Monte
carlo tree search: A review of recent modifications and
applications. Artificial Intelligence Review, 56(3):2497–
2562,2023.
[Vickrey,1961] William Vickrey. Counterspeculation, auc-
tions, and competitive sealed tenders. The Journal of Fi-
nance,16(1):8–37,1961.A Proofs couldmake,
A.1 ProofofLemma1 u (τ ,τˆ ) u (τ′,τˆ )
i i −i − i i −i
(cid:88) (cid:0) (cid:1)
ThissectionfollowsNisanandRonen[2007]. =w (f(τ ,τˆ ))+ wˆ f(τ ,τˆ )
i i −i j i −i
Let be a finite set of all allowed path allocations. For j̸=i
D
e ox fa nmp pl ae t, hsD om na (y V,b Ee )th oe
r
s aet sto rif ctal sl ubfe sa es tib ol fe itc .om Lb ein ta dtion =s −w i(f(τ i′,τˆ −i))+(cid:88) wˆ j(cid:0) f(τ i′,τˆ −i)(cid:1)
(π ,...,π ) be an allocation, τˆ = (s ,g ,cˆ,vˆ) be j̸=i
1 n i i i i i
∈ D (cid:0) (cid:1)
agent i’s reported type, and wˆ (d) := max(0,vˆ cˆ π ) h (τˆ ) h (τˆ )
i i i i i −i i −i
− | | − −
agenti’sresultingreportedwelfarefunction. Wewriteτˆ −i = =g(cid:0) f(τ ,τˆ )(cid:1) g(cid:0) f(τ′,τˆ )(cid:1)
(τˆ 1,...,τˆ i−1,τˆ i+1,...,τˆ n) for the tuple containing all re- i −i − i −i
ported types excluding τˆ, and τˆ = (τˆ ,...,τˆ ) or τˆ = 0,
i 1 n ≥
(τˆ,τˆ )forthetuplecontainingallreportedtypes.
i −i where the inequality follows by f’s welfare maximisation
Definition3. AVCGmechanismisamechanism(f,p),such f(τ ,τˆ ) argmax g(d) and since f(τ′,τˆ ) .
i −i ∈ d∈D i −i ∈ D
that Therefore,reportingtruthfullyalwaysmaximizesanindivid-
ualagent’sutilityandthus(f,p)isstrategyproof.
• Theallocationrulef maximizesthetotalreportedwel-
fareoverthesetofallowedallocations ,thatis, We now prove Lemma 1, recalling that we defined the
D
VCG-basedpaymentruleas
n
(cid:88)
τˆ=(τˆ 1,...,τˆ n):f(τˆ) argmax wˆ i(d) p (τˆ):=wˆ (d∗ ) wˆ (d∗),
∀ ∈ d∈D i=1 i −i −i − −i
where
(cid:0) (cid:1)
• The payment rule p(τˆ) = p 1(τˆ),...,p n(τˆ) charges
d∗
:=argmax(cid:88)
wˆ (d)
agentitheamountaccordingtotheVCG-formula i
d∈S
i
(cid:88) (cid:0) (cid:1) (cid:88)
p (τˆ):= w f(τˆ,τˆ ) +h (τˆ ), d∗ :=argmax wˆ (d).
i − j i −i i −i −i j
j̸=i d∈S j̸=i
whereh ()isanarbitraryfunctionofτˆ .
i −i Lemma1. Let(f,p)beamechanismconsistingofapathal-
·
Ifwedroptherequirementthattheallocationrulef should locationrulef thatsatisfiesMIRwithrangeSandtheVCG-
maximize welfare over all allowed outcomes , we obtain basedpaymentrulep. Then(f,p)isstrategyproof.
D
VCG-basedmechanisms.
Proof. Anagent’sutilityisthen
Definition 4. A VCG-based mechanism is a mechanism
(cid:0) (cid:1) (cid:0) (cid:1)
(f,p),suchthat u i(τˆ)=w i f(τˆ) p i f(τˆ)
−
• Theallocationrulef mapsreportedtypesintothesetof =w i(cid:0) f(τˆ)(cid:1) +(cid:88) wˆ j(d∗) −(cid:88) wˆ j(d∗ −i).
allowedoutcomes . j̸=i j̸=i
D
• Thepaymentrulechargesagentitheamountaccording The mechanism (f,p) thus fulfills the definition of a VCG-
totheVCG-formula. basedmechanismwhere
TheutilityofanagentiunderaVCG-basedmechanismis h (τˆ ):=(cid:88) wˆ (d∗ ).
(cid:0) (cid:1) i −i j −i
given by u (τˆ) = w f(τˆ) p (τˆ). By inserting the pay-
i i − i j̸=i
mentdefinitionviatheVCG-formula,theutilitybecomes
By definition of MIR, f produces the outcome which max-
u (τˆ,τˆ )=w (cid:0) f(τˆ,τˆ )(cid:1) +(cid:88) wˆ (cid:0) f(τˆ,τˆ )(cid:1) h(τˆ ). imizes reported welfare over S, which in particular ensures
i i −i i i −i j i −i −i
− that all outputs of f lie within S. The mechanism (f,p) is
j̸=i
thus a VCG mechanism, whose set of allowable outputs
D
Proposition 3. Let (f,p) be a VCG-based mechanism. As- is the range S. Following Proposition 3’s calculation with
suming that f produces the outcome which maximizes re- f(τ ,τˆ ) argmax g(d) and f(τ′,τˆ ) S, we see
i −i ∈ d∈S i −i ∈
portedwelfareover (i.e.,(f,p)isaVCG-mechanism),then thatagentswhichreporttruthfullyalwaysmaximizetheirutil-
each agent can maxD imize her utility by truthfully reporting ity.
τˆ :=τ ,suchthatwˆ =w .
i i i i
A.2 ProofofLemma2
Proof. To see this, assume that agent i reports truthfully, Lemma 2. Let (f,p) be a mechanism consisting of a path
meaning that τˆ := τ and thus wˆ = w . For d , de- allocation rule f and the VCG-based payment rule p. Let
i i i i
fine g(d) := w i(d)+(cid:80) j̸=iwˆ j(d). Fixing all othe∈ r aD gents’ c i(π i)=max(v i,c i |π i |)asabove. Then
reportsτˆ ,forallpossiblemisreportsτ′ = τ whichagenti (i) Themechanism(f,p)isindividuallyrational.
−i i ̸ i(ii) Forallagentsiandreportedtypesτˆ,p (τˆ) 0. and Mechanism Design. In this experiment on random-32-
i
≥
Thatis,themechanismhasnonegativepayments. 32-20 at 1800 agents, we fix the value distribution as log-
normal (0,1)andvarythecostdistributionfromuniform
Proof. Proving (i): We show that (f,p) ensures that each to (0L ,N 1), (0,0.752), (0,0.52)and (0,0.252).
agent i has a non-negative utility u = w p 0 for all LN LN LN LN
i i i
− ≥
possibleagentreportsτˆ:
(cid:16)(cid:88) (cid:88) (cid:17)
u (τˆ)=wˆ (d∗) wˆ (d∗ ) wˆ (d∗) (1)
i i − j −i − j
j̸=i j̸=i
(cid:88) (cid:88)
= wˆ (d∗) wˆ (d∗ ) (2)
i − j −i
i j̸=i
(cid:88) (cid:88)
wˆ (d∗) wˆ (d∗ ) wˆ (d∗ ) (3)
≥ i − j −i − i −i
i j̸=i
(cid:88) (cid:88)
= wˆ (d∗) wˆ (d∗ ) 0. (4)
i − i −i ≥
i i
Whereeq.(3)usesthatduetoourdefinitionofc (π ), an
i i
agent’s (reported) welfare is always non-negative, and non-
negativityineq.(4)followsduetod∗ bydefinitionbeingthe
(cid:80)
assignmentwhichmaximizes wˆ (d)foralld .
i i ∈D
Proving(ii): Wehaveforalliandreportedtypesτˆ:
p (τˆ)=wˆ (d∗ ) wˆ (d∗)
i −i −i − −i
(cid:88) (cid:88)
= wˆ (d∗ ) wˆ (d∗) 0
j −i − j ≥
j̸=i j̸=i
since d∗ is by definition the assignment that maximizes
(cid:80) −i
wˆ (d)foralld .
j̸=i j ∈D
B AdditionalResults
InFigure4,wetestourmechanismsin3Dmaps,modelinga
UAVairspaceassignmentproblem. Webuildthe3Dmapsby
stackingthecorresponding2DmapsfromtheMAPFbench-
markSternetal. [2019]thatweuseinourotherexperiments
vertically, resulting in 3D maps of height five. MCPP with
100samplesprovesitsscalabilitybyprovidingsolutionswith
a 100% success rate up to thousands of agents on the 3D
random-32-32-20 and 3D Paris-1-256 maps with a runtime
limitof3600s. ItconsiderablyimproveswelfareoverFCFS
while being close to optimal for lower agent levels. Due to
theaddeddegreesoffreedomin3DMAPFproblems,higher
amountsofagentsarerequiredtogeneratesufficientlymany
collisions for FCFS’ random priority ordering allocation to
be notably suboptimal. This is illustrated by the very small
welfare differential between FCFS and the (optimal) PCBS
in the 3D Paris-1-256 map even with many agents, and the
largerwelfaregaininthemuchmoreconstrained3Drandom-
16-16 map,obtainedbytruncatingthe3Drandom-32-32-20
map. Theexperimentfor3Drandom-16-16,unlikeallothers
inthispaper,wasrunonanAMDRyzenThreadripper3990X
with192GBofRAM.
Figure 5 illustrates how choosing non-uniform cost and
valuedistributionsandscalingthedistributionsdifferentlyal-
lowsonetoincreasethemagnitudeofthewelfaredifferential
between our mechanisms (illustrated by MCPP) over FCFS
at will. Uniform distributions, which we use for the main
contents’ experiments, are a standard assumption in MAPFFirst-Come-First-Serve Monte Carlo PP Exhaustive PBS PCBS
1.0 1.0
0.5 0.5
0.0 0.0
5 0 5 0 5 0 5 0 0 0 0 0 0 5 5 5 0 0 0 0 0
1 1 2 2 3 3 4 0 0 0 0 0 1 2 3 0 0 0 0 0
2 4 6 8 0 4 8 2 6 0
1 1 1 2
Number of Agents Number of Agents
600
2000
400
1000
200
0 0
5 0 5 0 5 0 5 0 0 0 0 0 0 5 5 5 0 0 0 0 0
1 1 2 2 3 3 4 0 0 0 0 0 1 2 3 0 0 0 0 0
2 4 6 8 0 4 8 2 6 0
1 1 1 2
Number of Agents Number of Agents
1.0006
1.04
1.0004
1.02
1.0002
1.00 1.0000
5 10 15 20 25 30 35 40 200 400 600 800 1000 15 25 35 400 800 1200 1600 2000
Number of Agents Number of Agents
3Drandom-16-16 3DParis 1 256
Figure4: Successrate,runtime,andratio-to-baselineofsocialwelfareforMCPPandFCFS(thebaseline)in3Dversionsofourbenchmark
maps.Solidlinesindicatetheaveragevalueover100instances,whiletheshadedareaisthe95%confidenceinterval.Ifamechanismfailsto
achievea100%successrate,wedonotplottheirwelfareforthatnumberofagents.
1.6
1.5
1.4
1.3
1.2
1.1
Uniform (0,12) (0,0.752) (0,0.52) (0,0.252)
LN CostLDNistributioLnN LN
Figure 5: Social welfare suboptimality in random-32-32-20 map
withMCPP,at1800agents.Allrunsuseastandardlog-normalvalue
distribution. Wevarytheircostdistributionsfromuniformonesto
differentlyscaledlog-normalones.
SFCF
/w
viD
WS
emitnuR
etaR
sseccuS
SFCF
/w
viD
WS
emitnuR
etaR
sseccuS
SFCF
/w
viD
WS