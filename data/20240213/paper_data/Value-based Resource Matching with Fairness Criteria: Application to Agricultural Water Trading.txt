Value-based Resource Matching with Fairness Criteria:
Application to Agricultural Water Trading
AbhijinAdiga∗ YohaiTrabelsi∗ TanvirFerdousi
UniversityofVirginia Bar-IlanUniversity UniversityofVirginia
Charlottesville,VA,USA RamatGan,Israel Charlottesville,VA,USA
MadhavMarathe S.S.Ravi SamarthSwarup
UniversityofVirginia UniversityofVirginia UniversityofVirginia
Charlottesville,VA,USA Charlottesville,VA,USA Charlottesville,VA,USA
AnilKumarVullikanti MandyL.Wilson SaritKraus
UniversityofVirginia UniversityofVirginia Bar-IlanUniversity
Charlottesville,VA,USA Charlottesville,VA,USA RamatGan,Israel
ReetwikaBasu SupriyaSavalkar MatthewYourek
WashingtonStateUniversity WashingtonStateUniversity WashingtonStateUniversity
Pullman,WA,USA Pullman,WA,USA Pullman,WA,USA
MichaelBrady KirtiRajagopalan JonathanYoder
WashingtonStateUniversity WashingtonStateUniversity WashingtonStateUniversity
Pullman,WA,USA Pullman,WA,USA Pullman,WA,USA
ABSTRACT KEYWORDS
Optimalallocationofagriculturalwaterintheeventofdroughts Watermarkets,bipartitematching,welfaremaximization,fairness,
isanimportantglobalproblem.Inaddressingthisproblem,many integerlinearprogram,complexity
aspects,includingthewelfareoffarmers,theeconomy,andthe
environment,mustbeconsidered.Underthisbackdrop,ourworkfo- ACMReferenceFormat:
cusesonseveralresource-matchingproblemsaccountingforagents AbhijinAdiga,YohaiTrabelsi,TanvirFerdousi,MadhavMarathe,S.S.Ravi,
withmulti-cropportfolios,geographicconstraints,andfairness. SamarthSwarup,AnilKumarVullikanti,MandyL.Wilson,SaritKraus,
ReetwikaBasu,SupriyaSavalkar,MatthewYourek,MichaelBrady,Kirti
First,weaddressamatchingproblemwherethegoalistomaximize
Rajagopalan,andJonathanYoder.2024.Value-basedResourceMatching
awelfarefunctionintwo-sidedmarketswherebuyers’require-
withFairnessCriteria:ApplicationtoAgriculturalWaterTrading.InFull
mentsandsellers’suppliesarerepresentedbyvaluefunctionsthat
versionofthepaperappearinginProc.ofthe23rdInternationalConferenceon
assignprices(orcosts)tospecifiedvolumesofwater.Forthesetting AutonomousAgentsandMultiagentSystems(AAMAS2024),Auckland,New
wherethevaluefunctionssatisfycertainmonotonicityproperties, Zealand,May6–10,2024,IFAAMAS,17pages.
wepresentanefficientalgorithmthatmaximizesasocialwelfare
function.Whenthereareminimumwaterrequirementconstraints,
wepresentarandomizedalgorithmwhichensuresthatthecon- 1 INTRODUCTION
straintsaresatisfiedinexpectation.Forasingleseller–multiple
1.1 Background
buyerssettingwithfairnessconstraints,wedesignanefficiental-
gorithmthatmaximizestheminimumlevelofsatisfactionofany Thegrowthintheglobalpopulationhasledtoasignificantin-
buyer.Wealsopresentcomputationalcomplexityresultsthathigh- creaseindemandforagriculturalandurbanwatersupplies[17].
lightthelimitsonthegeneralizabilityofourresults.Weevaluate However,watersupplyaugmentationhasreacheditslimit[9].Fur-
thealgorithmsdevelopedinourworkwithexperimentsonboth thermore,climatechangehasledtoanincreasedoccurrenceof
real-worldandsyntheticdatasetswithrespecttodroughtseverity, droughts,which,inturn,leadtoseverewatershortages[23].Water
valuefunctions,andseniorityofagents. marketshavebeenwidelyproposedasaneffectivemeansofwater
reallocationduringsuchshortages[9],andseveralformalandinfor-
malmarketshaveemergedacrosstheworld[21,22,50].Awidely
∗Bothauthorscontributedequallytothiswork. proposed(butmuchdebated)approachissociallyoptimalwater
allocation,wherewateristransferredfromlow-valuetohigh-value
agriculturalapplications[9,21,51].Muchoftheworkinthisregard
FullversionofthepaperappearinginProc.ofthe23rdInternationalConferenceon
AutonomousAgentsandMultiagentSystems(AAMAS2024),N.Alechina,V.Dignum, hasfocusedonelaboratemodelingofagricultural,hydrological
M.Dastani,J.S.Sichman(eds.),May6–10,2024,Auckland,NewZealand.©2024Interna- andeconomicaspectsoftheproblemasexploredthroughcomplex
tionalFoundationforAutonomousAgentsandMultiagentSystems(www.ifaamas.org).
agent-basedmodels(see,e.g.,[3,38,39,42]).Somereferenceshave
ThisworkislicencedundertheCreativeCommonsAttribution4.0International(CC-
BY4.0)licence. addressedcomputationalaspectsofsuchmodels(see,e.g.,[28,29]).
4202
beF
21
]SD.sc[
2v67560.2042:viXraWhileourworkisapplicabletomanywatermarketsettings,itis allthelowerboundconstraintsisitselfNP-complete.Whenasolu-
motivatedbytheriverwaterallocationmechanismsforagriculture tionsatisfyingalltheconstraintsisknowntoexistandthevalue
inthewesternUS[4,5,26].Here,waterisallocatedaccordingtothe functionssatisfymonotonicityproperties,wepresentanefficient
priorappropriationdoctrine,whichinducesaseniorityordering randomizedalgorithmtofindasolutionthatmaximizeswelfare
amongfarmers[9,37].Whenwateriscurtailedduetoshortages,it andsatisfiesthegivenlowerboundconstraintsinexpectation.To
ismadeavailabletoonlythosewaterrightsholderswhoareabove obtainthisresult,weusethedependentroundingalgorithmof[19]
asenioritythresholdchosenbyappropriateauthoritiesbasedon andleveragemonotonicitypropertiesofvaluefunctions.
thedroughtseverity.Thisnaturallypartitionsthesetoffarmers
MaximizingLeximinsatisfaction.Weconsiderthespecialcase
into two groups: potential sellers and potential buyers, leading
ofasingleseller–multiplebuyerswhereeachbuyerspecifiesthe
to a two-sided market. An example is provided in Figure 1. In
requirednumberofwaterunits.Thesatisfactionlevelofabuyer
addition,therearescenariosinvolvingexternalentities,suchas
isthefractionofherrequirementthatisallocated.Weconsider
wateraggregatorsorbrokers,whopoolwaterfrommultiplesellers
theproblemwheretheobjectiveistofindatradingassignment
(see,e.g.,[26,32,41])andsellittobuyers.
Underthisbackdrop,wefocusonaclassofvalue-basedresource thatmaximizesthesatisfactionleveloftheleastsatisfiedbuyer.We
provideanefficientalgorithmthatfindsavalidtradingassignment
matchingproblems.Weconsiderasetofagents(farmers),each
satisfyingthefollowingdesirableproperties:(i)itmaximizesthe
associatedwithadiscreteorderedsetofresources(unitvolumesof
water,orsimplywaterunits).Eachwaterunitisassociatedwitha numberofresourcesmatchedoverallvalidassignments(thusmax-
value,whichdependsonwhatusethatunitofwaterisbeingputto imizingsellerprofit),and(ii)inleximinorder[33],thevectorof
buyersatisfactionlevelsisatleastaslargeasthatofanyothervalid
(low-valueorhigh-valuecrops).Sincefarmerscanhavemulti-crop
assignment.Theuseofleximinorderasafairnesscriterionhasalso
portfolios,thevalueofwaterunitsmayvary,notonlyfromone
beenstudiedinseveralothercontexts(see,e.g.,[8,34]).
agenttoanother,butalsowithinanagent’sresourceset.Broadly,
ourworkisapplicabletomanymarketsettingsthatinvolvemultiple Experiments.Wepresentresultsfromexperimentswithaclass
identicalunitsofresources,suchasfinancialmarkets,electricity,
ofsyntheticdatasetsandtworeal-worlddatasets.Thelattercor-
CPUjobscheduling,andbandwidthallocation[12,24,40].
respondtotwowaterbasinsinthestateofWashington,US.We
In a two-sided market where the agents are partitioned into
studytheimpactoffactors,suchasdroughtseverity,valuefunc-
sellersandbuyersbyseniority,aseller’svalueforawaterunitcan
tions,andfarmerseniority,onthecompatibilitygraphstructure
beconsideredtheminimumpricetheselleriswillingtoaccept,
andobjectivesoftradingassignments(e.g.,welfaremaximization,
while,forabuyer,itisthemaximumpricethebuyeriswilling
maximizingsatisfactionlevelsofbuyers).Ourresultsshowthat
topay.Additionally,duetogeographicandlegalconstraints,not
thecombinedeffectsofseniority,cropprofile,andgeographiccon-
every buyer is compatible with a seller for trading water. This
straintscanleadtovariedtradeoutcomesacrossdifferentdatasets.
relationshipisrepresentedbyabuyer–sellerbipartitecompatibility
graph;seeFigure1foranexampleofstreamflowandtheresulting
2 RELATEDWORK
compatibilitygraph.Theobjectiveistoobtainatradingassignment,
thatis,amatchingofsellers’resourceswithbuyers’needs,subject Manyworkshaveproposedmechanismsforoptimalmatchingof
tocompatibilityandvalueconstraints.Wewillassumethatthe buyerstosellersinthecontextofwatermarkets.Xuetal.[51]con-
agentsaretruthfulabouttheirvaluations.Everytradingassignment sideratwo-sidedmarketwithsimplerlinearvaluefunctionswhere
isassessedbythetotalsocialwelfareitgenerates[29,51]. theyfirstapplyweightedbipartitematchingtoachievewelfare
maximization.Then,theysettransactionpricesforeachassign-
1.2 Contributions mentinthematching.Inasingle-seller/multiple-buyersframework,
RaffenspergerandMilke[38,39]useamultipartbiddingframework
Maximizingwelfareundermonotonicityconstraints.Wecon-
whereabuyer’swillingnesstopayismodeledasamonotonenon-
sidertheresourcematchingproblem(MaxWelfare),wherethe
increasingfunctionofthevolumeofwatertraded.Theydevelop
goalistomaximizethetotalwelfare.Weshowthatifthevaluefunc-
alinearprogrammingformulationthatmaximizestheconsumer
tionssatisfycertainmonotonicityproperties(undertheassumption
surplus.Usingasimilarframeworkbutaccountingforwaterqual-
thateveryagentisrationalorprofit-maximizing[6,11,38]),anop-
ity,SharghiandKerachian[42]proposeamulti-agentoptimization
timalmatchingcanbeobtainedinpolynomialtime.Weachievethis
model.Noorietal.[35]incorporatefairnesscriteriaintotheirmod-
bytransformingthetradingassignmentproblemintothemaximum
elsbyrequiringthateachbuyershouldreceiveacertainminimum
weightedmatchingproblemonabipartitegraph.Tocomplement
amountofwaterdependingonthebuyer’sdemand.Theabove
theaboveresult,weshowthatMaxWelfareisNP-hardevenwhen
paperstypicallyalsoaccountforavarietyofagriculturalandsocio-
themonotonicityconstraintsareviolatedonlyonthebuyer’sside.
economicfactors,resultinginverycomplexoptimizationproblems
Maximizingwelfareunderfairnessconstraints.Weconsider thataresolvedusingheuristics.Asmentionedearlier,ourwork
theproblem(MaxWelfareFair)ofmaximizingwelfarewiththe isapplicabletosettingsthatinvolveindistinguishableunitsofa
additionalconstraintthat,forspecifiedsubsetsofbuyers(where resource.Insuchasetting,SandholmandSuri[40]considerthe
thesubsetsmayalsobesingletons),aminimumnumberofwater problemofoptimalclearingwheresellersandbuyersspecifybids
unitsmustbeassigned.Suchconstraintscanbeviewedasaformof throughsupplyanddemandcurves.
enforcingdemographicfairness.Ingeneral,weshowthattheprob- Toourknowledge,veryfewpapershaveaddressedcomputa-
lemofdeterminingwhetherthereisanassignmentthatsatisfies tionalaspectsofwatermarkets.Liuetal.[29]considertheproblem2 3 1 1 4 1 (15) (27) 4
6 4 2(19) (25) 4
2 3 2 5
1 Drought
cutoff 3 (21) (23) 5
6 4
3 6
5
Sellers Buyers 3(23) (29) 6
Stream flow and 5 Sellers’ Buyers’
points of diversion Induced partial order Induced compatibility graph water units water units
Figure1:Example.Goingfromlefttoright,thefirstpanelshowsasamplestreamflowandpointsofdiversionfordifferenttradingagents.
Inthesecondpanel,eachdirectededge(𝑎,𝑏)indicatesthat𝑎 >𝑏,thatis,𝑎hashigherprioritythan𝑏.Whenthereisnodirectededge
betweentwonodes,theinterpretationisthattheybelongtodifferentstreams.Thedroughtcutoffcorrespondstothescenariowherewater
isavailabletoagents1,2,and3.Inthecompatibilitygraphshowninthethirdpanel,waterunitsandtheirvalueshavenotyetbeenfactored
in.Therightmostpanelshowsthecorrespondingresources–needsbipartitegraphalongwiththewaterunitsofthebuyersandsellersand
thecorrespondingcompatibilitygraph.Here,Seller3has,andBuyer4needs,twowaterunits,whiletheothershaveorneedonlyonewater
uniteach.Thevaluesofthewaterunitsareshowninparentheses.
ofoptimaltradingassignmentsinwaterrightmarkets.Theycon- (e.g.,croptype,whichfielditisappliedtoinafarm),anditsvalue
sidertwomaximizationobjectives–socialwelfareandflow–witha cancorrespondtotheanticipatedprofit,itsimportancetokeepthe
minimumthresholdconstraintonthevolumeofwatertradedin cropaliveorhealthy,etc.(see,e.g.,[38]).TheexampleinFigure1
eachtransaction.Theyconsiderasettingwithlinearvaluefunc- showsagentswithassociatedresourcesandvaluefunctions.
tions,wheretheproblemofmaximizingwelfarecanbeviewed Buyers,sellers,andtrading.Dependingonwateravailability,
asmaximizingflowsinaweightedseller–buyerbipartitegraph. theagentset𝐴ispartitionedintotwosets,namelysellers𝑆 and
Lietal.[28]considerthesamesettingandexaminetheassignment buyers 𝐵. We let 𝑁 𝑆 = |𝑆| and 𝑁 𝐵 = |𝐵|. Each seller𝑠 has𝛾 𝑠
problemfromtheperspectiveofcooperativegametheory.Both waterunits,whichistheagent’scapacity,whileeachbuyer𝑏hasa
workspresentexperimentalresultsusingwatermarketdata. requirementof𝛾 𝑏waterunits.AtradingassignmentT consistsofa
Ourworkisalsorelatedtoresourceallocationproblemsthatare matchingofbuyerwaterunitswithsellerwaterunits;itisspecified
modeledasmulti-roundmatchings[45]andrepeatedmatchings[7]. byasetoforderedpairsoftheform(𝑤 𝑖𝑠,𝑤𝑏 𝑗).
Inbothcases,theproblemcanbeviewedasamatching(ora𝑏-
Compatibility.Aseller𝑠iscompatiblewithabuyer𝑏if𝑏isallowed
matching)problem[30]onabipartitegraph,withmultiplecopies
tousethewaterrightownedby𝑠.Thiscompatibilityrelationship
ofnodescorrespondingtoeachresourceoragent.Thisissimilar
isdeterminedbygeographicfactorssuchaswhethertheyshare
toourwork,wherethewaterunitscorrespondingtoeachselleror
acommonstreamandprevailingwaterlaws.Thisrelationshipis
buyerarerepresentedasnodesofabipartitegraph.
representedbyaseller–buyer(undirected)bipartitecompatibility
Severalrecentpapershaveaddressedfairnessissuesinbipartite
graph𝐺(𝑆,𝐵,𝐸);aseller𝑠 ∈𝑆iscompatiblewithabuyer𝑏 ∈𝐵if
matching.Forexample,Lesmanaetal.[27]developanalgorithm
andonlyifthereisanedgebetween𝑠and𝑏in𝐺.Theexamplein
withprovableguaranteesforthetrade-offbetweenoperatorbenefit
Figure1(thirdpanel)showsacompatibilitygraphinducedbythe
(inourcase,asingleseller)andtheminimumsatisfactionorutility
geographicpositionsofagentsandwateravailability.
forthecustomer(inourcase,abuyer).Esmaeilietal.[16]consider
Totalvalueandwelfarefromtrade.Weassumethateverywater
Rawlsianfairnessinonlinebipartitematchings.Methodstoachieve
unit will be used regardless of whether it is traded or not. If a
groupfairnesshavealsobeenconsideredinbothofflineandonline
waterunitistraded,thenitisusedbythecorrespondingbuyer;
versionsofthebipartitematchingproblem[16,31,36].
otherwise,itisusedbytheseller.Thevalueextractedfromeach
3 PRELIMINARIES waterunitwilldependonwhousesit(thesellerorbuyer)and
L ree at l[ n𝑘 u] mde bn eo rt se .theset{1,2,...,𝑘}andR ≥0bethesetofnonnegative
h buo yw eri ’t si us nu itse 𝑤d
𝑏
𝑗. ,F to hr enex ita sm np ewle, vi af lua es ie sll 𝑓e 𝑏r (’ 𝑤s
𝑏
𝑗u )n .i Tt h𝑤 e𝑖𝑠 tois tam lva at lc uh ee bd et foo ra
e
A deg ne on tt es t, hr ees so eu tr oc fe 𝑁s, aa gn ed nv tsa .l Tu he efu agn ec nt ti son ars e.L oe rt d𝐴 ere= d{ b𝑎 y1, s𝑎 e2 n, i. o. r. it, y𝑎 ;𝑁 𝑎}
𝑖
t lera td 𝑊e Tis d𝜎 e0 no= te(cid:205) th𝑠∈ e𝑆 se(cid:205) t𝑤 o∈ fΓ m𝑠 a𝑓 𝑠 tc(𝑤 he) d.G rei sv oe un ra cet sra od fi sn eg llea rs ssi ag nn dm le en tt 𝑊T T,
denotethesetofunmatchedresourcesofsellers.Thetotalvaluefor
Ti os r hds ee en ere li eo d mr st eeo nt𝑎 tΓ s𝑎𝑗 of =o fr Γ{ 𝑎a 𝑤n a1𝑎y r, e𝑤𝑖 o> 2𝑎 r, d·𝑗 e. · rE · ea , d𝑤c sh 𝛾𝑎 o𝑎a t}g he o an f tt 𝛾 f𝑎 o𝑎 r∈ r ae𝐴 ls lo 𝑥i us r <a cs e 𝑦s so ,o wc ria awt te ead rte uw r ni u it th n 𝑤ia t 𝑥n 𝑎s. wa eg li fv ae rn e(t Tra )d =in (cid:205)ga (𝑤ss 𝑖𝑠i ,g 𝑤n 𝑏 𝑗m )∈e Tn [t 𝑓 𝑏T (𝑤is 𝑏 𝑗𝜎 )−(T 𝑓 𝑠) (𝑤= 𝑖𝑠𝜎 )]0 .+ Now teel tf ha are t( thT e) ww eh lfe ar re e
mustbesoldorboughtbeforethewaterunit𝑤𝑎 𝑦;weusethenotation functiondoesnotaccountforprofitsofindividualagents,whichis
𝑤 𝑥𝑎 ≺𝑤𝑎 𝑦toindicatethisordering.Avaluefunction𝑓
𝑎
:Γ
𝑎
→R
≥0
determinedbythetransactionpriceforeachtrade.
assignsanonnegativevalue𝑓 𝑎(𝑤)toeach𝑤 ∈Γ 𝑎.Eachwaterunit Remark3.1. Here,weassumethatthevaluefunctionsarepublic.
ofanagentcanbeconsideredtobeassociatedwithaspecificuse Wealsoassumethatthevalueofeachwaterunitremainsthesameregardlessoftherole(buyerorseller)oftheagentassociatedwith buyerwaterunit𝑤𝑏 𝑗 ofagent𝑏 ∈ 𝐵,wecreateanode𝑏 𝑗 in𝐺′.
it.Ingeneral,thisneednotbethecase.Forexample,ifanagent Let𝐵′ = {𝑏 𝑗 | ∀𝑏 ∈ 𝐵, 𝑤𝑏 𝑗 ∈ Γ 𝑏}and𝑆′ = {𝑠 𝑖 | ∀𝑠 ∈𝑆, 𝑤 𝑖𝑠 ∈ Γ 𝑠}.
riskslosingacropthatcorrespondstoamulti-yearinvestment,she Theedgeset𝐸′isdefinedasfollows:(𝑠 𝑖,𝑏 𝑗) ∈𝐸′ifandonlyif(i)𝑏is
vm ai lg uh et ob fe thw eil cli rn og p.to Wp ea ay lsm ou ac sh sum mo er te hf ao tr et vh ee ryw aa gte er nt th pa an rtt ih ce ipa an ten su ia nl compatiblewith𝑠in𝐺(i.e.,{𝑠,𝑏}∈𝐸)and(ii)𝑓 𝑏(𝑤𝑏 𝑗) ≥ 𝑓 𝑠(𝑤 𝑖𝑠).The
themarketasasellerorabuyer.Thisalsoneednotbethecase
weight𝛼 𝑒oneachedge𝑒 ={𝑠 𝑖,𝑏 𝑗}isgivenby𝛼
𝑒
=𝑓 𝑏(𝑤𝑏 𝑗)−𝑓 𝑠(𝑤 𝑖𝑠).
inreal-life;forexample,somefarmersareknowntoexhibitnon- (SeetherightmostpanelinFigure1foranexample.)
pecuniarybehavior[3,10],thatis,theywouldreducetheirgains
byoptingtofarmratherthanselltheirwater. Algorithm1:MaxWelfarewithmonotonevaluefunc-
tions.
4 MAXIMIZINGWELFARE
Input :Buyerset𝐵,sellerset𝑆,compatibility
4.1 ProblemDefinition graph𝐺(𝑆,𝐵,𝐸),valuefunctions𝑓 𝑎(·),∀𝑎∈𝑆⊎𝐵
Wenowdefineawelfaremaximizingresourcematchingproblem thatsatisfytheconditionsofTheorem4.1.
wherethegoalistomatchsellers’resourcestobuyers’needssuch 1 Constructresources–needscompatibility
that,foreachagent,thematchingrespectsthevalue-basedordering
graph𝐺′(𝐵′,𝑆′,𝐸′).
oftheresources,i.e.,ifaresourceismatchedinasolution,thenall 2
FindamaximumweightedmatchingMof𝐺′.
unitsvaluedhigherthanthisresourceintheagent’sportfolioare 3 LettradingassignmentT =∅.
alsomatched.Also,foreverymatchedresource,thevalueassigned 4 for(𝑠 𝑖,𝑏 𝑗) ∈Mdo
toitbythesellerisatmostthevalueassignedbythebuyer. 5 Add(𝑤 𝑖𝑠,𝑤𝑏 𝑗)toT.
Problem1(MaximumWelfareWaterTradingproblem–MaxWel- 6 while∃𝑎∈𝐵⊎𝑆and∃𝑖 >1s.t.𝑤 𝑖𝑎ismatchedinT but
vfa alr ue e). fuG ni cv te ion ns se ,t as no dfs ae cll oe mrs p𝑆 a, tb ibu iy lie tyrs g𝐵 r, at ph hei 𝐺rw (𝑆a ,t 𝐵e ,r 𝐸u )n ,i fits n, das as to rc ai da it ned
g 7
𝑤 𝑖𝑎
− R1
epis lan co et 𝑤d 𝑖𝑎o
with𝑤 𝑖𝑎 −1inT.
assignmentT∗thatmaximizesthewelfarefunctionwelfare(·)sub- Output:TradingassignmentT
jecttothefollowingconstraints:(i)Buyervaluestheunitatleastas
muchastheseller:foreverymatchedpair(𝑤 𝑖𝑠,𝑤𝑏 𝑗)where𝑤 𝑖𝑠 isthe
𝑖thunitofseller𝑠and𝑤𝑏
𝑗
isthe𝑗thunitofbuyer𝑏,𝑓 𝑏(𝑤𝑏 𝑗) ≥ 𝑓 𝑠(𝑤 𝑖𝑠), ProofofTheorem4.1. ForamatchingMin𝐺′,letweight(M)
denotethesumoftheweightsofalltheedgesinM.Notethatany
and(ii)Matchingisconsistentwithorderingofresources:forany
agent𝑎∈𝑆∪𝐵and𝑖 >1,𝑤 𝑖𝑎 ismatchedonlyif𝑤 𝑖𝑎 −1ismatched. t (r 𝑠a 𝑖,d 𝑏in 𝑗)g ∈ass Mign im fe an nt dT onc lyor ir fes (p 𝑤o 𝑖𝑠n ,𝑤ds 𝑏 𝑗t )o ∈a u Tn .iq Au le som
,
wat ec ih gi hn tg (Min )𝐺 =′:
Henceforth,werefertoatradingassignmentthatsatisfiesthetwo (cid:205) 𝑒∈M𝛼 𝑒 = (cid:205) 𝑒={𝑠𝑖,𝑏𝑗}[𝑓 𝑏(𝑖) − 𝑓 𝑠(𝑗)] = welfare(T).Hence,the
conditionsaboveasavalidtradingassignment. maximumwelfarethatcanbeachievedfromanyT isatmostthe
weightofanymaximumweightedmatchingof𝐺′.
4.2 MonotoneValueFunctions
WenowshowthattheoutputofAlgorithm1satisfiesthepriority
Here,weshowthat,withcertainmonotonicityconstraintsonvalue constraintsdefinedinProblem1.SinceMisamaximumweighted
functions,theMaxWelfareproblemcanbesolvedefficiently.The matching,T correspondstoanassignmentwithmaximumwel-
conditionsareasfollows.Foreachseller𝑠,thevaluefunctionis fare.However,itmightnotsatisfythepriorityconstraintsstated
(m f io .eo r .n ,eo 𝑓a 𝑏t co (h 𝑤ne b 𝑖𝑠un )yo ≤en r- 𝑓d 𝑏 𝑏e , (c 𝑤tr h 𝑖e 𝑠e −a 1s vi )an flg u ore(i. afe u l. l, n 𝑖𝑓 c𝑠 >t( i𝑤 o 1n𝑖𝑠 ).) i Ts≥ hm e𝑓 s𝑠 o e( n𝑤 co o𝑖𝑠 t− o rr1 n e) e sf po n or o na n dl -l i t𝑖 n oc> rr ae1 ta) iosa i nn n ad g l, i ∃ in s𝑎 nP ∈ or to .𝐵b Wle ⊎m it𝑆 h,1 os. uuS tcu h lp op sth so as ote f,T f go er nis s eo rn amo lit e tya 𝑖 ,v l> ea tl 1i 𝑎d ,𝑤t ∈r 𝑖𝑎a 𝐵d isi .n Lmg ea ta ts c (s 𝑤hig e 𝑖𝑠n d ,𝑤m b
𝑎
𝑗e u )n tt 𝑤 ∈, 𝑖i 𝑎. − Te 1.,
.
orprofit-maximizingagents;asellerwouldsellthefirstassigned LetT′=(T \{(𝑤 𝑖𝑠,𝑤𝑎 𝑗)})∪{(𝑤 𝑖𝑎 −1,𝑤𝑏 𝑗)}.Since(𝑤 𝑖𝑠,𝑤𝑎 𝑗) ∈ T,𝑎
resourcethatwasmeantforthelowestvaluedusewhileabuyer iscompatiblewith𝑠,i.e., (𝑠,𝑎) ∈ 𝐸 and 𝑓 𝑎(𝑤𝑎 𝑗) ≥ 𝑓 𝑠(𝑤 𝑖𝑠) byour
willusethefirstassignedresourceforthehighestvalueduse. construction of the bipartite graph𝐺′. Since 𝑓 𝑎 is a monotone
Theorem4.1. Supposewearegivenasetofsellers𝑆,buyers𝐵,their non-increasingfunction,𝑓 𝑎(𝑤𝑎 𝑗−1) ≥ 𝑓 𝑎(𝑤𝑎 𝑗).Hence,T′isalsoa
respectivewaterunits,acompatibilitygraph𝐺(𝑆,𝐵,𝐸),andvalue validassignment.Also,since𝑓 𝑎(𝑤𝑎 𝑗−1)−𝑓 𝑠(𝑤 𝑖𝑠) ≥ 𝑓 𝑎(𝑤𝑎 𝑗)−𝑓 𝑠(𝑤 𝑖𝑠),
functionssatisfyingthefollowingcriteria:∀𝑠 ∈𝑆,𝑓 𝑠 isamonotone welfare(T′) ≥welfare(T),whichimpliesthatthenewassignment
non-decreasingfunctionand∀𝑏 ∈𝐵,𝑓 𝑏isamonotonenon-increasing doesnotreducewelfare.(Infact,thewelfarecannotincreasesince
function.Inthissetting,MaxWelfarecanbesolvedintimepolyno- T has the maximum welfare value.) The same argument holds
mialinthetotalnumberofwaterunits. foreveryiterationintheloopdefinedonLine6inthealgorithm.
Notingthatthemaximumweightedbipartitematchingcanbecom-
WeshowthatAlgorithm1solvesMaxWelfareformonotonevalue
putedinpolynomialtime,thetheoremfollows.Fordetailsonthe
functions.Westartwiththefollowingdefinition. runningtime,seesupplement. □
Resources–needscompatibilitygraph.Giventhecompatibility
graph𝐺(𝑆,𝐵,𝐸) andthevaluefunctions,weconstructanedge- Non-monotonevaluefunctions.Onemayaskwhetheraneffi-
weightedbipartitegraph𝐺′(𝑆′,𝐵′,𝐸′)asfollows.Foreachseller cientalgorithmispossibleunderweakerassumptionsonthevalue
waterunit𝑤 𝑖𝑠 ofagent𝑠 ∈𝑆,wecreateanode𝑠 𝑖 in𝐺′.Foreach functions.WenowconsideraversionoftheMaxWelfareproblemwherethevaluefunctionsforsellersaremonotonenon-decreasing, MaxWelfareFairalsoinvolvesmatching-relatedconstraints.For
whilethoseforthebuyersarenotrequiredtosatisfythemonotone thisproblem,wheneverasolutionwhichsatisfiesalltheconstraints
non-increasingproperty.Ournextresultpointsoutthecomplexity exists,weshowbelow(Theorem5.1)thatthereisapolynomialtime
oftheMaxWelfareproblemforthatsetting. randomizedalgorithmtomaximizethewelfare.
Theorem4.2. Givenasetofsellers𝑆,buyers𝐵,theirwaterunits, Theorem5.1. LetMdenotethesetofalltradingassignmentsT
compatibilitygraph𝐺(𝑆,𝐵,𝐸),andvaluefunctionssatisfyingthe whichsatisfythelowerboundconstraintsassociatedwithall𝐿∈L.
followingcondition:∀𝑠 ∈ 𝑆,valuefunction 𝑓 𝑠 isamonotonenon- SupposeM ≠∅.If𝑓 𝑠 and𝑓 𝑏 havethesamemonotonicityproperties
decreasingfunction,MaxWelfareisNP-hard. asinTheorem4.1,thereisapolynomialtimerandomizedalgorithm
tofindatradingassignmentT satisfyingthefollowingproperties:
ProofIdea:OurreductionisfromtheExactCoverby3-Sets
(1)(Singlebuyerconstraint)foreach𝐿 ∈ L suchthat|𝐿| = 1,the
problem;seeSectionB.2ofthesupplement.
amountofwaterassignedisatleast𝑟(𝐿);(2)(Demographicconstraint)
Remark4.3. ByexaminingourproofofTheorem4.2,itcanbe foreach𝐿 ∈ L where|𝐿| > 1,thelowerboundconstraintfor𝐿is
seenthattheMaxWelfareproblemishardwhenvaluefunctions satisfiedinexpectation,and(3)theexpectedwelfareof T isatleast
(forboththesellersandbuyers)arethresholdfunctions(i.e.,they themaximumwelfareamongalltheassignmentsinM.
haveanon-zerovalueonlywhenthenumberofwaterunitssold
Proof. Let𝐺′(𝑆′,𝐵′,𝐸′)betheresources-needscompatibility
byasellerorassignedtoabuyerisatleastagivenpositiveinteger).
Thus,theproblemofmaximizingwelfareisNP-hardwhenagents
graph.Recallthatin𝐺′,𝑠
𝑖
representsthe𝑖thwaterunitofseller𝑠,
and𝑏
𝑗
representsthe𝑗thwaterunitofbuyer𝑏.Foranode𝑣in𝐺′,
havealowerboundonthenumberofwaterunitstheysell/buy
beforeatradeprovidesvaluetoanagent. let𝑁(𝑣) denotethesetofneighborsof𝑣.Let𝛼 𝑠𝑖𝑏𝑗 = 𝑓 𝑏(𝑤𝑏 𝑗) −
𝑓 𝑠(𝑤 𝑖𝑠)betheweightontheedge(𝑠 𝑖,𝑏 𝑗) ∈𝐸′.Weformulatethe
5 RESOURCEMATCHINGWITHFAIRNESS followinglinearprogram(LP)withavariable𝑧 𝑠𝑖𝑏𝑗foreachpossible
assignment(𝑠 𝑖,𝑏 𝑗)intheresource–needscompatibilitygraph.
Here,wepresenttworesultsincorporatingfairnesscriteriacorre-
∑︁
spondingtothebuyers.Thefirstresultisonmaximizingwelfare max 𝛼 𝑠𝑖𝑏𝑗𝑧 𝑠𝑖𝑏𝑗
subjecttolowerboundsonthenumberofwaterunitsassignedto
groupsofbuyers.ThesecondproblemaddressesLeximinfairness, ∀(𝑠 𝑖,𝑏 𝑗) ∈𝐸′, 𝑧 𝑠𝑖𝑏𝑗 ≥0, (1)
whichisageneralizationofRawlsianfairness.
5.1 Buyers’LowerBoundFairnessConstraints ∀𝑏 𝑗 ∈𝐵′, ∑︁ 𝑧 𝑠𝑖𝑏𝑗 ≤1; ∀𝑠 𝑖 ∈𝑆′, ∑︁ 𝑧 𝑠𝑖𝑏𝑗 ≤1, (2)
𝑠𝑖∈𝑁(𝑏𝑗) 𝑏𝑗∈𝑁(𝑠𝑖)
Let L = {𝐿 | 𝐿 ⊆ 𝐵} beacollectionofsubsets1 ofbuyers.For
each𝐿 ∈L,let𝑟(𝐿)beapositiveintegerdenotingtheminimum
∀𝐿∈L,
∑︁∑︁
𝑧 𝑠𝑖𝑏𝑗 ≥𝑟(𝐿). (3)
(total)numberofwaterunitstobeassignedtothebuyersin𝐿.Note
𝑏∈𝐿𝑠,𝑖,𝑗
that𝐿cancorrespondtoasinglebuyeraswell.
Theconstraintsin(2)correspondtomatchingconstraints,while
Problem2(MaximumWelfareWaterTradingwithbuyers’lower thosein(3)capturethefairnessconditions.Becauseofourassump-
boundFairnessconstraints(MaxWelfareFair)). Givensetsof tionregardingfeasibility,thereisanoptimalfractionalsolution𝑧to
sellers𝑆,buyers𝐵,associatedvaluefunctions,collectionofsub- theaboveLP.Notethatthesolution𝑧willsatisfythepropertythat
setsL,function𝑟 :L→Z >0,andacompatibilitygraph𝐺(𝑆,𝐵,𝐸), if𝑧 𝑏𝑖𝑠𝑗 >0,itmustbethecasethat(cid:205) 𝑠′𝑗′𝑧 𝑏(𝑖−1)𝑠′𝑗′ =1.Otherwise,
find a trading assignment T∗ that maximizes the welfare func- wecanmodifythefractionalsolutioninthesamewayasinthe
tionwelfare(·)underthefollowingconstraints:(i)foreverymatched proofofTheorem4.1andachievethisproperty.
pair(𝑤 𝑖𝑠,𝑤𝑏 𝑗)where𝑤 𝑖𝑠 isthe𝑖thunitofseller𝑠and𝑤𝑏
𝑗
isthe𝑗th Weusethedependentroundingalgorithmof[19],whichrounds
𝐿u ann ∈dit L𝑖o > ,f tb 1 hu , e𝑤y ne 𝑖𝑎 ur mi𝑏 s b, m e𝑓 𝑏 rat( oc𝑤 fh𝑏 𝑗 we) d ato≥ en rl𝑓 y u𝑠 ni( f𝑤 it𝑤 s𝑖𝑠 𝑖) 𝑎 a−,
s1
s(i ii i g) s nmf eo dar t tca ohn 𝐿ey d ia , sg a ane tn d lt e( ai𝑎 i si) t∈ f 𝑟o (𝑆 r 𝐿e )∪ .ac𝐵 h, 𝑧e is𝑏a 𝑖c a𝑠h n𝑗,𝑧 ia n𝑏 n𝑖 t𝑠 ed𝑗 g(cid:205)t eo r𝑖 ,,a 𝑠 f,n o𝑗 r𝑍in 𝐿𝑏t 𝑖e 𝑠 =g 𝑗e {∈r 𝑏v }{ ,a ⌊r i(cid:205) tia f𝑖b o,𝑠l le , l𝑗 o𝑍 𝑧 w𝑏𝑏 𝑖 s𝑖 𝑠𝑠 𝑗 t𝑗 h⌋s , au ⌈ t(cid:205)c ⌊h 𝑖 (cid:205),𝑠t , 𝑖h 𝑗 ,𝑠a 𝑧 ,t 𝑗𝑏 𝑧𝑖P 𝑠 𝑏r 𝑗 𝑖[ ⌉ 𝑠𝑍 } 𝑗⌋𝑏 .𝑖 S𝑠 ≥i𝑗 n 𝑟= ce ({1 𝑟 𝑏] ( }·= ))
,
sothat(cid:205) 𝑖,𝑠,𝑗𝑍 𝑏𝑖𝑠𝑗 ≥𝑟({𝑏}).Additionally,E[(cid:205) 𝑏∈𝐿(cid:205) 𝑖,𝑠,𝑗𝑧 𝑏𝑖𝑠𝑗] ≥
Itiseasytoconstructinstanceswherethereisnosolutionthatsat- 𝑟(𝐿)foreach|𝐿| > 1.Inasimilarmanner,theexpectedvalueof
isfiesallthelowerboundconstraints.Thisalsoimpliesthatbuyers’ theobjectivefunctionisatleasttheobjectivevalueoftheLP. □
lowerboundfairnessconstraintscanarbitrarilyaffectthewelfare
NotethatthesolutionT fromTheorem5.1neednotsatisfythe
objective.Whenthesubsetsforwhichlowerboundconstraints
lowerboundconstraintsforagiven𝐿 ∈L–itisonlysatisfiedin
specifiedarepairwisedisjoint,thefeasibilityproblemsharessome
expectation,overtherandomchoicesmadebythealgorithm.It
similaritywiththeconstructionofcoalitionstooptimizecertain
actuallygivesa(fractional)solutionwhenevertheLPisfeasible,
functionsofagents’utilitiesinhedonicgames(seee.g.,[47,48])
whichmighthappenevenifM = ∅.Wenotebelowthatifthe
andtheproblemofpartitioningthenodesetsofgraphssothat
MaxWelfareFairinstancehaslowerboundconstraintsonlyfor
thesubgraphinducedoneachblockofthepartitionhasaspeci-
individual buyers, they are satisfied exactly as the resulting LP
fiedminimumdegree(see,e.g.,[1,2,43]).Itshouldbenotedthat
representsaninstanceofthe𝑏-matching2problem.
1Ingeneral,|L|canbeexponentialin|𝐵|.Wewillassumethat|L|isboundedbya
polynomialin|𝐵|. 2SeeSectionAofthesupplementforadefinitionofthe𝑏-matchingproblem.Corollary5.2. LetMdenotethesetofalltradingassignmentsT roundsassignedto𝑥 𝑖 isℓ.Theobjectiveistofinda𝑘-roundmatch-
whichsatisfythelowerboundconstraintsassociatedwithall𝑏 ∈𝐵. ingtomaximizethetotalbenefit.GivenaninstanceofMaxLeximin,
SupposeM ≠∅.If𝑓 𝑠and𝑓 𝑏havethesamemonotonicityproperties wecanconstructaninstanceofMaxTB-MRMasfollows.
asinTheorem4.1,itispossibletofindatradingassignmentT (1) Constructanewcompatibilitygraph𝐺 𝑚(𝑋,𝑌,𝐸 𝑚)where𝑋 =
in polynomial time, which ensures that: (1) for each buyer𝑏 ∈ {𝑣}isaspecialnodethatrepresentsaspecificresourceinevery
𝐵, the amount of water assigned is at least𝑟({𝑏}), and (2) the round,𝑌 =𝐵,thesetofbuyers,and𝐸 𝑚 ={(𝑣,𝑏) |𝑏 ∈𝐵}.(𝐺 𝑚
expectedwelfareof T isatleastthemaximumwelfareamongall isastargraphwithcenter𝑣andnodesof𝐵asleaves.)
theassignmentsinM. (2) Thenumberofrounds𝑘 =|𝑊|,oneforeachwaterunitin𝑊.
Complexity.Weshowthat,ingeneral,theproblemofdetermining (3) F spo or ne dac th ob thu oy se er𝑏 re, p𝐾 r𝑏 es= en{ t𝑖 in| g(𝑤 co𝑖 m,𝑏 p) a∈ tib𝐸 l𝑤 e} re, si. oe u., rt ch ee s,r ao nu dnd 𝜌s 𝑏c =or 𝛾r 𝑏e-
,
whetherthereisamatchingsolutionthatsatisfiesallthelower therequirementof𝑏.Theconstructionofthebenefitfunction𝜇
𝑏
boundconstraintsisitselfanNP-completeproblem.Thisisshown
followstheconstructionusedinTheorem4.9in[45].
usingareductionfromtheMinimumVertexCoverproblem(see
Givenamulti-roundmatchingsolutionMtotheaboveinstanceof
PropositionC.1inSectionC.1ofthesupplement).
theMaxTB-MRMproblem,weconstructatradingassignmentT
5.2 LeximinFairness
asfollows:Eachmatchingedge(𝑣,𝑏)correspondstosomeround𝑖.
Itismappedtotheassignment (𝑤 𝑖,𝑏) ∈ T.Theproofthatthe
We consider a simpler setting of a single seller with a set of𝑘 solutionsatisfiesleximin-largestcriterionusesseveraladditional
resourcesorwaterunits𝑊 ={𝑤 1,𝑤 2,...,𝑤 𝑘}andmultiplebuyers
results;itispresentedinSectionC.2ofthesupplement.
withrequirements.Allwaterunitshavethesamevalue.Theseller’s
objective is to maximize the number of resources sold, subject Remark5.4. WenotethatinTrabelsietal.[45],itwasonlyshown
totheconstraintsrepresentedbyaresource–buyercompatibility thattheirsolutionfortherelevantbenefitfunctionsatisfiesthe
graph𝐺 𝑤(𝑊,𝐵,𝐸 𝑤)andanadditionalfairnessconditiondiscussed Rawlsiansocialwelfare,i.e.,thesolutionmaximizesthesatisfaction
below.ForanyassignmentT andbuyer𝑏 ∈ 𝐵,let𝜂 𝑏 denotethe oftheleastsatisfiedbuyer.Here,inthecontextoftradingassign-
totalnumberofwaterunitsassignedto𝑏.Let𝛾 𝑏 bethenumberof ments,weshowthatthesameconstructionprovidesastronger
unitsrequiredby𝑏.Let𝜓(T) = (𝜂 𝑏/𝛾 𝑏 |𝑏 ∈𝐵)denotethebuyer leximin-largestsolution.
satisfactionvectorcorrespondingtoT.Thefairnessconditionwe
6 EXPERIMENTS
imposeisbasedonleximinorderingofvectorsdefinedbelow.
LeximinOrdering:Supposewehavetworealsequences,𝜇 1and Weexperimentedwithreal-worldandsyntheticdatasets3tostudy
𝜇 2,eachoflength𝑘.Wesaythat𝜇 1isleximinlargerthan𝜇 2ifthere resourcematchingundervariousscenariosdeterminedbydrought
existsaninteger0≤ℓ <𝑘suchthatthefirstℓsmallestelements
severity,typesofvaluefunctions,andagentseniority.Allourexper-
ofbothvectorsareequal,whilethe(ℓ+1)-smallestelementof𝜇
1 imentalresultsrelyontheassumptionsmentionedinRemark3.1.
isgreaterthanthe(ℓ+1)-smallestelementof𝜇 2.
Supposethesequences𝜇 1and𝜇 2representthesatisfactionvec- 6.1 Datasets
t
l
seo inxr
i
cs
m
eo ,inf fob
l
rau sry oge mer rs
eth
ic nar te
n
ea g𝜇t ee
2
rd
.F
ℓb
r
<oy
m
𝑘tw
,a
to
hfa
ea irs (ns ℓei +g ssn 1m
p
)tee hrn
s
lpt es
e ac
sT
t
t1
iv
saa
e
tn
, iT
sd
fi1
eT
is
d2
p
ba
r
un
e
yd
fe er
r𝜇 a1
hb
ali es
s
S agy en nt th se 𝐴tic =da {t 𝑎a 𝑖se |t 1s. ≤We 𝑖c ≤on 𝑁sid }e wra hesi rm ep ale buse yt eu rp cw anhe bre uyth fe rr oe mar ae n𝑁
y
alargersatisfactionlevelin𝜇 1comparedtothatin𝜇 2.(Foralllower selleraslongasthereisvaluecompatibility.Fromadomainper-
values,thesatisfactionratioofbuyersin𝜇 1isatleastaslargeas spective,thissetupmodelsthesituationwherethereisasingle
thatof𝜇 2.)Thismotivatesthefollowingproblem. stream,and,therefore,anagentcanpotentiallyaccessanyother
agent’swater.Wewillassumethatallcapacitiesandrequirements
Problem3(MaxLeximin). Givenasellerwithaset𝑊 of𝑘water arethesame;thatis,forallagents𝑎 ∈𝑆∪𝐵,𝛾
𝑎
=𝑘.Wateravail-
units,asetofbuyers𝐵withthesamecostforeverywaterunit,and ability𝛿determinesthefractionofwaterthatisavailable.If𝛿 =1
acompatibilitygraph𝐺 𝑤(𝑊,𝐵,𝐸 𝑤),findatradingassignmentT∗ (similarly,𝛿 = 0), then all (none of the) 𝑁𝑘 units of water are
withtheleximin-largestbuyersatisfactionvector. available,andtherefore,thereisnotrade.Everyagent𝑎 𝑖 isasso-
Theorem5.3. AnoptimalsolutiontotheMaxLeximinproblem ciatedwith𝑘 unitsofwater.Given𝛿,agent𝑎 𝑖 isasellerifand
canbeobtainedinpolynomialtime. onlyif 𝑁𝑖 ≥ 1−𝛿 (largerthe𝑖,thehigherthepriority).Agents
arecategorizedintotwotypes:high-valuedandlow-valued.Fora
Proofoutline:First,weshowthataninstanceof MaxLeximin seller𝑠,wewillconsiderasimplelinearvaluefunction:𝑓 𝑠(ℓ)=𝛽ℓ
canbereducedtoaninstanceofthemulti-roundmatchingproblem forℓ =1,...,𝑘;high-valuedagentshavealarger𝛽thanlow-valued
calledMaxTB-MRMfromTrabelsietal.[45].Inmulti-roundmatch- agents.Similarly,forabuyer𝑏,wewillconsiderthefollowinglinear
i nn eg e, d𝑋 tois ba es met ao tcf ha eg den tots ra en sd ou𝑌 rci es sa is net 𝑘o rf or ue ns do sur fc oe rs sw omhe ere poag sie tn ivt es f au gn enct tio
𝑎
𝑖n: is𝑓 𝑏 h( igℓ) h-= va𝛽 lu(𝑘 ed− oℓ r+ lo1 w) -f vo ar luℓ e= d,1 w, e.. w., i𝑘 ll. dT eo fid ne ec aid pe row bh ae bt ih lie tyr
integer𝑘.Abipartitecompatibilitygraph𝐺 𝑚(𝑋,𝑌,𝐸 𝑚)indicates functionasfollows:𝑝 ℎ(𝑎 𝑖)=𝜆 𝑁𝑖 +(1−𝜆)(cid:0) 1− 𝑁𝑖 (cid:1) ,where𝜆∈ [0,1]
whichresourceiscompatiblewithwhichagentformatching.Each isatunableparameter.Thehigherthe𝜆,thegreatertheprobability
agent𝑥 𝑖 hasapermissiblesetofrounds𝐾 𝑖 ⊆ [𝑘]inwhichitcanbe thathighpriorityagentsarehigh-valued.If𝜆=0.5,thenallagents
matched,and𝜌 𝑖 ≤ |𝐾 𝑖|isthedesirednumberofroundsinwhichit
willbematched.Inaddition,𝜇 𝑖 : [𝜌 𝑖] →R >0isabenefitfunction 3ThedataandthecodeforrunningtheexperimentsareavailableinGithub[44].The
foragent𝑥 𝑖,whichgivesabenefitvalue𝜇 𝑖(ℓ)whenthenumberof
dataissummarizedinTable1inSectionDofthesupplement.(a) (b) (c) (d)
10 500 1.0
λ,βh
0.6
8 400 0.8 (0.0,0.7)
(0.0,0.9) 6 300 0.6 0.4 (0.5,0.7)
4 200 0.4 (0.5,0.9)
0.2
(1.0,0.7)
2 100 0.2
(1.0,0.9)
0 0 0.0 0.0
0.0 0.5 1.0 0.00 0.25 0.50 0.75 1.00 0.00 0.25 0.50 0.75 1.00 0.00 0.25 0.50 0.75 1.00
δ δ δ δ
Figure2:Panels(a)and(b)showstructuralpropertiesoftheresources–needsgraphforthesyntheticdatasetswithrespecttoincreasing
wateravailability.InPanels(c)and(d),Y-axisgivesthetotalvalue𝜎(T∗)andwelfare(T∗)correspondingtoanoptimalassignmentT∗
respectively,normalizedby𝜎 0,thetotalvaluewhen100%ofwaterisavailable.Allresultsarefor𝑁 = 10andthenumberofunitsper
agent𝑘 =5.Theresultsareshownfordifferentvaluesof𝜆and𝛽 ℎ.
havethesameprobabilityof0.5tobeassignedtothehigh-valued whodonothavewatercannotbuyfromtheformergroup.The
category.Inourexperiments,the𝛽valueforthehigh-valuedagent, correspondingsetofplotsforreal-worlddatasetsareinFigure3.
denotedby𝛽 ℎ,isarealvaluebetween0.5and1,andfor𝛽 ℓ,the𝛽 Wenotethat,inthiscase,thenumberofsellersinPlot3(a)doesnot
forthelow-valuedagent,issetto1−𝛽 ℎ. increaselinearlywith𝛿,particularlyinthecaseoftheTouchetnet-
Real-worlddatasets.Weuseddatasetscontaining93usablewater works.Thecurveplateausataround𝛿 =0.2beforerisingat𝛿 >0.5
rightsheldintheTouchetRiverWatershedand77usablewater inPlot3(a).Thereasonforthisistheexistenceofsenioragentsre-
rightsheldintheYakimaRiverWatershedinthestateofWashing- quiringverylargenumbersofwaterunits.Untilsufficientwateris
ton,alongwiththeirassociatedfarmattributes,includingacreage, available,theseagentswillbeclassifiedasbuyersinsteadofsellers,
croptypes,andvolumeofwaterneeded.Thevalueofawaterunit
causingtheaforementionedplateaus.Therefore,as𝛿isincreased,
wascalculatedbasedonvalueofproductionperacrefortherel- thenumberofavailablewaterrightsfortradeincreasesabruptly.
evantcroptypes[25](𝑛 𝑖)andthevolumeofwaterrequiredfor ThisalsoleadstotheplateauinginPlot3(b).Overall,weobserve
eachfield(𝑣 𝑖).Then,wecalculatedthevalueperacre-foot𝑝 𝑖 = thatheterogeneity(bothquantityandcropvalue)incropportfolios,
𝐴 𝑖 ·𝑛 𝑖/𝑣 𝑖,where𝐴 𝑖 isacreage,𝑛 𝑖 isthevalueofproductionper seniority,andgeographicconstraintscanleadtofewercompatible
acrebasedoncroptype.Buyersandsellersweredecidedbased seller-buyerunitpairs.Also,thenumberofsuchpairsisrelatively
on water availability and water right seniority. The aggregated lowinthecaseof Yakima.
volumesperfield𝑣 𝑖 weredisaggregatedintoprioritizedunitsof Welfarefromtradeandwateravailability.Figures2(c)and(d)
water(withunitsizesbeing5,10,or20acre-feet).Forbuyers,units
showthebenefitoftradingforsyntheticdatasets.Thetotalvalue
wereprioritizedindescendingorderoftheirvalue,while,forthe
duetotradingissignificantlyhigherwhenwateravailabilityis
sellers,unitswereprioritizedinascendingorderoftheirvalue,thus
around50%.Weobservethatthecombinationofseniorityandcrop
satisfyingthemonotonicityconstraintsofAlgorithm1.Wecreated
value(highorlow)hasasignificanteffect.Ascenariocorresponding
theresources–needsbipartitegraphusingthevaluefunctionsand to high-value buyers and low-value sellers (𝜆 = 0) offers more
geographiclocationsofthewaterrights.Thisisdescribedinmore opportunitiesformatchingthantheotherwayround(𝜆=1).The
detailinthesupplement. welfarepeakswhen𝛿 isintheinterval[0.25,0.35],whichisalso
6.2 Results theintervalwiththehighestnumberofedgesinthebipartitegraph.
Theparameter𝛽 ℎ contributessignificantlytothevalueofwelfare.
Compatibilitygraphstructureandwateravailability.Here, Thelargerthe𝛽 ℎ,thegreaterthetotalwelfare𝜎(T).
weexaminethestructureofthebuyer–sellerandresources–needs However,inthecaseofreal-worlddatasets,weseeamuchricher
compatibilitygraphswithincreasingwateravailability𝛿.Forthe behavior,whichispartlyexplainedbythestructureoftheresources–
syntheticgraphs,Figure2(a)showsalinearincreaseinthenumber needsnetwork.TheYakimadatasetexhibitscharacteristicssimilar
ofsellers,whichisduetothefactthateachagentisassignedthe tothoseofsyntheticdatasetsaround𝛿 =0.5,butthenormalized
samenumberofresources.Notethatthebuyer–sellercompatibil- totalvaluedropsclosetozeroevenwhenaround25%ofthewater
itygraphinthiscaseonlydifferswithrespectto𝛿,asallother isavailable(seeFigure3(c)).Thisisduetothesamereasonasthat
parametersonlydeterminethevalueofthewaterunits.However, fortheTouchetdataset:anagentwithalargenumberofwater
theresources–needsbipartitegraph(definedinSection4.2)isin- units.Onlyforasufficientlylargevalueof𝛿doesthisagentgetto
fluencedsignificantlybycombinationsofseniorityandvalue.In exerciseitswaterunitandbecomeaseller.FortheTouchetdata,
Plot2(b),weobservethatthenumberofedgesintheresources– weobservethesamephenomenonaswasobservedforthenumber
needsgraphsignificantlydecreasesasthenumberofseniorhigh- ofedgesat0.25≤𝛿 ≤0.5.Wenotethatthewelfareinthecaseof
valueagents(𝜆and𝛽 ℎ beingbothhigh)increasesduetothefact theTouchetnetworksismuchlargerthanthatforYakima,where
thatmosthigh-valueagentshavewater,whilelow-valueagents seller-buyercompatibilityisrelativelylow.
srellesforebmuN
hpargsdeen-seRehtnisegdE
σ/)
(σ
0 ∗
T
σ/)
(eraflew
0
∗ T(a) (b) (c) (d)
100 100 ×104 1.0 4 ×106
80 0.8
75 Touchet5 3
60 0.6 Touchet10
50 Touchet20 2
40 0.4
Yakima5
20 25 0.2 Yakima10 1
Yakima20
0 0 0.0 0
0.0 0.5 1.0 0.00 0.25 0.50 0.75 1.00 0.00 0.25 0.50 0.75 1.00 0.00 0.25 0.50 0.75 1.00
δ δ δ δ
Figure3:Panels(a)and(b)showstructuralpropertiesoftheresources–needsgraphforreal-worlddatasetswithrespecttoincreasing
wateravailability.InPanels(c)and(d),Y-axisgivesthetotalvalue𝜎(T∗)andwelfare(T∗)correspondingtoanoptimalassignmentT∗
respectively,normalizedby𝜎 0,thetotalvaluewhen100%ofwaterisavailable.Allresultsareforvaryingsizesforwaterunits.
λ=0,βh=0.7 λ=0.5,βh=0.7 λ=1,βh=0.7 sellersformostbuyers.Therefore,withtheadditionalconstraints
1.00
δ oflowerboundsasinSection5.1,thiswillmostlyleadtoinfeasible
0.75 0.2 instances.Next,wenotethatthemeanormedianbuyersatisfac-
0.50 0.4 tionneednotincreaseas𝛿increases.As𝛿increases,thenumber
0.6
0.25 ofbuyersdecreases.Hence,itispossiblethatfortheremaining
0.8
0.00 buyers,thebuyersatisfactionislow.Thisexplainsthedecreasein
1 2 3 4 5 1 2 3 4 5 1 2 3 4 5
r( b ) r( b ) r( b ) buyersatisfactionforYakima10from𝛿 =0.3to𝛿 =0.4.
{ } { } { }
Figure4:Thelossinwelfareasthelowerboundonthenumber
Touchet10 Yakima10
ofwaterunitsforeachindividualbuyerisincreased.Thewelfare- 1.0
fairnesstradeoffistheratiowelfare(T𝑟∗)/welfare(T∗),whereT𝑟∗ 0.8
isanoptimalsolutionwhichsatisfiesthefairnesscriteriathatevery 0.6
buyerismatchedwithatleast𝑟({𝑏}) =𝑟 waterunitsandT∗ is 0.4
0.2
anoptimalsolutionwhennosuchconstraintsareimposed.The
0.0
resultsareforthesyntheticgraphsfordifferentvaluesof𝜆and𝛿 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9
δ
over100replicates.
Figure 5: A boxplot of buyer satisfaction (water units
Buyersatisfaction.Forthesyntheticnetworks,wefindwelfare
matched/required water units) distribution with respect to
maximizing solutions with the constraint that every buyer𝑏 is
wateravailability.GiventheoptimalsolutionfromAlgorithm1,for
matchedtoatleast𝑟({𝑏}) = 𝑟 waterunits.Figure4showsthe
eachbuyer,thesatisfactioniscomputed.Insomecases,theboxes
decreaseinwelfareas𝑟 increases.Avalueofzeroonthey-axis
arenotvisible.Thesecorrespondtoamedianofeitherzeroorone.
correspondstoaninfeasibleinstancegiventheminimumsatisfac-
tionconstraints.Wenotethatforlower𝛿,themaximumwelfare
achievableissmallforevensmall𝑟,indicatingthat,duringwater
Thesizeofwaterunits.Werecallthatallourproposedalgorithms
scarcity,thewelfare–fairnesstradeoffishigh.Forahigh𝜆,where runinpolynomialtimeinthenumberofwaterunits.Thisisunlike
theproblemsconsideredinLiuetal.[29],wherethecomplexity
mostbuyersarelow-valuedandmostsellersarehigh-valued,we
seeasharpdropinwelfarewithincreasing𝑟. waswithrespecttothenumberofagents.Giventheheterogeneity
inthevaluationofeachwaterunit,thisisunavoidable.Onewayto
Forthereal-worldgraphs,wehaveplottedbuyersatisfactionin
mitigatethisproblemistoincreasethesizeofasinglewaterunit.
Figure5forwaterunitsizeof10,whentherearenolowerbound
Ouranalysisonthesizeofwaterunitsisinthesupplement.
constraints.Weobservethat,forbothdatasets,thegeneralsatis-
factionlevelsarelowfor𝛿 <0.5.Weseesomeoutlierswith100%
7 FUTUREWORK
satisfaction.Uponinspection,wefoundthatthesebuyerstypically
haveasingleunitrequirement.WenotethatforTouchet10,the Wepresentedresultsforaclassofresourcematchingproblems
averagebuyersatisfactionjumpsto≈ 0.5at𝛿 = 0.6.Thereare motivatedbyapplicationstowatertrading.Onedirectionforfu-
low-valuedagentswithwateravailableat𝛿 ≥0.5whocanleadto tureworkistoconsideroptimalallocationproblemswithother
anincreaseintrade.Weobservethatwelfareisnotindicativeof welfarefunctionsandfairnesscriteria.Ourworkassumesthatthe
buyersatisfaction,asitonlydependsonthetotalvalueandtotal valuationsofresourcesarepublic.Ifthevaluationsarenotfully
quantity of trade. We observe that, in general, it is challenging revealed(amorepracticalsetting),interestingandricherproblems
toguaranteeaminimumnumberofwaterunitstomostbuyers involvingnegotiationsandpricediscoveryemerge.Ourworkisa
duetothefactthat,inmanyscenarios,therearenocompatible steptowardsmodelingandunderstandingtheseissues.
srellesforebmuN
)∗T(eraflew/)∗rT(eraflew
hpargsdeen-seRehtnisegdE
σ/)
(σ
0
∗
T
noitcafsitasreyuB
)
(eraflew
∗
T8 ACKNOWLEDGMENTS
[23] GiorgosKallis.2008.Droughts.AnnualReviewofEnvironmentandResources33
(2008),85–118.
Wethankthereviewersandeditorsfortheirvaluablesuggestions.Thisma-
[24] MohsenKhorasany,RezaRazzaghi,AliDorri,RajaJurdak,andPierluigiSiano.
terialisbaseduponworksupportedbytheAIResearchInstitutesprogram 2020.Pavingthepathfortwo-sidedenergymarkets:Anoverviewofdifferent
supportedbyUSDA-NIFAandNSFundertheAIInstitute:AgriculturalAI
approaches.IEEEAccess8(2020),223708–223722.
[25] DennisKoongandSteveAnderson.2022.2022WASHINGTONANNUALSTATIS-
forTransformingWorkforceandDecisionSupport(AgAID)awardNo.2021- TICALBULLETIN.https://www.nass.usda.gov/Statistics_by_State/Washington/
67021-35344,USDA-NIFAundertheNetworkModelsofFoodSystemsand Publications/Annual_Statistical_Bulletin/2022/WA_ANN_2022.pdf. [Accessed
08-Oct-2023].
theirApplicationtoInvasiveSpeciesSpread,grantno.2019-67021-29933,
[26] BryanLeonard,ChristopherCostello,andGaryDLibecap.2019. Expanding
USDANationalInstituteofFoodandAgricultureproject#1016467,andNSF watermarketsinthewesternUnitedStates:Barriersandlessonsfromother
awardNo.OAC-1916805(CINES).Opinions,findings,andconclusionsare
naturalresourcemarkets.ReviewofEnvironmentalEconomicsandPolicy13,1
(2019),43–61.
thoseoftheauthorsanddonotnecessarilyreflecttheviewofthefunding
[27] NixieSLesmana,XuanZhang,andXiaohuiBei.2019.Balancingefficiencyand
entities. fairnessinon-demandridesourcing.Advancesinneuralinformationprocessing
systems32(2019),5310–5320.
[28] ZhiyuanLi,YichengLiu,PingzhongTang,TingtingXu,andWeiZhan.2017.
REFERENCES Stabilityofgeneralizedtwo-sidedmarketswithtransactionthresholds.InPro-
ceedingsofthe16thConferenceonAutonomousAgentsandMultiAgentSystems.
[1] NogaAlon.2006.Splittingdigraphs.Combinatorics,ProbabilityandComputing IFAAMAS,Online,290–298.
15(2006),933–937. [29] YichengLiu,PingzhongTang,TingtingXu,andHangZheng.2016.Optimizing
[2] J.Bang-JensenanddN.CohenandF.Havet.2016. Findinggood2-partitions tradingassignmentsinwaterrightmarkets.InProc.AAAIConferenceonArtificial
ofdigraphsII.Enumerableproperties.TheoreticalComputerScience640(2016), Intelligence,Vol.30.AAAIPress,Online,551–557.
1–19. [30] L.LovászandM.D.Plummer.1986.MatchingTheory.NorthHolland,Amsterdam,
[3] ReetwikaBasu.2023.ThreeEssaysonAgent-BasedModelsforWaterAllocation TheNetherlands.
underAppropriativeRights.PhDthesis.WashingtonStateUniversity. [31] WillMa,PanXu,andYifanXu.2022. Group-levelFairnessMaximizationin
[4] JamesFBookerandRobertAYoung.1994.Modelingintrastateandinterstate OnlineBipartiteMatching.InProceedingsofthe21stInternationalConferenceon
marketsforColoradoRiverwaterresources.JournalofEnvironmentalEconomics AutonomousAgentsandMultiagentSystems.IFAAMAS,Online,1687–1689.
andManagement26,1(1994),66–87. [32] WesternWaterMarket.2023.InformationonWaterMarketsinWesternUSA.
[5] VictorBrajer,ALChurch,RonaldCummings,andPhillipFarah.1989. The https://westernwatermarket.com/. [Accessed04-10-2023].
strengthsandweaknessesofwatermarketsastheyaffectwaterscarcityand [33] HerveMoulin.2004.FairDivisionandCollectiveWelfare.MITPress,Cambridge,
sovereigntyinterestsintheWest.Nat.ResourcesJ.29(1989),489. MA.
[6] SusanMBurke,RichardMAdams,andWesleyWWallender.2004.Waterbanks [34] S.Narang,A.Biswas,andY.Narahari.2022.OnAchievingFairnessandStability
andenvironmentalwaterdemands:CaseoftheKlamathProject.WaterResources inMany-to-OneMatchings.ArXivReport:2009.05823v4.
Research40,9(2004),1–9. [35] MahsaNoori,AlirezaEmadi,andRaminFazloula.2021.Anagent-basedmodelfor
[7] IoannisCaragiannisandShivikaNarang.2023.Repeatedlymatchingitemsto waterallocationoptimizationandcomparisonwiththegametheoryapproach.
agentsfairlyandefficiently.InInternationalSymposiumonAlgorithmicGame WaterSupply21,7(2021),3584–3601.
Theory.Springer,NewYork,NY,347–364. [36] AtasiPanda,AnandLouis,andPrajaktaNibhorkar.2022. Bipartitematch-
[8] XingyuChenandZijieLiu.2020. TheFairnessofLeximininAllocationof ingswithgroupfairnessandindividualfairnessconstraints. ArXivpreprint
IndivisibleChores.ArXivReport:2005.04864v1. arXiv:2208.09951.
[9] HowardChongandDavidSunding.2006.Watermarketsandtrading.Annu.Rev. [37] TroutUnlimitedWashingtonWaterProject.2019.Landowner’sguidetoWashing-
Environ.Resour.31(2006),239–264. tonwaterrights.https://appswr.ecology.wa.gov/docs/WaterRights/wrwebpdf/
[10] JosephCookandSergeySRabotyagov.2014.Assessingirrigators’preferences landownerguide-2019.pdf. [Accessed08-Apr-2023].
forwatermarketleaseattributeswithastatedpreferencesapproach. Water [38] JohnF.RaffenspergerandMarkW.Milke.2017.Participantsinandcomponents
ResourcesandEconomics7(2014),19–38. ofthesmartmarketinstitution.InSmartmarketsforwaterresources:amanual
[11] QianDang,MeganKonar,JeffreyJReimer,GiulianoDiBaldassarre,Xiaowen forimplementation.Springer,Heidelberg,Germany,95–136.
Lin,andRuijieZeng.2016.Atheoreticalmodelofwaterandtrade.Advancesin [39] JohnF.Raffensperger,MarkW.Milke,andE.GrantRead.2009.Adeterministic
WaterResources89(2016),32–41. smartmarketmodelforgroundwater. OperationsResearch57,6(2009),1333–
[12] XiaotieDeng,Li-ShaHuang,andMinmingLi.2007.OnWalrasianpriceofCPU 1346.
time.Algorithmica48(2007),159–172. [40] TuomasSandholmandSubhashSuri.2002.Optimalclearingofsupply/demand
[13] DepartmentofEcology,StateofWashington.[n.d.].Waterrights.https://appswr. curves.InInternationalSymposiumonAlgorithmsandComputation.Springer,
ecology.wa.gov/waterrighttrackingsystem/WaterRights/default.aspx. [Accessed NewYork,NY,600–611.
Apr-2023]. [41] MindySelman,EvanBranosky,CyJones,andJennyGuiling.2009.Waterquality
[14] RanDuanandHsin-HaoSu.2012. Ascalingalgorithmformaximumweight tradingprograms:Aninternationaloverview. Issuebrief,WorldResources
matchinginbipartitegraphs.InProceedingsofthetwenty-thirdannualACM-SIAM Institute(WRI),Washington,DC.
symposiumonDiscreteAlgorithms.SIAM,1413–1424. [42] SoroushSharghiandRezaKerachian.2022.Anuncertainty-basedsmartmarket
[15] J.EdmondsandR.M.Karp.1972. Theoreticalimprovementsinalgorithmic modelforgroundwatermanagement.WaterSupply22,3(2022),3352–3373.
efficiencyfornetworkflowproblems.J.ACM19,2(1972),248–264. [43] MichaelStiebitz.1996.DecomposingGraphsUnderDegreeConstraints.J.Graph
[16] SeyedEsmaeili,SharmilaDuppala,DavidsonCheng,VedantNanda,Aravind Theory23,3(1996),321–324.
Srinivasan,andJohnPDickerson.2023. Rawlsianfairnessinonlinebipartite [44] Yohai Trabelsi. 2024. Code and Data: Value-based Resource Match-
matching:Two-sided,group,andindividual.InProceedingsoftheAAAIConference ing with Fairness Criteria: Application to Agricultural Water Trading.
onArtificialIntelligence,Vol.37.AAAIPress,Online,5624–5632. https://github.com/yohayt/Value_based_Resource_Matching_with_Fairness_
[17] FoodandAgricultureOrganization.2022.TheStateoftheWorld’sLandandWater Criteria_Application_to_Agricultural_Water_Trading.
ResourcesforFoodandAgriculture–Systemsatbreakingpoint.Rome,Online. [45] YohaiTrabelsi,AbhijinAdiga,SaritKraus,S.S.Ravi,andDanielJRosenkrantz.
[18] H.N.Gabow.1983.AnEfficientReductionTechniqueforDegree-Constrained 2023. Resourcesharingthroughmulti-roundmatchings.InProceedingsofthe
SubgraphandBidirectedNetworkFlowProblems.InProceedingsofthe15th AAAIConferenceonArtificialIntelligence.AAAIPress,Online,11681–11690.
AnnualACMSymposiumonTheoryofComputing,25-27April,1983,Boston,Mas- [46] Washington State Department of Agriculture. [n.d.]. Agricultural
sachusetts,USA.ACM,NewYork,NY,448–456. Land Use. https://agr.wa.gov/departments/land-and-water/natural-
[19] RajivGandhi,SamirKhuller,SrinivasanParthasarathy,andAravindSrinivasan. resources/agricultural-land-use. [AccessedApr-2023].
2006.Dependentroundinganditsapplicationstoapproximationalgorithms.J. [47] NaftaliWaxman,NoamHazon,andSaritKraus.2021. Manipulationof𝑘-
JACM53,3(2006),324–360. CoalitionalGamesonSocialNetworks.ArXivReport:2105.09852v1.
[20] M.R.GareyandD.S.Johnson.1979.ComputersandIntractability:AGuidetothe [48] NaftaliWaxman,SaritKraus,andNoamHazon.2020.OnMaximizingEgalitarian
TheoryofNP-Completeness.W.H.FreemanandCo.,SanFrancisco,CA. Valuein𝐾-CoalitionalHedonicGames.ArXivReport:2001.10772v1.
[21] CharlesWHowe.2013.Interbasintransfersofwater:Economicissuesandimpacts. [49] D.B.West.2003.IntroductiontoGraphTheory.Prentice-Hall,Inc.,Englewood
Routledge,NewYork,NY. Cliffs,NJ.
[22] CharlesWHoweandChristopherGoemans.2003. Watertransfersandtheir [50] SarahAWheeler(Ed.).2021.WaterMarkets:AGlobalAssessment.EdwardElgar
impacts:LessonsfromthreeColoradowatermarkets1.JAWRAJournalofthe Publishing,Cheltenham,UK.
AmericanWaterResourcesAssociation39,5(2003),1055–1065.[51] TingtingXu,HangZheng,JianshiZhao,YichengLiu,PingzhongTang,YCEthan
Yang,andZhongjingWang.2018.Atwo-phasemodelfortradematchingand
pricesettingindoubleauctionwatermarkets. WaterResourcesResearch54,4
(2018),2999–3017.TechnicalSupplement
Papertitle:Value-basedResourceMatchingwithFairnessCriteria:ApplicationtoAgriculturalWaterTrading
A ADDITIONALMATERIALFORSECTION1
A.1 DefinitionsofSomeCombinatorialProblems
Thissubsectionprovidesformaldefinitionsofsomeproblemswhichareusedinvarioussectionsofthepaper.Thesedefinitionscanbefound
inseveralstandardtexts(e.g.,[20]).
(a)ExactCoverby3-Sets(X3C)
Instance:Auniversalset𝑈 ={𝑢 1,𝑢 2,...,𝑢 𝑡},where𝑡 =3ℓforsomeintegerℓ;acollection𝐶 ={𝐶 1,𝐶 2,...,𝐶 𝑟},whereeach𝐶 𝑗 isasubsetof
𝑈 and|𝐶 𝑗|=3,1≤ 𝑗 ≤𝑟.
Question:Isthereasubcollection𝐶′of𝐶suchthat(i)thesetsin𝐶′arepairwisedisjointand(ii)theunionofallthesetsin𝐶′isequalto𝑈?
ItiswellknownthatX3CisNP-complete[20].NotethatwhenthereisasolutiontoanX3Cinstance,thecollection𝐶′musthaveexactly
ℓ =𝑡/3setssinceeachsetin𝐶′hasthreeelementsandthesetsmustbepairwisedisjoint.
(b)MaximumWeightedMatchinginaBipartiteGraph
Werecallthatamatching𝑀inagraph𝐺(𝑉,𝐸)isasubsetofedgessuchthatnotwoedgesof𝑀areincidentonthesamenode[49].
Whenthereareweightsonedges,theweightofamatching𝑀 isthesumoftheweightsoftheedgesin𝑀.Aformaldefinitionofthe
maximumweightedmatchingproblemforbipartitegraphsisasfollows.
Instance:Abipartitegraph𝐺(𝑆,𝐵,𝐸),aweight𝑤(𝑒)foreachedge𝑒 ∈𝐸.
Requirement:Amatching𝑀thathasthemaximumweightoverallthematchingsin𝐺.
Itiswellknownthatamaximumweightedmatchinginabipartitegraph𝐺(𝑆,𝐵,𝐸)canbecomputedintime𝑂((|𝑆|+|𝐵|)3)(seeTableII
of[?]forasummaryoftheavailablealgorithmsandtheirrunningtimes).
(c)DegreeConstrainedSubgraphor𝑏-Matching(DCS)
Instance:Abipartitegraph𝐺(𝑋,𝑌,𝐸),nonnegativeintegers𝜆(𝑣)and𝜇(𝑣)foreachnode𝑣 ∈𝑋 ∪𝑌 suchthat𝜆(𝑣) ≤𝜇(𝑣).
Requirement:Isthereasubgraph𝐺′(𝑋,𝑌,𝐸′) of𝐺 suchthatforeach𝑣 ∈ 𝑋 ∪𝑌,thedegree𝑑(𝐺′,𝑣) of𝑣 in𝐺′ satisfiesthecondition
𝜆(𝑣) ≤𝑑(𝐺′,𝑣) ≤𝜇(𝑣)?
ItisknownthattheDCSproblemcanbesolvedefficientlyusingareductiontothematchingproblemonbipartitegraphs[18].Whena
solutionexists,acorrespondingsubgraphcanalsobeobtainedefficiently.
(d)MinimumVertexCover(MinVC)
Instance:Anundirectedgraph𝐺(𝑉,𝐸)andapositiveinteger𝑘 ≤ |𝑉|.
Question:Isthereavertexcover𝑉′ ⊆𝑉 ofsizeatmost𝑘for𝐺 (i.e.,asubset𝑉′ofnodessuchthat|𝑉′| ≤𝑘andforeachedge{𝑥,𝑦}∈𝐸,at
leastoneof𝑥 and𝑦isin|𝑉′|)?
ItiswellknownthatMinVCisNP-complete[20].
B ADDITIONALMATERIALFORSECTION4
B.1 RunningtimeofAlgorithm1
TherunningtimeofthealgorithmisdominatedbythecomputationofamaximumweightedmatchinginStep2.Amaximumweighted
matchingof𝐺′canbecomputedin𝑂((|𝑆′|+|𝐵′|)3)time(seeTableIIof[?]fortheavailablealgorithmsandtheirrunningtimes).B.2 StatementandProofofTheorem4.2
StatementofTheorem4.2:Supposewearegivenasetofsellers𝑆,buyers𝐵,theirwaterunits,compatibilitygraph𝐺(𝑆,𝐵,𝐸),andvalue
functionssatisfyingthefollowingcondition:∀𝑠 ∈𝑆,𝑓
𝑠
isamonotonenon-decreasingfunction.Inthissetting,MaxWelfareisNP-hard.
Proof:Weuseadecisionversionof MaxWelfarewheretheinputincludesanadditionalintegerparameter𝜆andthegoalistodetermine
whetherthereisanassignmentforwhichthewelfarefunctionhasavalueofatleast𝜆.Ourproofof NP-hardnessisthroughareduction
fromtheExactCoverby3-Sets(X3C)problem(definedinSectionA.1).
Givenaninstance𝐼 ofX3Cconsistingofauniversalset𝑈 = {𝑢 1,𝑢 2,...,𝑢 𝑡},where𝑡 = 3ℓ,andacollection𝐶 = {𝐶 1,𝐶 2,...,𝐶 𝑟}of
3-elementsubsetsof𝑈,weconstructaninstance𝐼′of MaxWelfareasfollows.
(1) Theset𝑆 ={𝑠 1,𝑠 2,...𝑠 𝑡}ofsellersisinone-to-onecorrespondencewiththeset𝑈.Eachseller𝑠 𝑖 hasonlyoneassociatedwaterunit𝑤𝑖 ,
1≤𝑖 ≤𝑡.(Thus,thesetofwaterunitsonthesellersideisinone-to-onecorrespondencewiththesetofsellers.)
(2) Theset𝐵={𝑏 1,𝑏 2,...𝑏 𝑟}ofbuyersisinone-to-onecorrespondencewiththesetcollection𝐶.
(3) Weassumethattheelementsof𝑈 areorderedas{𝑢 1,𝑢 2,...,𝑢 𝑡}andthattheelementsineachsubset𝐶 𝑗 ∈𝐶arelistedintheorderin
whichtheyappearin𝑈.Foreachset𝐶 𝑗 ={𝑢 𝑗 ,𝑢 𝑗 ,𝑢 𝑗 }oftheX3Cinstance𝐼,wecreatethreewaterunits𝑤𝑗 ,𝑤𝑗 and𝑤𝑗 forbuyer𝑏 𝑗,
1 2 3 1 2 3
1≤ 𝑗 ≤𝑟.Waterunit𝑤 𝑝𝑗 iscompatiblewithwaterunit𝑤𝑗𝑝 (ofseller𝑠 𝑗𝑝),1≤𝑝 ≤3.(Forexample,suppose𝐶 𝑗 ={𝑢 3,𝑢 4,𝑢 7}.Wehave
threewaterunitsforbuyer𝑏 𝑗,namely𝑤𝑗 ,𝑤𝑗 an𝑤𝑗 ;further,𝑤𝑗 ,𝑤𝑗 an𝑤𝑗 arecompatiblewiththesellerwaterunits𝑤3,𝑤4and𝑤7
1 2 3 1 2 3
respectively.)
(4) Foreachseller𝑠 𝑖,thevaluefunction𝑓 𝑠𝑖 isdefinedasfollows:𝑓 𝑠𝑖(𝑤𝑖)=1,1≤𝑖 ≤𝑡.(Thus,thefunction𝑓 𝑠 associatedwitheachseller𝑠is
triviallymonotoneandnon-decreasing.)
(5) Foreachbuyer𝑏 𝑗,thevaluefunction𝑓 𝑏𝑗 isdefinedasfollows:𝑓 𝑏𝑗(𝑤 1𝑗 )=0,𝑓 𝑏𝑗(𝑤 2𝑗 )=0,and𝑓 𝑏𝑗(𝑤 3𝑗 )=𝑄,where𝑄isaninteger≥4,
1≤ 𝑗 ≤𝑟.(Thefunction𝑓 𝑏 associatedwitheachbuyer𝑏ismonotonebutnon-decreasing;thatis,itfailstosatisfytheconditionneeded
forTheorem4.1.)
(6) Thelowerbound𝜆onthevalueofthewelfarefunctionissettoℓ(𝑄−3).
ThiscompletestheconstructionoftheMaxWelfareinstance𝐼′.Clearly,theconstructioncanbedoneinpolynomialtime.Wenowshow
thatthereisasolutiontotheMaxWelfareinstance𝐼′iffthereisasolutiontotheX3Cinstance𝐼.
Supposethereisasolution𝐶′ totheX3Cinstance𝐼.Recallthatsuchasolutionmusthaveexactlyℓ sets.Withoutlossofgenerality,
l re et spth ee cts ivo elu lytio ton tb he eg thiv re en eub ny i𝐶 ts′ 𝑤= 𝑗 ,{ 𝑤𝐶 1 𝑗,𝐶 an2 d,. 𝑤.. 𝑗,𝐶 oℓ f} b. uIf y𝐶 er𝑗 𝑏= 𝑗,{ 1𝑢 𝑗 ≤1,𝑢 𝑗𝑗 ≤2,𝑢 ℓ𝑗 .3 (} T, ha ess oig thn et rh 𝑟e −w ℓat be ur yu en rsit as r𝑤 en𝑗 1 o, t𝑤 a𝑗 s2 sa ign nd e𝑤 da𝑗 3 no yf wse al tl ee rrs u𝑠 n𝑗 i1 t, s𝑠 .)𝑗 2 Sia nn cd e𝑠 𝐶𝑗 3 ′
1 2 3
coversalltheelementsof𝑈,thisassignsallthe𝑡 =3ℓwaterunitsofthesellers.Sincethesetsin𝐶′arepairwisedisjoint,eachwaterunitof
asellerisassignedtoexactlyonebuyer.Thus,foreachseller𝑠 𝑖,thevalue𝑓 𝑠𝑖(𝑤𝑖) =1(1 ≤𝑖 ≤𝑡 =3ℓ),andforeachbuyer𝑏 𝑗,thevalue
𝑓 𝑏𝑗(𝑤 3𝑗 )=𝑄.Hence,thevalueofthewelfarefunctionis(cid:205)ℓ 𝑗=1𝑓 𝑏𝑗(𝑤 3𝐽 )−(cid:205) 𝑖3 =ℓ 1𝑓 𝑠𝑖(𝑤𝑖)=𝑄ℓ−3ℓ=ℓ(𝑄−3)=𝜆.Thus,wehaveasolutionto
theMaxWelfareinstance𝐼′.
NowsupposethereisasolutiontotheMaxWelfareinstance𝐼′.Wehavethefollowingclaim.
Claim1:AnyvalidsolutiontotheMaxWelfareinstance𝐼′mustincludethefollowingtwoproperties:(a)exactlyℓbuyershaveavalueof
𝑄fortheirvaluefunctions;and(b)allthe𝑡 =3ℓsellershavethevalue1fortheirvaluefunctions.
ProofofClaim1:First,considerPart(a).Sincethetotalnumberofavailablewaterunitsfromthesellersis𝑡 =3ℓandeachbuyerneeds3
unitsfortheirvalue-functionstohaveavalue𝑄,atmostℓbuyerscanhavethevalue𝑄fortheirvaluefunctions.Now,supposeforthesake
ofcontradiction,thenumber𝑧ofbuyerswiththevalue𝑄fortheirvalue-functionsislessthanℓ.Suchanassignmentwoulduseatleast3𝑧
waterunitsofsellers(sinceeachbuyerwithvaluefunction𝑄needsthreewaterunits).Thenthevalueofthewelfarefunctionisatmost
𝑧𝑄−3𝑧=𝑧(𝑄−3).Since𝑧 <ℓ,thevalueofthewelfarefunctionis<𝜆=ℓ(𝑄−3).Thiscontradictstheassumptionthatthevalueofthe
welfarefunctionisatleastℓ(𝑄−3),andcompletesourproofofPart(a).
ToprovePart(b),notethatfromPart(a),thenumberofbuyerswiththevalue𝑄 fortheirvaluefunctionisℓ.Sinceeachsuchbuyer
isassignedthreewaterunits,itfollowsthatthetotalnumberofwaterunitsassignedtoallthebuyersis3ℓ.Thiscompletestheproofof
Claim1.□
InviewofClaim1,anysolutiontoinstance𝐼′hasexactlyℓbuyers,eachofwhomhasbeenassignedthreewaterunits.Withoutlossof
generality,let{𝑏 1,𝑏 2,...,𝑏 ℓ}denotethissetofbuyers.Constructthefollowingcollection𝐶′ofsubsets:foreachbuyer𝑏 𝑗 inthesolution,
choosethecorrespondingset𝐶
𝑗
in𝐶′,1≤ 𝑗 ≤ℓ.Sincethesetsofwaterunitsassignedtothebuyersarepairwisedisjointandthe3ℓwater
unitsofthesellersareusedinthesolutionto𝐼′,itcanbeseenthat𝐶′isasolutiontotheX3Cinstance𝐼′,andthiscompletesourproofof
Theorem4.2.C ADDITIONALMATERIALFORSECTION5
C.1 AdditionalMaterialforSection5.1
InSection5.1,weconsideredthewelfaremaximizationproblemwhentherearelowerboundsonthenumberofwaterunitstobeassigned
tosubsetsofbuyers.Here,weshowthat,ingeneral,theproblemofdeterminingwhetherthereisasolutionthatsatisfiesallsuchlower
boundconstraintsisitself NP-complete.Itshouldbenotedthatthisdecisionproblemdoesnotinvolvewelfaremaximization.Aformal
statementoftheproblemisasfollows.
FeasibilityofDemographicConstraints(FeasDemog)
Instance:Aset𝑆ofsellersandtheirwaterunits,aset𝐵ofbuyers,aresource–needscompatibilitygraph𝐺′,acollection𝐷ofconstraintsof
theform(𝐴,𝑞)where𝐴⊆𝐵isasubsetofbuyersand𝑞isapositiveintegerthatgivesalowerboundonthetotalnumberofwaterunitsto
beassignedtothebuyersin𝐴.
Question:Isthereavalidassignmentthatsatisfiesalltheconstraintsin𝐷?
ThefollowingresultestablishesthecomplexityoftheFeasDemogproblem.
PropositionC.1. TheFeasDemogproblemisNP-complete.
Proof:ItcanbeseenthattheFeasDemogproblemisinNPsincegivenanassignment,itiseasytoefficientlycheckwhetheritsatisfiesall
theconstraintsin𝐷.ToproveNP-hardness,weuseareductionfromtheMinVCproblem(definedinSectionA.1).
Givenaninstance𝐼 oftheMinVCproblemconsistingofagraph𝐺(𝑉,𝐸) andaninteger𝑘 ≤ |𝑉|,weconstructaninstance𝐼′ ofthe
FeasDemogproblemasfollows.
(1) Theset𝑆 ={𝑠 1,𝑠 2,...,𝑠 𝑘}consistsof𝑘sellers;eachseller𝑠 𝑖 hasexactlyonewaterunit𝑤 𝑖,1≤𝑖 ≤𝑘.
(2) Let|𝑉|={𝑣 1,𝑣 2,...,𝑣 𝑛}.Theset𝐵={𝑏 1,𝑏 2,...,𝑏 𝑛}ofbuyersisinone-to-onecorrespondencewiththenodeset𝑉.
(3) Theresource–needsgraph𝐺′isacompletebipartitegraphbetweenthewaterunitsofsellersandthebuyers.(Inotherwords,anywater
unitofthesellerscanbeassignedtoanybuyer.)
(4) Theset𝐷has𝑚=|𝐸|constraints.Foreachedge𝑒 ={𝑣 𝑖,𝑣 𝑗}of𝐺,wecreateaconstraint({𝑏 𝑖,𝑏 𝑗},1);thatis,thebuyerscorresponding
totheendpointsofedge𝑒mustbeassignedatotalofatleastonewaterunit.
Thiscompletestheconstruction.Itiseasytoverifythattheconstructioncanbecarriedoutinpolynomialtime.
SupposethereisasolutiontotheMinVCproblem.Withoutlossofgenerality,let𝑉′ ={𝑣 1,𝑣 2,...,𝑣 𝑘}denotethegivenvertexcoverof
size𝑘.ConsiderthematchingassignmentT givenbyT ={(𝑤 𝑖,𝑏 𝑖) : 1≤𝑖 ≤𝑘}.(Recallthatbuyer𝑏 𝑖 correspondstonode𝑣 𝑖 of𝐺.)Since
theresource–needsgraphisacompletebipartitegraph,thisassignmentsatisfiesthecompatibilityconditions.Toshowthatthisassignment
satisfiesalltheconstraintsin𝐷,consideranyconstraint({𝑏 𝑥,𝑏 𝑦},1)in𝐷.Thisconstraintwasaddedto𝐷duetotheedge{𝑣 𝑥,𝑣 𝑦}in𝐺.
Since𝑉′isavertexcoverfor𝐺,atleastoneof𝑣
𝑥
and𝑣
𝑦
appearsin𝑉′.Withoutlossofgenerality,let𝑣
𝑥
bein𝑉′.Thus,theassignmentT
givesawaterunittobuyer𝑏 𝑥,thussatisfyingtheconstraint({𝑏 𝑥,𝑏 𝑦},1).Thus,wehaveavalidsolutiontotheFeasDemoginstance𝐼′.
Now,supposethereisasolutionT totheFeasDemoginstance𝐼′.Withoutlossofgenerality,letthissolutionassignwaterunitstobuyers
{𝑏 1,𝑏 2,...,𝑏 𝑟}forsome𝑟 ≤𝑘.(Sincethereareonly𝑘waterunitsintotal,thenumber𝑟 ofbuyerstowhomwaterunitscanbeassignedis
atmost𝑘.)Let𝑉′ ={𝑣 1,𝑣 2,...,𝑣 𝑟}bethenodescorrespondingtothebuyerstowhomwaterunitsareassignedbyT.Wenowshowthat
𝑉′isavertexcoverfor𝐺.Consideranyedge𝑒 ={𝑣 𝑥,𝑣 𝑦}of𝐺.Notethat𝐷hastheconstraint({𝑏 𝑥,𝑏 𝑦},1)correspondingto𝑒.Sincethis
constraintissatisfiedbyT,atleastoneof𝑏
𝑥
and𝑏
𝑦
mustbeassignedawaterunit.Thus,atleastoneofthesetwonodesappearsin𝑉′.
Thus,𝑉′isavertexcoverofsize≤𝑘for𝐺.ThiscompletesourproofofPropositionC.1.
C.2 AdditionalMaterialforSection5.2
ThepurposeofthissectionistoshowthattheMaxLeximinproblemcanbesolvedefficiently.Forthereader’sconvenience,werepeatthe
definitionoftheproblem.
DefinitionofMaxLeximinproblem:Givenasellerwithaset𝑊 of𝑘waterunits,asetofbuyers𝐵withthesamecostforeverywater
unit,andacompatibilitygraph𝐺 𝑤(𝑊,𝐵,𝐸 𝑤),findatradingassignmentT∗withtheleximin-largestbuyersatisfactionvector.
AsmentionedinSection5.2,weobtainanefficientalgorithmfortheMaxLeximinproblembyreducingittoaproblemcalledMaxTB-MRM
fromTrabelsietal.[45].AdefinitionoftheMaxTB-MRMproblemisasfollows.
Instance:Abipartitegraph𝐺(𝑋,𝑌,𝐸′),where𝑋 isasetofagentsand𝑌 isasetofresources,anumberofmatchingrounds,𝑘.Foreach
agent𝑥 𝑗,permissiblesetofrounds𝐾 𝑗 ⊆ [𝑘],thedesirednumberofrounds𝜌 𝑗,andavalidbenefitfunction𝜇′ 𝑗(·).
Required:FindacollectionM∗consistingofatmost𝑘matchingsof𝐺 thatmaximizesthesum(cid:205) 𝑥𝑗∈𝑋 𝜇′ 𝑗(·).TheefficientalgorithmforMaxTB-MRMpresentedin[45]requiresthatthebenefitfunctionsforagentsbevalid.Thedefinitionofa
validbenefitfunctionisasfollows.
Validbenefitfunction:Foreachagent𝑥 𝑗,let𝜇 𝑗(ℓ)denotethenon-negativebenefitthattheagent𝑥
𝑗
receivesifitappearsinℓmatchings,
forℓ =0,1,2,...,𝜌 𝑗.Let𝛿 𝑗(ℓ) =𝜇 𝑗(ℓ)−𝜇 𝑗(ℓ−1)forℓ =1,2,...,𝜌 𝑗.Wesaythatthebenefitfunction𝜇
𝑗
isvalidifitsatisfiesallofthe
followingfourproperties:(P1)𝜇 𝑗(0) = 0;(P2)𝜇 𝑗 ismonotonenon-decreasinginℓ;(P3)𝜇 𝑗 hasthediminishingreturnsproperty,thatis,
𝜇 𝑗(ℓ)−𝜇 𝑖(ℓ−1) ≤𝜇 𝑗(ℓ−1)−𝜇 𝑖(ℓ−2)for2≤ℓ ≤𝜌 𝑖;and(P4)𝛿 𝑗(ℓ) ≤1,forℓ =1,2,...,𝜌 𝑗.
Notethat𝜇 𝑗(·)satisfiespropertyP3iff𝛿 𝑗(·)ismonotonenon-increasinginℓ.
Wenowshowthatthefollowingproblem,whichisrelatedtotheMaxLeximinproblem,canbeefficientlysolvedthroughareductionto
theMaxTB-MRMproblem.(ThisreductionwassketchedinSection5.2.)
FindingaTradingAssignmenttoMaximizetheTotalReward(Max-Reward-Trade)
Instance:Aset𝑊 = {𝑤 1,𝑤 2,...,𝑤 𝑡} ofwaterunits,aset𝐵 = {𝑏 1,𝑏 2,...,𝑏 𝑚} ofbuyers,abipartitecompatibilitygraph𝐺(𝑊,𝐵,𝐸),a
requirement𝜌 𝑗 ≤ |𝑊|andavalidbenefitfunction𝜇 𝑗 foreachbuyer𝑏 𝑗.(Thebenefitfunction𝜇 𝑗(ℓ)isdefinedforallℓ,0≤ℓ ≤𝜌 𝑗.)
Required:FindatradingassignmentT suchthatthetotalrewardB(T)=(cid:205)𝑚 𝑗=1𝜇 𝑗(·)duetotheassignmentismaximized.
LemmaC.2. TheMax-Reward-TradeproblemcanbesolvedinpolynomialtimethroughareductiontotheMaxTB-MRMproblem.
Proof:AreductionfromtheMax-Reward-TradeproblemtotheMaxTB-MRMproblemisasfollows.
(1) Thecompatibilitygraph𝐺′(𝑋,𝑌,𝐸′)isagraphwith𝑋 =𝐵,𝑌 = {𝑣}isasinglenodewhichrepresentsonedifferentwaterrightper
matchingroundand𝐸′ ={{𝑥,𝑦}|𝑥 ∈𝑋,𝑦 ∈𝑌}.(Thus,𝐺′isastargraphwithacenternodeand|𝐵|leaves).
(2) Thetotalnumberofroundsis𝑘 =|𝑊|(i.e.,thenumberofwaterunits).
(3) Foreachbuyer𝑏 𝑗,𝐾 𝑗 ={𝑖|(𝑣 𝑖,𝑣 𝑗) ∈𝐸}(oneroundpercompatiblewaterunit).
(4) Foreachbuyer𝑏 𝑗,thedesirednumberofroundsis𝜌 𝑗.
(5) Foreachbuyer𝑏 𝑗,thebenefitfunctionis𝜇 𝑗.
GivenasolutionMtoMaxTB-MRM,weconstructatradingassignmentT asfollows:eachmatchingedgeinMbecomesoneentry
(𝑤 𝑖,𝑏 𝑗)ofT;here,𝑤 𝑖isdeterminedbythematchingroundand𝑏 𝑗 bytheagent.ToseethatanoptimalsolutiontoMaxTB-MRMprovidesan
optimalsolutiontoMax-Reward-Trade,consideranoptimalsolutionM∗toMaxTB-MRMandletthiscorrespondtoatradingassignment
T forMax-Reward-Trade.AssumeforthesakeofcontradictionthatthereisasolutionT′ suchthatB(T′) > B(T).GivenT′,we
constructamatchingsolutionM′suchthatforeachbuyerandassignedwaterrightinT′,wematchthecorrespondingbuyertothewater
unitinthecorrespondinground.ItcanbeseenthattheresultingsolutionisvalidtoMaxTB-MRM.Furthermore,itsvalueisgreaterthan
thatofB(M∗),contradictingtheassumptionthatM∗isanoptimalsolutiontotheMaxTB-MRMinstance.Toconclude,wehaveanoptimal
solutiontotheMax-Reward-Tradeinstance.□
Whenthebenefitfunction𝜇 𝑗 foreachbuyer𝑏 𝑗 hastheform𝜇 𝑗(ℓ)=ℓ,for0≤ℓ ≤𝜌 𝑗,thetotalrewardofallthebuyersrepresentsthe
totalnumberofwaterunitsassigned.Thus,theabovereductionshowsthattheproblemoffindingatradingassignmentthatmaximizesthe
totalnumberofwaterunitsassignedintheabovesettingcanbesolvedefficiently.
WenowaddressthemainresultwhichistoshowthatthealgorithmforMaxTB-MRMin[45]canbeusedtosolvetheMaxLeximin
problem.Thisisdonebyshowingthatavalidrewardfunctionforeachbuyercanbeconstructedsothatmaximizingthetotalreward
producesasolutiontotheMaxLeximinproblem.Westatethisresultbelow.
LemmaC.3. ConsideranyinstanceoftheMaxLeximinproblem.Thereexistsavalidbenefitfunction𝜇 𝑗 foreachbuyer𝑏 𝑗 suchthatmaximizing
thetotalbenefitunderthisfunctiongivesasolutiontotheMaxLeximinproblem.
WeproceedtoproveLemmaC.3inseveralstages.Wefirstgivetheprocedureforconstructingavalidbenefitfunctionforeachbuyer.The
stepsofthisprocedureareasfollows.(Thereadershouldbearinmindthat𝐵and𝑊 denotethesetofbuyersandwaterunits,respectively,
oftheMaxLeximinproblem.Also,foreachbuyer𝑏 𝑗,𝜌 𝑗 givesthenumberofwaterunitsdesiredby𝑏 𝑗.)
(1) Let𝐹 =(cid:8)𝑘 𝑖/𝑘 𝑗 |𝑘 𝑖,𝑘 𝑗 ∈ [𝑊]}and𝑘 𝑖 ≤𝑘 𝑗(cid:9) ∪{0}.
(2) Let𝜋 :𝐹 →{1,...,|𝐹|}correspondtotheindexofeachelementin𝐹 whensortedindescendingorder.
(3) Foreach𝑞 ∈𝐹,let𝜉(𝑞)=(|𝐵|·|𝑊|)𝜋(𝑞)/(|𝐵|·|𝑊|)|𝐹|.Notethateach𝜉(𝑞) ∈ (0,1].
(4) Theincrementalbenefit𝛿 𝑗(ℓ)forabuyer𝑏 𝑗 fortheℓthwaterunitisdefinedas𝛿 𝑗(ℓ)=𝜉(cid:0)(ℓ−1)/𝜌 𝑗)(cid:1) .Thus,thebenefitfunction𝜇 𝑗 for
buyer𝑣 𝑗 isgivenby𝜇 𝑗(0)=0and𝜇 𝑗(ℓ)=𝜇 𝑗(ℓ−1)+𝛿 𝑗(ℓ)for1≤ℓ ≤𝜌 𝑗.
Itcanbeseenthat𝜇 𝑗 satisfiespropertiesP1,P2andP4ofavalidbenefitfunction.WenowshowthatitalsosatisfiesP3,thediminishing
returnsproperty.
LemmaC.4. Foreachbuyer𝑏 𝑗,theincrementalbenefit𝛿 𝑗(ℓ)ismonotonenon-increasinginℓ.Therefore,𝜇 𝑗(·)satisfiesdiminishingreturns
property.Proof. Bydefinition,forℓ =1,...,𝜌 𝑗−1,𝛿 𝑗(ℓ)/𝛿 𝑗(ℓ+1)=𝜉(cid:0)(ℓ−1)/𝜌 𝑗(cid:1)/𝜉(cid:0)ℓ/𝜌 𝑗(cid:1) ≥ |𝐵|·|𝑊| >1,bynotingthat𝜋(ℓ/𝜌 𝑗)−𝜋((ℓ+1)/𝜌 𝑗) ≥1.
Hence,thelemmaholds. □
TocompletetheproofofLemmaC.3,wemustshowthatanysolutionthatmaximizesthebenefitfunctiondefinedaboveoptimizesthe
leximinorder.Westartwithsomedefinitionsandalemma.
Forabuyer𝑏
𝑗
and𝑞 ∈𝐹,let𝐹 𝑗>(𝑞)={ℓ |0≤ℓ ≤𝜌
𝑗
andℓ/𝜌
𝑗
>𝑞}.Wewillnowshowthattheincrementalbenefit𝛿 𝑗(ℓ)obtainedby
buyer𝑏 𝑗 formatchingℓisgreaterthanthesumofallincrementalbenefits𝛿 𝑗′(ℓ′),forallbuyers𝑏 𝑗′ andforallℓ′satisfyingℓ′/𝜌 𝑗′) >ℓ/𝜌 𝑗.
LemmaC.5. Foranybuyer𝑏 𝑗 andnon-negativeintegerℓ ≤𝜌 𝑗,wehave𝛿 𝑗(ℓ) >(cid:205) 𝑗′∈𝐵(cid:205) ℓ′∈𝐹 𝑗> ′(ℓ/𝜌𝑗)𝛿 𝑗′(ℓ′).
Proof. Foranyℓ′ ∈ 𝐹 𝑗> ′(ℓ/𝜌 𝑗),notethatℓ/𝜌 𝑗 < ℓ′/𝜌 𝑗′.Hence,𝜋(ℓ/𝜌 𝑗) −𝜋(ℓ′/𝜌 𝑗′) ≥ 1.Thisimpliesthat𝛿 𝑗(ℓ)/𝛿 𝑗′(ℓ′) = 𝜉(cid:0)(ℓ −
1)/𝜌 𝑗(cid:1)/𝜉(cid:0)(ℓ′−1)/𝜌 𝑗′)(cid:1) ≥ |𝑊|·|𝐵|.Since𝜌𝑗′ ≤ |𝑊|,thenumberof𝛿 𝑗′(ℓ′)termsper𝑗′isatmost|𝑊|.Sinceℓ/𝜌 𝑗 ∉𝐹 𝑗> ′(ℓ/𝜌 𝑗),thenumber
of𝛿 𝑗′(ℓ)termsfor𝑗′ =𝑖isatmost|𝑊|−1.Sincethereare|𝐵|buyers𝑏
𝑗′
∈𝐵,itfollowsthatthereareatmost|𝐵|·|𝑊|−1terms𝛿 𝑗′(ℓ′)in
total.Therefore,(cid:205) 𝑗′=𝑖(cid:205)
ℓ′∈𝐹 𝑗> ′(ℓ/𝜌𝑗
𝛿 𝛿𝑗′ 𝑗(( ℓℓ′ )) <1. □
WearenowreadytocompletetheproofofLemmaC.3.
ProofofLemmaC.3.Theproofisbycontradiction.SupposeA∗isanoptimalsolutiongiventhebenefitfunctiondefinedabove.Wewillshow
thatifthereexistsasolutionAwithleximinorderbetterthanthatofA∗,thenthetotalbenefitB(A) >B(A∗),contradictingthefactthatA∗
isanoptimalsolution.Let𝐴=(𝑙 1/𝜌 1,𝑙 2/𝜌 2,...,𝑙 |𝐵|/𝜌 |𝐵|)beasortedlistofsatisfactionratiosforAandlet𝐴∗=(𝑙 1∗/𝜌 1,𝑙 2∗/𝜌 2,...,𝑙∗ |𝐵|/𝜌 |𝐵|)
bealistdefinedsimilarlyforA∗.Let𝑘denotethefirstindexforwhich𝑙 𝑘/𝜌 𝑘 ≠𝑙 𝑘∗/𝜌 𝑘.
ForagivensolutionA,weuse𝛾 𝑗(A)todenotethenumberofwaterrightsassignedtobuyer𝑏 𝑗,1≤ 𝑗 ≤ |𝐵|.Werecallthatthebenefit
functionforAcanbewrittenasB(A)=(cid:205)| 𝑗𝐵 =| 1(cid:205)𝛾 ℓ=𝑗( 1A)𝛿 𝑗(ℓ).Foreach𝑗,the𝛿 𝑗(ℓ)termscanbepartitionedintotwoblocksasfollows.
(i)𝐷 1(A)={(𝑗,ℓ) |∀𝑗, ℓ/𝜌
𝑗
<𝑘},and
(ii)𝐷 2(A)={(𝑗,ℓ) |∀𝑗, ℓ/𝜌
𝑗
≥𝑘.
WecanpartitionthetermscorrespondingtoB(A∗)inthesameway,andtheseblocksaredenotedby𝐷 1(A∗)and𝐷 2(A∗).Fromthedefinition
of𝑘,itfollowsthat𝐷 1(A∗)=𝐷 1(A).SinceAhasabetterleximinorder,and,fromdefinition,itfollowsthatℓ 𝑘∗/𝜌 𝑘 <ℓ 𝑘/𝜌 𝑘.Inaddition,from
theorderoftheratiolists,itfollowsthatℓ 𝑘/𝜌 𝑘 >ℓ 𝑗∗/𝜌 𝑗 forall𝑗 >𝑘.FromlemmaC.5,itfollowsthat𝛿 𝑘(ℓ 𝑘) >(cid:205) 𝑗′∈𝐵(cid:205) ℓ′∈𝐹 𝑗> ′(ℓ/𝜌𝑗𝛿 𝑗′(ℓ′),
and,therefore,𝛿 𝑘(ℓ 𝑘) >(cid:205) (𝑗,ℓ)∈𝐷 (A∗)𝛿 𝑗(ℓ).Finally,weget
2
B(A)−B(A∗)= ∑︁ 𝛿 𝑗(ℓ)− ∑︁ 𝛿 𝑗(ℓ)
(𝑗,ℓ)∈𝐷 (A) (𝑗,ℓ)∈𝐷 (A∗)
2 2
∑︁
≥𝛿 𝑘(ℓ 𝑘)− 𝛿 𝑗(ℓ) >0
(𝑗,ℓ)∈𝐷 (A∗)
2
Thus,B(A) >B(A∗),andthiscontradictstheoptimalityofA∗.Thelemmafollows. □
Thus,wehaveshownthatanygiveninstanceoftheMaxLeximinproblemcanbesolvedefficientlybyconstructingsuitablebenefit
functionsforeachbuyer,reducingtheproblemtotheMaxTB-MRMproblem,andthenusingtheefficientalgorithmfortheMaxTB-MRM
problemfrom[45].Wehavethuscompletedaproofofthefollowingtheorem(i.e.,Theorem5.3ofSection5.2):
Theorem5.3:AnoptimalsolutiontotheMaxLeximinproblemcanbeobtainedinpolynomialtime.
D ADDITIONALMATERIALFORSECTION6
Thereal-worldnetworkswereconstructedusingwaterrightsdata,acreage,typesofcropsgrown,andwaterdemandbycroptype[13,25,46].
Weidentified93waterrightsheldintheTouchetRiverWatershedand77waterrightsheldintheYakimaRiverBasin.Bothoftheserivers
areinWashingtonState.Thewaterrightswerecorrelatedwiththeirassociatedfarmfields,whichallowedthewaterrightstobemapped
totheircorrespondingcroptypes,acreage,andwaterdemand.UsingWashingtonStatecropproductiondatafromtheUSDANational
AgriculturalStatisticsService(NASS)[25],weestimatedthevalueofproductionperacreforeachcroptype,andmadeeducatedguesseson
thosecroptypeswhichwerenotincludedinNASSdata.Wethencalculatedthevolumeofwaterneededperwaterrightcroptype,and
assignedamonetaryvaluetoeachunitofwaterneeded.Toassignthevalueperunit,wefirstcalculatedthetotalvolume𝑣 𝑖 neededper
field𝑖inacre-feetas𝑣 𝑖 =round(𝑎 𝑖 ·𝑚𝑚 𝑖/304.8),where𝑎 𝑖 and𝑚𝑚 𝑖 denoterespectivelytheacreageandthevolumerequiredperacre(in
acre-millimeters)offield𝑖.
Thetotal(baseline)watercapacity𝑊 wascalculatedasthesumofdemandsacrossallofthewaterrightsperwatershed(Touchetand
Yakima)undernormalconditions.Thereducedwatercapacity𝑅–toaccountfordroughtconditions–wascalculatedas𝑅
𝑖
=𝑐 𝑖/100*𝑊
foreachpercentagecapacity𝑐in[10%..90%],calculatedin10%increments.Sortingthewaterrightsbyseniority(basedonprioritydate),Table1:Datasetsandtheirattributes.
Data Num. Totalwa- Totalvalue Max. Min.
agents terunits value value
Synthetic 10 50 variable variable variable
Touchet5 93 2704 8,533,475.94 57629.24 703.38
Touchet10 93 1389 8,778,037.64 115258.49 1406.77
Touchet20 93 741 9,400,712.72 230516.97 2813.54
Yakima5 77 3616 21,838,629.76 31606.52 264.33
Yakima10 77 1838 22,088,453.49 63213.04 528.66
Yakima20 77 952 22,698,607.80 126426.07 1057.31
moreseniorwaterrightsweredesignatedassellersuntilthesumofthesellers’watervolumeswouldhaveexceeded𝑅.Allother,more
junior,waterrightsweredesignatedasbuyers.Then,foreachsellerandbuyer,wedisaggregatedthetotalvolumeandvalueperunitinto
separaterowsbyunit.Fortheseller,itwasassumedthattheywouldprioritizesellingwaterfortheirlowervaluecropsfirst,sothearrayof
disaggregatedunitswouldbesortedbyvalueperunitinascendingorder.Similarly,buyerswouldprobablyprioritizebuyingwaterfortheir
high-valuecropsfirst,sotheirarrayofdisaggregatedunitswassortedbyvalueperunitindescendingorder.
Finally,abipartitegraphwascreated,mappingeachofthesellers’unitsofwatertocompatiblebuyers’units.Inordertobecompatible,(𝑖)
thebuyerhadtobeupstreamordownstreamoftheseller(e.g.,notindifferentstreamshedsorindifferentforksofthesameriver),and(𝑖𝑖)
thebuyer’svalueforagivenunithadtobegreaterthanorequaltotheseller’svalue(orprice)forthatunit.
AsummaryofvaluesforYakima–basedondifferent𝑅values–canbeseeninTable2.Afewobservationsareworthnoting.TheUnit
SizeinAcre-Feetindicatesthatunitsizewascalculatedbetweenrowsfor10and20acre-feetperunit,whichexplainswhythe20acre-feet
numberofunitswillalwaysbecloseto50%ofthe10acre-feetnumberofunits.Second,whendividingtheacre-feetperunitsize,anypartial
unitsareroundeduptothenextintegervalue,whichiswhytheTotalValueforthe20acre-feetunitsizewillalwaysbesomewhatlarger
thantheTotalValueforthecorresponding10acre-feetunitsize.Thereappearstobenodifferencebetweenthe10%watercapacityand
20%watercapacitystatisticsbecausethesecondmostseniorwaterrightincludedmorethan20%ofthetotalwaterunits,whichprevented
thenumberofsellerstoincreaseuntiltotalwatercapacityroseto30%.Finally,thesevaluesarebasedonlyonthestatisticsforthedataset
pre-experiment,orthenumberofunitsandtotalvaluethatcouldpossiblybetraded,butnottheactualtotalsfrommatchingdoneduring
trading.
%TotalWaterCapacity UnitSizeinAcre-Feet #Units TotalValue Sellers Buyers
10% 10 11 $27534.75 1 76
10% 20 6 $30037.91 1 76
20% 10 11 $27534.75 1 76
20% 20 6 $30037.91 1 76
30% 10 542 $10,664,614.78 8 69
30% 20 276 $10,795,007.24 8 69
40% 10 705 $14,590,442.54 26 51
40% 20 366 $14,872,635.68 26 51
50% 10 905 $14,980,581.61 37 40
50% 20 471 $15,287,062.66 37 40
60% 10 1060 $15,321,802.09 46 31
60% 20 551 $15,639,329.06 46 31
70% 10 1270 $19,918,785.39 57 20
70% 20 659 $20,363,049.477 57 20
80% 10 1435 $20,386,759.85 63 14
80% 20 745 $20,882,922.60 63 14
90% 10 1556 $20,630,547.56 68 9
90% 20 807 $21,134,945.99 68 9
Table2:Valuebreakdownandseller-buyerratiosfortheYakimadatasetforunit-sizes10and20acre-feetperunit.
Thesizeofwaterunits.Werecallthatallourproposedalgorithmsruninpolynomialtimeinthenumberofwaterunits.Thisisunlike
theproblemsconsideredinLiuetal.[29],wherethecomplexitywaswithrespecttothenumberofagents.Giventheheterogeneityinthe
valuationofeachwaterunit,thisisunavoidable.Onewaytomitigatethisproblemistoincreasethesizeofasinglewaterunit.OurresultsinFigure3comparenetworkswithdifferentwaterunitresolutionswithrespecttoboththestructuralpropertiesandthewelfarefrom
trade.WenotethatPlot(a)isnotaffectedbythecoarseningoftheresolution,i.e.,thenumberofsellersremainsthesameasafunction
of𝛿.However,wedoseeabenefitofcoarsening,asitgreatlyreducesthenumberofedgesintheresources–needscompatibilitygraphsas
thesizeofawaterunitisincreased.However,weobservethatcoarseninghasverylittleeffectontotalvalue.Wedoobserveasignificant
differenceinthewelfarecurvesofTouchet10andTouchet20.Wenotethatforanyfixedvalueof𝛿,thegreaterthesizeofthewaterunit,
thegreateristhewelfare.Thisismainlyduetoroundingeffectsthatleadtoanincreaseinthetotalnumberofwaterunits.However,the
trendremainsthesameacrossdifferentsizes.