RuleAlign: Making Large Language Models Better Physicians with
Diagnostic Rule Alignment
XiaohanWang‚ô†‚ô¢,‚àóXiaoyanYang‚ô°‚àó,YuqiZhu‚ô†‚ô¢,YueShen‚ô°,JianWang‚ô°
PengWei‚ô°,LeiLiang‚ô°,JinjieGu‚ô°,HuajunChen‚ô†‚ô¢,NingyuZhang‚ô†‚ô¢‚Ä†
‚ô†ZhejiangUniversity, ‚ô°AntGroup
‚ô¢ZJU-AntGroupJointResearchCenterforKnowledgeGraphs,
{wangxh07,zhangningyu}@zju.edu.cn
Abstract
LargeLanguageModels(LLMs)likeGPT-4,
MedPaLM-2, and Med-Gemini achieve per-
formance competitively with human experts
acrossvariousmedicalbenchmarks. However,
they still face challenges in making profes-
sionaldiagnosesakintophysicians,particularly
inefficientlygatheringpatientinformationand
reasoningthefinaldiagnosis. Tothisend,we
introducetheRuleAlignframework,designed
to align LLMs with specific diagnostic rules.
We develop a medical dialogue dataset com-
prisingrule-basedcommunicationsbetweenpa-
tientsandphysiciansanddesignanalignment Figure1: Inmedicalpractice,physiciansneedtogather
learningapproachthroughpreferencelearning. sufficientpatientinformationthroughinquirytomake
Experimentalresultsdemonstratetheeffective- thefinaldiagnosticopinion. Asprofessionalphysicians,
nessoftheproposedapproach. Wehopethat theirquestionsareusuallyrule-aligned,makingtheen-
ourworkcanserveasaninspirationforexplor- tireprocessefficientandlogical.
ingthepotentialofLLMsasAIphysicians.
1 Introduction
2023; Gao et al., 2023). One critical issue is log-
Medical diagnosis involves physicians obtaining ical consistency: LLMs may propose diagnostic
patients‚Äôsubjectivesymptomsthroughquestioning, hypotheseswithoutadequateinformationalsupport
as well as objective examination results, to infer or disregard previous replies, leading to unsatis-
the most likely diseases or health issues (Zhang factoryresponses(Li√©vinetal.,2024). Moreover,
et al., 2022; He et al., 2023; G√∂nd√∂cs and D√∂r- LLMs face significant challenges in adhering to
fler,2024;Caruccioetal.,2024). LargeLanguage rules(Mesk√≥andTopol,2023;Luetal.,2024;Luo
Models(LLMs)canextendmedicalresourcesby etal.,2024). Notethatmedicalpracticeisgoverned
leveragingmedicalcorporainpretrainingtosimu- bystringentprofessionalguidelinesandstandards
latephysicians,providinginitialscreeningservices asshowninFigure1,yetLLMsoftendemonstrate
that alleviate theburdenon physicians andaccel- limited familiarity with regulations, resulting in
eratethediagnosticprocessforpatients (Singhal informationalshortfalls. Furthermore,thelackof
et al., 2023a; Peng et al., 2023; Wu et al., 2024; specializedknowledgeisevidentasLLMsstruggle
Zhang et al., 2023; Thirunavukarasu et al., 2023; toaccuratelycomprehendandutilizeprofessional
Baoetal.,2023a). However,LLMsfaceasignifi- terminology,renderingthemincapableofprovid-
cantgapcomparedtorealphysicians(Zhouetal., ingconvincingdiagnosesandactionableadvice.
2023; Jiang et al., 2023; Tu et al., 2024), particu- Tothisend,weintroducetheRuleAlignframe-
larlyinspecializedinquiriesforspecialtydiseases. worktomakeLLMsbetterphysicianswithdiagnos-
Theparadigmsofexistingworksaretoocoarse ticrulealignment. Specifically,wecollectthenec-
in disease categories and differ greatly from ac- essarydiagnosticruleswithinthefieldofurology
tual consultations (Chen et al., 2023b; Jin et al., and provide a rule-based dialogue dataset Urolo-
‚àóEqualcontribution. gyRD.ItisdesignedtoguidethebehaviorofLLMs,
‚Ä†Correspondingauthor. ensuringthattheirresponsesalignwithestablished
4202
guA
22
]LC.sc[
1v97521.8042:viXraprotocols. Wetrainthemodelbyconstructingopti- selection responses, iterating until the model can
mizedpreferencepairswithoutadditionalhuman- nolongerdistinguishbetweenthem.
annotation resource, which can achieve improve-
ments in both single-round evaluation and multi- 3 DatasetConstruction
roundStandardPatienttesting(Liuetal.,2024).
3.1 DiagnosticRuleCollection
2 RelatedWorks Tomeettheneedsofrealpatientclinicalscenarios,
we introduce more detailed diagnostic rules dur-
MedicalLLMs. MedicalLLMsholdsignificant
ingthedatasetconstruction. Bysummarizingrel-
application value, with both academic and indus-
evantconversationsandextractingkeyrulesfrom
trialsectorsactivelyadvancingtheirdevelopment.
standardizeddiagnosticguidelines,wespecifythe
ByintroducingmedicaldataintogeneralLLMs,
physician‚Äôs diagnostic rules at the level of target
supervised finetuning (SFT) becomes more com-
diseasesandstronglyassociatedevidenceasshown
mon,suchasMedPaLM-2(Singhaletal.,2023b),
inFigure2. Tofurtherfocusourresearchandbetter
and Med-Gemini (Saab et al., 2024). It also
addressspecializedissues,wetakeurologyasan
leads to the emergence of many Chinese medi-
exampleandconstructrulesforitscommontarget
cal LLMs, including DoctorGLM (Xiong et al.,
diseases,thatis,eachdiseased isequippedwith
i
2023), HuatuoGPT-II (Chen et al., 2023a), and
itscorrespondingdiagnosticrulesr.
i
Zhongjing (Yang et al., 2024). BianQue (Chen
Diagnostic rules r can be divided into two as-
et al., 2023b) utilize BianQueCorpus dialogue i
pects: constraintswithinthediagnosislogicand
dataset optimized and constructed via ChatGPT,
the search for important evidence. The former
balancing the capability of asking questions and
atthelogicallayerprimarilyproceedaccordingto
providing health advice. The characteristic of
the trajectory reformulated as œÑ = (s ‚Üí e ‚Üí
DISC-MedLLM(Baoetal.,2023b)liesinenhanc- i i i
h ‚Üí d). Here,thetrajectorycomponentsarede-
ingconversationalabilitybyincorporatingknowl- i i
finedasfollows: thepatient‚Äôssubjectivesymptom
edgegraphquestion-answerpairsandhumanpref-
descriptions,thecollectionofpatient‚Äôsobjective
erenceguidedconversationsintoinstructiondata. i
examination results e , the inquiry into the pa-
PLPF (Dou et al., 2024) involves rule modeling i
tient‚Äôs personal medical history h, and the final
and preference learning to integrate the doctor‚Äôs i
diagnosticopinion. Patientsoftenfirstreportpain
diagnosticlogicintoLLMs.
or discomfort; strategically following this trajec-
Model Alignment. Human feedback (Ouyang tory can effectively collect more comprehensive
etal.,2022)iswidelyappliedtoenhancetheper- medicalinformation.
formanceofLLMsthroughoptimizedpreference Asforkeypatientevidence,patientsfrequently
learning. RLHF(Christianoetal.,2017)employs fail to identify which information is relevant for
arewardmodeltrainedviatheBradley-Terry(BT) an accurate diagnosis, necessitating detailed in-
modeltosuggestoptimizedoutputsthatmaximize quiries by doctors. Within the symptom set S =
rewards through RL algorithms like PPO (Schul- {S ,S ,S ,...},basedondiagnosticknowledge,
a b c
manetal.,2017). SLiC(Zhaoetal.,2023)ranks symptomsS andS areoftenassociatedwiththe
a b
model-generatedpreferencesbycombininglosses, target disease, making them key diagnostic indi-
whileRRHF(Yuanetal.,2023)assumesmultiple cators. For example, fever and difficulty urinat-
rankedresponsesforzero-marginlikelihoodcon- ing are important symptom evidences for blad-
trastiveloss;bothmethodsrelyonexplicitreward der cancer. Objective examination results E =
models. TheproposeofDPO(Rafailovetal.,2023) {E ,E ,E ,...},comprisingphysicalexams,lab-
a b c
providesatheoreticalandtechnicalbasisforalign- oratorytests,andimagingstudies,areessentialfor
mentmethodsfreefromthedependenceonreward their reliability and minimal bias, thereby helps
models. DPOdirectlyusestheBTmodeltofitthe confirm the validity of a diagnosis. Professional
preferences. RSO(Liuetal.,2023)combinesthe doctorsselectandcategorizeexaminationevidence
benefitofSLiCandDPOwithdataaugmentation basedonimportanceandprovideacorresponding
throughstatisticalrejectionsampling. SPIN(Chen orderERbasedonpracticalexperience. Personal
et al., 2024) enhances DPO using self-iterative medical history H can be categorized into med-
training with SFT data, treating synthetic data as ication, surgical, past medical, and reproductive
rejection responses and high-quality SFT data as histories;selectivequestioningbasedonnecessity.Symptoms Examination History Final diagnosis
ùëÜ:the symptom set ùê∏: objective examination results ùêª: Personal medical history
Important pEnhanced MRI Medication histories
S : Backache pUrgency
a
Surgical histories
Normal pUrine Culture
S b : Fever pUrinalysis
Past medical histories
‚Ä¶
Exam Order Urinalysis > Enhanced MRI
ùëÜ = {S, S, S , ...} = CT Urography Reproductive histories
a b c
Figure2: Physicians‚Äôdiagnosticrulesarespecifiedforspecificdiseasesandcloselyassociatedevidenceinthis
study. Theyadheretonotonlygeneraldiagnosticprinciplesbutalsospecializeddiseaserequirements.
Therefore,K = {S ,E ,ER ,H }denotesthe originaldialogueM intoarule-baseddialogueMr.
i di di di di
essentialpatientevidences,includingsymptoms, Thisadaptationprocesscanbeformulatedas:
examinationresults,examinationorderandmedi-
cal history. In conclusion, the diagnostic rules r Mr = G (M,r) = G (G (q,d),T(œÑ,K))
i i p i i p M i i i i
integratetheelementsœÑ andK toenhancetheeffi-
i i
ciencyandeffectivenessofthediagnosticprocess. whereTrepresentsthetemplateofrulesandpen-
capsulatestheconstraintsnecessarytoensurethe
3.2 DatasetGeneration
patient‚Äôs honesty and clarity of intent. Through
Data Collection. Open-sourced medical dia- thisapproach,thesynthesizeddialoguesnotonly
loguedatasets(Zengetal.,2020)frequentlylack conformmorecloselytotheprescribeddiagnostic
structured examination results, leading to incom- rulesbutalsomaintainconsistencyandreliability.
pletediagnostictrajectory. Duetotheoverlapbe-
tween disease categories and our specific targets, 3.3 QualityControl
wechoosetheRJUA-QA(Lyuetal.,2023)asini- Toensureprecisionandintegrity,UrologyRDun-
tialdata. Afterfilteringthecategories,weconvert dergoes rigorous annotation by professional doc-
single-turn question q and corresponding disease tors. Inourprocess,urologyspecialistsreviewall
d into dialogues M, encompassing the trajectory diagnosticrulesr. Basedonthesevalidatedrules,
i
frominitialsymptomstophysiciandiagnoses,rep- thepassrateforahundredsamplesinUrologyRD
resentedasM = G M(q,d), whereGdenotesthe approaches70%,withexpertsdeemingthesedia-
GPT-4turboAPI. logues to be comprehensive and logical. We list
thedatastatisticsinTable1.
DiseaseNameMapping. Indataconstruction,it
isimperativetomapdiseasenamesmeticulously.
Statistics Items Number
Thisinvolvesdistillingintricatepathologydescrip-
Disease 32
tionsfoundinclinicalrecordsintobroadermedical
DiagnosticRules 32
categories(e.g.,"rightrenalhydronephrosis"to"re-
TrainDialogues 2,267
nalhydronephrosis"). Detailslikewhichsideand Number
TrainRounds 14,599
progressionstagewhilecriticalforclinicalinvesti-
TestDialogues 107
gations,wieldlimitedinfluenceonqueryandrisk
TestRounds 720
complicatingstudydesignsunduly. Consequently,
wemapdiseasetermstodefinedcategories,ensur- RoundsPerDialogue 13/3
Max/Min
ingrobustdatacompilationandprecisealignment LengthEachRound 200/3
withestablisheddiagnosticrules.
Table1:ThistableoutlinesthestatisticsforUrologyRD,
Diagnostic Rule Adaption. By applying rules includingcountsandlengthsforvariouscomponents.
r into the prompts for LLMs, we transform thecalculatestheoptimizationstrategy‚Äôsrewardusing
aclosed-formexpression,implicitlydefinedbythe
modelsœÄ andœÄ ,denotedas
Œ∏ ref
œÄ (y|x)
Œ∏
r (x,y) = Œ≤log (2)
Œ∏
œÄ (y|x)
ref
Here,Œ≤ signifiesahyper-parametercontrolling
the scale of the reward difference. DPO directly
simplifiesthelearningoftheoptimalstrategyusing
Figure3: ThepipelineofRuleAlign. Theoptimization preferencepairsDp,aimingtoincreasethelikeli-
containsdistinctstrategiestobuildthepreferencepairs
hoodofpreferredcompletionsy anddecreasethe
w
withoutextrahuman-annotationresource.
likelihoodofdispreferredcompletionsy ,as
l
4 TheProposedApproach: RuleAlign L (œÄ ;œÄ ) =‚àí E (cid:2)
DPO Œ∏ ref
4.1 Overview
‚ü®x,yw,y l‚ü©‚àºDp
(cid:3)
logœÉ(r (x,y )‚àír (x,y ))
Œ∏ w Œ∏ l
Preference learning (Jiang et al., 2024), which
(3)
leverageshuman-labeledpreferencepairs,iscon-
sideredaneffectivemethodforaligningLLMswith
4.3 PreferencePairOptimization
humanobjectives. DPOstandsasaprominentap-
proachinofflinepreferenceoptimization(Rafailov
Weproposeanefficientmethod,RuleAlign,which
et al.,2023), notable foreliminating the needfor
isdesignedtoautomaticallygenerateandoptimize
anexplicitrewardmodel. High-qualitypreference
preferencedataforalignment(inFigure3). Build-
pairs are essential for DPO but typically demand
ingonpreviousresearch,weutilizedialoguessyn-
substantialmanualannotationresources.
thesizedusingdiagnosticrulestorepresentpositive
4.2 PreferenceLearning preferences, while responses after the SFT stage
aredesignatedasdispreferredforDPO.Whenthe
TheUrologyRDdatasetD encompassesbothpre-
LLM output y closely matches y , the loss ap-
cise inquiry information and complex diagnostic l w
proaches zero. Conversely, a greater disparity re-
rules, forming a comprehensive resource for dis-
sultsinincreasedlossandlargergradientupdates,
easediagnosis. Theprogressionfrompre-trained
therebyenhancingthelearningofpreferences.
models to aligned LLMs using the DPO method
generallyinvolvestwodistinctphases: trainingthe However, the experiment reveals that original
policymodelthroughsupervisedfine-tuning,and preference pairs do not consistently improve the
conductingpreferenceoptimization. performance of LLMs. In fact, models refined
InSFTphase,thelanguagemodelisfinetuned using DPO can occasionally perform worse than
withhigh-qualityinstructiondataDcloselyaligned those solely optimized through SFT. This explo-
with the objectives of the downstream task. This ration underscores the critical need to match the
includesinstructionsfromusers‚Äôinputsxaccom- dispreferred completions with these less satisfac-
paniedbysuitableresponsesy. TheLLMœÄ gener- toryinstancesforefficientlearning. Consequently,
Œ∏
atesaprobabilitydistributionr (x,y),optimized we propose an approach to enhance dispreferred
Œ∏
byminimizingthenegativelog-likelihood. completions y l through sample filtering using se-
manticsimilarityandthedeliberatedisruptionof
dialogueorder. Specifically,theformerentailsmul-
L (œÄ ) =‚àí E logœÉ(r (x,y))
SFT Œ∏ Œ∏ (1) tiplesamplingoutputsafterSFTandselectingthe
‚ü®x,y‚ü©‚àºD
item with the lowest similarity to y by BLEU
w
In the second phase, the SFT model serves as score and lower than the threshold. Additionally,
the reference policy œÄ , while the policy model thedispreferredcompletionsareconstructedbyre-
ref
œÄ actsasthetrainableparametersforpreference peatingexistingresponsesorusingthesubsequent
Œ∏
learning. Unlike the prior RLHF methods, DPO responsetodisruptthediagnosticlogic.Model Method Perplexity‚Üì ROUGE-1/2/L‚Üë BLEU‚Üë LengthRate(1)
Base 15.78 21.61/4.45/16.79 4.86 4.29
Baichuan2-7B-chat SFT 3.69 43.91/18.81/38.80 20.07 1.11
DPO 3.68 37.75/17.96/37.75 18.78 1.10
RuleAlign 3.77 44.44/19.04/39.30 19.87 1.07
Base 49.44 13.74/2.01/8.54 2.24 9.04
Qwen1.5-7B-chat SFT 4.37 33.14/12.23/25.27 11.43 5.15
DPO 3.19 42.98/18.05/38.00 18.14 0.97
RuleAlign 3.28 44.20/18.82/39.21 19.48 1.03
Base 20.92 15.17/2.69/25.26 1.96 14.49
Huatuo-II-7B SFT 3.74 44.18/19.34/39.19 20.18 1.10
DPO 3.72 42.49/17.19/37.53 18.33 1.11
RuleAlign 3.81 44.53/19.45/39.67 20.26 1.06
Table2: Wecomparetheperformanceofdifferentmodelsinsingle-roundtest. Thebestresultsaremarkedinbold.
5 Experiments textwithground-truth,wherehighervaluesreflect
greatercongruence. Lastly,LengthRatemeasures
5.1 Settings
theproportionallengthofgeneratedtexttoground-
EvaluationScenarios. WhenexaminingLLMs truth,near1.0indicatingcloseralignment.
as physicians, the standardization of patient re- InSPtesting,weadoptmetricsintheframework,
sponsespresentsachallengeduetotheinherently encompassingfivecriticaldimensionsofdiagnosis:
history-dependent nature. Therefore, it is recom- InformationCompleteness,GuidanceRational-
mendedthatmodelevaluationsbeconductedsepa- ity,DiagnosticLogicality,ClinicalApplicability
ratelyinbothsingle-roundandmulti-roundsettings andTreatmentLogicality. Collectively,thesemet-
to more effectively assess their competencies. In ricsassesstheeffectivenessofLLMsfromtheini-
single-roundtest,thetestsetisselectedfrompre- tialgatheringofpatientinformationtothelogical
viouslyconstructeddataset,usingtargetdialogue reasoningbehinddiagnosticopinionsandtheprac-
rounds as input/output pairs with prior rounds as ticalexecutionofreachingaconclusivediagnosis,
history. Inmulti-roundcontext,wefindthatStan- ensuringacomprehensiveevaluationinsimulating
dardized Patient (SP) Testing is a requisite and reasoninganddecision-makingprocesses.
commonlyemployedmethodsforassessingclini-
caldialogue. Wefollowtheframeworkproposed 5.2 MainResults
byLiuetal.(2024)coveringdiseasesweinvolve.
We report the main results of the experiments in
Table2,highlightingthesuperiorperformanceof
Baselines. Three Chinese LLMs are chosen as
RuleAlign. Applying RuleAlign to three distinct
basemodels. Baichuan2-7B-chat(Baichuan,2023)
modelsdemonstratesitseffectivenessinaligning
and Qwen1.5-7B-chat (Bai et al., 2023) repre-
LLMs with medical diagnosis task, resulting in
sentwidelyaccessibleopen-sourceLLMs,exem-
moreaccurateandnaturalresponses. RuleAlignre-
plifying distinct architectures. While Huatuo-II-
ducestheperplexitytoarangeof3to4,whilealso
7B(Chenetal.,2023a)asamedicalLLMispredi-
improvingtheROUGE-1by20-30andincreasing
cateduponthefoundationsofBaichuan2-7B-Base,
theBLEUtonearly20. Byleveragingtheinstruc-
augmentedwithacorpusofmedicalSFTdata.
tions,LLMsarecapableoffittingrules;however,
Metrics. In single-round test, several metrics - therearestillcertainconstraintsinthemodelpost-
perplexity,RougeandBLEUseries,andLength SFT.Ontheonehand,thereexistshallucinations
Rate - serve as key evaluative tools. Perplexity afterSFT,andinthecaseofQwen,itcontinuesto
assessesthelikelihoodofLLMsgeneratingaspe- output irrelevant content after necessary outputs,
cific sequence, with lower values suggesting bet- resultinginlongerresponsesandlowerscores. Em-
tertraining. ROUGEandBLEUmetricsevaluate ployingDPOwithdirectSFToutputsandtargets
thesemanticandsyntacticsimilarityofgenerated can alleviate such hallucinations. Thus, the per-Qwen1.5 Perplexity Rouge-1 BLEU 50
4.25
allpreferencepairs 3.28 44.20 19.48 40
-onlysimilarity 3.19 42.91 18.66 4.00
-onlydisruption 3.53 43.09 18.97 30 3.75
3.50 20
Table3:Theresultofdifferentpreferencepairoptimiza-
tionstrategiesperformedinQwen1.5-7B-chat. 3.25 10
0% 25% 50% 75% 100%
Preference Pairs Number
Perplexity Rouge-1 BLEU
formance of DPO is superior to that of SFT in Figure4: Theresultsforpreferencepairsofdifferent
Qwen. Ontheotherhand,DPOmayunderperform numbersizesperformedinQwen1.5-7B-chat.
SFT,sincethedisparitieshavethepotentialtocon-
fuse the LLMs in alignment. When it comes to
BaichuanandHuatuo,therearecasesofpoorper-
formanceintermsofspecificlogicfollowingwhere
the order of inquiry is either repeated or skipped.
ItisnotedthatRuleAlign,optimizingdispreferred
completions by semantic similarity filtration and
orderdisruption,couldimprovethequalityofgen-
eratedtextinmetricssuchasRougeandBLEU,as
well as Length Rate, despite a minor shortfall in
perplexity. What‚Äôsmore,thecomparisonbetween
Huatuo and Baichuan demonstrates that normal
medicalcorpusshowlittleaffectondiagnosesor
furtheralignmentondiagnosticrules.
Figure5: ThisradarplotshowstheSPtestingranksof
differentmethods,withclosertotheouteredgeindicat-
inghigherrankingandbetterperformance.
5.3 Analysis
AsdisplayedinTable3andFigure4,weconduct 5.4 StandardizedPatient(SP)Testing
furtheranalysisontheprimarycomponentsofpref-
This sophisticated multi-agent system is explic-
erencepairsthataffectonmodel‚Äôsabilitytopredict
itly designed to emulate the dynamic dialogues
the next round of inquiry. To verify the validity
betweenpatientsandthephysicianagent. Thisin-
of strategies in preference pair optimization, we
corporatesRetrieval-AugmentedEvaluation(RAE)
compare RuleAlign with only applying semantic
mechanism that predicts patient responses based
similarityfiltrationororderdisruptiontobuildthe
ontherepositorythatarchivesavastarrayofsymp-
dispreferred completions. The ablation study re-
tomsandtestoutcomes,therebyprovidingarealis-
vealsthataddingbothstrategiesofRuleAligncould
ticsimulationofpatientbehavior.
bring about better performance in metrics Rouge
andBLEU.Also,itexplainsthattheunsatisfiedrise SPResults. Figure5illustratesRuleAlign‚Äôsmul-
of the perplexity score in RuleAlign is attributed tidimensional abilities to communicate with pa-
totheintroductionoforderdisruption. Inaddition, tients that mimic real-world diagnoses and rank
the scale of preference pairs, depicted in Figure thescoresamongdifferentmethods. Theincrease
4,showsthataquarterofthepreferencepairsare ofinformationcompletenessmirrorstheadvance-
sufficient to train the SFT model and learn about mentsofLLMsincollectingsufficientcriticalpa-
the preference. Increasing the number of prefer- tientinformationduringconversations. Especially,
encepairsonthisbasisdoesnotbringsignificant utilizing evidence knowledge in diagnostic rules,
improvementtotheeffect. Thus,fortherulealign- RuleAligninstructsLLMstoqueryaboutmoretar-
mentofmedicaldiagnosis,thestrategyofdesign- geted test and examination reports which brings
ingpreferencepairshasamoreimportantimpact abouttheimprovementofguidancerationality. Ad-
ontheaccuracyofsingle-roundprediction. ditionally,theriseindiagnosticlogicalitymeasures
ytixelpreP
UELB
& eguoRhowthemodellogicallydeducesaccuratediagnos- ZhongyuWei.2023a. Disc-medllm: Bridginggen-
ticconclusionsinaccordancewiththeaccessible erallargelanguagemodelsandreal-worldmedical
consultation. arXivpreprintarXiv:2308.14346.
information. RuleAlignalsoreachesover5turns
dialoguesinaverageinmetricclinicalapplicability. ZhijieBao,WeiChen,ShengzeXiao,KuangRen,Jiaao
Butintheabsenceoftreatmentknowledgeenhance- Wu,ChengZhong,JiajiePeng,XuanjingHuang,and
ZhongyuWei.2023b. Disc-medllm: Bridginggen-
ment,allfourapproachesaretiedintermsofmetric
erallargelanguagemodelsandreal-worldmedical
treatment logicality. Meanwhile, RuleAlign still
consultation. CoRR,abs/2308.14346.
existsagreatdisparityindeliveringfinalaccurate
LoredanaCaruccio,StefanoCirillo,GiuseppePolese,
diagnosesandtreatmentsuggestionscomparableto
Giandomenico Solimando, Shanmugam Sundara-
thoseprovidedbyreal-worldphysicians. Weillus-
murthy,andGenoveffaTortora.2024. Canchatgpt
trateacaseofSPtestinginFigure7todemonstrate provideintelligentdiagnoses? acomparativestudy
theeffectivenessofRuleAlign. between predictive models and chatgpt to define a
new medical diagnostic bot. Expert Systems with
Applications,235:121186.
6 Conclusion
Junying Chen, Xidong Wang, Anningzhe Gao, Feng
Inthisstudy,webuildthemedicaldialoguedataset Jiang,ShunianChen,HongboZhang,DingjieSong,
UrologyRDbasedonthediagnosticrulesandpro- WenyaXie, ChuyiKong, JianquanLi, XiangWan,
HaizhouLi,andBenyouWang.2023a. Huatuogpt-
posetheinnovativemethodRuleAligntoautomati-
ii, one-stage training for medical adaption of llms.
callysynthesizethepreferencepairsforalignment.
CoRR,abs/2311.09774.
The experiment results show the effectiveness of
Yirong Chen, Zhenyu Wang, Xiaofen Xing, Huimin
RuleAlignonvariousevaluationsettings. Andwe
Zheng,ZhipeiXu,KaiFang,JunhongWang,Sihang
anticipate our work will bring benefits to further
Li, Jieling Wu, Qi Liu, and Xiangmin Xu. 2023b.
research on LLMs as medical applications or AI Bianque: Balancingthequestioningandsuggestion
physicians. abilityofhealthllmswithmulti-turnhealthconversa-
tionspolishedbychatgpt. CoRR,abs/2310.15896.
EthicalConsiderations
ZixiangChen,YiheDeng,HuizhuoYuan,KaixuanJi,
andQuanquanGu.2024. Self-playfine-tuningcon-
Thisworkadheresstrictlytoethicalstandardsand
vertsweaklanguagemodelstostronglanguagemod-
best practices in research. All medical data uti- els. CoRR,abs/2401.01335.
lizedareextractedfrompubliclyavailabledatasets
PaulF.Christiano, JanLeike, TomB.Brown, Miljan
thatdonotcontainanysensitiveorproprietarypa-
Martic,ShaneLegg,andDarioAmodei.2017. Deep
tient information. Consequently, this research is reinforcementlearningfromhumanpreferences. In
conductedwithoutanyethicalconcerns. AdvancesinNeuralInformationProcessingSystems
30: AnnualConferenceonNeuralInformationPro-
cessing Systems 2017, December 4-9, 2017, Long
Acknowledgements
Beach,CA,USA,pages4299‚Äì4307.
Wewouldliketoexpressoursinceregratitudeto Chengfeng Dou, Zhi Jin, Wenpin Jiao, Haiyan Zhao,
LLaMA-Factory(Zhengetal.,2024)forefficient YongqiangZhao,andZhenweiTao.2024. Integrat-
ing physician diagnostic logic into large language
fine-tuningpipelines. Ourappreciationalsogoes
models: Preferencelearningfromprocessfeedback.
toRJUA-QA(Lyuetal.,2023)andRJUA-SP(Liu
CoRR,abs/2401.05695.
etal.,2024).
WilliamGao,DayongWang,andYiHuang.2023. De-
signingadeeplearning-drivenresource-efficientdi-
agnosticsystemformetastaticbreastcancer: Reduc-
References
inglongdelaysofclinicaldiagnosisandimproving
patientsurvivalindevelopingcountries. CancerIn-
JinzeBai,ShuaiBai,YunfeiChu,ZeyuCui,KaiDang,
formatics,22:11769351231214446.
Xiaodong Deng, Yang Fan, Wenbin Ge, Yu Han,
Fei Huang, Binyuan Hui, Luo Ji, Mei Li, and Jun-
D√≥raG√∂nd√∂csandViktorD√∂rfler.2024. Aiinmedical
yangLinetal.2023. Qwentechnicalreport. arXiv
diagnosis: Aiprediction&humanjudgment. Artifi-
preprintarXiv:2309.16609.
cialIntelligenceinMedicine,149:102769.
Baichuan. 2023. Baichuan 2: Open large-scale lan- KaiHe,RuiMao,QikaLin,YuchengRuan,XiangLan,
guagemodels. arXivpreprintarXiv:2309.10305. MenglingFeng,andErikCambria.2023. Asurvey
oflargelanguagemodelsforhealthcare: fromdata,
ZhijieBao,WeiChen,ShengzeXiao,KuangRen,Jiaao technology, and applications to accountability and
Wu,ChengZhong,JiajiePeng,XuanjingHuang,and ethics. arXivpreprintarXiv:2310.05694.LavenderYaoJiang,XujinChrisLiu,NimaPourNeja- InformationProcessingSystems35: AnnualConfer-
tian,MustafaNasir-Moin,DuoWang,AnasAbidin, enceonNeuralInformationProcessingSystems2022,
Kevin Eaton, Howard Antony Riina, Ilya Laufer, NeurIPS2022,NewOrleans,LA,USA,November28
Paawan Punjabi, et al. 2023. Health system-scale -December9,2022.
languagemodelsareall-purposepredictionengines.
Nature,619(7969):357‚Äì362. Cheng Peng, Xi Yang, Aokun Chen, Kaleb E. Smith,
Nima M. Pournejatian, Anthony B. Costa, Cheryl
Ruili Jiang, Kehai Chen, Xuefeng Bai, Zhixuan He, Martin,MonaG.Flores,YingZhang,TanjaMagoc,
JuntaoLi,MuyunYang,TiejunZhao,LiqiangNie, GloriaP.Lipori,DuaneA.Mitchell,NaykkySingh
andMinZhang.2024. Asurveyonhumanpreference Ospina,MustafaM.Ahmed,WilliamR.Hogan,Eliz-
learningforlargelanguagemodels. arXivpreprint abethA.Shenkman,YiGuo,JiangBian,andYonghui
arXiv:2406.11191. Wu. 2023. A study of generative large language
modelformedicalresearchandhealthcare. npjDigit.
QiaoJin,WonKim,QingyuChen,DonaldC.Comeau,
Medicine,6.
Lana Yeganova, W. John Wilbur, and Zhiyong Lu.
2023. Medcpt: Contrastivepre-trainedtransformers
RafaelRafailov,ArchitSharma,EricMitchell,Christo-
with large-scale pubmed search logs for zero-shot
pherD.Manning,StefanoErmon,andChelseaFinn.
biomedicalinformationretrieval. Bioinform.,39(10).
2023. Directpreferenceoptimization:Yourlanguage
model is secretly a reward model. In Advances in
Valentin Li√©vin, Christoffer Egeberg Hother, An-
NeuralInformationProcessingSystems36: Annual
dreasGeertMotzfeldt,andOleWinther.2024. Can
ConferenceonNeuralInformationProcessingSys-
large language models reason about medical ques-
tems2023, NeurIPS2023, NewOrleans, LA,USA,
tions? Patterns,5(3):100943.
December10-16,2023.
LeiLiu,XiaoyanYang,FangzhouLi,ChenfeiChi,Yue
Shen,ShiweiLyu,MingZhang,XiaoweiMa,Xian- KhaledSaab,TaoTu,Wei-HungWeng,RyutaroTanno,
guoLyu,LiyaMa,ZhiqiangZhang,WeiXue,Yiran David Stutz, Ellery Wulczyn, Fan Zhang, Tim
Huang,andJinjieGu.2024. Towardsautomaticeval- Strother,ChunjongPark,ElaheVedadi,JuanmaZam-
uation for llms‚Äô clinical capabilities: Metric, data, brano Chaves, Szu-Yeu Hu, Mike Schaekermann,
andalgorithm. CoRR,abs/2403.16446. Aishwarya Kamath, and Yong Cheng et al. 2024.
Capabilitiesofgeminimodelsinmedicine. CoRR,
TianqiLiu,YaoZhao,RishabhJoshi,MishaKhalman, abs/2404.18416.
MohammadSaleh,PeterJ.Liu,andJialuLiu.2023.
Statistical rejection sampling improves preference John Schulman, Filip Wolski, Prafulla Dhariwal,
optimization. CoRR,abs/2309.06657. Alec Radford, and Oleg Klimov. 2017. Proxi-
malpolicyoptimizationalgorithms. arXivpreprint
XinyuLu,BowenYu,YaojieLu,HongyuLin,Haiyang arXiv:1707.06347.
Yu, Le Sun, Xianpei Han, and Yongbin Li. 2024.
Sofa: Shieldedon-the-flyalignmentviapriorityrule KaranSinghal,ShekoofehAzizi,TaoTu,SSaraMah-
following. CoRR,abs/2402.17358. davi,JasonWei,HyungWonChung,NathanScales,
AjayTanwani,HeatherCole-Lewis,StephenPfohl,
Yangyifei Luo, Zhuo Chen, Lingbing Guo, Qian Li,
etal.2023a. Largelanguagemodelsencodeclinical
WenxuanZeng,ZhixinCai,andJianxinLi.2024. As-
knowledge. Nature,620(7972):172‚Äì180.
gea: Exploitinglogicrulesfromalign-subgraphsfor
entityalignment. arXivpreprintarXiv:2402.11000.
Karan Singhal, Tao Tu, Juraj Gottweis, Rory Sayres,
ElleryWulczyn,LeHou,KevinClark,StephenPfohl,
ShiweiLyu,ChenfeiChi,HongboCai,LeiShi,Xiaoyan
HeatherCole-Lewis,andDarleneNealetal.2023b.
Yang, Lei Liu, Xiang Chen, Deng Zhao, Zhiqiang
Towards expert-level medical question answering
Zhang, Xianguo Lyu, Ming Zhang, Fangzhou Li,
withlargelanguagemodels. CoRR,abs/2305.09617.
Xiaowei Ma, Yue Shen, Jinjie Gu, Wei Xue, and
Yiran Huang. 2023. RJUA-QA: A comprehensive
Arun James Thirunavukarasu, Darren Shu Jeng Ting,
QAdatasetforurology. CoRR,abs/2312.09785.
KabilanElangovan,LauraGutierrez,TingFangTan,
BertalanMesk√≥andEricJTopol.2023. Theimperative and Daniel Shu Wei Ting. 2023. Large language
forregulatoryoversightoflargelanguagemodels(or modelsinmedicine. Naturemedicine,29(8):1930‚Äì
generative ai) in healthcare. NPJ digital medicine, 1940.
6(1):120.
TaoTu,AnilPalepu,MikeSchaekermann,KhaledSaab,
LongOuyang,JeffreyWu,XuJiang,DiogoAlmeida, JanFreyberg,RyutaroTanno,AmyWang,BrennaLi,
Carroll L. Wainwright, Pamela Mishkin, Chong MohamedAmin,NenadTomasev,ShekoofehAzizi,
Zhang,SandhiniAgarwal,KatarinaSlama,AlexRay, KaranSinghal,YongCheng,LeHou,AlbertWebson,
JohnSchulman,JacobHilton,FraserKelton,Luke KavitaKulkarni,S.SaraMahdavi,ChristopherSem-
Miller,MaddieSimens,AmandaAskell,PeterWelin- turs,JurajGottweis,JoelleK.Barral,KatherineChou,
der,PaulF.Christiano,JanLeike,andRyanLowe. Gregory S. Corrado, Yossi Matias, Alan Karthike-
2022. Training languagemodelsto followinstruc- salingam,andVivekNatarajan.2024. Towardscon-
tionswithhumanfeedback. InAdvancesinNeural versationaldiagnosticAI. CoRR,abs/2401.05654.Jiageng Wu, Xiaocong Liu, Minghui Li, Wanxin Li, YaoweiZheng,RichongZhang,JunhaoZhang,Yanhan
ZichangSu,ShixuLin,LucasGaray,ZhiyunZhang, Ye,ZheyanLuo,ZhangchiFeng,andYongqiangMa.
YujieZhang,QingchengZeng,JieShen,Changzheng 2024. Llamafactory: Unified efficient fine-tuning
Yuan, and Jie Yang. 2024. Clinical text datasets of 100+ language models. In Proceedings of the
for medical artificial intelligence and large lan- 62ndAnnualMeetingoftheAssociationforCompu-
guage models ‚Äî a systematic review. NEJM AI, tationalLinguistics(Volume3: SystemDemonstra-
1(6):AIra2400012. tions),Bangkok,Thailand.AssociationforComputa-
tionalLinguistics.
HonglinXiong,ShengWang,YitaoZhu,ZihaoZhao,
Yuxiao Liu, Linlin Huang, Qian Wang, and Ding- Hongjian Zhou, Boyang Gu, Xinyu Zou, Yiru Li,
gang Shen. 2023. Doctorglm: Fine-tuning your SamS.Chen,PeilinZhou,JunlingLiu,YiningHua,
chinese doctor is not a herculean task. CoRR, Chengfeng Mao, Xian Wu, Zheng Li, and Fenglin
abs/2304.01097. Liu. 2023. A survey of large language models
in medicine: Progress, application, and challenge.
Songhua Yang, Hanjie Zhao, Senbin Zhu, Guangyu CoRR,abs/2311.05112.
Zhou,HongfeiXu,YuxiangJia,andHongyingZan.
2024. Zhongjing: Enhancingthechinesemedicalca-
pabilities of large language model through expert
feedback and real-world multi-turn dialogue. In
Thirty-Eighth AAAI Conference on Artificial Intel-
ligence,AAAI2024,Thirty-SixthConferenceonIn-
novativeApplicationsofArtificialIntelligence,IAAI
2024, Fourteenth Symposium on Educational Ad-
vancesinArtificialIntelligence,EAAI2014,Febru-
ary20-27,2024,Vancouver,Canada,pages19368‚Äì
19376.AAAIPress.
Hongyi Yuan, Zheng Yuan, Chuanqi Tan, Wei Wang,
SongfangHuang,andFeiHuang.2023. RRHF:rank
responsestoalignlanguagemodelswithhumanfeed-
back. InAdvancesinNeuralInformationProcessing
Systems36: AnnualConferenceonNeuralInforma-
tionProcessingSystems2023,NeurIPS2023,New
Orleans,LA,USA,December10-16,2023.
GuangtaoZeng,WenmianYang,ZeqianJu,YueYang,
Sicheng Wang, Ruisi Zhang, Meng Zhou, Jiaqi
Zeng,XiangyuDong,RuoyuZhang,HongchaoFang,
Penghui Zhu, Shu Chen, and Pengtao Xie. 2020.
MedDialog: Large-scalemedicaldialoguedatasets.
InProceedingsofthe2020ConferenceonEmpirical
MethodsinNaturalLanguageProcessing(EMNLP),
pages9241‚Äì9250,Online.AssociationforComputa-
tionalLinguistics.
HongboZhang,JunyingChen,FengJiang,FeiYu,Zhi-
hong Chen, Guiming Chen, Jianquan Li, Xiangbo
Wu, ZhangZhiyi, QingyingXiao, etal.2023. Hu-
atuogpt,towardstaminglanguagemodeltobeadoc-
tor. InFindingsoftheAssociationforComputational
Linguistics: EMNLP2023,pages10859‚Äì10885.
NingyuZhang,MoshaChen,ZhenBi,XiaozhuanLiang,
LeiLi,XinShang,KangpingYin,ChuanqiTan,Jian
Xu,FeiHuang,etal.2022. Cblue:Achinesebiomed-
icallanguageunderstandingevaluationbenchmark.
In Proceedings of the 60th Annual Meeting of the
AssociationforComputationalLinguistics(Volume
1: LongPapers),pages7888‚Äì7915.
YaoZhao,RishabhJoshi,TianqiLiu,MishaKhalman,
MohammadSaleh, andPeterJ.Liu.2023. Slic-hf:
Sequence likelihood calibration with human feed-
back. CoRR,abs/2305.10425.A Appendix
A.1 Trainingdetails
Inourexperiment,weemployanNVIDIAA100
GPUtotrainthealignedmodels. Duringboththe
SFTstageandthepreferencealignmentphase,we
incorporate the LoRA technique in the training
process. Thedetailedhyperparametersweuseare
showninTable4andTable5.
Table4: DetailedhyperparametersusedinSFT
Name Value
lorarank 8
loraalpha 16
loratarget all
cutofflen 1,024
epochs 10
batchsizeperdevice 4
gradientaccumulationsteps 8
Figure6: Theseplotsillustratethetop10categoriesin
learningrate 5e-5 trainset(up)andtestset(down)inUrologyRD.
ticcommunicationsbetweenpatientandphysician,
Table5: DetailedhyperparametersusedinRuleAlign
whichfollowsthedesignedrulesfordiseases.
andDPO.
In addition, the template prompt used as input
forGPT-4turboAPIasintroducedinsection3.2,
Name Value
follows the formulas G and G . It should be
M p
lorarank 8 mentionedthatsincethemedicaldatausedinthis
loraalpha 16 work are originally in Chinese, and we employ
loratarget all GPT4ofortranslationdirectly.
cutofflen 1,024
A.3 SPTestingdetails
epochs 1
batchsizeperdevice 4
SPMetric Base SFT DPO RuleAlign
gradientaccumulationsteps 8
InformationCompleteness 6.04 15.14 15.72 17.32
learningrate 2e-5 DiagnosticLogicality 22.72 20.45 31.82 31.82
GuidanceRationality 9.30 26.43 25.36 29.29
ClinicalApplicability 1.77 4.42 5.41 5.39
TreatmentLogicality 4.55 4.55 4.55 4.55
A.2 Datasetdetails
Table6: SPcomparisonofmethods.
Thissubsectionexpands¬ß3withadditionaldetails
about our data construction steps and statistical TheSPtestingframeworkoffersnecessarymet-
analysis. TheinitialQ&AdatasetRJUA-QAcov- ricstoscrutinizewhethertheconductexhibitedby
ers67commonurologicaldiseasecategories,which the physician agent adheres to the stringent pro-
is developed in collaboration with department of tocols of professional clinical practice pathways.
urologyShanghaiRenjiHospital(Lyuetal.,2023). Table6presentsthedetailedmetricscoresforvari-
Throughtheconstructionpipeline,theUrologyRD ousmethodsemployedwithintheSPtestingframe-
consistsoftrainandtestsplitsandspansacross32 work. Given the variability in the range of each
diseases. Figure6illustratethediseasecategories metric and the inclusion of 44 standard patients,
distributioninUrologyRD.Figure8showsanex- theranksofSPmetricsinFigure5areconsidered
ampleofUrologyRDdataset,asimulateddiagnos- amoreeffectivepresentationforevaluation.CaseStudyinSPTesting
English Chinese
Patient: Doctor, I‚Äôve had a dull pain on the ÊÇ£ËÄÖÔºöÂåªÁîüÊÇ®Â•ΩÔºåÊàëÂè≥‰æßËÖ∞ÈöêÈöêÁóõ‰∫ÜÂ•ΩÂá†
rightsideofmywaistforseveralmonths. ‰∏™Êúà„ÄÇ
Doctor: Hello,isthispainconstantorintermit- ÂåªÁîüÔºö‰Ω†Â•ΩÔºåËØ∑ÈóÆËøô‰∏™ËÖ∞ÁóõÊòØÊåÅÁª≠ÊÄßÁöÑËøò
tent? Isthereanythingthatmakesitworse? ÊòØÈó¥Ê≠áÊÄßÁöÑÔºüÊúâÊ≤°Êúâ‰ªÄ‰πà‰∫ãÊÉÖ‰ºöËÆ©ÂÆÉÂä†
Patient: Nofever. ÂâßÔºü
Doctor: I see. Haveyou had any urinarysys- ÊÇ£ËÄÖÔºöÊó†ÂèëÁÉ≠
temexaminations,suchasaroutineurinalysis ÂåªÁîüÔºö‰∫ÜËß£‰∫ÜÔºå‰Ω†ÊúâÊ≤°ÊúâÂÅöËøáÊ≥åÂ∞øÁ≥ªÁªü
oraurinarysystemultrasound? ÊñπÈù¢ÁöÑÊ£ÄÊü•ÔºåÊØîÂ¶ÇÂ∞øÂ∏∏ËßÑÊàñËÄÖÊ≥åÂ∞øÁ≥ª
Patient: Onemonthago,urinarysystemultra- ÁªüBË∂ÖÔºü
sound showed: Strong echo of 15*12mm in ÊÇ£ËÄÖÔºö1ÊúàÂâçÊ≥åÂ∞øÁ≥ªÁªüBË∂ÖÊ£ÄÊü•ÔºöÂè≥‰æßËæìÂ∞ø
theuppersegmentoftherightureter,withhy- ÁÆ°‰∏äÊÆµÂº∫ÂõûÂ£∞15*12mmÔºå‰º¥ËÇæÁõÇÁßØÊ∞¥
dronephrosis. Cardiacultrasound,leftatrialen- ÂøÉÂΩ©Ë∂ÖÔºåÂ∑¶ÊàøÂÜÖÂæÑÂ¢ûÂ§ßÔºåÂ∑¶ÂÆ§È©∞Âº†ÂäüËÉΩÂáè
largement,leftventriculardiastolicdysfunction, ÈÄÄÔºåÊúØÂâç1Â§©Â∞øÂ∏∏ËßÑÔºåÂ∞øÈ¢úËâ≤Á®ªÈªÑËâ≤ÔºåÂ∞ø
routineurinalysisonedaybeforesurgery: Urine ÊµëÊµäÂ∫¶Ê∏Ö‰∫ÆÔºåÂ∞øÊØîÈáç1.028ÔºåÂ∞øÈÖ∏Á¢±Â∫¶5.5Ôºå
color: strawyellow,urineclarity: clear,urine Â∞ø‰∫öÁ°ùÈÖ∏ÁõênegÔºåÂ∞øÁôΩÁªÜËÉûÈÖØÈÖ∂negÔºåÂ∞øËõã
specific gravity: 1.028, urine pH: 5.5, urine ÁôΩË¥®2+‚ÜëÔºåÂ∞øËë°ËêÑÁ≥ñ4+‚ÜëÔºåÂ∞øÈÖÆ‰Ωì1+‚ÜëÔºåÂ∞ø
nitrite: negative,urineleukocyteesterase: neg- ËÉÜÂéünormÔºåÂ∞øËÉÜÁ∫¢Á¥†negÔºåÂ∞øÊΩúË°Ä3+‚ÜëÔºå
ative, urine protein: 2+‚Üë, urine glucose: 4+‚Üë, ÈïúÊ£ÄÁ∫¢ÁªÜËÉû100+/HPÔºåÈïúÊ£ÄÁôΩÁªÜËÉûÊú™Êü•
urine ketone bodies: 1+‚Üë, urine urobilinogen: ËßÅ/HPÔºå1Â§©Ââç
normal,urinebilirubin: negative,urineoccult ÂåªÁîüÔºöÊ†πÊçÆ‰Ω†Êèê‰æõÁöÑ‰ø°ÊÅØÂíåÊ£ÄÊü•ÁªìÊûúÔºåÁªì
blood: 3+‚Üë,microscopicexamination... Âêà‰Ω†ÁöÑÁóáÁä∂Ôºå‰Ω†ÂèØËÉΩÊúâËæìÂ∞øÁÆ°ÁªìÁü≥ÂºïËµ∑ÁöÑ
Doctor: Basedontheinformationandresults ËÇæÁõÇÁßØÊ∞¥„ÄÇÊàë‰ª¨ËøòÈúÄË¶ÅËøõ‰∏ÄÊ≠•ÁöÑÂΩ±ÂÉèÂ≠¶Ê£Ä
you‚Äôve provided, along with your symptoms, Êü•Êù•Á°ÆËÆ§ÁªìÁü≥ÁöÑÁ°ÆÂàá‰ΩçÁΩÆÂíåÂ§ßÂ∞è„ÄÇ‰Ω†ÊòØÂê¶
you might have hydronephrosis caused by a Â∑≤ÁªèËøõË°å‰∫ÜÊõ¥ËØ¶ÁªÜÁöÑÂΩ±ÂÉèÂ≠¶Ê£ÄÊü•Ôºå‰æãÂ¶ÇËÇæ
ureteralstone. Weneedfurtherimagingstudies ËæìÂ∞øÁÆ°CTÔºü
to confirm the exact location and size of the ÊÇ£ËÄÖÔºöÊàë‰∏çÁü•ÈÅìÔºåËØ∑ÂåªÁîüËØ¢ÈóÆÂÖ∂‰ªñÈóÆÈ¢òÔºÅ
stone. Haveyouhadamoredetailedimaging, ÂåªÁîüÔºöÊòéÁôΩ‰∫Ü„ÄÇËØ∑ÈóÆ‰Ω†ÊúâÊ≤°ÊúâÂÖ∂‰ªñÁöÑÊó¢ÂæÄ
suchasakidneyandureterCTscan? ÁóÖÂè≤ÔºåÊØîÂ¶ÇÈ´òË°ÄÂéã„ÄÅÁ≥ñÂ∞øÁóÖÊàñÂøÉËÑèÁóÖÔºü
Patient: I don‚Äôt know, please ask other ques- ÊÇ£ËÄÖÔºöÈ´òË°ÄÂéãÔºåÈò¥ÊÄßÁ≥ñÂ∞øÁóÖÔºåÈò≥ÊÄß
tions,doctor! ÂåªÁîüÔºö‰∫ÜËß£‰∫Ü„ÄÇÂÖ≥‰∫éÁ≥ñÂ∞øÁóÖÔºå‰Ω†ÁõÆÂâçÂú®Êúç
Doctor: Understood. Do you have any other Áî®‰ªÄ‰πàËçØÁâ©ÊéßÂà∂Ë°ÄÁ≥ñÂêóÔºü
pastmedicalhistory,suchashypertension,dia- ÊÇ£ËÄÖÔºöÊ≤°ÊúâÁõ∏ÂÖ≥Áî®ËçØÂè≤„ÄÇ
betes,orheartdisease? ÂåªÁîüÔºöÂ•ΩÁöÑÔºåÊÑüË∞¢‰Ω†Êèê‰æõÁöÑ‰ø°ÊÅØ„ÄÇÊ†πÊçÆ‰Ω†
Patient: Hypertension,negative. Diabetes,pos- ÊèèËø∞ÁöÑÁóáÁä∂ÂíåÂ∑≤ÊúâÁöÑÊ£ÄÊü•ÁªìÊûúÔºåÂä†‰∏ä‰Ω†ÁöÑ
itive. Á≥ñÂ∞øÁóÖÁóÖÂè≤ÔºåÊàëËÆ§‰∏∫‰Ω†ÂæàÂèØËÉΩÊÇ£ÊúâÂè≥‰æßËæì
Doctor: Gotit. Regardingdiabetes,areyoucur- Â∞øÁÆ°ÁªìÁü≥ÂØºËá¥ÁöÑËÇæÁõÇÁßØÊ∞¥„ÄÇÊàë‰ª¨ÈúÄË¶ÅËøõË°å
rently taking any medications to control your ËÇæËæìÂ∞øÁÆ°CTÊ£ÄÊü•Êù•Á°ÆÂÆöÁªìÁü≥ÁöÑÁ°ÆÂàá‰ΩçÁΩÆÂíå
bloodsugar? Â§ßÂ∞èÔºå‰ª•‰æøËøõ‰∏ÄÊ≠•Á°ÆËØä„ÄÇ
Patient: Nomedicationhistoryrelated.
Doctor: Okay, thanks. Based on the symp-
tomsyoudescribedandtheexistingtestresults,
combined with your history of diabetes, I be-
lieveyouareverylikelytohavehydronephrosis
causedbyaureteralstoneontherightside. We
need to conduct a kidney and ureter CT scan
todeterminetheexactlocationandsizeofthe
stoneforfurtherdiagnosis.
Figure7: ThisisacaseofdiagnosticconsultationbetweenourtrainedAIphysicianandthepatientsimulatedby
RJUA-SPframework.ExampleofDatasetUrologyRD
English Chinese
Patient: Doctor,hello. Iama66-year-oldmale ÊÇ£ËÄÖÔºöÂåªÁîüÔºåÊÇ®Â•Ω„ÄÇÊàëÊòØ‰∏ÄÂêç66Â≤ÅÁöÑÁî∑ÊÄß
patient,andrecently,duringacheck-up,Idis- ÊÇ£ËÄÖÔºåÊúÄËøëÊàëÂÅöÊ£ÄÊü•ÂèëÁé∞Âè≥ËÇæ‰∏äËÖ∫ÊúâÂõä
covered a cyst on my right adrenal gland that ËÇøÔºåÂ∑≤Áªè8Âπ¥‰∫Ü„ÄÇ
hasbeentherefor8years. ÂåªÁîüÔºöÊÇ®Â•ΩÔºÅÊÇ®ÊúÄËøëÊúâÊ≤°ÊúâÂá∫Áé∞‰ªª‰Ωï‰∏ç
Doctor: Hello! Haveyouexperiencedanydis- ÈÄÇÔºåÊØîÂ¶Ç‰ΩìÈáçÂèòÂåñ„ÄÅ‰πèÂäõÊàñÊòØË°ÄÂéãÊ≥¢Âä®Á≠â
comfort recently, such as weight changes, fa- ÁóáÁä∂Ôºü
tigue,orbloodpressurefluctuations? ÊÇ£ËÄÖÔºöÊ≤°ÊúâÁâπÂà´ÊÑüËßâÔºåÂè™ÊòØ‰æãË°åÊ£ÄÊü•Êó∂Âèë
Patient: No special sensations, it was only Áé∞ÁöÑ„ÄÇ
foundduringaroutinecheck-up. ÂåªÁîüÔºöÊÇ®‰πãÂâçÊúâÂÅöËøáËÇæ‰∏äËÖ∫Ë∂ÖÂ£∞Ê£ÄÊü•ÂêóÔºü
Doctor: Have you previously had an adrenal ÊÇ£ËÄÖÔºöÊ≤°ÊúâÔºåÊàëÊ≤°ÊúâÂÅöËøáËÇæ‰∏äËÖ∫Ë∂ÖÂ£∞„ÄÇ
ultrasoundexamination? ÂåªÁîüÔºöÈÇ£ÊÇ®ÊúâÂÅöËøá‰∏äËÖπÈÉ®Â¢ûÂº∫CTÊàñMRIÊ£Ä
Patient: No, I have not had an adrenal ultra- Êü•ÂêóÔºü
sound. ÊÇ£ËÄÖÔºöÊ†πÊçÆ‰∏ä‰∏™ÊúàCTAÊ£ÄÊü•ÔºåÊàëÂèåËÇæÊúâ
Doctor: HaveyouhadanenhancedCTorMRI Â§öÂèëÁöÑÁ±ªÂúÜÂΩ¢ÂõäÊÄßÂØÜÂΩ±ÔºåÂè≥ËÇæÁöÑËæÉÂ§ßËÄÖ
oftheupperabdomen? Á∫¶1cmÔºåÂè≥ËÇæ‰∏äËÖ∫Êúâ‰∏Ä‰∏™Áõ¥ÂæÑ3cmÁöÑÁ±ªÂúÜÂΩ¢
Patient: According to the CTA examination ËÇøÂùó„ÄÇ
lastmonth,Ihavemultipleroundcysticshad- ÂåªÁîüÔºöÂ•ΩÁöÑÔºåÈÇ£ÊÇ®ÊúâÊ≤°ÊúâËøõË°åËøáË°ÄËÇæ‰∏äËÖ∫
ows on both kidneys, the largest on the right ÊøÄÁ¥†Ê£ÄÊü•ÊàñÂ∞øËÇæ‰∏äËÖ∫ÊøÄÁ¥†Ê£ÄÊü•Ôºü
kidney being about 1 cm, and a round mass ÊÇ£ËÄÖÔºöÊ≤°ÊúâÔºåÊàëÊ≤°ÊúâËøõË°åËøáËøô‰∫õÊøÄÁ¥†Ê£Ä
with a diameter of 3 cm on the right adrenal Êü•„ÄÇ
gland. ÂåªÁîüÔºöÊòéÁôΩ‰∫Ü„ÄÇËØ∑ÈóÆÊÇ®ÊúâÊ≤°ÊúâÈ´òË°ÄÂéãÊàñÂÖ∂
Doctor: Okay,haveyouundergoneanyblood ‰ªñÊó¢ÂæÄÁóÖÂè≤Ôºü
adrenalhormonetestsorurineadrenalhormone ÊÇ£ËÄÖÔºöÊàëÊúâÈ´òË°ÄÂéãÁöÑÁóÖÂè≤Ôºå‰ΩÜÊ≤°ÊúâÁ≥ñÂ∞ø
tests? ÁóÖ„ÄÅÂÜ†ÂøÉÁóÖ„ÄÅËÑëË°ÄÁÆ°ÁñæÁóÖÁ≠âÊÖ¢ÊÄßÁóÖÂè≤„ÄÇ
Patient: No, I have not had those hormone ÂåªÁîüÔºö‰∫ÜËß£‰∫ÜÔºåÊÇ®ÁöÑÈ´òË°ÄÂéãÊòØÊÄé‰πàÊéßÂà∂
tests. ÁöÑÔºüÊòØÂê¶ÊúâÂú®Áî®ËçØÁâ©Ê≤ªÁñóÔºü
Doctor: Understood. Doyouhaveahistoryof ÊÇ£ËÄÖÔºöÊàë‰∏ÄÁõ¥Âú®Áî®ËçØÊéßÂà∂ÔºåË°ÄÂéãÊØîËæÉÁ®≥
hypertensionoranyotherpastmedicalhistory? ÂÆö„ÄÇ
Patient: Ihaveahistoryofhypertension,butno ÂåªÁîüÔºöÊ†πÊçÆÊÇ®ÁõÆÂâçÊèê‰æõÁöÑ‰ø°ÊÅØÔºåÁªìÂêàÊÇ®ÁöÑ
diabetes,coronaryheartdisease,orcerebrovas- È´òË°ÄÂéãÂè≤ÂíåCTAÊ£ÄÊü•ÁªìÊûúÔºåÊàë‰ª¨‰∏çËÉΩÊéíÈô§
culardisease. ËÇæ‰∏äËÖ∫ËÇøÁò§ÁöÑÂèØËÉΩÊÄß„ÄÇËôΩÁÑ∂ÁõÆÂâçÊ≤°ÊúâÊòé
Doctor: Gotit. Howisyourhypertensioncon- Á°ÆÁöÑËÇæ‰∏äËÖ∫ÊøÄÁ¥†ÂàÜÊ≥åÂºÇÂ∏∏ÁöÑÁóáÁä∂Ôºå‰ΩÜ‰∏∫‰∫Ü
trolled? Areyouonmedication? Á°ÆËØäÔºåÊàë‰ª¨ÈúÄË¶ÅËøõË°åË°ÄËÇæ‰∏äËÖ∫ÊøÄÁ¥†Ê£ÄÊü•Âíå
Patient: Ihavebeenonmedicationtocontrol Â∞øËÇæ‰∏äËÖ∫ÊøÄÁ¥†Ê£ÄÊü•Ôºå‰ª•ÂèäÂèØËÉΩÁöÑ‰∏äËÖπÈÉ®Â¢û
it,andmybloodpressureisquitestable. Âº∫MRIÊ£ÄÊü•„ÄÇËøô‰∫õÊ£ÄÊü•Â∞ÜÊúâÂä©‰∫éÊàë‰ª¨Á°ÆÂÆö
Doctor: Based on the information you have ËÇøÁò§ÁöÑÊÄßË¥®ÂíåÂäüËÉΩÊ¥ªÊÄß„ÄÇ
providedsofar,alongwithyourhistoryofhy-
pertension and the CTA examination results,
wecannotruleoutthepossibilityofanadrenal
tumor. Although there are currently no clear
symptomsofabnormaladrenalhormonesecre-
tion,tomakeadefinitivediagnosis,weneedto
conductbloodadrenalhormonetestsandurine
adrenalhormonetests,aswellasapossibleen-
hancedMRIoftheupperabdomen. Thesetests
willhelpusdeterminethenatureandfunctional
activityofthetumor.
Figure8: CaseofdatasetUrologyRDTemplateforConvertingQuestion-AnswerPairsfromRJUA-QAintoMulti-turnDialogues
English
Your task is to adapt the provided single-turn medical consultation dialogue into a realistic
multi-turn conversation between a physician and a patient. The multi-turn dialogue should be
entirelybasedonthesingle-turndialoguewithoutaddinganynewinformation. Itshouldstartwith
thepatientpresentingaquestion,followedbythephysician‚Äôsinquiries,andendwithaspecific
diagnosisfromthephysician. Notreatmentsuggestionsorfollow-upactionsarenecessary.
Adheretothefollowingguidelineswhencreatingthedialogue:
1. The dialogue should start with the patient describing the initial symptoms, followed by the
physicianaskingquestionstoobtainmoredetailedinformation.
2. Eachquestionfromthephysicianandresponsefromthepatientshouldbecloselyrelatedand
basedsolelyontheinformationalreadyprovidedbythepatient.
3. Avoid introducing new symptoms, tests, or diseases in the dialogue, strictly adhering to the
symptomsinitiallydescribedbythepatient.
4. Theultimategoalistoestablishaspecificdiagnosis,withtheconversationendingwhenthe
physiciandeliversthedefinitivediagnosis. Notreatmentsuggestionsarerequired.
Hereisanexampleofasingle-turnmedicalconsultationdialogue:
Patient: {{ QUESTION q }}
Physician: {{ DISEASE d }}
Pleasecreatearealisticmulti-turnphysician-patientdialoguebasedontheprovidedinformation,
endingwithacleardiagnosisfromthephysician.
Chinese
ÊÇ®ÁöÑÂ∑•‰ΩúÊòØÂà©Áî®Êèê‰æõÁöÑÂçïËΩÆÂåªÁñóÂí®ËØ¢ÂØπËØùÂÜÖÂÆπÔºåÊîπÁºñÊàê‰∏Ä‰∏™Á¨¶ÂêàÂÆûÈôÖÁöÑÂ§öËΩÆÂåªÁîü‰∏éÊÇ£ËÄÖ
Èó¥ÁöÑÂØπËØù„ÄÇÂ§öËΩÆÂØπËØùÂ∫îÂΩìÂÆåÂÖ®Âü∫‰∫éÂçïËΩÆÂØπËØù‰∏≠ÁöÑ‰ø°ÊÅØÔºå‰∏çÊ∑ªÂä†‰ªª‰ΩïÊñ∞‰ø°ÊÅØ„ÄÇÂ§öËΩÆÂØπËØùÂºÄ
Âßã‰∫éÊÇ£ËÄÖÊèêÂá∫ÈóÆÈ¢òÔºåÁªßÁª≠ÈÄöËøáÂåªÁîüÁöÑÈÄê‰∏™ÈóÆÈ¢òÊù•Êé¢Á©∂ÔºåÂπ∂ÊúÄÁªà‰ª•ÂåªÁîüÂØπÊÇ£ËÄÖÁöÑÂÖ∑‰ΩìËØäÊñ≠
ÁóÖÁóáÁªìÊùüÔºåÊó†ÈúÄÊèê‰æõÊ≤ªÁñóÂª∫ËÆÆÊàñÂêéÁª≠Ë°åÂä®„ÄÇ
ÈÅµÂÆà‰ª•‰∏ãË¶ÅÁÇπÁîüÊàêÂØπËØùÔºö
1. ÂºÄÂßãÊó∂ÊÇ£ËÄÖÊèèËø∞ÂàùÂßãÁóáÁä∂Ôºå‰πãÂêéÂåªÁîüÈÄöËøáËØ¢ÈóÆÂæóÂà∞Êõ¥Â§öËØ¶ÁªÜ‰ø°ÊÅØ„ÄÇ
2. ÊØè‰∏™ÂåªÁîüÁöÑÊèêÈóÆÂíåÊÇ£ËÄÖÁöÑÁ≠îÂ§çÈÉΩÁ¥ßÂØÜÂÖ≥ËÅîÔºå‰ªÖÂü∫‰∫éÊÇ£ËÄÖÂ∑≤Êèê‰æõÁöÑ‰ø°ÊÅØ„ÄÇ
3. ÈÅøÂÖçÂú®ÂØπËØù‰∏≠ÂºïÂÖ•Êñ∞ÁöÑÁóáÁä∂„ÄÅÊ£ÄÊü•ÊàñÁñæÁóÖÔºå‰∏îÂ∫îÂΩì‰∏•Ê†ºÈÅµÂæ™ÊÇ£ËÄÖÂéüÊúâÁöÑÁóáÁä∂ÊèèËø∞„ÄÇ
4. ÊúÄÁªàÁõÆÊ†áÊòØÁ°ÆÁ´ã‰∏Ä‰∏™ÂÖ∑‰ΩìÁöÑËØäÊñ≠ÔºåÂπ∂‰ª•ÂåªÁîüÁöÑÂÜ≥ÂÆöÊÄßËØäÊñ≠‰Ωú‰∏∫ÂØπËØùÁªìÊùü„ÄÇ‰∏çÈúÄË¶ÅÁªôÂá∫
Ê≤ªÁñóÂª∫ËÆÆ„ÄÇ
‰ª•‰∏ãÊòØÂçïËΩÆÂåªÁñóÂí®ËØ¢ÂØπËØùÁ§∫‰æãÔºö
ÊÇ£ËÄÖÔºö{{ QUESTION q }}
ÂåªÁîüÔºö{{ DISEASE d }}
ËØ∑Ê†πÊçÆÊèê‰æõÁöÑ‰ø°ÊÅØÂàõÂª∫‰∏Ä‰∏™ÈÄºÁúüÁöÑÂ§öËΩÆÂåªÊÇ£ÂØπËØùÔºåÂπ∂‰ª•ÂåªÁîüÊòéÁ°ÆÁöÑËØäÊñ≠ÁªìÊùü„ÄÇ
Figure9: Thistemplateisneededtotransformsimplemedicalquestionandanswerpairsintointeractive,multi-turn
dialoguesthatmoreaccuratelyreflectreal-lifephysician-patientinteractions. ItisrepresentedasM =G (q,d),
M
whereGdenotestheGPT-4turboAPI.TemplateforTransformingDiagnosisDialoguesintoRule-BasedDialogues
English
Adjusttheconversationbetweenthephysicianandthepatientaccordingtothefollowingrules.
Thegoalistoestablishaspecificdiagnosis. Startwiththepatient‚Äôsdescriptionoftheircondition
andendwiththephysician‚Äôsdefinitivediagnosis. Notreatmentrecommendationsareneeded. The
resultsofanycompletedtestsmustbeprovidedbythepatient,andthephysiciancanonlyobtain
relevantinformationthroughpreviousdialogueandproceedwithfurtherinquiries.
Whenthephysicianisinquiring,thefollowingrulemustbefollowed:
{{ RULE_PHYSICIAN M }}
i
Whenthepatientanswersthephysician‚Äôsquestions,thefollowingrulesmustbefollowed:
1. Answerthephysician‚Äôsquestionscompletelyandhonestly. Iftherearenorelatedsymptomsor
testresults,honestlystatenone. Donotfabricateorsupplementwithunperformedtestresults.
2. Thepatient‚Äôsgoalistoconfirmorruleoutadisease. Donotperformadditionalexamination
actions,endtheconversationafterobtainingadiagnosis,andiflackingdiagnosticevidence,end
theconversationwithoutcontinuingtoobtainevidence.
3. Ifthereisaclearhistoryofmedication,surgery,pastillnesses,ormarriageandchildbirth,it
shouldberetainedintheconversation.
Originalphysician-patientdialogue:
{{ DIALOGUES r }}
i
Adjustedphysician-patientdialogue:
Chinese
Â∞ÜÂåªÁîüÂíåÊÇ£ËÄÖÂØπËØùÊåâÁÖß‰∏ãÂàóËßÑÂàôË∞ÉÊï¥ÔºåÊúÄÁªàÁõÆÊ†áÊòØÁ°ÆÁ´ãÂÖ∑‰ΩìÁöÑËØäÊñ≠„ÄÇ‰ª•ÊÇ£ËÄÖÊèèËø∞Ëá™Ë∫´ÊÉÖ
ÂÜµÂºÄÂßãÔºå‰ª•ÂåªÁîüÁöÑÂÜ≥ÂÆöÊÄßËØäÊñ≠‰Ωú‰∏∫ÂØπËØùÁªìÊùüÔºå‰∏çÈúÄË¶ÅÁªôÂá∫‰ªª‰ΩïÊ≤ªÁñóÂª∫ËÆÆ„ÄÇÂ∑≤ÂÅöÁöÑÊ£ÄÊü•Áªì
ÊûúÈúÄÁî±ÊÇ£ËÄÖÊèêÂá∫ÔºåÂåªÁîüÂè™ËÉΩÊ†πÊçÆÂâçÈù¢ÁöÑÂØπËØùËé∑ÂæóÁõ∏ÂÖ≥‰ø°ÊÅØÂπ∂ËøõË°å‰∏ã‰∏ÄÊ≠•ËØ¢ÈóÆ„ÄÇ
ÂåªÁîüÂú®ËøõË°åËØ¢ÈóÆÊó∂ÔºåÈúÄÈÅµÂæ™ËßÑÂàôÔºö
{{ RULE_PHYSICIAN M }}
i
ÊÇ£ËÄÖÂú®ÂõûÁ≠îÂåªÁîüÊèêÈóÆÊó∂ÔºåÈúÄÈÅµÂæ™ËßÑÂàôÔºö
1.ÂÆåÊï¥‰∏îËØöÂÆûÂõûÁ≠îÂåªÁîüÊèêÈóÆ„ÄÇËã•Êó†Áõ∏ÂÖ≥ÁóáÁä∂ÊàñÊ£ÄÊü•ÁªìÊûúËØöÂÆûËØ¥ÊòéÊ≤°ÊúâÔºåÁ¶ÅÊ≠¢ÊçèÈÄ†Ôºå‰∏çÂæóË°•
ÂÖÖÊ≤°ÊúâËøõË°åÁöÑÊ£ÄÊü•ÁªìÊûú„ÄÇ
2.ÊÇ£ËÄÖÁõÆÊ†áÊòØÔºåÁ°ÆËØäÊàñÊéíÈô§ÁñæÁóÖ„ÄÇ‰∏çÂæóËøõË°åÈ¢ùÂ§ñÁöÑÊ£ÄÊü•Ë°å‰∏∫ÔºåËé∑ÂæóËØäÊñ≠ÂêéÁªìÊùüÂØπËØùÔºåËã•
Áº∫Â∞ëÁ°ÆËØäËØÅÊçÆ‰πüÁªìÊùüÂØπËØùÔºå‰∏çËÉΩÂú®Ëé∑ÂæóËØÅÊçÆÂêéÁªßÁª≠ÂØπËØù„ÄÇ
3.ÊúâÊòéÁ°ÆÁöÑÁî®ËçØÂè≤„ÄÅÊâãÊúØÂè≤„ÄÅÊó¢ÂæÄÂè≤„ÄÅÂ©öËÇ≤Âè≤Áõ∏ÂÖ≥ÈúÄ‰øùÁïôÂØπËØù„ÄÇ
ÂéüÂßãÂåªÁîüÊÇ£ËÄÖÂØπËØù:
{{ DIALOGUES r }}
i
Ë∞ÉÊï¥ÂêéÁöÑÂåªÁîüÊÇ£ËÄÖÂØπËØù:
Figure10: Thistemplateaimstoguidethetransformationofmulti-rounddialogueM intorule-baseddialogueMr.
ItisrepresentedasMr =G (M,r),whereGdenotestheGPT-4turboAPI.
p i i