Matching-Driven Deep Reinforcement Learning for
Energy-Efficient Transmission Parameter Allocation
in Multi-Gateway LoRa Networks
Ziqi Lin, Xu Zhang, Shimin Gong, Member, IEEE, Lanhua Li, Zhou Su, Senior Member, IEEE, and
Bo Gu, Member, IEEE
Abstract—Long-range (LoRa) communication technology, dis- academia since they operate in licence-free ISM frequency
tinguished by its low power consumption and long communica- bands [4].
tionrange,iswidelyusedintheInternetofThings.Nevertheless,
ALoRanetworktypicallycomprisesnumerousenddevices
the LoRa MAC layer adopts pure ALOHA for medium access
(EDs), LoRa gateways (GWs), and a network server (NS).
control, which may suffer from severe packet collisions as the
networkscaleexpands,consequentlyreducingthesystemenergy DatapacketsfromEDsarecollectedbyGWsandsubsequently
efficiency (EE). To address this issue, it is critical to carefully forwarded to the NS. In the MAC layer, the LoRa network
allocate transmission parameters such as the channel (CH), adopts pure ALOHA to access the wireless medium [5].
transmission power (TP) and spreading factor (SF) to each end
However,therandomnessofpureALOHAmayleadtoserious
device (ED). Owing to the low duty cycle and sporadic traffic
packet collisions with an increase in the number of EDs.
of LoRa networks, evaluating the system EE under various
parameter settings proves to be time-consuming. Consequently, Data retransmission caused by such collisions may escalate
we propose an analytical model aimed at calculating the system the energy consumption of EDs and consequently reduce the
EEwhilefullyconsideringtheimpactofmultiplegateways,duty system energy efficiency (EE).
cycling, quasi-orthogonal SFs and capture effects. On this basis,
Different combinations of EDs’ transmission parameters,
weinvestigateajointCH,SFandTPallocationproblem,withthe
suchasthechannel(CH),spreadingfactor(SF),andtransmis-
objective of optimizing the system EE for uplink transmissions.
DuetotheNP-hardcomplexityoftheproblem,theoptimization sionpower(TP),resultinvariedperformance.Forinstance,in-
problem is decomposed into two subproblems: CH assignment creasing the TP and SF enhances the transmission’s resilience
and SF/TP assignment. First, a matching-based algorithm is tonoiseandincreasesthetransmissionrangebutconcurrently
introduced to address the CH assignment subproblem. Then, an
decreases the data rate and increases the energy consumption.
attention-based multiagent reinforcement learning technique is
Existing work on transmission parameter allocation for EDs
employed to address the SF/TP assignment subproblem for EDs
allocatedtothesameCH,whichreducesthenumberoflearning inLoRanetworkshasfocusedmainlyonsingle-GWscenarios
agents to achieve fast convergence. The simulation outcomes [6]–[8].Inthispaper,weconcentrateonoptimizingthesystem
indicate that the proposed approach converges quickly under EE of a multi-GW LoRa network through the allocation of
variousparametersettingsandobtainssignificantlybettersystem
the transmission parameters, which is challenging for the
EE than baseline algorithms.
following reasons.
Index Terms—LoRa, multigateway, system energy efficiency, 1) Lack of an analytical model for calculating the EE:
matching-based, multiagent deep reinforcement learning.
LoRa EDs perform with low duty cycles and have limited
data rates, which results in sporadic packet transmission.
I. INTRODUCTION Therefore, it is time-consuming to evaluate the EE across
Owing to their long communication range and low power various parameter settings in practice. An analytical model
consumption, low-power wide area networks (LPWANs) [1] thatcanevaluatetheEEinrealtimeisthereforeimportantfor
are extensively utilized in the development of autonomous efficiently allocating the transmission parameters. However,
wireless networks for various Internet of Things (IoT) appli- most existing analytical models consider only the single-GW
cations, such as smart agriculture [2] and smart cities [3]. As scenario[9],[10].Inmulti-GWscenarios,packetsfromanED
typical LPWANs, long-range (LoRa) networks have attracted may experience independent path loss and can be received by
increasing attention from researchers in both industry and any GW within the communication range. Therefore, existing
analytical models for single-GW scenarios cannot be directly
This work was supported in part by the National Science Foundation of applied to multi-GW scenarios.
China(NSFC)underGrantU20A20175andinpartbytheNationalKeyR&D
2) Imperfect SF orthogonality: Due to imperfect SF
ProgramofChinaunderGrant2020YFB1713800.(Correspondingauthor:Bo
Gu.) orthogonality,theinterferenceresultingfromconcurrenttrans-
B. Gu, S. Gong, L. Li, Z. Lin and X. Zhang are with the School of mission over the same CH with different SFs (i.e., inter-SF
Intelligent Systems Engineering, Sun Yat-sen University, Shenzhen 518107,
interference) is nonnegligible [11]. Such inter-SF interference
China, and with the Guangdong Provincial Key Laboratory of Fire Science
andIntelligentEmergencyTechnology,Guangzhou510006,China(E-mails: may increase the possibility of packet loss when the signal-
gubo@mail.sysu.edu.cn; gong0012@e.ntu.edu.sg; lilh65@mail.sysu.edu.cn; to-interference ratio (SIR) is below a specific threshold [12].
linzq36@mail2.sysu.edu.cn;zhangx526@mail2.sysu.edu.cn).
Since packets can be received by several GWs, different
Z.SuiswiththeSchoolofCyberScienceandEngineering,Xi’anJiaotong
University,Xi’an710049,China(E-mail:zhousu@ieee.org). combinationsoftransmissionparametersmayresultinvarious
4202
luJ
81
]AM.sc[
1v67031.7042:viXrapacket delivery rates (PDR) in different GWs, which further [15]. Li et al. [9] designed DyLoRa to achieve optimal EE
complicates EE optimization in multi-GW scenarios. by dynamically adjusting the optimal transmission parameters
To address the abovementioned challenges, we design an for EDs. Martin et al. [15] proposed a link quality detection
analytical model to calculate the system EE within a multi- mechanism (i.e., calculating lost/erroneous data packets over
GW LoRa network. Then, we investigate the problem of joint time) to quickly identify the optimal transmission parameters
CH, SF and TP allocation to optimize the system EE. Due to to improve system EE. However, these methods rely on the
the NP-hard complexity of the problem, we decompose the assumptionofperfectlyorthogonalSFs,whichisuntenablein
optimization problem into two subproblems: CH assignment realLoRanetworks.Severalstudieshavefocusedonparameter
and SF/TP assignment. A two-stage optimization framework, allocation in scenarios with imperfect SF orthogonality [16],
termed MMALoRa, which integrates matching techniques [17]. Amichi et al. [16] investigated the issue of jointly op-
and multiagent deep reinforcement learning, is proposed to timizing SF and TP allocation to improve throughput fairness
maximize the system EE. First, a matching-based algorithm and reduce energy consumption. Su et al. [17] focused on
is designed to solve the CH assignment subproblem. Then, uplink transmissions and proposed a joint user scheduling, SF
anattention-basedmultiagentreinforcementlearning(MAAC) allocation and TP assignment scheme to maximize the EE.
algorithm [13] is employed to address the SF/TP assignment However,theabovementionedmethodsrequirefrequentinfor-
problem.Theprincipalcontributionsofthispaperarefourfold: mation exchange between the GW and EDs, which is difficult
• We propose an analytical model to calculate the system to implement due to the constrained spectrum resources in
EE in multi-GW LoRa networks while fully considering LoRa networks.
the imperfect SF orthogonality and duty cycling. The Many studies have investigated parameter assignment
simulation outcomes confirm that the proposed model withinLoRanetworksemployingdeepreinforcementlearning
can accurately evaluate the system EE of LoRa networks (DRL). Inaam et al. [18] introduced a centralized DRL-based
under different parameter settings. scheme for parameter assignment in which the GW acts as
• Leveraging the proposed analytical model, we formulate a centralized node to adjust the parameters of each ED to
a joint CH/SF/TP assignment problem aimed at max- maximize the PDR. Qin et al. [6] focused on maximizing
imizing the uplink systems’ EE. Then, we propose a the system EE by training a deep Q-network based on the
two-stage optimization framework, namely MMALoRa, GW to generate CH and SF allocations and then solving a
which combines matching theory and multiagent rein- nonconvex optimization problem to determine the optimal TP.
forcement learning to derive the optimal solution. Duc-Tuyen et al. [19] designed a multiarmed bandit-based
• CH assignment is formulated as a many-to-one matching learning algorithm to minimize the probability of collisions
problem and a low-complexity algorithm is developed to by appropriately allocating radio resources.
derive stable matching results between EDs and CHs. Different from the abovementioned works focused on
To achieve fast convergence, an MAAC-based algorithm single-GW scenarios, some researches [20]–[22] have studied
is proposed to determine the SF/TP for each ED group theparameterallocationprobleminmulti-GWLoRanetworks.
assignedtothesameCHtoreducethenumberoflearning Liao et al. [21] introduced a dynamic approach for selecting
agents. In particular, the attention mechanism enables theGWandassigningSFs,whichreducesthepacketcollision
each ED to determine how much “attention” should be rate by equalizing the time-on-air (ToA) of each SF. Yathreb
given to the parameter allocations of pertinent EDs with et al. [22] presented a stochastic geometry-based approach
the goal of enhancing the system EE. for analyzing the uplink transmission performance in LoRa
• Simulation results reveal that MMALoRa can achieve networks. Gao et al. [20] introduced EF-LoRa, a framework
rapidconvergenceandthattheEDscanlearnappropriate designedtoachievefairEEamongEDsbyallocatingdifferent
transmission parameter allocation policies in multi-GW parameters to various EDs. However, the above investigations
LoRa networks. neglectedtheimpactofcaptureeffectsandquasiorthogonality
betweenSFsontheperformanceofLoRanetworks;thus,their
results do not represent real-world scenarios.
II. RELATEDWORK
In this paper, we focus on a multi-GW LoRa network
Recently, various techniques have been employed to op- and propose a two-stage framework, MMALoRa, to optimize
timize the parameters of EDs in LoRa networks, aiming to the system EE while fully considering imperfect SF orthog-
enhance network performance. LoRaWAN, the MAC layer onality, capture effects, and duty cycling. Since the NS has
protocol of LoRa networks, currently utilizes an adaptive data global knowledge of all EDs, MMALoRa can run on a high-
rate (ADR) [14] to automatically select the SF and TP for performanceNS.Thus,thelearnedexperiencesofeachEDcan
each ED to ensure that the signal-to-noise ratio (SNR) of besharedthroughtheNS,therebyimprovingtheefficiencyof
the ED is higher than a demodulation floor. However, Li et model training.
al. [9] demonstrated that the ADR approach tends to choose
larger TPs and SFs to meet the minimum SNR required for
III. SYSTEMMODEL
demodulation, potentially resulting in an increase in energy
consumption of as much as 103%. We focus on uplink transmissions in a multi-GW LoRa
To improve the system EE of LoRa networks, many ad- network consisting of N EDs, K GWs, and one NS. The
vancedresourceallocationalgorithmshavebeenproposed[9], sets of GWs and EDs are denoted as K = {1,2,··· ,K}𝑛 pr payload size of the packet, and DE is the low-data-rate mode
indicator,whichisDE =1ifthemodeisenableandDE =0
𝑇𝑐,𝑚𝑖 otherwise. The CR value ranges from 5 to 8, representing a
𝑖 coding rate ranging from 4/5 to 4/8. Tci,mi = 2mi is the
𝑇𝑐,𝑚𝑗 5 preamble symbols symbol time, and BW ci is the
bandwidts hym obo fl CHB
c
iW .ci
𝑗 Since the LoRa network operates in the unlicensed spec-
trum, EDs should comply with the maximum restrictions of
duty cycle δ. Due to the duty cycle, each transmission is
𝑇 𝑖𝑐,𝑚𝑖 +𝑇 𝑗𝑐,𝑚𝑗 −(𝑛 pr−5)×𝑇 s𝑚 ym𝑖
bol
divided into an active period, wherein packets are transmit-
ted, as well as an inactive period, during which no packet
Fig. 1: Packets from the target ED and interferer with inter-
transmission occurs. According to [23], the probability that
ference time interval and preamble details.
the interfering ED j is operating in the active period at a
given time Tcj,mj is defined as δ =1−100(1−δ)λTcj,mj.
j j j
By fully considering the effects of the duty cycle, the
and N = {1,2,··· ,N}, respectively. Specifically, the GWs
probability that interfering ED j transmits in the interference
receiveanddecodepacketsfromtheEDsdeployedwithintheir
time interval T can be given by:
communication range and forward them to the NS. The LoRa ij
EDs communicate with the GW through multiple CHs and h =1−e−λTijδj (5)
j
adoptSFstosharefrequenciesandtimeslotswithEDswithin
the same CH. At most, each ED is allowed to access one CH B. Capture Effect and Quasi-Orthogonality between SFs
and select one SF per transmission. The sets of SFs and CHs
The signal transmitted by ED i experiences channel fading
are expressed as M={7,8,··· ,12} and C ={1,2,··· ,C},
andpathlossbeforearrivingatGWk,andthereceivedsignal
respectively.
strength is defined as:
prx =p ·g ·a(d ) (6)
A. The Traffic Pattern of LoRa Networks i,k i i,k i,k
We assume that the traffic pattern of the LoRa network fol- wherep i denotestheTPofEDiandg i,k denotestheRayleigh
lowsaPoissondistribution[23].Therefore,anEDtransmitsκ fading channel between GW k and ED i. In addition, a(d i,k)
packetswithinatimeintervalT withthefollowingprobability: denotes the path loss attenuation function, following the Friis
transmission equation [25], which can be expressed as:
(λT)κ
P(X =κ)= e−λT (1) (cid:18) ω (cid:19)τ
κ! a(d )= (7)
i,k 4πfd
where λ denotes the average sending rate. Accordingly, the i,k
probability that the ED remains silent in time interval T where ω and f represent the light velocity the carrier fre-
is P(X =0) = e−λT. Then, the probability that the ED quency, respectively. d i,k is the distance from ED i to GW k
transmits at least one packet can be defined as: and τ denotes the path loss exponent.
Owingtothecaptureeffectandthequasi-orthogonalnature
h=1−P(X =0)=1−e−λT (2) of SFs, a packet from the ED can be decoded if the received
SIR is above a relative threshold, even in the presence of
As shown in Fig. 1, Bor et al. [24] experimentally demon-
overlappingtransmissions.ThethresholdsforvariousSFpairs
strated that even if the preamble is affected by interference,
are given by the following SIR matrix [10]:
thepacketcanstillbedecodediftheGWcancorrectlyreceive
the last five symbols of the preamble. Therefore, to guarantee SF SF SF SF SF SF
7 8 9 10 11 12
the successful reception of the packet from ED i by the GW, SF  1 −8 −9 −9 −9 −9 
7
the interfering ED j that uses the same CH as ED i (i.e., SF 8  −11 1 −11 −12 −13 −13 
c tii m= e c inj t) es rvh ao lu :ld not transmit during the following interference ∆ [dB] = SS FF 19 0     − −1 15 9 − −1 13 8 −1 17 − 113 − −1 14 7 − −1 15 8    
 
T =Tcj,mj +Tci,mi −(n −5)×Tci,mi (3) SF 11  −22 −22 −21 −20 1 −20 
ij j i pr symbol SF −25 −25 −25 −24 −23 1
12
whereTci,mi andTci,mj aretheToAforEDiandinterfering (8)
i j
EDj,respectively,totransmitapacketwhenusingSFm and The rows denote the SF selected by the target ED, and the
i
m , respectively. The ToA of the packets transmitted by ED columns denote the SF selected by the interfering ED. The
j
i is given by: SIR of ED i above the relevant threshold can be defined as
follows:
Tci,mi =(n +n )×Tci,mi
i pr pl symbol prx p ·g ·a(d )
=(cid:18) 20.25+max((cid:24) 8L 4− (m4m −i+ 2D28 E+ ) 16(cid:25) CR,0)(cid:19) ×T sc yi m,m boi l S (i,j),k = pr ji x, ,k k = p ji ·g ji, ,k k·a(xi j, ,k k) ≥η mSIR i,mj (9)
i
(4) where ηSIR denotes the SIR threshold that a packet is
mi,mj
where n and n represent the numbers of symbols of transmitted at SF and the colliding packet is transmitted
pr pl mi
the preamble and the payload, respectively. L represents the at SF .
mjC. Packet Delivery Rate in Single-GW LoRa Networks ing to Semtech specifications [26]. The sensitivity thresholds
Accordingto[25],GWk cansuccessfullydecodeanuplink for various SFs are defined in Table I.
packet transmitted from ED i if the following two conditions 2) The received SIR exceeds a certain threshold ηSIR in
mi,mj
are satisfied: the presence of overlapping transmissions.
1) The received signal strength prx exceeds the receiver In summary, the PDR of ED i at GW k is defined by Eq.
i,k
sensitivity ηsen. The receiver sensitivity is determined accord- (10).
i
N
D (c,m,p)=P (cid:8) prx ≥ηsen(cid:9) × (cid:89) Xcj,mj(cid:104) h P (cid:110) S ≥ηSIR (cid:111) +(1−h )(cid:105)
i,k i,k i j j (i,j),k mi,mj j
ci=cj,
j̸=i
N (cid:20) (cid:26) (cid:27) (cid:21)
=P {p i·g i,k·a(x i,k)≥η isen}× (cid:89) X jcj,mj h jP pp i ·· gg i,k· ·a a( (d xi,k) ) ≥η mSIR i,mj +(1−h j) (10)
ci=cj, j j,k j,k
j̸=i
=P (cid:26) g ≥ η isen (cid:27) × (cid:89)N Xcj,mjh (cid:34) P (cid:40) g ≥ η mSIR i,mj ·p j ·g j,k·a(x j,k)(cid:41) +(1−h )(cid:35)
i,k p ·a(d ) j j i,k p ·a(d ) j
i i,k ci=cj, i i,k
j̸=i
For simplicity, we define I =p ·g ·a(x ) as the whereEsu(c,m,p)representstheenergyconsumptionrequired
(i,j),k j j,k j,k i
interferenceofEDj withEDi.BasedontheRayleighfading foratransmittingpacketfromEDitobesuccessfullyreceived
assumption (i.e., g ∼exp(1)), Eq. (10) can be rewritten as: by a GW. e is the energy consumed during the transmission
D i,k(c,m,p)=exp(cid:18) −
p
·η ais (e dn )(cid:19) × p coro nc se us ms pin tioa
npi
ti dm ue eu tonit inw tei rt fh erT eP ncp ei ., Tan hd
e
ie nDp ti i e· (T rc fi ,c m ei r, ,m p e) ni ci es mth ae yen cae urg sy
e
i i,k
(cid:89)N Xcj,mj(cid:34)
h
exp(cid:32) −η mSIR i,mjI (i,j),k(cid:33)
+(1−h
)(cid:35) m adu dl it ti ip ol ne ar le etr na en rs gm yi cs osi no sn us mo pf tia onp .acket, subsequently leading to
j j p ·a(d ) j
ci=cj, i i,k Therefore,thesystemEEforuplinktransmissioninaLoRa
j̸=i network is defined as follows:
(11)
where c = {c i} i∈N,m = {m i} i∈N and p = {p i} i∈N repre- EE(c,m,p)= (cid:88) EE i(c,m,p) (14)
sent the CH, SF and TP allocation for the EDs, respectively.
i∈N
Xcj,mj isabinaryvalue.Here,Xcj,mj =1meansthatSFm
j j j
and CH c j are allocated to ED j, and X jcj,mj =0 otherwise. IV. PROBLEMFORMULATION
WeaimtomaximizethesystemEEofuplinktransmissions
TABLE I: Sensitivity thresholds and distance ranges
withinmulti-GWLoRanetworksbyjointlyoptimizingtheCH
SpreadingFactors 7 8 9 10 11 12 assignment strategy c, the SF assignment strategy m and the
Sensitivity(dBm) -123 -126 -129 -132 -134.5 -137 TPallocationstrategypforeachED.Formally,thisallocation
Distanceranges(km) (0,2] (2,4] (4,6] (6,8] (8,10] (10,12] problem is defined as:
D. Packet Delivery Rate in Multi-GW LoRa Networks P1:maxEE(c,m,p)
c,m,p
In LoRa networks, the broadcast packets from each ED
s.t. (15a) p ≤p ≤p ,∀i∈N
can be decoded by any GW within the communication range. min i max
Then,theGWrelaysallthereceivedpacketstotheNS,which (15b) X ici,mi ∈{0,1},∀i∈N,c i ∈C,m i ∈M
discards duplicate packets. Therefore, a packet is successfully (15c) (cid:88) (cid:88) Xci,mi ≤1,∀i∈N (15)
i
transmitted from an ED if it is received by at least one GW.
ci∈Cmi∈M
Hence, the PDR of an ED in a multi-GW LoRa network is (cid:88)
(15d) Xci,mi ≤Λ ,∀c ∈C,m ∈M
calculated as follows: i max i i
D (c,m,p)=1−
(cid:89)
[1−D (c,m,p)]
i∈Nci
i i,k (12) (15e) D (c,m,p)≥D ,∀i∈N
i th
k∈K
where (cid:81) [1−D (c,m,p)] represents the probability that whereconstraint(15a)representsthelowerandupperbounds
i,k
k∈K fortheavailableTP.Constraint(15b)definesthebinaryassign-
the packet from ED i fails to be received by any GW. ment variables Xci,mi for the CHs and SFs. Constraint (15c)
i
ensuresthateachEDisallowedtoaccessatmostoneCHand
E. Energy Efficiency Model
select one SF. Constraint (15d) represents the upper limit on
The EE of an ED can be defined as the number of trans-
thenumberofEDsthatcanbeassignedtoeachCH,andN is
mitted information bits within an energy consumption unit.
ci
thegroupofEDsassignedtothesameCHasEDi.Constraint
Therefore, the EE of ED i is given by:
(15d) aims to reduce the implementation interference and
L L complexity of each CH. Constraint (15e) specifies the PDR
EE i(c,m,p)= Esu(c,m,p) = e ·Tci,mi · 1 (13) threshold D to guarantee reliable transmission.
i pi i Di(c,m,p) thfollows:
P1:
Joint CH/SF/TP Allocation
P2:maxEE(c)
Decomposition Decomposition
c
P2: P3: s.t. (16a) Xci,mi ∈{0,1},∀i∈N,c ∈C,m ∈M
i i i
CH Allocation SF/TP Allocation SF/TP Allocation Result (cid:88) (cid:88)
CH Allocation
(16b) X ici,mi ≤1,∀i∈N (16)
Result ci∈Cmi∈M
(cid:88)
Matching-based CH Performing the MAAC-based SF/TP (16c) X ici,mi ≤Λ max,∀c i ∈C,m i ∈M
allocation algorithm allocationalgorithm for each ED group
i∈Nci
EDs
MAAC-based SF/TP
CH1 allocationalgorithm ProblemP2isclassifiedasamany-to-onematchingproblem
CHs 1 2 3 4 CH2 MAAC-based SF/TP since at most one CH can be matched with an ED, while
allocationalgorithm
multiple EDs can be matched with the same CH. Moreover,
MAAC-based SF/TP
CH3 allocationalgorithm due to the interference term in Eq. (9), the EE of any ED
over its occupied CH is related to other EDs sharing this CH.
CH1 CH2 CH3 CH4 MAAC-based SF/TP
CH4 allocationalgorithm Therefore, for each ED, the matched CH and the other EDs
matchedwiththesameCHmustbothbeconsidered.Similarly,
ED groups
CH Allocation Result for each CH, not only the EDs matched with this CH but also
Fig. 2: The workflow of the MMALoRa framework. the interrelationships within the group of EDs matched with
this CH, which are influenced by cochannel interference (i.e.,
inter-SF and co-SF interference in the same CH, where co-SF
istheinterferencegeneratedbetweenEDsthatselectthesame
Due to the coupling of the SF/TP/CH assignments and the
SF on the same CH) must be considered. Thus, problem P2
nonconvex optimization objective, the problem described is
also includes externalities.
NP-hard,indicatingthatresolvingthisproblemwithinpolyno-
In traditional matching, each set of players establishes a
mial time is challenging. Therefore, a two-stage optimization
fixed preference ordering based on their preferences for the
framework, MMALoRa, is proposed to derive the solution
other set of players [27]. Next, players from different sets are
to problem P1 in two stages: CH assignment and SF/TP
matched with each other according to their preference order-
assignment. The workflow of MMALoRa is illustrated in Fig.
ing. However, the presence of externalities leads to changes
2.Intheinitialstage,amatching-basedalgorithmisemployed
in the preference ordering of players as matching progresses,
to match the CH for each ED. Given the CH assignment, all
which considerably complicates the matching process. To
EDs can be segmented into separate groups according to the
address these concerns, we employ the approach of swap
EDs assigned to the same CH. In the final stage, an MAAC-
matching, as described in [28], which captures the external-
basedalgorithmisemployedtoallocateSF/TPvaluesforeach
ities using utility functions instead of traditional preference
ED group in parallel.
ordering.
To more effectively describe the swap matching approach
used in the many-to-one matching problem with externalities,
we initially define the foundational concepts of matching
V. MATCHING-BASEDCHASSIGNMENTALGORITHM
theory:
1) Notation for many-to-one matchings: We define two
Inthissection,wepresentamatching-basedCHassignment disjoint sets, the ED set N and the CH set C. For the CH set,
algorithm,withtheEDsandCHsregardedastwodistinctsets there exists a positive integer quota Λ max, which denotes the
of players to be matched to optimize the EE. maximumlimitonthenumberofEDsusingthesameCHand
is defined in (16c). A matching ψ describes the allocation of
EDs to CHs such that each ED is matched with only one CH,
while each CH is matched with multiple EDs. More formally,
this can be represented as follows:
A. CH Assignment Optimization
Definition 1: A many-to-one matching is a subset ψ ⊆C×
N such that |ψ(i)| = 1 and |ψ(c)| ≤ Λ , where ψ(i) =
It is assumed that each ED is assigned the maximum TP max
{c∈C : (i,c)∈ψ} and ψ(c)={i∈N : (i,c)∈ψ}.
and a fixed SF. The SF allocation is determined based on a
predefined relationship between the distance from the ED to 2)Utilityfunction:EachCHpreferstobematchedwiththe
the GW and the corresponding SF, as specified in Table I. groupofEDswiththelargestutility,whereaseachEDprefers
Given that the PDR of an ED is heavily influenced by its to be matched with the CH that offers the largest utility.
SF/TP allocation, adjusting the ED’s PDR solely through CH For a given matching ψ, the utility of ED i under ψ can be
assignment is likely to be ineffective. Consequently, we do defined as follows:
not account for the PDR constraints of the ED during the CH
assignment process. Thus, problem P1 can be reformulated as U (ψ)=EE (ψ) (17)
i iThe utility of CH c under the matching ψ is given by: Algorithm 1 Matching-based CH assignment algorithm
(cid:88) 1: Step 1: Initialization
U (ψ)= EE (ψ)
c i (18) 2: Initial matching ψ = ψ 0: EDs and CHs are randomly
i∈Nc matched with each other under constrains of |ψ(i)| = 1
where N is the ED group assigned to CH c. and |ψ(c)|≤Λ ;
c max
3) Two-sided exchange stable (2ES): Externalities make 3: Step 2: Swap matching
designing matching mechanisms more challenging, as stable 4: repeat
matching cannot be guaranteed straightforwardly. Therefore, 5: for ∀i∈N do
2ES is introduced to describe the effect of externalities on the 6: for ∀i′ ∈N −i, with ψ(i)=c and ψ(i′)=c′ do
matchingoutcomes[28].Tobetterdescribe2ES,theprinciple 7: if (i,i′) is a swap-blocking pair then
of swap matching is initially introduced, defined as follows: 8: Execute the swap operation;
Definition 2: Swap matching behaviour ψi′ = 9: Update the current matching: ψ =ψi′;
i i
ψ\{(i,c),(i′,c′)}∪{(i′,c),(i,c′)} is defined by ψi′(i) = c′ 10: else
i
and ψi′(i′)=c. 11: Keep the current matching;
i
Swap matching is accomplished through the execution of 12: end if
swap operations; thus, the notion of swap-blocking pairs is 13: end for
introduced. 14: end for
Definition 3: Given a pair (i,i′) that is matched according 15: until no swap-blocking pair exists.
to ψ, if there exist ψ(i)=c and ψ(i′)=c′ such that 16: Return the final matching ψ∗
1) ∀q ∈{i,i′,ψ(i),ψ(i′)},U (ψi′)≥U (ψ)
q i q
2) ∃q ∈{i,i′,ψ(i),ψ(i′)},U (ψi′)>U (ψ)
q i q
then (i,i′) is a swap-blocking pair. Theorem 2: Assuming a total iteration count of I, the
Under condition 1), the utility of any involved player q computational complexity of the matching-based algorithm is
cannot decrease after performing the swap operation between bounded by O(IΛ2 C(C−1)).
max
(i,i′). Under condition 2), the utility of at least one player Proof:ForanyCHc,thealgorithmevaluatesamaximumof
q can improve after performing the swap operation between Λ EDsandinspectsΛ (C−1)potentialswapoperations
max max
(i,i′). Then, 2ES matching can be achieved after multiple for each of these EDs. Therefore, there exist Λ2 C(C −1)
max
swapmatchingoperations,whichisdescribedinthefollowing possibleswapoperationsinoneiteration.Consequently,given
definition: the number of iterations I, the complexity of the matching-
Definition 4: If there are no swap-blocking pairs, the based algorithm is bounded by O(IΛ2 C(C−1)).
max
matching ψ is 2ES.
VI. MAAC-BASEDSF/TPALLOCATIONALGORITHM
B. Proposed Matching-Based Algorithm
In this section, we optimize the SF/TP assignments for
The matching-based CH assignment algorithm consists of EDs allocated to the same CH to maximize the EE. First,
an initialization phase and a swap matching phase, which is weformulatetheSF/TPallocationproblem.Subsequently,the
summarizedinAlgorithm1.First,wegiveaninitialmatching aforementioned problem is reformulated as a Markov game,
ψ , in which EDs and CHs are randomly matched with each with the training and execution phases of the MAAC-based
0
other. Next, each ED constantly searches for swap-blocking algorithm presented in detail.
pairs to execute the swap operation until no swap-blocking
pairsremain.Finally,thefinalstablematchingstateisreturned.
A. SF/TP Allocation Optimization
Theorem 1: Through a limited number of swap operations,
the proposed matching-based CH assignment algorithm is Given the CH assignment, P1 is defined as follows:
capable of converging to a 2ES matching. (cid:88)
P3:maxEE(m,p)=max EE (m,p)
Proof: After each swap operation between ED i and ED c
m,p m,p
i′ with i ∈ ψ(c), i′ ∈ ψ(c′), the EDs are matched with CH c∈C
s.t. (19a) p ≤p ≤p ,∀i∈N
c and c′, respectively, which changes the matching from ψ min i max
to ψ ii′. According to Definition 3, the utility of any player (19b) X ici,mi ∈{0,1},∀i∈N,c i ∈C,m i ∈M (19)
among {i,i′,c,c′} does not decrease when a swap operation (19c) (cid:88) (cid:88) Xci,mi ≤1,∀i∈N
i
is performed and the utility of at least one player can be
ci∈Cmi∈M
augmented. Therefore, the EE of at least one player will
(19d) D (m,p)≥D ,∀i∈N
improve after performing a swap operation. On the one hand, i th
the finite number of EDs and CHs restricts the number of Note that obtaining the optimal solution for P3 remains
swap operations per iteration. On the other hand, the EE is challengingduetothecouplingoftheSFandTPassignments
constrained by an upper limit owing to the finite spectrum and the nonconvex optimization objective. To address this
resources [17]. As a result, the number of iterations is finite problem,anMAAC-basedalgorithmisemployedtodetermine
and the proposed matching-based algorithm can converge to a the SF/TP allocation for the EDs to maximize the EE in each
2ES matching within a limited number of swap operations. CH.Specifically, we initially recast P3 as a Markov where ϱ represents a nonnegative weight that balances the
game with multiple EDs, which is defined as a tuple trade-off between the system EE and the penalty imposed on
⟨N,S,T,{A } ,{R } ⟩, where S represents a set ED i. EE denotes the EE of all EDs in CH c without
i i∈N i i∈N (c,−i)
of states, T denotes the state transition function, R is considering ED i, and γ is a binary value used to ensure
i Dth
the reward function space of ED i and A denotes the that the PDR constraint is satisfied, which can be given by:
i
action space of ED i. At time slot t, ED i selects action
(cid:40)
at i ∈ A i based on local observation ot i, where ot i is the γ = 1, D i ≥D th (24)
proportion of the global state st ∈ S. Then, ED i receives Dth 0, D <D
i th
a reward rt+1, and the state transits from st to st+1 with
i
probability T(st+1|st,at,··· ,at ). Each ED i attempts to
1 N
B. Proposed MAAC-Based Algorithm
learn the optimal policy π , which maximizes its cumulative
i
discounted reward (cid:80)∞ µnrt+1+n, where µ denotes the TheMAAC-basedalgorithmadoptsasoftactor-critic(SAC)
n=0 i
discount rate. Given that the MAAC-based algorithm is a frameworkandincorporatesamultiheadattentionmechanism.
model-free reinforcement learning approach, information on Fig. 3 shows the MAAC-based algorithm architecture, which
the state transition function is not needed. Consequently, we consists of a centralized training module and a distributed
concentrate on the design of the three fundamental elements executionmodule.SincetheNScanobtaintheEDinformation
of the Markov game pertaining to P3: the state, action, and collected by all GWs, centralized training is performed on the
reward function. NS. This architecture reduces the signalling overhead caused
State: The observation space for each ED includes three by information transmission among the EDs, thereby increas-
distinct components: the individual PDR, the individual EE, ing the flexibility of the algorithm. A complete description of
and the distances between the ED and each GW. Since the the MAAC-based algorithm is provided in Algorithm 2.
transmission performance of each ED cannot be determined In the distributed execution module, each ED acts as an
before the initiation of time slot t, the ED relies on delayed agent and interacts with the LoRa network in each time slot
transmission performance as a crucial environmental feature. t. Agent i (∀i ∈ N) selects action at based on the current
i
At time slot t, the observation space of agent i is given by: observation ot. Then, agent i receives a new observation ot+1
i i
as well as a corresponding reward rt+1, and the transition
ot ={Dt−1,EEt−1,d } (20) i
i i i i tuple (ot,at,rt+1,ot+1) is collected. After collecting the
i i i i
transition tuple of each agent, the transition tuples of all
where d ={d ,d ,··· ,d } is the set of distances from
i i,1 i,2 i,K
agents (ot,at,rt+1,ot+1) are stored in the experience replay
ED i to each GW. Without loss of generality, the global state
st is selected to be the set of observations of all EDs ot = buffer B, where at = (at 1,...,at N), ot = (ot 1,...,ot N),
{ot,··· ,ot }. ot+1 =(ot 1+1,...,ot N+1) and rt+1 =(r 1t+1,...,r Nt+1).
1 N
In the centralized training module, if the length of the
Action: By receiving the current observation at time slot t,
experiencereplaybufferl exceedsthebatchsizeB,themini-
each agent determines the TP/SF allocation. The TP of each B
batch tuples B are randomly sampled from the experience
EDisdiscretizedintoJ levels,andthepowerlevelsetisgiven mini
replay buffer B in every time slot T to train the policy.
by: update
Because the transmission parameters assigned to the EDs are
P = tightly coupled, the performance of an individual ED can
(cid:26) p −p 2(p −p ) (cid:27) be significantly influenced by the actions of other EDs. To
p ,p + max min,p + max min ,··· , p
min min J −1 min J −1 max address this problem, a multihead attention mechanism is
(21) employed to learn the critic for each agent by selectively
Then, the action of agent i is defined as: considering information from other agents. Specifically, each
agentincorporatestheobservationsandactionsofotheragents
at i ={mt i,pt i} (22) intoitsownaction-valuefunctionQϕ i(o,a),whichisgivenby:
where pt i ∈ P, mt i ∈ M. Consequently, the action space Qϕ i(o,a)=F i(f¯ i,x i) (25)
dimension for each ED is |M|×|P|.
Reward: Our proposed reward function is designed to where ϕ denotes the weight parameter of the critic network,
optimize the nonconvex objective specified in problem P3. F denotesatwo-layermultilayerperceptron(MLP),andf¯ =
i i
The reward for ED i is composed of two parts: (1) the total f (o ,a ) denotes a one-layer MLP embedding function. In
i i i
EE of all EDs that use the same CH c as ED i, i.e., EE , and addition, x denotes the contribution of other agents and is
c i
(2) the average EE reduction attributed to interference from defined as follows:
c
EDi,i.e.,EE (c,−i).Therefore,attimeslott,giventheaction x =(cid:88) ρ h(Vf¯)
at ={mt,pt} of agent i, the reward for ED i can be defined i j j (26)
i i i
as: j̸=i
rt+1 =γ ·(cid:2) ϱEE +(1−ϱ)EE (cid:3) wherethesharedmatrixV transformstheembeddingfunction
i D (cid:34)th c (c,−i) (cid:35) f¯ j into a “value” and h denotes a leaky ReLU activation
=γ · ϱ (cid:88) EE +(1−ϱ)(EE c − EE (c,−i) ) (23) function. ρ j is the attention weight. A query-key system is
Dth i N N −1 used to compare the similarity between f¯ and f¯; then, the
i∈Nc j iCentralized training Shared multi-head attention mechanism
Action (TP&SF Allocation)
SF=7 SF=8 … SF=12 (𝑜 𝑖𝑡,𝑎 𝑖𝑡,𝑟 𝑖𝑡,𝑜 𝑖𝑡+1) Ex𝒐 p𝒐𝑡 e𝒐, 𝑡 r𝒐𝒂, 𝑡 ie𝒂 𝑡,𝑡 ,𝒂 n, 𝑡 𝒂 c𝒓, 𝑡𝒓 𝑡 e,𝑡 ,𝒓 , 𝑡 r𝒓𝒐, 𝑡 e𝒐 𝑡,𝑡 p,𝒐+𝑡 l𝒐+ 𝑡 y1 +𝑡1 + b21 uffer 𝑓𝑓 𝑗𝑖 ҧҧ 𝑊𝑊𝑞 𝑘 Sc pa role dd u cd tot Softmax share among EDs
𝑗∈\𝑖
mini-batch (𝒐,𝒂,𝒓,𝒐′) 𝑉
prD odo ut
ct
𝑥𝑖
unique to each ED
𝑓1ҧ 𝑥
1
Actor 1 Actor 2 … Actor N … At hte en at dion heC ao dn s c pa et re n aa gt ee n t …
LoRa networks environment 𝑓𝑁ҧ 𝑥 𝑁
Critic 1 Critic 2 Critic N
𝑜 𝑖𝑡 𝑎 𝑖𝑡 𝑟 𝑖𝑡,𝑜 𝑖𝑡+1 Agent 1 Agent 2 Agent 𝑁 𝑓 𝑖ҧ 𝑥 𝑖
Agent 𝑖 Actor 𝑖 Attention mechanism 𝑜 𝑖,𝑎 𝑖 MLP MLP 𝑄 𝑖𝜙(𝒐,𝒂)
weights of Critic 𝑖
Distributed execution actor network
Fig. 3: The MAAC-based algorithm architecture for SF/TP allocation.
similarity value is passed to a softmax function. ρ can be Algorithm 2 MAAC-based SF/TP allocation algorithm
j
calculated as follows: Initialize:
exp(f¯TWTW f¯) The experience replay buffer B
ρ j = (cid:80)N expj (f¯Tk WTq Wi f¯) (27) The weights of critic network ϕ¯←ϕ
j=1 j k q i The weights of actor network θ¯←θ
where f¯ is transformed into a “key” by W , and f¯ is for episode=1,2,··· ,N do
j k i episode
transformed into a “query” by W . Note that we use a mul- Reset the operating environment
q
tihead attention mechanism, where each head uses a separate Each agent i gets the initial observation state ot
i
parametergroup(V,W ,W )tocalculatethecontributionsof for t=1,2,··· ,T do
k q train
other agents to agent i. Due to the sharing of the separate Each agent i takes the action at ∼π (ot)
i θi i
parameter groups, all critic networks are updated to minimize Each agent i calculates rt according to Eq. (23)
i
a joint regression loss function, which is defined as follows: Each agent i observes ot+1
i
Store (ot,at,rt,ot+1) for all agents in B
N
(cid:88) (cid:16) (cid:17)2
L (ϕ)= E [ Qϕ(o,a)−y ], (28) end for
Q (o,a,r,o′)∼D i i
if l >B and T %t=0 then
i=1 B update
Randomly sample mini-batch B from B
w ϕ¯h ae nre
d
y θ¯i a= rer i th+
e
µ wE ea ig′∼ hπ tsθ¯[− ofα tl ho eg( tπ arθ¯ gi( ea t′ i| co r′ i it) i) c+ neQ twϕ i¯ o(o rk′,a a′ n)] d, Minimizingthejointregressionlm oin si sfunctiontoupdate
the critic networks according to Eq. (28)
target actor network, respectively, α denotes the temperature
Performing gradient ascent to update the actor net-
parameter and is used to determine the balance between
works according to Eq. (29)
exploitation and exploration within the SAC framework. Update the target actor networks: θ¯←ζθ+(1−ζ)θ¯
Theindividualpoliciesareupdatedwiththegradientascent Update the target critic networks:ϕ¯←ζϕ+(1−ζ)ϕ¯
algorithm, and the gradient can be defined as follows:
end if
∇ J(θ)=E [∇ log(π (a |o ))φ (a ,o )] (29) end for
θi o∼B,a∼π θi θi i i i i i
where φ (a ,o ) = −αlog(π (a |o ))+A (o,a); the multi-
i i i θi i i i
agentadvantagefunction,A (o,a),isusedtoindicatewhether
i A. Simulation Setup
the action of agent i could improve its expected return, which
can be defined as: In the simulation setup, as outlined by the GW locations
described in [23], the GWs are not deployed too close to
A (o,a)=Qϕ(o,a)−b(o,a ) (30)
i i −i each other while allowing for overlapping coverage areas.
where a −i represents the actions of all agents except Therefore, multiple GWs are randomly distributed within an
agent i. b(o,a −i) represents the baseline of the mul- areaof20km×20km,withaminimumseparationof12km
tiagent strategy, which can be defined as b(o,a −i) = between each GW. Moreover, each GW serves as the center
(cid:80)
a′
i∈Aiπ θi(a′ i|o i)Qϕ i(o,(a′ i,a −i)). of a circular cell with a radius of R = 12 km. All EDs
are uniformly distributed within these circular cells to ensure
VII. NUMERICALRESULTS that all EDs can reach at least one GW. The locations of the
In this section, the impact of various parameter settings on GWs and EDs are shown in Fig. 4. All the GWs and EDs
theaccuracyoftheproposedanalyticalmodelisfirstanalyzed. are configured to operate at the 868 MHz ISM band channel
Subsequently, the performance of the MMALoRa algorithm frequency, with a bandwidth of 125 kHz. The duty cycle is
and the effects of various parameter settings on the LoRa 1%,andthepayloadsizeis20bytes.Theremainingsimulation
network’s performance are evaluated. parameters are summarized in Table II.      LoRasimsimulator,respectively.Fig.5showstheMAEswith
 ( Q G  ' H Y L F H
a confidence interval of 95%, where the blue dashed line is
 * D W H Z D \
      the mean and the red solid line is the median.
First, the accuracy of the analytical model is evaluated for
     
networkswithvariousnumbersofEDsrangingfrom60to160,
andthenumberofGWsisfixedat3.AlltheEDsareassigned
    
the largest SF. As shown in Fig. 5(a), the MAE is less than
  3% and increases slightly with the increasing number of EDs.
This outcome occurs owing to the inherent stochastic nature
     oftheLoRaMACprotocol,withanincreaseinthenumberof
EDs leading to increased packet collisions. Moreover, when
      theEDsutilizethehighestSF,theirToAvaluesareincreased,
rendering them more susceptible to interference from other
     
EDs. Therefore, this susceptibility may lead to increased
packet collisions, ultimately resulting in a reduction in the
     
                                                accuracy of the analytical model.
 [  P 
Then, the number of EDs is fixed at 160, while the number
Fig. 4: Locations of the GWs and EDs.
of GWs varies from 2 to 4. All the EDs are assigned the
TABLE II: Simulation parameters largest SF. As shown in Fig. 5(b), the MAE is less than 3%
and decreases slightly with the increasing number of GWs.
Parameters Values
Pathlossexponent(τ) 2.7 This is because the increase in the number of deployed GWs
Averagesendingrate(λ) 0.001s−1 reduces the distance between the majority of EDs and their
Preamblelength(npr) 8bytes closest GW. Consequently, this reduction in distance results
Codingrate 4/5
in shorter ToA values and channel occupation durations,
Minimumtransmissionpowerlimit(p min) 2dBm
Maximumtransmissionpowerlimit(pmax) 20dBm effectively alleviating the negative impact of channel fading
Rewardweights(ϱ) 1/N on the accuracy of the model.
TABLE IV: Parameter setting [24]
B. Model Accuracy Analysis
Parameter PS1 PS2 PS3
In this subsection, we verify the accuracy of the analytical
SF 7 12 12
model in three scenarios, which vary in the number of EDs,
BW(kHz) 500 125 125
the number of GWs, and the transmission parameter config-
urations. Similar to [23], it is assumed that all EDs utilize CR 4/5 4/8 4/5
the same CH and the highest TP. Since the EE of an ED is
Third, we consider three distinct transmission parameter
related mainly to the PDR, we compare the PDR derived by
setting policies, PS1, PS2 and PS3 (see Table IV), within
theproposedanalyticalmodelwiththatgeneratedbytheopen-
networks with 3 GWs and 160 EDs. PS1 utilizes the trans-
sourceLoRasimsimulator[24]toevaluatetheaccuracyofour
mitter settings, leading to the shortest possible ToA of 9.024
analytical model. The PDR within the LoRasim simulator is
ms. PS2 employs the most robust transmission parameter
defined as the ratio of the number of successfully received
settings, resulting in the longest possible ToA of 1187.84 ms.
packets to the total transmitted packets by an ED.
Finally, PS3 adopts the parameter settings used by common
We use the mean absolute error (MAE) to evaluate the
LoRaWANdeployments[24].AsshowninFig.5(c),theMAE
accuracy of the proposed analytical model:
of the model is consistently less than 4%. Nevertheless, the
MAE= |N1
|
(cid:88) |D i−Dˆ i| (31) t ara sn ls im ghi ts ls yion lowp ea rram ace ct ue rr acs ye .tti Tn hg is
s
i in
s
P beS c1 ausa ere no ub mta ei rn oe ud
s
w EDith
s
i∈N
located far from the GW are allocated to the smallest SF,
where N is the ED set and D i and Dˆ i are the PDRs of which causes the received signal power at the GW to be
ED i calculated by the proposed analytical model and the lower than the receiver sensitivity threshold, thereby leading
to increased packet loss. Consequently, the model tends to
slightly overestimate the PDR.
TABLE III: The training parameters of the MMALoRa algo-
rithm The entirety of the presented results validate the ability of
the proposed analytical model to accurately estimate the PDR
Parameters Values
Lengthofanepisode(T train) 30 regardless of the number of EDs or GWs within the LoRa
Sizeofexperiencereplaybuffer(|B|) 105 networks or the transmission parameter settings.
Minibatchsize(Bmini) 1024
Subsequently, based on this analytical model, the perfor-
Learningrate 0.001
mance of the proposed MMALoRa algorithm in assigning
Discountrate(µ) 0.99
Targetnetworkupdaterate(ζ) 0.001 transmission parameters in various LoRa network scenarios
Numberofattentionheads 2 is evaluated. In the subsequent evaluation, the number of CHs
  P  \         
       
         
         
       
 
       
         
                            PS1 PS2 PS3
 1 X P E H U  R I  ( ' V  1 X P E H U  R I  * : V  3 D U D P H W H U  6 H W W L Q J  3 R O L F \
(a) (b) (c)
Fig. 5: MAE between the proposed analytical model and simulations for various (a) numbers of EDs, (b) numbers of GWs
and (c) transmission parameter settings.
is set to C = 4, and each CH operates with a bandwidth of
 0 0 $ / R 5 D N      125 kHz [29].
     0 0 $ / R 5 D  8 N     
 0 0 $ / R 5 D N      
C. Behaviour of the MMALoRa Algorithm  0 0 $ / R 5 D  8 N      
 0 0 $ / R 5 D N      
To evaluate the convergence of the MMALoRa algorithm      0 0 $ / R 5 D  8 N      
fordifferentparameterconfigurations,weconductexperiments
by varying the number of EDs from 80 to 160 while keeping
the number of GWs constant at 2. The parameters used for    
training the MMALoRa algorithm are summarized in Table
III.AsshowninFig.6(a),theMMALoRaalgorithmconverges
within50episodes,witheachepisodelastingapproximately3   
minutes, which is acceptable. Moreover, to evaluate the effec-                       
tiveness of the attention mechanism, a comparative analysis  ( S L V R G H
of the results from the proposed MMALoRa and MMALoRa- (a) System EE vs. the number of iterations (K=2, N=80, 120,
U methods is conducted. The MMALoRa-U represents the 160).
algorithm with a uniform attention approach in which the
attention weights are fixed. This restriction prevents the algo-
   
rithm from focusing on specific EDs. As shown in Fig. 6(a),
the system EE with the MMALoRa algorithm is better than
thatwiththeMMALoRa-Ualgorithm,andthedifferenceinthe
   
system EEs of the MMALoRa and MMALoRa-U algorithms
increases with increasing number of EDs. This is not surpris-
ingbecausetheMMALoRa-Ualgorithmfocusesonallagents
     0 0 $ / R 5 D    K H D G 
equally, which prevents each agent from obtaining valuable
 0 0 $ / R 5 D    K H D G 
information from other agents during the training process.
 0 0 $ / R 5 D    K H D G 
Consequently, MMALoRa-U fails to effectively mitigate the
    0 0 $ / R 5 D  8
cochannel interference that arises with an increasing number
                      
of EDs.
 ( S L V R G H
Then, the number of attention heads is varied to examine
(b) The training process of the MMALoRa algorithm (K=2,
the effect of the attention mechanism on the performance of
N=160).
the MMALoRa algorithm. The numbers of GWs and EDs are
Fig. 6: Convergence of the MMALoRa algorithm (D =
set to 2 and 160, respectively. As shown in Fig. 6(b), the total th
70%).
reward achieved by the 4-head MMALoRa algorithm is lower
than the rewards achieved by the 1-head MMALoRa and 2-
headMMALoRaalgorithms.Thisisnotsurprisingbecausethe • EF-LoRa:EF-LoRausesagreedyalgorithmthataimsat
increasednumberofattentionheadscomplicatesthealgorithm, maximizing the minimum EE in LoRa networks [25].
whichcanpotentiallyleadtooverfittingininstanceswherethe • RCST:RCSTemploysarandomselectionmechanismto
data available in the experience replay buffer are insufficient determine the CHs, SFs and TPs.
for training.
The PDR constraint D is varied among values of 50%,
th
60%, and 70% to investigate its effect on the performance of
D. Comparison with Existing Algorithms
the MMALoRa algorithm.
Threebaselineschemesareusedtoanalysetheperformance We first conduct a comparative analysis of the average
of the MMALoRa algorithm. PDR and system EE results obtained by employing various
• ADR: The ADR algorithm adaptively selects SF and TP algorithms with different numbers of EDs. The number of
valuesfortheEDsaccordingtotheSNRandensuresthat GWs is fixed at 3, while the number of EDs varies from
the SNR is higher than the demodulation floor [14]. 60 to 160. As shown in Fig. 7, the MMALoRa algorithm
     ( $ 0      ( $ 0
  - P  W L E   \ F Q H L F L I I (  \ J U H Q (  P H W V \ 6
 G U D Z H 5  O D W R 7
     ( $ 0       
       
       
       
 0 0 $ / R 5 D  Dth        0 0 $ / R 5 D  Dth      
 0 0 $ / R 5 D  Dth        0 0 $ / R 5 D  Dth      
     0 0 $ / R 5 D  Dth            0 0 $ / R 5 D  Dth      
 $ ' 5  $ ' 5
 ( )  / R 5 D  ( )  / R 5 D
 5 & 6 7  5 & 6 7
                                     
 1 X P E H U  R I  ( ' V  1 X P E H U  R I  * : V
(a) AveragePDRvs.differentnumberofEDs.
(a) AveragePDRvs.differentnumberofGWs.
       
 0 0 $ / R 5 D  Dth      
 0 0 $ / R 5 D  Dth      
     0 0 $ / R 5 D  Dth          
 $ ' 5
 ( )  / R 5 D
     5 & 6 7    
   
   
         0 0 $ / R 5 D  Dth      
 0 0 $ / R 5 D  Dth      
  
 0 0 $ / R 5 D  Dth      
    $ ' 5
 ( )  / R 5 D
   5 & 6 7
                       
       
 1 X P E H U  R I  ( ' V
 1 X P E H U  R I  * : V
(b) SystemEEvs.differentnumberofEDs.
(b) SystemEEvs.differentnumberofGWs.
Fig.7:ComparisonoftheaveragePDRandsystemEEresults
Fig.8:ComparisonoftheaveragePDRandsystemEEresults
achieved by different algorithms under different numbers of
achieved by different algorithms under different numbers of
EDs (K=3).
GWs (N=140).
can optimize the system EE while satisfying varying PDR MMALoRa algorithm tends to allocate higher SFs and TPs to
constraints. Specifically, as depicted in Fig. 7(a), when sub- EDstoensurereliabletransmission,whichconsequentlyleads
jected to PDR constraints of D th at 50%, 60%, and 70%, to an increase in energy consumption. Next, we compare the
the MMALoRa algorithm achieves average PDRs of approx- performance of different algorithms with varying numbers of
imately 70%, 75%, and 80%, respectively. Fig. 7(b) shows GWs. The number of GWs is varied from 1 to 4, and the
the system EE versus the number of EDs. Furthermore, the numberofEDsissetto140.AsshowninFig.8,thesystemEE
performance gap between the MMALoRa algorithm and the and average PDR improve as the number of GWs increases.
other algorithms escalates with increasing number of EDs. ThisisbecausetheincreasingnumberofGWsmayreducethe
This is because with an increasing number of EDs, the distances between EDs and their nearest GWs. Consequently,
MMALoRa algorithm can intelligently allocate transmission EDs can utilize lower SFs and TPs, thereby achieving lower
parameters to mitigate cochannel interference. The EF-LoRa energyconsumptionandshorterToAvalues.ThereducedToA
algorithm obtains limited performance because it is designed also diminishes the probability of packet collisions due to the
to address a max-min problem to achieve EE fairness among interference from other EDs.
the EDs. On the other hand, the ADR algorithm tends to
select larger SFs and higher TPs to maintain the SNR above
VIII. CONCLUSION
the demodulation threshold, resulting in limited effectiveness
in mitigating interference. However, as the PDR constraint In this paper, we investigate multi-GW LoRa networks and
increases, the system EE calculated by the MMALoRa al- propose an analytical model to calculate the system EE while
gorithm decreases. Notably, when the PDR constraint D is fullyconsideringdutycycling,quasi-orthogonalityandcapture
th
set to 70%, the MMALoRa algorithm demonstrates limited effects. The simulation results validate that the proposed
performance in terms of the system EE. This is because the analytical model accurately assesses the system EE of LoRa
 H W D 5  \ U H Y L O H '  W H N F D 3  H J D U H Y $
  - P  W L E   \ F Q H L F L I I (  \ J U H Q (  P H W V \ 6
 H W D 5  \ U H Y L O H '  W H N F D 3  H J D U H Y $
  - P  W L E   \ F Q H L F L I I (  \ J U H Q (  P H W V \ 6networks under different settings according to comparisons [17] B.Su,Z.Qin,andQ.Ni,“EnergyefficientuplinktransmissionsinLoRa
with the system EE obtained by the open-source LoRasim networks,” IEEE Transactions on Communications, vol. 68, no. 8, pp.
4960–4972,2020.
simulator.Onthebasisoftheanalyticalmodel,weinvestigate
[18] I.Ilahi,M.Usama,M.O.Farooq,M.U.Janjua,andJ.Qadir,“Intelligent
the problem of joint CH, SF and TP allocation to optimize resource allocation in dense lora networks using deep reinforcement
the system EE. Owing to the NP-hardness of the problem, learning,”arXivpreprintarXiv:2012.11867,2020.
[19] D.-T.Ta,K.Khawam,S.Lahoud,C.Adjih,andS.Martin,“LoRa-MAB:
we decomposed the original problem into two subproblems:
AflexiblesimulatorfordecentralizedlearningresourceallocationinIoT
CH assignment and SF/TP assignment. Then, a two-stage networks,”in201912thIFIPwirelessandmobilenetworkingconference
optimization framework, MMALoRa, is proposed to solve (WMNC),2019,pp.55–62.
[20] Z.Zhao,W.Gao,W.Du,G.Min,W.Mao,andM.Singhal,“Towards
the two subproblems. The simulation results demonstrate that
energy-fairness in lora networks,” IEEE Transactions on Mobile Com-
the MMALoRa algorithm rapidly converges under various puting,2022.
parameter configurations, significantly enhancing the system [21] W.-S. Liao, O. Zhao, K. Ishizu, and F. Kojima, “Adaptive Parameter
AdjustmentforUplinkTransmissionforMulti-gatewayLoRaSystems,”
EE while ensuring the PDR constraint in comparison to the
in201922ndInternationalSymposiumonWirelessPersonalMultimedia
three baseline algorithms. Communications(WPMC),2019,pp.1–5.
[22] Y.Bouazizi,F.Benkhelifa,andJ.McCann,“SpatiotemporalModelling
ofMulti-GatewayLoRaNetworkswithImperfectSFOrthogonality,”in
REFERENCES GLOBECOM 2020 - 2020 IEEE Global Communications Conference,
2020,pp.1–7.
[1] U.Raza,P.Kulkarni,andM.Sooriyabandara,“LowPowerWideArea [23] V. Toro-Betancur, G. Premsankar, M. Slabicki, and M. Di Francesco,
Networks: An Overview,” IEEE Communications Surveys & Tutorials, “ModelingCommunicationReliabilityinLoRaNetworkswithDevice-
vol.19,no.2,pp.855–873,2017. level Accuracy,” in IEEE INFOCOM 2021 - IEEE Conference on
[2] W.Lu,X.Xu,G.Huang,B.Li,Y.Wu,N.Zhao,andF.R.Yu,“Energy ComputerCommunications,2021,pp.1–10.
efficiencyoptimizationinSWIPTenabledWSNsforsmartagriculture,” [24] M. C. Bor, U. Roedig, T. Voigt, and J. M. Alonso, “Do LoRa low-
IEEETransactionsonIndustrialInformatics,vol.17,no.6,pp.4335– power wide-area networks scale?” in Proceedings of the 19th ACM
4344,2020. International Conference on Modeling, Analysis and Simulation of
[3] R. Eletreby, D. Zhang, S. Kumar, and O. Yag˘an, “Empowering low- WirelessandMobileSystems,2016,pp.59–67.
power wide area networks in urban settings,” in Proceedings of the [25] W. Gao, W. Du, Z. Zhao, G. Min, and M. Singhal, “Towards Energy-
ConferenceoftheACMSpecialInterestGrouponDataCommunication, FairnessinLoRaNetworks,”in2019IEEE39thInternationalConfer-
2017,pp.309–321. enceonDistributedComputingSystems(ICDCS),2019,pp.788–798.
[4] J.P.S.Sundaram,W.Du,andZ.Zhao,“Asurveyonloranetworking: [26] Semtech, “SX1272/3/6/7/8: LoRa Modem Designer’s Guide AN1200.
Researchproblems,currentsolutions,andopenissues,”IEEECommu- 13,”2019.
nicationsSurveys&Tutorials,vol.22,no.1,pp.371–388,2019. [27] D. Gale and L. S. Shapley, “College admissions and the stability of
[5] LoRa Alliance, “LoRaWAN What is it? A technical overview marriage,”TheAmericanmathematicalmonthly,vol.69,no.1,pp.9–
of LoRa and LoRaWAN,” Oct 2018. [Online]. Available: https: 15,1962.
//lora-alliance.org/sites/default/files/2018-04/what-is-lorawan.pdf. [28] E.Bodine-Baron,C.Lee,A.Chong,B.Hassibi,andA.Wierman,“Peer
[6] Z. Qin, J. Li, and B. Gu, “Channel-Occupation-Aware Resource Allo- effectsand stabilityin matchingmarkets,”in InternationalSymposium
cation in LoRa Networks: a DQN-and-Optimization-Aided Approach,” onAlgorithmicGameTheory. Springer,2011,pp.117–129.
in 2022 IEEE Wireless Communications and Networking Conference [29] F.Yu,X.Zheng,L.Liu,andH.Ma,“Loradar:Anefficientlorachannel
(WCNC),2022,pp.1455–1460. occupancy acquirer based on cross-channel scanning,” in IEEE INFO-
[7] A.-U.-H.Ahmar,T.D.Nguyen,W.Joosen,andD.Hughes,“EH-CRAM: COM2022-IEEEConferenceonComputerCommunications,2022,pp.
A Sustainable Energy Harvesting Algorithm for LPWANs,” in 2021 540–549.
IEEE Wireless Communications and Networking Conference (WCNC),
2021,pp.1–7.
[8] H.H.R.Sherazi,L.A.Grieco,M.A.Imran,andG.Boggia,“Energy-
efficient LoRaWAN for industry 4.0 applications,” IEEE Transactions
onIndustrialInformatics,vol.17,no.2,pp.891–902,2020.
[9] Y.Li,J.Yang,andJ.Wang,“DyLoRa:Towardsenergyefficientdynamic
LoRatransmissioncontrol,”inIEEEINFOCOM2020-IEEEConference
onComputerCommunications,2020,pp.2312–2320.
[10] A.Mahmood,E.Sisinni,L.Guntupalli,R.Rondon,S.A.Hassan,and
M. Gidlund, “Scalability analysis of a LoRa network under imperfect
orthogonality,” IEEE Transactions on Industrial Informatics, vol. 15,
no.3,pp.1425–1436,2018.
[11] F. Benkhelifa, Z. Qin, and J. A. McCann, “User fairness in energy
harvesting-basedLoRanetworkswithimperfectsforthogonality,”IEEE
TransactionsonCommunications,vol.69,no.7,pp.4319–4334,2021.
[12] D. Bankov, E. Khorov, and A. Lyakhov, “Mathematical model of
lorawan channel access with capture effect,” in 2017 IEEE 28th An-
nual International Symposium on Personal, Indoor, and Mobile Radio
Communications(PIMRC),2017,pp.1–5.
[13] S.IqbalandF.Sha,“Actor-attention-criticformulti-agentreinforcement
learning,” in International conference on machine learning (ICML),
2019,pp.2961–2970.
[14] D. Garlisi, I. Tinnirello, G. Bianchi, and F. Cuomo, “Capture aware
sequentialwaterfillingforLoRaWANadaptivedatarate,”IEEETrans-
actions on Wireless Communications, vol. 20, no. 3, pp. 2019–2033,
2020.
[15] M. Bor and U. Roedig, “LoRa transmission parameter selection,” in
201713thInternationalConferenceonDistributedComputinginSensor
Systems(DCOSS),2017,pp.27–34.
[16] L.Amichi,M.Kaneko,E.H.Fukuda,N.ElRachkidy,andA.Guitton,
“Jointallocationstrategiesofpowerandspreadingfactorswithimperfect
orthogonalityinloranetworks,”IEEETransactionsonCommunications,
vol.68,no.6,pp.3750–3765,2020.