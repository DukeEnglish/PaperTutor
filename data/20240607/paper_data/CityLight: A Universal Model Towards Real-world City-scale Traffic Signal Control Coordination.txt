CityLight: A Universal Model Towards Real-world
City-scale Traffic Signal Control Coordination
JinweiZeng,ChaoYu,XinyiYang,WenxuanAo,JianYuan,YongLi,YuWang,HuazhongYang
DepartmentofElectronicEngineering
TsinghuaUniversity
zengjw17@gmail.com
Abstract
Traffic signal control (TSC) is a promising low-cost measure to enhance trans-
portationefficiencywithoutaffectingexistingroadinfrastructure. Whilevarious
reinforcementlearning-basedTSCmethodshavebeenproposedandexperimentally
outperform conventional rule-based methods, none of them has been deployed
intherealworld. Anessentialgapliesintheoversimplificationofthescenarios
intermsofintersectionheterogeneityandroadnetworkintricacy. TomakeTSC
applicableinurbantrafficmanagement,wetargetTSCcoordinationincity-scale
high-authenticityroadnetworks,aimingtosolvethethreeuniqueandimportant
challenges: city-levelscalability, heterogeneityofreal-worldintersections, and
effective coordination among intricate neighbor connections. Since optimizing
multipleagentsinaparameter-sharingparadigmcanboostthetrainingefficiency
andhelpachievescalability,weproposeourmethod,CityLight,basedonthewell-
acknowledged optimization framework, parameter-sharing MAPPO. To ensure
the unified policy network can learn to fit large-scale heterogeneous intersec-
tionsandtackletheintricatebetween-neighborcoordination,CityLightproposes
a universal representation module that consists of two key designs: heteroge-
neousintersectionalignmentandneighborhoodimpactalignmentforcoordina-
tion. To further boost coordination, CityLight adopts neighborhood-integrated
rewards to transition from achieving local optimal to global optimal. Exten-
sive experiments on datasets with hundreds to tens of thousands of real-world
intersectionsandauthentictrafficdemandsvalidatethesurprisingeffectiveness
and generalizability of CityLight, with an overall performance gain of 11.66%
and a 22.59% improvement in transfer scenarios in terms of throughput. Fur-
ther in-depth analyses demonstrate CityLight’s success in addressing heteroge-
neous intersections and holistically optimizing the traffic system, validating its
applicabilitytoreal-worlddeployment. Ourcodesanddatasetsareavailableat:
https://anonymous.4open.science/r/CityLight-CB80.
1 Introduction
Modern cities are suffering from heavy traffic congestion due to the rapid urbanization. with no
requirementforadjustmentstoexistingroadinfrastructure, trafficsignalcontrol(TSC)hasbeen
recognizedasalow-costmeasureforimprovingtrafficefficiencyandrelievingsuchcongestion[17].
Althoughreinforcementlearning(RL)hasbeenwidelyincorporatedinTSCandshownexperimental
superiorityoverrule-basedmethods,noneofthemhavebeendeployedtoreal-worldtrafficmanage-
mentduetooversimplificationoftrafficscenarios,particularlyintermsofintersectionheterogeneity
and road network intricacy [13]. Therefore, nowadays cities still rely on rule-based methods to
controltrafficlights,leadingtoinsufficiencyandhugedelaycost[12]. Inthissense,itisurgentto
makeRL-basedTSCmethodstrulyapplicableintacklingcity-scalereal-worldintersections.
Preprint.Underreview.
4202
nuJ
6
]YS.ssee[
2v62120.6042:viXraMostoftheexistingRL-basedTSCmethodscanonlytackleurbanregionsthatcomprisetensof
intersectionsandcannotscaletocity-levelapplicationswiththousandsoreventensofthousandsof
intersectionsduetohugecomputationalcosts. Somedesignmoreinformativeobservations[10,8],
whilesomeattempttoachievebettercoordinationbyincorporatingneighborhoodinformation[18,21]
orsettinghierarchicalrewards[16,1]. However,thesemethodsrelyonseparatepolicynetworks
for each intersection, suffering from high training time in large-scale scenarios. Although some
works [24, 19] try to tackle large-scale TSC by proposing parameter-sharing optimization meth-
ods, their evaluations are conducted on oversimplified gridded homogeneous intersections (see
AppendixA.2.1),leavingtheireffectivenessincomplexreal-worldscenariostoquestion. Moreover,
noneofthemfullyleveragetheinformativeneighborhoodstates,resultingininadequateintersection
coordination. Toconclude,theinsufficientscalabilityandthequestionableeffectivenessincomplex
real-worldroadnetworkshinderthepracticalapplicationofexistingreinforcementlearning-based
TSCmethods.
Tofillinthegap, weaimtobuildupacity-scaleTSCmethodthatcaneffectivelycoordinateon
large-scalereal-worldheterogeneousintersections. However,suchataskisquitechallenging. Firstly,
intersectionsinacitycanscaletothousandsandeventensofthousands[24]. Usingacentralized
modeltooptimizealltheintersectionssimultaneouslywillbringdimensionalityexplosionissues
whileassigningeachintersectionaseparatepolicynetworkwillcosthugecomputationalexpenses
during optimization. Therefore, how to effectively scale to the city level poses great challenges.
Secondly,duetothecomplexityofreal-worldroadnetworks,real-worldintersectionsexhibitdiverse
configurations and scales, resulting in variations in factors considered in traffic signal control at
differentintersections.Developingpoliciesthataccountforthevariationsandfitalltheseintersections
isessentialbutchallenging. Finally,realroadtopologycouldbeintricatelyinterwoveninsteadof
simplygridded, thedistancesandconnectinglanesbetweenintersectionsgreatlyvaryacrossthe
city. Thisaddstothedifficultyofmodelingthetrafficimpactsfromneighborhoodintersectionsand
effectivelyachievingcoordination.
To address the aforementioned challenges, we propose CityLight for city-scale real-world TSC
coordination. Consideringthetrainingefficiencyofparameter-sharingoptimizationframeworksfor
large-scaleoptimizationtasks,CityLightadoptsawell-acknowledgedparameter-sharingtraining
framework,MAPPO[25],toachievecity-levelscalability. Toensurethelearnedunifiedpolicyby
MAPPOcanbeappliedtoreal-worldheterogeneousintersectionswithintricateneighboringconnec-
tions,CityLightfeaturesauniversalrepresentationmodule. Specifically,itfirstalignstheobservation
ofintra-intersectiontrafficstatesofvariousintersectionswhilepreservingtheirheterogeneityin-
formation. Then,torepresentinformativeneighboringstatesforeffectivecoordination,itfurther
mapsneighboringintersections’originalobservationsontoauniformspacethatcharacterizestheir
relativetrafficimpactsonthetargetintersections,whereanattentivegroupfusionfollowstoaggregate
neighborhoodimpactsconsideringtheircompetitiverelationships. Tofurtherboostcoordination,
CityLightalsofeaturesarewardintegrationmodulethatcombinesneighborhoodconsiderationsinto
therewarddesign,whichtherebybridgesthegapbetweenlocaloptimalandglobaloptimal.
Insummary,tothebestofourknowledge,wearethefirsttoincorporatereinforcementlearningto
tackletheessentialbutchallengingcity-scalereal-worldTSCproblem. Bycharacterizinglocaltraffic
statesandrelativetrafficimpactsfromneighboringintersectionsinanalignedmannerandlearning
withaunifiedpolicynetwork, CityLightachievescity-levelscalabilitywhileensuringconsistent
applicability to heterogeneous intersections and effective coordination. Extensive experiments
on hundreds to tens of thousands of authentic intersections and traffic demands demonstrate the
remarkableeffectivenessofourmodel,withanoverall11.66%improvementandasuperiorityof
22.59%intransferscenariosinthroughput.Furtherin-depthanalysessubstantiateCityLight’sefficacy
inaddressingheterogeneousintersectionsandholisticallyoptimizingthetrafficsystem, showing
CityLight’sgreatpotentialtobetrulyapplicableinreal-worldurbantrafficmanagement.
2 RelatedWork
Trafficsignalcontrolisanessentialmeasurefortrafficsystemmanagement,whichhasthereforebeen
extensivelyresearched. Conventionalapproachesgenerallyincorporatemanuallydesignedrulesfor
signaltransitionjudgement[11,9,28,27,23]. Forexample,FixedTime[28]transitssignalalongthe
cyclephasesequenceatafixedandsetinterval.MaxPressure[27]allowspassageforthetrafficphase
thathasthelargestdiscrepancybetweenthenumberofenteringvehiclesandexitingvehicles,thereby
2Figure1: Illustrationof(a)termsintrafficsignalcontrolproblem;(b)phasereindexingoperation;(c)
between-intersectiontrafficrelations. Bestviewedincolors.
achievingtheequivalenceofvehicledistribution. Althoughrobustandsteady,rule-basedmethods
lackflexibilityinaddressingcomplextrafficpatternsandachievingcoordination[22],consequently
resultingininefficiencyissues.
Tosolvetheinefficiencyissue,reinforcementlearning(RL)-basedTSChasbeenwidelyresearched
these years considering RL’s strength in decision making [10, 8, 18, 21, 1, 20]. However, these
methods are mostly limited to region-scale optimization that only contains tens of intersections.
Specifically,some[10,8]proposedmoreinformativetrafficobservationrepresentationstoassistRL
modelsinunderstandingtrafficsituations. Someachievedbettercoordinationeitherbyincorporating
graphneuralnetworkstoaggregateneighborhoodsituations[18,21]orhierarchicallyoptimizingthe
wholetrafficsignalsystem[1,16]. Sincethesemethodsassigneachintersectiononeseparatepolicy
networktolearnitsindependentpolicy,theiradaptationstolarge-scalescenariosfacehightraining
timecosts. Totacklelarge-scalescenarios,severalworkscameupwithparameter-sharingmethodsto
decreasetrainingcomplexity. Forexample,MPLight[24]proposedaparameter-sharingDQNagent
thatusespressure(thediscrepancybetweenenteringvehiclesandexitingvehiclesoftheintersection)
as the reward to achieve equitable traffic flow. GPLight [19] grouped agents with similar traffic
patternsandassignedeachgroupasharedpolicynetworktodecreasemodelcomplexity. However,
theevaluationsofexistinglarge-scaletrialsarealllimitedtooversimplifiedroadnetworksthatonly
comprisegriddedhomogeneousintersections(seeAppendixA.2.1),leavingtheireffectivenessin
dealingwithreal-worldheterogeneousandintricateintersectionstoquestion.Moreover,noneofthem
fullyleveragetheneighborhoodtrafficinformationandbetween-neighborconnectivityinformation
tolearntrafficimpactsfromneighboringintersections,whichresultsinadequatecoordination. In
conclusion,existingRL-basedTSCmethodsarelimitedinscalabilityandeffectivenessintackling
intricateauthenticintersections,andtherebycannotbeappliedtoreal-worldcity-scaledeployment.
3 Preliminaries
Trafficsignalcontrolreferstothetransitionoftrafficsignalstatesatintersections. Anintersection,as
casedinFigure1(a),connectsseveralroadsattheirends,whereeachroadincludesseverallanes
pointingtodifferenttrafficmovements. Atrafficphaseisdefinedasvalidandcontradictorytraffic
movementsatatime. Duetothecomplexityofurbanroadsystemsinreallife,intersectionsvary
greatlyinconfigurationandscale,leadingtotheheterogeneityofintersections. Urbanintersections
mainly comprise three-phase and four-phase intersections, whose corresponding phase sets are
illustratedinFigure1(a). Sinceturningrightisalwaysallowed,itisomittedinthephasedefinition.
Weformulatethereinforcementlearning-basedcity-scaletrafficsignalcontrol(TSC)problemwith
thedecentralizedpartiallyobservableMarkovdecisionprocesses(DEC-POMDP)[14]withshared
rewards. ADEC-POMDPisdefinedby⟨S,A,O,R,P,n,γ⟩. S isthestatespace. Aistheshared
action space for each agent i. o = O(s;i) is the local observation for agent i at global state s.
i
P(s′|s,A)denotesthetransitionprobabilityfromstos′ giventhejointactionA = (a ,...,a )
1 n
for all n agents. R(s,A) denotes the shared reward function. γ is the discount factor. Agents
use a policy π (a |o ) parameterized by θ to produce an action a from the local observation o ,
θ i i i i
3Figure2: OverallframeworkofCityLight. Bestviewedincolors.
and jointly optimize the discounted accumulated reward J(θ) = E [(cid:80) γtR(st,At)] where
At,st t
A =(at,...,at)isthejointactionattimestept.
t 1 n
4 CityLight: AUniversalModelforCity-scaleReal-worldTSCCoordination
Toovercomethechallengesofscalability,intersectionheterogeneity,andcomplexityofbetween-
neighborrelationshipsincity-scalecoordinatedtrafficsignalcontrol,weproposeCityLight,whose
framework is illustrated in Figure 2. Considering the parameter-sharing paradigm’s capacity to
improvetrainingefficiencyandhelpachievecity-levelscalability,weadoptthewell-acknowledged
multi-agentreinforcementlearningframeworkMAPPO[25]asouroptimizationframework.However,
toensurethelearningoftheuniversalandgeneralizablepolicyintheframework,theinputtedagent
representationsneedtobealignedtoletthepolicybetterunderstandthevarioussituationsofdifferent
intersections. As a solution, CityLight incorporates a universal representation module to extract
alignedrepresentationsfornotonlytheinnertrafficstatesofeachheterogeneousintersectionbut
theirintricateimpactfromneighboringintersectionsaswell. Onthisbasis,thelearnedpolicycan
universally fit various intersections and tackle diverse coordination scenarios. To further boost
coordination,wealsoproposearewardintegrationdesignthattakesneighborhoodsituationsinto
consideration in optimization. In the following sections, we provide detailed descriptions of our
designs to apply MAPPO [25] to city-scale TSC. We also provide the formula of each design in
AppendixA.1.
4.1 UniversalRepresentation
4.1.1 ObservationAlignmentforHeterogeneousIntersections
PhaseReindexing. Whilewehavedefinedthephasesetforthree-phaseandfour-phaseintersections
inthepreliminarydefinitions,thephaseshavenoorderwithintheset. Weintroducephasereindexing
operationfortworeasons: Firstly,sinceweuseaunifiedpolicynetworkforallagents,reindexing
phases to the uniform phase order can align phases of the same index to be of the same traffic
movementsemantics,therebyhelpingthepolicynetworkbetteridentifythedecisionlogicsforthe
exacttrafficmovements. Secondly,orderedobservationscanpavethewayforthefollowinguniversal
representationsofneighboringintersections.
AsillustratedinFigure1(b),selectinganyroadastheaxisroad,thephasesforafour-phaseinter-
sectioncanbeorderedastheturning-leftphasefromtheaxisroad,straight-throughphasefromthe
axisroad,turning-leftphasefromthecrossedroad,andstraight-throughphasefromthecrossedroad.
Forathree-phaseT-intersection,thereisonlyonestraight-throughphase. Wecanreindexphases
tofitthefirstthreephasesofthereindexorder. Fortheotherthree-phaseY-intersections,thethree
phasesareidenticalanddonotneedtochangetheorders. Tomention,thephasereindexoperation
4onlyneedstobedoneoncebeforetraining. Thephaseordersforeachintersectionarefixedafterthat.
WeprovidecaseexamplesinAppendixA.1.1tohelpunderstandthephasereindexingoperation.
ObservationExtraction. Sincewewanttolearnoptimalstrategiesforheterogeneousintersections
undervaryingtrafficpatterns,weincludeanintersection’sdynamictrafficfeatures,staticconfigura-
tion,andscalecharacteristicsinitsobservation. Specifically,afterphasereindexing,theobservation
X is concatenated from a four-digit vector representing the sum of the queuing vehicles at each
phase,afour-digitone-hotactionvectorindicatingthecurrentpassingphase,andafour-digitin-lane
numbervectorforeachphasedenotingtheintersectionscale. Forthree-phaseintersections,thefourth
digitofeachvectorispaddedby-1. Inthisway,theobservationsummarizesthetrafficsituationsfor
intersectionsuniversallywhilepreservingtheirheterogeneityregardingconfigurationandscale.
Withtheoriginalexplicitobservationsatallintersections,thekeyistoeffectivelyorganizethemto
feedthecriticalinformationofeachtargetintersectiontotheactiondecoder,whichshouldcontain
a concise representation of each target intersection’s own traffic situations and a comprehensive
characterizationofitsinteractionswithneighboringintersections.
4.1.2 SelfRepresentationLearning
To concisely characterize a target intersection’s inner traffic states, we incorporate the well-
acknowledgedself-attentionmechanismtoattentivelyextractinformationfromitsinitialobservation.
Throughthisprocess,weobtaintheselfrepresentationXtofthetargetintersection.
4.1.3 NeighborhoodRepresentationAlignmentforCoordination
Coordinationbetweentrafficsignalshasbeenvalidatedtoimproveoverallsystemefficiency[18,21].
However, mostexistingapproachesassigneachagentanindependentpolicynetworktolearnits
interactionwithneighboringintersections. Inthisway,eachnetworklearnstheintersection’slocal
trafficrelationwiththeneighborhoodimplicitlythroughtrialanderror. However,theseapproaches
strugglewithscalabilityduetoextremelyhighcomputationalcosts.
With the parameter-shared MAPPO framework as the base to ensure scalability, it is crucial to
establishanalignedneighborhoodrepresentationparadigmtoensurethattheunifiedpolicynetwork
canfindpatternsonhowintricatebetween-neighborinteractionsaffecttrafficandtherebyinform
policylearning. Thecluewecomeupwithtoalignneighborhoodrepresentationsistomodeltheir
relativetrafficimpactonthetargetintersection, whichisauniformsemanticspaceregardlessof
thelocationsandcharacteristicsoftheneighboringintersections. Sincethecrucialneighborhood
informationforatargetintersectiontochooseacoordinatedtrafficsignalactionisthepotentialvehicle
flowsfromtheneighborhoodintersections,specifyingwhichpartintheneighboringrepresentations
indicatestheincomingtrafficflowandmodelingtheflow’simpactisinformative.
To achieve alignment of neighborhood representations, we introduce a relation encoder to map
originalneighboringobservationstothespacerepresentingrelativetrafficmovementinformation.
Additionally,weincorporateconnectivityinformationtomodelthestrengthofimpactsfromneigh-
borhoodstothetargetintersections. Agroupfusionmoduleisfurtherproposedtoaggregatemultiple
neighborhoodrepresentations,takingintoaccounttheirmutualcompetitiverelations.
RelationEncoder. Weproposearelationencodertoembedneighborrepresentationstothealigned
relativetrafficmovementspace. Sincetheordersofphasesarefixedafterphasereindexing,thetraffic
relationfromaneighboringintersectiontothetargetintersectionisdeterminedbythedirectionof
the neighboring intersection’s axis road, which has two possibilities as illustrated in Figure 1(c).
Therefore,therelationcanbeencodedwithatwo-digitone-hotvectorX ,witheachonerepresenting
r
atypeofphaseorderregardingrelativetrafficmovement.
Consideringthecapabilityofthecross-attentionmethodtoextractcorrespondinginformationfrom
reference vectors based on the query vector, we incorporate it to learn neighbor representations
alignedinrelativetrafficmovementsbasedontheirrelativetrafficrelationvectors. Specifically,with
therelativerelationX asthequeryandtheoriginalobservationX oftheneighboringintersection
r
asthereference,thecross-attentionmechanismprojectsneighboringintersectionsontoauniform
relativetrafficmovementspace,whichmeansthatthesamepartintherepresentationscorresponds
tothecharacterizationsofthesamerelativetrafficmovementtothetargetintersection. Wefurther
5introduceaself-attentionmechanismtothemappedrepresentationtoextractinformation,fromwhich
wegettheneighborhoodrelativeobservationrepresentationsXr.
ImpactModeling. Distanceandlinkingstrength(numberofconnectedlanes)betweenthetarget
intersection and a neighboring intersection, which can be summarized as their connectivity X ,
c
influencehowtheneighboringintersectionsimpactthetargetintersection. Meanwhile,thetraffic
situationofthetargetintersectionalsoimpactshowtheneighboringintersectionswillinteractwithit.
Weproposeourconnectivity-basedimpactmodelingmoduletocharacterizetherelativeimpactfrom
theneighborhood.
TheconnectivityinformationX islinearlyembeddedandconcatenatedwiththetargetintersection’s
c
selfrepresentationXt. Theconcatenationprovidessufficientinformationformodelingtherelative
impactstrengthofneighboringinteractions. Therefore,weapplyitasthequeryinthecross-attention
operationtocharacterizetheneighborhoodimpactrepresentationsXn.
GroupFusion. Tofullyleveragetheintricateandvariousneighboringinformation,itisessentialto
effectivelyfusetheminaconciseandintuitivemanner. Duetotheflippingsymmetryofintersections,
theimpactofflippedneighborsonthetargetintersectionishomogeneousandthetwogroupsofflipped
neighborsaretypicallyorthogonallylaidoutwithcompetitiveimpactsonthetargetintersection’s
signalchoice. Thereby,wedenoteeachgroupofflippedneighborsascompetinggroup(ascasedin
Figure2). Weorderthecompetinggroupalongtheaxisroadasthefirstandtheonealongthecrossed
roadasthesecond. Sincewithinagroup,differentneighboringtrafficpatternsmayhavedifferent
indicationsforthetrafficsignalaction,weattentivelyaggregateneighboringrepresentationsfroma
groupbyputtinghigherweightonnoteworthyneighboringpatterns. ThefinalrepresentationXf of
anintersectionistheconcatenationofitsownrepresentationandtheaggregatedrepresentationsof
eachcompetinggroup.
The action space for each intersection is their reindexed traffic signal phase set. In this way, the
actionspacealignswiththefinalrepresentationwhichislearnedfromobservationsofreindexed
phases. Withthefinalrepresentationfullycharacterizingatargetintersection’sowntrafficstatesand
neighboringtrafficimpacts,theactiondecodercantherebylearntheoptimaldecisionpoliciesfor
varyingsituations.
4.2 RewardIntegration
Existingliteratureintrafficsignalcontrolstypicallyassignsindependentrewardsforintersections,
aimingtomaximizeeachintersection’strafficefficiency. However,thecombinationoflocaloptimal
policiesdoesnotensureaglobaloptimalpolicy[1]. Forexample,releasingnumerousvehiclesfrom
oneupstreamintersectiontothealreadycongesteddownstreamintersectionmightenhancethetraffic
efficiencyitself,butitcouldexacerbateextremecongestionatthedownstreamintersection,even
leadingtoagridlock. Thus,itisessentialtoadjusttheconventionalindependentrewarddesignstofit
thecoordinationtarget.
Toenhancecoordinationbetweenoneintersectionanditsone-hopneighboringintersections, we
integrateneighboringintersections’originalrewardsintotheintersection’soriginalreward.Todismiss
theimpactofimbalancednumbersofone-hopneighborsduetotheheterogeneityofintersections
andcomplexityofreal-worldroadnetworks,wedesigntherevisedrewardasthecombinationof
theoriginalrewardandtheweightedaverageoftheirone-hopneighbors’originalrewards,where
thetwotermsarebalancedwithatunablecoefficient. Inourimplementation,wechoosethewell-
acknowledgedaveragequeuelengthmetricastheoriginalreward[18,26,20].
5 NumericalExperiments
5.1 ExperimentalSetup
Testbed We conduct experiments on the next-generation traffic simulation platform, MOSS [3].
SimilartotraditionalSUMO[7]andCityFlow[6]simulatorsinemployingcar-followingandlane-
changingmodelstocalculatethemotionofeachvehicle,MOSSachievedahigh-fidelity100-times
simulationspeed-upbyadoptingGPUacceleration. TheexperimentalsettingoftheTSCfollows
existing works [15]: for every time interval, which is 15 seconds, the actor in CityLight and all
baselines select the next traffic signal for every intersection. The optimization scenario involves
6Table1: PerformancecomparisonofCityLightagainstbaselinesintworegion-scaleandtwocity-
scaledatasets. Bolddenotesthebestresultsandunderlinedenotesthesecond-bestones. ’-’denotes
’noresult’duetoextremelyhightrainingtimecost.
Chaoyang CentralBeijing Jinan Beijing
Model TP↑ ATT↓ TP↑ ATT↓ TP↑ ATT↓ TP↑ ATT↓
FixedTime 6076 826.7 18602 1514.9 33681 1605.2 60615 1133.5
MaxPressure 1215 1776.1 5448 1879.9 2492 2051.7 15563 1566.7
AdjustedMaxPressure 5909 785.3 18950 1497.4 33367 1601.8 64613 1090.3
FRAP 6211 905.9 17169 1561.0 − − − −
CoLight 6685 753.3 18566 1504.1 − − − −
MPLight 6119 871.5 17516 1563.0 30458 1648.5 60676 1132.2
Efficient-MPLight 5931 951.5 16043 1611.0 29237 1680.3 57800 1171.4
Advanced-CoLight 6530 828.7 17620 1537.1 − − − −
Advanced-MPLight 6339 827.0 16685 1581.3 32235 1622.8 64781 1086.8
GPLight 5879 960.3 17505 1570.2 29888 1677.3 60235 1144.9
CityLight(Ours) 7692 603.4 21552 1434.5 36735 1554.5 70459 1029.1
Improvement 15.06% 19.90% 13.73% 4.20% 9.07% 2.95% 8.76% 5.31%
trafficflowinthemorningrushwithina60-minutetimeframe. Moredetailsonourtestbedcanbe
referredtoinAppendixA.3.
DatasetsWeconstructtworeal-worldregion-scaledatasetsandtwocity-scaledatasetsforcompre-
hensivecomparisonswithbaselinesandperformancevalidationsacrossscales. Region-scaledatasets
includehundredsoftrafficsignallights: Chaoyang(97intersections)andCentralBeijing(885
intersections). City-scaledatasetshavereachedthescaleofthousandsandeventensofthousands:
Jinan(3930intersections)andBeijing(13952intersections). Wegeneratevehicletrajectorydata
thatcloselyreplicatesreal-worldtrafficdemandsforeachdataset. FordatasetsofBeijing,thevehicle
trajectories are generated based on the true hour-level OD flow matrix collected from a Chinese
location-basedservice(LBS)providerin2020. ForJinan,thevehicletrajectoriesarerecoveredfrom
trafficcameravideos[4,5]. MoredetailsareinAppendixA.2.2.
BaselinesandMetricsToevaluatetheperformanceofourproposedCityLightmethod,wecompare
it against three rule-based and seven RL-based TSC methods. We first include three rule-based
methods, Fixed Time [28] and Max Pressure [27], and Adjusted Max Pressure. The RL-based
TSCmethodsincludesFRAP[26],CoLight[18],MPLight[24],Efficient-MPLight[10],Advanced-
CoLight [8], Advanced-MPLight [8], and GPLight [19]. We use two widely adopted evaluation
metrics: throughput(TP)andaveragetraveltime(ATT).AppendixA.4.1andA.4.3providemore
detailsofbaselinesandimplementations.
5.2 OverallPerformance
WecomparetheperformanceofourCityLightwithbaselinesintworegion-scaledatasetsandtwo
city-scaledatasetsasshowninTable1. FRAP,Colight,andAdvanced-Colightlearnindependent
policiesforeachintersection,leadingtounaffordablecomputationalandtrainingtimecostswhen
appliedtocity-scaledatasets. Thereby,weonlylisttheirperformanceonregion-scaledatasets. Based
ontheseresults,wehavethesenoteworthyobservations:
• ConsistentSuperiority. OurCityLightmodelconsistentlyachievesthebestperformanceacross
differentmetricsanddataset scales. Forregion-levelexperiments, our methodoutperformsall
state-of-the-artbaselines,withanaverageliftof14.40%intermsofthroughputandanaverage
reductionof12.05%intermsofaveragetraveltime. Whenevaluatedatthecitylevel,ourmethod
alsoshowsanastonishingimprovementof8.92%inthroughputand4.13%inaveragetraveltime.
ThesignificantperformancegaindemonstratesCityLight’seffectivenessinachievingcoordinated
TSCforintricatereal-worldtrafficandroadnetworks.
• Incapabilityofexistinglarge-scaleTSCmethodstotacklereal-worldcity-scaleintersections.
Whenscaledtothecitylevel,theperformancesofMPlight,Efficient-MPLight,Advanced-MPlight,
andGPLightperformevenworsethanrule-basedmethods. Thereasonmaybetheirinsufficiency
to incorporate neighborhood information, which leads to the nonstationarity issue in training.
7Suchaphenomenonalsodemonstratestheinadequaterobustnessofthesepreviousworkswhose
performanceshaveonlybeenevaluatedinoversimplifiedscenarios.
5.3 TransferabilityTest
ToevaluatethegeneralizabilityandrobustnessofourCityLightmodel,weconducttransferability
testsonourCityLightandbaselinesapplicabletotransferscenarios,whicharetheparameter-sharing
learning-basedbaselines. Specifically,weconstructtwotransferpairs. Thefirstpairinvolvesthemu-
tualtransferbetweenChaoyangandCentralBeijing,whoseperformanceindicatesthetransferability
acrossscale. ThesecondpairtransfersbetweenJinanandBeijingtotestthecity-leveltransferability.
Table2: TransferexperimentsofCityLightagainstbaselinesapplicabletotransferscenariosacross
scaleandcity. Bolddenotesthebestresultsandunderlinedenotesthesecond-bestones. Duetospace
limits,weshortenChaoyangto’CY’andCentralBeijingto’CB’.
CB->CY CY->CB Beijing->Jinan Jinan->Beijing
Model TP↑ ATT↓ TP↑ ATT↓ TP↑ ATT↓ TP↑ ATT↓
MPLight 5048 1025.9 15010 1624.6 26621 1695.3 52615 1185.7
Efficient-MPLight 1955 1626.1 14966 1625.8 23144 1748.7 53175 1207.8
Advanced-MPLight 5137 926.2 15040 1623.3 29933 1635.8 57199 1150.3
CityLight(Ours) 6704 741.5 19648 1476.5 34016 1579.8 66116 1070.5
Improvement 30.50% 19.94% 30.64% 9.04% 13.64% 3.42% 15.59% 6.94%
AspresentedinTable2,CityLightshowsgreattransferabilityacrossbothscaleandcity. Compared
withthenon-transferscenarios,theperformancegainofCityLightoverthebestbaselineenlarges,
withanaverageimprovementof30.57%whentransferredacrossscaleand14.62%whentransferred
across city in terms of throughput. Moreover, while parameter-sharing learning-based baselines
all show a worse performance compared with the best rule-based method (refer to Table 1), our
CityLightoutperformsrule-basedmethodssignificantly. Allthesestatisticsvalidatetherobustness
andgeneralizabilityofourCityLightmodelanditsapplicabilitytoreal-worldtransferscenarios.
5.4 AblationStudies
Figure3: Performanceofablationvariants.
CityLight proposes several important designs to make the universal policy learned by MAPPO
applicabletoheterogeneousandintricatereal-worldintersections: relationencoder,impactmodeling,
groupfusionforuniversalrepresentation,andrewardintegration. Weconductablationstudiesto
examinethecontributionofeachcomponentandlisttheperformancesinFigure3,whichshows
thatCityLightimprovestheMAPPOframeworkby3.6%intermsofthroughput. Suchasignificant
performance gain confirms that the universal representation module and the reward integration
moduleeffectivelyenabletheunifiedpolicynetworktolearnapolicythatisuniversallyapplicable
to heterogeneous intersections with complex neighborhood interactions. Also, we can see that
removing any module from our CityLight causes a performance decline. Specifically, removing
relationencodingcausesa2.23%performancedecreaseintermsofthroughput,whichindicatesthe
significanceofaligningneighborhoodobservationsfromtheuniformperspectiveofrelativetraffic
movements. Meanwhile,removingimpactmodelingandgroupfusionalsodecreasestheperformance
ofthroughputby1.66%and1.85%respectively. Therewardintegrationdesignalsobringsa1.28%
performancegainofthroughput,showingitscontributiontoboostingglobaloptimization.
5.5 Effectivenessofunifiedpolicyforheterogeneousintersections
InourCityLight, weproposetheuniversalrepresentationmoduletorepresentintersectionswith
heterogeneousconfigurationsinanalignedmannerandtherebylearnaunifiedpolicy. Tovalidatethe
8effectivenessofuniversalrepresentationintacklingintersectionheterogeneity,wecomparelearning
unifiedpolicyandseparatepoliciesfordifferentconfigurationsonfourdatasets.
Table3: Performancecomparisonsofunifiedpolicyandseparatepoliciesfordifferentconfigurations.
Chaoyang CentralBeijing Jinan Beijing
TP↑ ATT↓ TP↑ ATT↓ TP↑ ATT↓ TP↑ ATT↓
SeparatePolicies 7325 624.5 20944 1446.3 35943 1563.8 70031 1033.6
UnifiedPolicy 7692 576.5 21552 1434.5 36735 1554.5 70459 1029.7
Improvement 5.01% 7.69% 2.90% 0.82% 2.20% 0.59% 0.61% 0.38%
AsshowninTable3,withalignedrepresentations,alearnedunifiedpolicynetworkcanworkfor
heterogeneousintersections,bringinganaverageperformancegainof2.68%intermsofthroughput
and2.37%intermsofaveragetraveltime. Itthereforevalidatestheeffectivenessoftheuniversal
representationmoduleinaligningrepresentationsofdifferentconfigurationsfromtheuniformtraffic
movementsemanticstolearnshareddecisionlogicwhilepreservingtheirheterogeneity.
5.6 ImportanceofHolisticTrainingforCity-scaleOptimization
Whileitisimportanttooptimizetrafficsignalcontrolfortraffic
management in the cities, it remains a question of whether
thetrainingmustbeinaholisticway. Sincetherehavebeen
numerous region-level traffic signal control approaches, is
it feasible to divide the city into multiple regions and then
aggregatemodelsoptimizedforeachzonetoimplementcity-
leveldecisions? Toanswerthisquestion,weconductacase
studyofCityLightinJinanandBeijing.Wedividedthedataset
intohalveshorizontally,vertically,andintoquarters. Under
eachdivision,wecontrolledeachsub-regionusingaCityLight
model optimized in this sub-region and then evaluated the
overallperformanceontheentiredataset.
As shown in Figure 4, holistic training for the whole city
significantlyoutperformsaggregatingtrainedmodelsofeach
sub-region. Moreover,asthenumberofsub-regionsincreases,
the performance of the overall traffic signal control system
Figure4: Performanceofmodelcom-
declines.Thisphenomenonfurtheremphasizestheimportance
binations under horizontal, vertical,
ofholistictrainingforthewholecity,whichtreatsthewhole
and quarterly divisions of Beijing
cityasasystemandcomprehensivelymodelsthemutualinflu-
dataset.
encesbetweenTSCpoliciesandurbantrafficpatterns,thereby
obtainingaglobaloptimalstrategy.
6 Conclusion
Inthiswork,weproposeCityLighttotackletheessentialbutseverelychallengingcity-levelreal-
worldtrafficsignalcontrolproblem. Featuringauniversalrepresentationmoduletolearnaligned
representationsofintersectionstoinputintotheunifiedpolicynetwork,andarewardintegration
moduletoboostneighborhoodconsiderationsandcoordination,CityLightachievescity-levelcoordi-
natedtrafficsignalcontrol. ExtensiveexperimentsshowthatCityLighthasanexcellentperformance
indatasetswithhigh-authenticitycity-scaleintersectionsandtrafficdemands,withan11.66%and
22.59%performancegaininthroughputfornon-transferandtransferscenariosrespectively. However,
there still exist some limitations, including the ignorance of the impact of pedestrians and some
specialtrafficfunctions,suchastidallanes,whicharelefttoourfuturework.
7 BroaderImpacts
SinceCityLightcantackleheterogeneousintersectionsandintricatebetween-neighborconnections
andhasbeenvalidatedonhigh-authenticitydatasets,itmakesbreakthroughstoexistingRL-based
9TSCmethodsforbeingtrulyapplicableforreal-worlddeployment. Oncedeployed,CityLightcan
significantlyimprovetrafficefficiency,mitigatetrafficcongestion,andsavecongestion-relatedenergy
consumption. Also,wecontributetotheresearchcommunitybyopen-sourcingcodesforcrawling
mapsandgeneratingtrafficforanycity. Userscanconvenientlyapplyourworktoanyregionor
developtheirownmethod.
References
[1] BingyuXu,YaoweiWang,ZhaozhiWang,HuizhuJia,andZongqingLu. Hierarchicallyand
cooperativelylearningtrafficsignalcontrol. InProceedingsoftheAAAIconferenceonartificial
intelligence,volume35,pages669–677,2021.
[2] QizeJiang, MinhaoQin, ShengminShi, WeiweiSun, andBaihuaZheng. Multi-agentrein-
forcementlearningfortrafficsignalcontrolthroughuniversalcommunicationmethod. arXiv
preprintarXiv:2204.12190,2022.
[3] JunZhang,WenxuanAo,JunboYan,CanRong,DepengJin,WeiWu,andYongLi. Moss: A
large-scaleopenmicroscopictrafficsimulationsystem,2024.
[4] FudanYu,HuanYan,RuiChen,GuozhenZhang,YuLiu,MengChen,andYongLi. City-scale
vehicletrajectorydatafromtrafficcameravideos. Scientificdata,10(1):711,2023.
[5] FudanYu,WenxuanAo,HuanYan,GuozhenZhang,WeiWu,andYongLi. Spatio-temporal
vehicletrajectoryrecoveryonroadnetworkbasedontrafficcameravideodata. InProceedings
of the 28th ACM SIGKDD Conference on Knowledge Discovery and Data Mining, pages
4413–4421,2022.
[6] Huichu Zhang, Siyuan Feng, Chang Liu, Yaoyao Ding, Yichen Zhu, Zihan Zhou, Weinan
Zhang,YongYu,HaimingJin,andZhenhuiLi. Cityflow: Amulti-agentreinforcementlearning
environment for large scale city traffic scenario. In The world wide web conference, pages
3620–3624,2019.
[7] MichaelBehrisch,LauraBieker,JakobErdmann,andDanielKrajzewicz. Sumo–simulation
of urban mobility: an overview. In Proceedings of SIMUL 2011, The Third International
ConferenceonAdvancesinSystemSimulation.ThinkMind,2011.
[8] LiangZhang,QiangWu,JunShen,LinyuanLü,BoDu,andJianqingWu. Expressionmight
beenough: representingpressureanddemandforreinforcementlearningbasedtrafficsignal
control. InInternationalConferenceonMachineLearning,pages26645–26654.PMLR,2022.
[9] RogerPRoess,ElenaSPrassas,andWilliamRMcShane. Trafficengineering. Pearson/Prentice
Hall,2004.
[10] QiangWu,LiangZhang,JunShen,LinyuanLü,BoDu,andJianqingWu. Efficientpressure:
Improvingefficiencyforsignalizedintersections. arXivpreprintarXiv:2112.02336,2021.
[11] Francisco J Martinez, Chai Keong Toh, Juan-Carlos Cano, Carlos T Calafate, and Pietro
Manzoni. Asurveyandcomparativestudyofsimulatorsforvehicularadhocnetworks(vanets).
WirelessCommunicationsandMobileComputing,11(7):813–828,2011.
[12] NationalOperationCenterofExcellence. Trafficsignalbenchmarkingandstateofthepractice
report,2019.
[13] ArthurMüller,VishalRangras,TobiasFerfers,FlorianHufen,LukasSchreckenberg,Jürgen
Jasperneite,GeorgSchnittker,MichaelWaldmann,MaximFriesen,andMarcoWiering.Towards
real-worlddeploymentofreinforcementlearningfortrafficsignalcontrol. In202120thIEEE
InternationalConferenceonMachineLearningandApplications(ICMLA),pages507–514.
IEEE,2021.
[14] FransAOliehoek,ChristopherAmato,etal. AconciseintroductiontodecentralizedPOMDPs,
volume1. Springer,2016.
[15] Qiang Wu, Mingyuan Li, Jun Shen, Linyuan Lü, Bo Du, and Ke Zhang. Transformerlight:
A novel sequence modeling based traffic signaling mechanism via gated transformer. In
Proceedingsofthe29thACMSIGKDDConferenceonKnowledgeDiscoveryandDataMining,
pages2639–2647,2023.
[16] JinmingMaandFengWu. Learningtocoordinatetrafficsignalswithadaptivenetworkpartition.
IEEETransactionsonIntelligentTransportationSystems,2023.
10[17] StevenIChien,KitaeKim,andJaniceDaniel. Costandbenefitanalysisforoptimizedsignal
timing-casestudy: Newjerseyroute23. InstituteofTransportationEngineers.ITEJournal,
76(10):37,2006.
[18] HuaWei,NanXu,HuichuZhang,GuanjieZheng,XinshiZang,ChachaChen,WeinanZhang,
YanminZhu,KaiXu,andZhenhuiLi. Colight: Learningnetwork-levelcooperationfortraffic
signalcontrol. InProceedingsofthe28thACMinternationalconferenceoninformationand
knowledgemanagement,pages1913–1922,2019.
[19] Yiling Liu, Guiyang Luo, Quan Yuan, Jinglin Li, Lei Jin, Bo Chen, and Rui Pan. Gplight:
groupedmulti-agentreinforcementlearningforlarge-scaletrafficsignalcontrol. InProceedings
oftheThirty-SecondInternationalJointConferenceonArtificialIntelligence,pages199–207,
2023.
[20] Xinshi Zang, Huaxiu Yao, Guanjie Zheng, Nan Xu, Kai Xu, and Zhenhui Li. Metalight:
Value-basedmeta-reinforcementlearningfortrafficsignalcontrol. InProceedingsoftheAAAI
conferenceonartificialintelligence,volume34,pages1153–1160,2020.
[21] Libing Wu, Min Wang, Dan Wu, and Jia Wu. Dynstgat: Dynamic spatial-temporal graph
attention network for traffic signal control. In Proceedings of the 30th ACM international
conferenceoninformation&knowledgemanagement,pages2150–2159,2021.
[22] MaximFriesen,TianTan,JürgenJasperneite,andJieWang. Multi-agentdeepreinforcement
learningforreal-worldtrafficsignalcontrols-acasestudy. In2022IEEE20thInternational
ConferenceonIndustrialInformatics(INDIN),pages162–169.IEEE,2022.
[23] Seung-BaeCools,CarlosGershenson,andBartD’Hooghe. Self-organizingtrafficlights: A
realisticsimulation. Advancesinappliedself-organizingsystems,pages45–55,2013.
[24] ChachaChen,HuaWei,NanXu,GuanjieZheng,MingYang,YuanhaoXiong,KaiXu,and
ZhenhuiLi. Towardathousandlights: Decentralizeddeepreinforcementlearningforlarge-
scaletrafficsignalcontrol. InProceedingsoftheAAAIconferenceonartificialintelligence,
volume34,pages3414–3421,2020.
[25] ChaoYu,AkashVelu,EugeneVinitsky,JiaxuanGao,YuWang,AlexandreBayen,andYiWu.
The surprising effectiveness of ppo in cooperative multi-agent games. Advances in Neural
InformationProcessingSystems,35:24611–24624,2022.
[26] GuanjieZheng, YuanhaoXiong, XinshiZang, JieFeng, HuaWei, HuichuZhang, YongLi,
KaiXu,andZhenhuiLi. Learningphasecompetitionfortrafficsignalcontrol. InProceedings
ofthe28thACMinternationalconferenceoninformationandknowledgemanagement,pages
1963–1972,2019.
[27] PravinVaraiya. Themax-pressurecontrollerforarbitrarynetworksofsignalizedintersections.
InAdvancesindynamicnetworkmodelingincomplextransportationsystems,pages27–66.
Springer,2013.
[28] Peter Koonce et al. Traffic signal timing manual. Technical report, United States. Federal
HighwayAdministration,2008.
[29] SiqiLai,ZhaoXu,WeijiaZhang,HaoLiu,andHuiXiong. Largelanguagemodelsastraffic
signalcontrolagents: Capacityandopportunity. arXivpreprintarXiv:2312.16044,2023.
[30] Shuo Feng, Xintao Yan, Haowei Sun, Yiheng Feng, and Henry X Liu. Intelligent driving
intelligencetestforautonomousvehicleswithnaturalisticandadversarialenvironment. Nature
communications,12(1):748,2021.
[31] Arne Kesting, Martin Treiber, and Dirk Helbing. General lane-changing model mobil for
car-followingmodels. TransportationResearchRecord,1999(1):86–94,2007.
[32] Martin Treiber, Ansgar Hennecke, and Dirk Helbing. Congested traffic states in empirical
observationsandmicroscopicsimulations. PhysicalreviewE,62(2):1805,2000.
[33] IshuTomar,SIndu,andNeetaPandey.Trafficsignalcontrolmethods:Currentstatus,challenges,
andemergingtrends. ProceedingsofDataAnalyticsandManagement: ICDAM2021,Volume
1,pages151–163,2022.
[34] TianshuChu,JieWang,LaraCodecà,andZhaojianLi. Multi-agentdeepreinforcementlearning
forlarge-scaletrafficsignalcontrol. IEEETransactionsonIntelligentTransportationSystems,
21(3):1086–1095,2019.
11A Appendix
A.1 ModelSpecifications
Inthissection,weprovideformulationsordetaileddescriptionsforthemodulesinCityLight. Prior
totheformulations,wepreliminarilyintroducetheattentionmechanismweadopt.
Given the references and queries, the attention mechanism learns to selectively extract useful in-
formation according to the interactions of the references and queries. For a multi-head attention
mechanism,giventhereferencevectorrandqueryq,theoutputtedembeddingforoneheadis
softmax(cid:0)(W qq) √×(W kr)T (cid:1)
(W r). (1)
v
d
k
Andthefinalmulti-headembeddingsaretheconcatenationsoftheseone-headembeddings. HereW ,
k
W ,andW arelearnablemappingmatrixes,andd isthedimensionofr. Forconvenience,werefer
q v k
totheadoptionoftheattentionmechanismasAttention(r,q)whererdenotesthereferencesandq
denotesthequeries. Whenrandqareidentical,whichmeansthatwewanttoperformself-guided
attention,werefertotheprocessasSelf−Attention(r).
A.1.1 PhaseReindexing
FigureA1: Illustrationsofthephasereindexingoperations.
Thephaseindexingprocessconsistsofthefollowingtwosteps: selectingonestraightroadinthe
intersection as the axis road; rearranging the phases as the turning-left phase from the axis road,
straight-throughphasefromtheaxisroad, turning-leftphasefromthecrossedroad, andstraight-
throughphasefromthecrossedroad. Fora4-phaseintersection,sincetherearetwooptionsforthe
axisroad,therearetwopossiblereindexedphasesets. For3-phaseTintersections,theaxisroadhas
onlyoneoption. Forthe3-phaseYintersection,itsphasesareidenticalandreindexing-free. Inthis
way,wesetrulesforthephasereindexingprocessforallcommonintersectionsintherealworld.
Moreover,thephasesofthesameorderindexcorrespondtogenerallyconsistenttrafficmovements,
therebyhelpingthepolicynetworkbetteridentifythedecisionlogicsfortheexacttrafficmovements.
A.1.2 SelfEncoder
Toconciselycharacterizeatargetintersectioni’sinnertrafficstates,weincorporatetheself-attention
mechanism to attentively extract information from its initial observation X . The encoded self
i
representationXtofthetargetintersectioncanbeformulatedas
i
12Xt =Self−Attention(X ). (2)
i i
A.1.3 RelationEncoder
FigureA2: Illustrationsofthedefinitionsofrelationvectors.
Afterphasereindexing,thetrafficrelationfromaneighboringintersectiontothetargetintersectionis
determinedbythedirectionoftheneighboringintersection’saxisroad,whichhastwopossibilitiesas
showninFigureA2. Therefore,weuseatwo-digitone-hotvectorX toencodetherelation,with
r
eachonerepresentingatypeofphaseorderregardingrelativetrafficmovement. Theprocesscanbe
formulatedas
(cid:40) [1,0] ifaxisroadofintersectionj intersectsthetargetintersectioni
X = ,j ∈N(i)
r,ij
[0,1] ifaxisroadofintersectionj doesn’tintersectthetargetintersectioni
(3)
TheoutputtedneighboringrepresentationsforneighboringintersectionsN(i)afterrelationencoding
canbeformulatedas
Xr =Self−Attention(Attention(X ,f(X ))),j ∈N(i). (4)
j j r,ij
Heref isalearnablemappinglayer,X istheoriginalobservationsofneighboringintersectionsand
X istheircorrespondingrelationvectors.
r
A.1.4 ImpactModeling
TheconnectivityinformationX ,includingthedistanceandlinkingstrength(numberofconnected
c
lanes)informationbetweenintersectionstogetherwiththetargetintersection’sselfrepresentationXt,
providesufficientinformationformodelingtherelativeimpactstrengthofneighboringinteractions.
Therefore,welinearlyembedX andconcatenateitwiththeselfrepresentationXt toserveitas
c
thequeryinthecross-attentionoperation. Inthisway,wemanagetocharacterizetheneighborhood
impactrepresentationsXn. Theprocesscanbeformulatedas
Xn =Attention(cid:0) Xr,Xt||f(X )(cid:1) ,j ∈N(I). (5)
j j i c,ij
Heref isalearnablemappinglayerand||denotesvectorconcatenation.
A.1.5 GroupFusion
To fully leverage the intricate and various neighboring information, it is essential to effectively
fusetheminaconciseandintuitivemanner. Therefore,wefirstdivideneighborintersectionsinto
competinggroups,andthenattentivelyaggregateneighboringrepresentationsfromagroupbyputting
higherweightonnoteworthyneighboringpatterns. Specifically,forneighboringintersectionj inthe
m-thcompetinggroupN ofintersectioni,theimportanceweightsarecalculatedby
cm
a =c·Tanh(W ·Xn+b),j ∈N (I),m∈{0,1}, (6)
j j cm
eaj
s = ,j ∈N (i),m∈{0,1}. (7)
j (cid:80) eam cm
m∈Ncm(i)
13Here W ∈ R1×d, b ∈ R1, and c ∈ R1 are the learnable parameters, and d is the dimension of
neighboringrepresentations{Xn}. Thefinaloverallrepresentationofthetargetintersectioni’is
(cid:88) (cid:88)
X f =X t|| s Xn|| s Xn, (8)
i i j j j j
j∈Nc1(i) j∈Nc2(i)
whereXtarecalculatedfromEqu2andXniscalculatedfromEqu5.
A.1.6 RewardIntegration
Toenhancecoordinationbetweenoneintersectionanditsone-hopneighboringintersections, we
integrateneighboringintersections’originalrewardsintotheintersection’soriginalreward. Thefinal
rewardr f ofintersectionicanbeformulatedas
i
(cid:80)
r
r f =r +α· j∈N(i) j , (9)
i i |N(i)|
whererdenotestheoriginalindependentrewards,N(i)denotestheone-hopneighborsetofintersec-
tioni,|N(i)|denotesthenumberofone-hopneighbors,andαisatunablebalancingcoefficientto
balancebetweenlocaloptimalandneighborhoodoptimal.
A.2 DataDescriptions
A.2.1 OversimplifiedDatasetsinPreviousEvaluations
FigureA3: DatasetscommonlyusedinevaluationsofexistingTSCworks.
Herewesummarizethedatasetscommonlyusedtoevaluateexistingtrafficsignalcontrolmethods:
• Hangzhou. A grid road network with 4×4 intersections in Gudang Sub-district of Hangzhou,
China. Usedin[19,2,16,29,15,18,10,1,26,8],etc.
• Jinan. Agridroadnetworkwith3×4intersectionsinDongfengSub-districtofJinan,China. Used
in[19,2,16,29,15,18,10,1,26,8],etc.
• Manhattana. Agridroadnetworkwith196intersectionscollectedinManhattan,NewYork,the
UnitedStates. Usedin[19,2,15,18,1,8],etc.
14Andtwolarge-scaleroadnetworkdatasetstoevaluatelarge-scaletrafficsignalcontrolmethods:
• SyntheticGrids. Asyntheticgriddatasetwith1089intersectionsforlarge-scaleTSCevaluation.
Usedin[19].
• Manhattanb. Agridroadnetworkwith2510intersections. Thisdatasetwasalsocollectedin
Manhattan,NewYork,theUnitedStates. Usedin [24].
AsshowninFigureA3,thesecommonlyusedroadnetworkdatasetsforevaluationsarequiteregular:
theroadnetworksaregriddedconnected,theintersectionsarehomogeneouswithoutconfiguration
differences,andthedistancesbetweenintersectionsarerelativelyuniform. However,thereal-world
roadnetworksformorecitiesmaybequitemorecomplicated. Duetoconstraintsimposedbyterrain,
rivers, and existing buildings on the road, the roads may be irregularly arranged and intricately
intertwined. Meanwhile,therearedifferencesintheimportanceofurbanroads,leadingtodifferences
inroadclassesandscales.Therefore,evaluationsdoneonthesedatasetsmaynottrulyvalidatethe
proposedmethod’sconsistentlysuperiorperformancewhenfacingheterogeneousintersections
and complex intersection connectivity patterns. To ensure the real-world applicability of the
developedtrafficsignalcontroloptimizationalgorithm,itisessentialtoeliminatethegapbetween
thetestingdatasetandthereal-worldroadnetwork.
A.2.2 High-authenticityDatasetsusedinevaluationsofCityLight
(a)Chaoyang (b)CentralBeijing
FigureA4: Visualizationsofintersections.
Datasets Chaoyang CentralBeijing Beijing Jinan
#Intersections 97 885 13952 4064
#Three-phaseintersections 49 630 9752 2466
#Four-phaseintersections 48 255 4200 1595
#Roads 608 4640 76806 23950
CoveredArea 14.2km2 79.3km2 3104.4km2 1477.5km2
#Agents 9000 55429 143298 99712
TableA1: Thebasicinformationandstatisticsoffourreal-worlddatasets.
Inthissection,weintroducethedetailsoftheusedreal-worlddatasets,withanoverallstatistical
summaryinTableA1:
15FigureA5: Visualizationsofcasesofroadnetworksandintersectionsinourdatasets. Theblueline
denotesroadsandthegreenpointdenotesintersections.
• ChaoyangThisdatasetiscollectedintheChaoyangdistrictofBeijing,withaboundaryof[(116.39,
39.97), (116.42, 39.97), (116.42, 40.01), (116.39, 40.01)]. Thetrafficsignalsarevisualizedin
FigureA4a.
• CentralBeijing. ThisdatasetiscollectedatthecenterofBeijing,mainlycoveringtheDongcheng
districtandtheXichengdistrict. Theregionboundaryis[(116.35,39.87),(116.42,39.87),(116.42,
39.94),(116.35,39.94)]. andthecorrespondingtrafficsignalvisualizationisFigureA4b.
• Jinan. Acity-leveldatasetcoveringtheurbanareasofJinan,withaboundaryof[(116.84,36.57),
(117.35,36.57),(117.35,36.76),(116.84,36.76)].
• Beijing. Acity-leveldatasetcoveringalmostallurbanareasofBeijing(withinthesixthringof
Beijing). Theboundaryis[(116.14,39.76),(116.65,39.76),(116.65,40.15),(116.14,40.15)].
TheroadnetworkdataofallfourdatasetsisdirectlycrawledfromOpenStreetMap1,acrowd-souring
high-coveragemapservicewebsite. Thetrafficsignalsarereconstructedbasedonintersectionsin
1https://www.openstreetmap.org/
16theroadnetwork. ThetraffictrajectoriesarerecoveredfromtrueODortrajectorydatatoreplicate
real-worldtrafficpatterns. Specifically,thetraffictrajectorydatainJinanisrecoveredfromcollected
junctioncameradatafollowing[5,4]. ForBeijing,trafficflowsaregeneratedfromthetruesecond-
level road network-level OD matrix collected by a large Chinese location-based service (LBS)
providerin2020. Alldatasetsincludevehiclestravelingduringthemorningrushhourfrom7to8am.
ThevisualizationsoftheODdistributionofourdatasetsarepresentedinFigureA7andFigureA6.
(a)Origin (b)Destination
FigureA6: Origin-destinationdistributionofthetraffictrajectoriesinJinandataset.
(a)Origin (b)Destination
FigureA7: Origin-destinationdistributionofthetraffictrajectoriesinBeijingdataset.
A.3 SimulationEnvironment: MOSS
Inthiswork,allexperiments,includingCityLightandallbaselines,areconsistentlyconductedwith
thetrafficsimulatorMOSS,whichisshortforMObilitySimulationSystem. Thecomprehensive
17introduction of MOSS can be referred to in [3]. The car-following model in MOSS is the IDM
model[32]andthelane-changingmodelisaMOBILmodel[31,30]. Whileexistingmicroscopic
simulators,suchasSUMO,CityFlow,andCBLab,aretypicallyimplementedonCPUsandsufferfrom
computationalinefficiency,MOSSadoptsgraphicsprocessingunits(GPUs)asthemaincomputational
hardware and parallelizes all simulation computation processes to accelerate without damage to
realism. Onthesamecomputationalresources,asimulationoftrafficinvolving2.4millionvehicles
overanhourrevealsthatMOSScanachieveaspeedenhancementof100timescomparedtoCityFlow,
thefastestmicroscopictrafficsimulator[3].Meanwhile,MOSScanachieveahigherdegreeofrealism
comparedwithexistingsimulators[3]. Inconclusion,thehighcomputationalefficiencyandhigh
fidelity of MOSS can ensure the fast and accurate simulation of city-scale traffic and is thereby
adoptedinourimplementationofCityLight.
A.4 ExperimentDetails
A.4.1 Baselines
• FixedTime[28]. Transitalongthephasesetwiththefixedtimeinterval.
• Max Pressure [27]. Pressure is defined as the discrepancy in the number of vehicles for the
enteringlanesandexistinglanesofaphase. Maxpressuretransitsthetrafficsignaltothephase
withthemaximumvalueofpressure. Inthisway,thetrafficsystemreachesequitabletrafficflow.
• AdjustedMaxPressure[27]. Thelengthofroadsinreal-worldroadsystemsvariesalot,leading
towide-rangevehiclecapacity. Theinitialdefinitionofpressureoverlookstheheterogeneityof
vehiclecapacitythatcausesfundamentalimbalancesinroads’vehiclenumbers. Therefore,longer
roadsmaybeconsistentlyexperiencinghighpressureandgreenphase,leadingtovehiclesonother
roadsbeingtrapped. Wedistillsuchimpactbyredefiningpressureasthediscrepancyinthenumber
ofvehiclesperroadlengthfortheenteringlanesandexitinglanes.
• FRAP [26]. A reinforcement learning-based traffic signal control method that considers the
rotation-symmetryofintersectionsbymodelingfromtheperspectiveofphasecompetitionrelation.
Eachintersectionhasanindependentpolicynetworktobeoptimized.
• MPLight[24]. Areinforcementlearning-basedmethodthatadoptsaparameter-sharingFRAP
model as the unified policy network and introduces pressure of the intersection, which is the
discrepancyinthenumberofvehiclesforallenteringlanesandallexitinglanes,asthereward.
• CoLight [18]. A reinforcement learning-based method that uses a graph attentional network
toincorporateneighboringsituationsfordecision. Eachintersectionhasanindependentpolicy
networktobeoptimized.
• Efficient-MPLight[10]. Itintroducestheefficientpressureintotheobservationspace,whichis
calculatedbythediscrepancyinthenumberofvehiclesperenteringlaneandperexitinglaneof
everyphase.
• Advanced-MPLight[8]. ItadjustsMPLightbytakingintoaccounttherunningvehiclesapproach-
ingtheintersectionintheobservation.
• Advanced-CoLight[8]. BuiltonCoLightwiththesameadjustmentinAdvanced-MPLight.
• GPLight[19]. AMARLmethodthatdynamicallygroupsintersectionsandsharesparameters
withingroups.
A.4.2 Metrics
• Throughput. Thetotalnumberoffinishedtravelsinthesimulationepisode. Ahigherthroughput
correspondstoahighertrafficefficiency.
• AverageTravelTime. Theaveragetraveltimespentbyallvehiclesinthesimulationepisode. A
lowaveragetraveltimecorrespondstoahighertrafficefficiency.
A.4.3 Implementation
TableA2showstheparameterdetailsofCityLightondifferentdatasets. Duringthetrainingprocess,
weusedtheAdamoptimizerforgradient-basedmodeloptimization. Thelearningrateofboththe
actorandthecriticissetas5e-4followingthedefaultsettingofMAPPO[25]. Withoutspecification,
18Parameter Chaoyang CentralBeijing Jinan Beijing
bufferepisodesize 60 12 12 4
numminibatch 6 4 18 18
ppoepoch 16 16 10 10
balancingcoefficientα 0.2 0.2 0.2 0.2
TableA2: HyperparametersofourCityLightmodelonalldatasets.
Method Chaoyang CentralBeijing Jinan Beijing
FRAP ~1.5h ~12h - -
CoLight ~2d ~4d - -
MPLight ~4h ~8h ~8h ~10h
Efficient-MPLight ~3.5h ~7h ~8h ~8h
Advanced-Colight ~1.5d ~3d - -
Advanced-MPLight ~4.5h ~7.5h ~6h ~8h
GPLight ~12h ~14h ~17h ~18h
CityLight ~7h ~12h ~11h ~14h
TableA3: TrainingtimeconsumptionofourCityLightmodelandbaselinesolutions. ’-’denotesno
resultduetoextremelyhighcomputationalcost.
thehyperparametersfollowthedefaultsettingofMAPPO[25]aswell. SinceMAPPOisanon-policy
learningframework,thenumberofepisodesinabuffercorrespondstothenumberofsamplestolearn
complexdecisionpatterns. Therefore,thebufferepisodesizeshouldbetunedaccordingtotheagent
numbertoensuretheoverallsamplesize. Numofminisizeissettosplitthebufferintoseparate
batchestorelievethecostofGPUmemory. PPOepochcorrespondstothenumberofusagetimes
ofeverytrainingdata. ThePPOepochshouldbesetsmallerindifficultenvironmentstoprevent
overfitting. ThebalancingcoefficientalphaisdefinedinEqu9,andwegridsearchitin{0.1,0.2,
0.3}. Forourbaselines,wealsofinetunedtheirhyperparametersineachdatasetrespectivelyforfair
comparisons.
WeconductexperimentsononesingleGPU(NVIDIAA100). TheGPUmemorycostofCityLight
isaround60G.Tonote,whentheavailableGPUmemoryislimited,theGPUmemorycostcanbe
mitigated by increasing the hyperparameter term, num mini batch, which reduces the batch size
conveniently.
A.5 TimeConsumptionAnalysis
TableA3providesadetailedcomparisonofthecomputationalcostofCityLightagainstallbaselines.
AllmethodsarecompletedonasingleGPU(NVIDIAA100). Asobserved,FRAP,CoLight,and
AdvancedColightrequireday-leveltrainingtimebecausetheydonotemployaparameter-sharing
paradigm,necessitatingindividualmodeloptimizationforeachagent. Comparedwiththeremaining
parameter-sharing methods, CityLight incurs a slightly higher training cost due to the adopted
on-policytrainingframework,butitisquitedurable.
A.6 SpecificationofHighAuthenticity
Inthiswork,wewanttomitigatethegapbetweenreinforcementlearning-basedtrafficsignalcontrol
methodsandreal-worlddeploymentbymakingtheexperimentalsituationasauthenticaspossible.
Thebreakthroughswemakeinbuildingahigh-authenticityexperimentalscenariocanbesummarized
inthefollowingthreepoints:
• More realistic road network and intersections. In our large-scale datasets, we collect road
networksandintersectionsfromonlinemapservices.Theconfigurationsandscalesofourcollected
intersectionsareconsistentwithreality. Moreover,wecollectroaddatafromthecentralsectionsof
twotypicalreal-worldcities. Thedatafeaturesaninterwovenroadnetworkwithvariousclasses
ofroads,whichmoreaccuratelyreflectsthecomplexityofrealroadnetworkscomparedtothe
meticulouslyselectedsimulationareasinexistingdatasets.
19• More realistic traffic vehicle trajectories. The vehicle trajectories in our datasets are either
generatedwithfine-grainedorigin-destinationdistributiondataorrecoveredfromjunctioncamera
dataasstatedinAppendixB.Therefore,thesevehicletrajectoriesbetterreplicatereal-worldtraffic
patterns.
• Higherfidelityofvehiclesimulations. Inourexperiments,weconductexperimentsinMOSS[3],
atrafficsimulationplatformwithhigherfidelitythanexistingsimulators. Therefore,thesimulator
canbetterrecoverthetrafficscenariosofreal-worldsituations.
However,consideringtheextremecomplexityofreal-worldtrafficsystems,weadmitthatthereare
stillcertainaspectswhereoursimulationenvironmentdivergesfromreal-worldtrafficconditions.
Forinstance,ourworkdoesnotdifferentiatebetweentidalflowlanesandstandardroadswithinour
network. Nevertheless,ourworkhasmadesignificantprogressinconstructingahigh-authenticity
experimentenvironment,whichthereforeempowersamorecomprehensiveevaluationofthereal-
worldapplicabilityoftheoptimizedtrafficsignalcontrolmethod.
20