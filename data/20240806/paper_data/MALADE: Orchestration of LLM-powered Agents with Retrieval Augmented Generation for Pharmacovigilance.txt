MALADE: Orchestration of LLM-powered Agents
with Retrieval Augmented Generation for Pharmacovigilance
JihyeChoi∗1,NilsPalumbo∗1,PrasadChalasani2,MatthewM.Engelhard3,
SomeshJha1,2,AnivaryaKumar3,DavidPage3
1UniversityofWisconsin-Madison,2Langroid,3DukeUniversity
ABSTRACT
In the era of Large Language Models (LLMs), given their remarkable text under-
standing and generation abilities, there is an unprecedented opportunity to develop
new, LLM-based methods for trustworthy medical knowledge synthesis, extrac-
tion and summarization. This paper focuses on the problem of Pharmacovigilance
(PhV),wherethesignificanceandchallengeslieinidentifyingAdverseDrugEvents
(ADEs) from diverse text sources, such as medical literature, clinical notes, and
drug labels. Unfortunately, this task is hindered by factors including variations in
theterminologiesofdrugsandoutcomes,andADEdescriptionsoftenbeingburied
in large amounts of narrative text. We present MALADE, the first effective col-
laborative multi-agent system powered by LLM with Retrieval Augmented Gener-
ationforADEextractionfromdruglabeldata. Thistechniqueinvolvesaugmenting
a query to an LLM with relevant information extracted from text resources, and
instructing the LLM to compose a response consistent with the augmented data.
MALADE is a general LLM-agnostic architecture, and its unique capabilities are:
(1) leveraging a variety of external sources, such as medical literature, drug labels,
andFDAtools(e.g.,OpenFDAdruginformationAPI),(2)extractingdrug-outcome
associationinastructuredformatalongwiththestrengthoftheassociation,and(3)
providing explanationsfor established associations. Instantiated with GPT-4Turbo
or GPT-4o, and FDA drug label data, MALADE demonstrates its efficacy with an
Area Under ROC Curve of 0.90 against the OMOP Ground Truth table of ADEs.
Our implementation leverages the Langroid multi-agent LLM framework and can
befoundathttps://github.com/jihyechoi77/malade.
1 Introduction
Pharmacovigilance (PhV) is the science of identification and prevention of adverse drug events
(ADEs) caused by pharmaceutical products after they are introduced to the market. PhV is of
enormousimportancetoboththepharmaceuticalindustryandpublichealth,asitaimstosafeguard
the well-being of patients by detecting new safety concerns and intervening when necessary. A
∗Equalcontribution,listedalphabeticallybylastname
4202
guA
3
]LC.sc[
1v96810.8042:viXraMALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
(cid:31)(cid:30)(cid:29)(cid:28)(cid:27)(cid:26)(cid:25)(cid:27)(cid:30)(cid:29)(cid:28)(cid:27)(cid:29)(cid:28)(cid:26)(cid:31)(cid:25)(cid:24)(cid:23)(cid:22)(cid:24)(cid:21)(cid:24)(cid:28)(cid:20)(cid:19)(cid:20)(cid:29)(cid:18)(cid:24)(cid:31)(cid:17)(cid:22)(cid:16)(cid:26)(cid:21) (cid:31)(cid:30)(cid:29)(cid:28)(cid:27)(cid:3)(cid:25)(cid:27)(cid:31)(cid:11)(cid:27)(cid:24)(cid:28)(cid:20)(cid:29)(cid:7)(cid:6)(cid:29)(cid:28)(cid:26)(cid:31)(cid:17)(cid:22)(cid:16)(cid:26)(cid:5)(cid:14)(cid:16)(cid:20)(cid:9)(cid:8)(cid:4)(cid:24)(cid:31)(cid:13)(cid:21)(cid:21)(cid:8)(cid:9)(cid:29)(cid:19)(cid:20)(cid:29)(cid:8)(cid:28)(cid:21) (cid:31)(cid:30)(cid:29)(cid:28)(cid:27)(cid:2)(cid:25)(cid:27)(cid:31)(cid:3)(cid:19)(cid:2)(cid:24)(cid:1)(cid:29)(cid:28)(cid:26)(cid:31)(cid:127)(cid:19)(cid:26)(cid:24)(cid:20)(cid:8)(cid:22)(cid:6)(cid:5)(cid:14)(cid:16)(cid:20)(cid:9)(cid:8)(cid:4)(cid:24)(cid:31)(cid:13)(cid:21)(cid:21)(cid:8)(cid:9)(cid:29)(cid:19)(cid:20)(cid:29)(cid:8)(cid:28)(cid:21)
(cid:31)(cid:30)(cid:29)(cid:28)(cid:27)(cid:26)(cid:25)(cid:24)(cid:31)(cid:31)(cid:31)(cid:6)(cid:5)(cid:22)(cid:16)(cid:26)(cid:22)(cid:19)(cid:28)(cid:26)(cid:16)(cid:5)(cid:28)(cid:26)(cid:9)(cid:29)(cid:27)(cid:16) (cid:5) (cid:31) (cid:13) (cid:127)€ (cid:5)(cid:27)(cid:19)(cid:18)(cid:15)(cid:23)(cid:29)(cid:12)(cid:157)(cid:29)(cid:157)(cid:27)(cid:30)‚(cid:29)(cid:27)(cid:23)(cid:19)(cid:157)ƒ(cid:27)(cid:11)(cid:1)(cid:27)(cid:12)(cid:18)(cid:21)(cid:19)(cid:11)(cid:29)(cid:17)(cid:29)„(cid:12)…(cid:31) (cid:31)(cid:30)(cid:29)(cid:28)(cid:27)(cid:26)(cid:25)(cid:24)(cid:31)(cid:31)(cid:31)(cid:6)(cid:5)(cid:22)(cid:16)(cid:26)(cid:18)(cid:9)(cid:20)(cid:22)(cid:14)(cid:16)(cid:26)(cid:12)(cid:29)(cid:28)(cid:27)(cid:26)
(cid:19)(cid:28)(cid:20)(cid:19)(cid:28)(cid:27)(cid:28)(cid:16)(cid:22)(cid:16)(cid:18)(cid:4)(cid:28)(cid:26)(cid:12)(cid:19)(cid:3)(cid:10)(cid:27)(cid:26)(cid:18)(cid:23)(cid:26)(cid:25)(cid:11)(cid:2)(cid:24)(cid:26)(cid:18)(cid:23)(cid:5)(cid:18)(cid:1)(cid:18)(cid:16)(cid:29)(cid:19)(cid:15)(cid:8)(cid:7) €‚(cid:29)(cid:21)(cid:31)‚(cid:19)(cid:21)(cid:31)(cid:2)(cid:24)(cid:24)(cid:28)(cid:31)(cid:9)(cid:8)(cid:28)(cid:7)(cid:29)(cid:22)(cid:4)(cid:24)(cid:27)(cid:31)(cid:2)(cid:6)(cid:31)(cid:30)(cid:17)(cid:13)ƒ(cid:19)(cid:28)(cid:27)(cid:1)(cid:24)(cid:22)(cid:31) (cid:25)(cid:11)(cid:2)(cid:24)(cid:26)(cid:18)(cid:23)(cid:5)(cid:18)(cid:1)(cid:18)(cid:16)(cid:29)(cid:19)(cid:15)(cid:26)(cid:5)(cid:22)(cid:4)(cid:28)(cid:26)(cid:29)(cid:23)(cid:26)(cid:25)(cid:11)(cid:23)(cid:10)(cid:18)(cid:29)(cid:28)(cid:12)(cid:28)(cid:9)(cid:22)(cid:15)(cid:8)(cid:7)
(cid:29)(cid:28)(cid:27)(cid:29)(cid:9)(cid:19)(cid:20)(cid:29)(cid:28)(cid:26)(cid:31)(cid:20)‚(cid:19)(cid:20)(cid:31)(cid:19)(cid:28)(cid:26)(cid:29)(cid:8)(cid:24)(cid:27)(cid:24)(cid:4)(cid:19)(cid:31)(cid:8)(cid:7)(cid:31)(cid:20)‚(cid:24)(cid:31)(cid:7)(cid:19)(cid:9)(cid:24)(cid:144)(cid:31)
(cid:31)(cid:30)(cid:29)(cid:28)(cid:27)(cid:26)(cid:25)(cid:24)(cid:31)(cid:31)(cid:31)(cid:30)(cid:29)(cid:28)(cid:27)(cid:26)(cid:25)(cid:24)(cid:23)(cid:22)(cid:21)(cid:22)(cid:20)(cid:19)(cid:18)(cid:21)(cid:26)(cid:17)(cid:22)(cid:21)(cid:28)(cid:22)(cid:16)(cid:28)(cid:15) (cid:24)…(cid:20)(cid:22)(cid:24)(cid:4)(cid:29)(cid:20)(cid:29)(cid:24)(cid:21)(cid:144)(cid:31)(cid:1)(cid:29)(cid:23)(cid:21)(cid:144)(cid:31)(cid:31) (cid:31)(cid:31)(cid:12)(cid:19)(cid:20)(cid:29)(cid:24)(cid:28)(cid:20)(cid:21)(cid:31)†(cid:29)(cid:20)‚(cid:31)(cid:19)(cid:31)‚(cid:29)(cid:21)(cid:20)(cid:8)(cid:22)(cid:6)(cid:31)(cid:8)(cid:7)(cid:31)
(cid:20)(cid:24)(cid:14)(cid:27)(cid:13)(cid:12)(cid:30)(cid:19)(cid:11)(cid:18)(cid:12)(cid:10)(cid:27)(cid:24)(cid:23)(cid:22)(cid:21)(cid:27)(cid:16)(cid:11)(cid:17)(cid:29)(cid:27)(cid:24)(cid:9) (cid:18)(cid:23)(cid:14)(cid:31)(cid:19)(cid:28)(cid:30)(cid:22)(cid:29)(cid:27)(cid:28)(cid:28)(cid:27)(cid:26)(cid:13)(cid:25)(cid:12)(cid:24)(cid:28)(cid:14)(cid:31)(cid:31)(cid:19)(cid:31)(cid:28)(cid:30)(cid:22)(cid:29)(cid:27)(cid:28)(cid:28)(cid:27)(cid:26)(cid:25)(cid:26)(cid:11)(cid:25)(cid:2)(cid:23)(cid:22)(cid:10)(cid:20)(cid:18)(cid:16)(cid:29)(cid:29)(cid:28)(cid:20)(cid:12)(cid:19)(cid:28)(cid:18)(cid:9)(cid:21)(cid:15)(cid:22)(cid:15)(cid:8)(cid:7) (cid:19)(cid:28)(cid:26)(cid:29)(cid:8)(cid:24)(cid:27)(cid:24)(cid:4)(cid:19)(cid:31)(cid:16)(cid:28)(cid:22)(cid:24)(cid:1)(cid:19)(cid:20)(cid:24)(cid:27)(cid:31)(cid:20)(cid:8)(cid:31)(cid:13)(cid:127)‡(cid:5)(cid:29)(cid:28)‚(cid:29)(cid:2)(cid:29)(cid:20)(cid:8)(cid:22)(cid:31)(cid:20)‚(cid:24)(cid:22)(cid:19)(cid:23)(cid:6)(cid:31)
(cid:18)(cid:23)(cid:14)(cid:31)(cid:19)(cid:28)(cid:30)(cid:22)(cid:29)(cid:27)(cid:28)(cid:28)(cid:27)(cid:26)(cid:13)(cid:25)(cid:12)(cid:24)(cid:28)(cid:14)(cid:31)(cid:31)(cid:19)(cid:31)(cid:28)(cid:30)(cid:22)(cid:29)(cid:27)(cid:28)(cid:28)(cid:27)(cid:26)(cid:25)(cid:26)(cid:11)(cid:25)(cid:127)(cid:23)(cid:18)(cid:27)(cid:10)(cid:18)(cid:18)(cid:23)(cid:29)(cid:29)(cid:28)(cid:20)(cid:12)(cid:19)(cid:28)(cid:18)(cid:9)(cid:21)(cid:15)(cid:22)(cid:15)(cid:8)(cid:7) (cid:4)(cid:19)(cid:6)(cid:31)(cid:2)(cid:24)(cid:31)(cid:19)(cid:20)(cid:31)(cid:29)(cid:28)(cid:9)(cid:22)(cid:24)(cid:19)(cid:21)(cid:24)(cid:27)(cid:31)(cid:22)(cid:29)(cid:21)„(cid:31)(cid:8)(cid:7)(cid:31)
(cid:18)(cid:23)(cid:14)(cid:19)(cid:28)(cid:22)(cid:27)(cid:28)(cid:13)(cid:12)(cid:28)(cid:14)(cid:19)(cid:28)(cid:22)(cid:27)(cid:28)(cid:26)(cid:25)(cid:11)(cid:23)(cid:10)(cid:18)(cid:29)(cid:28)(cid:12)(cid:28)(cid:9)(cid:22)(cid:15)(cid:8)(cid:7)
(cid:16)(cid:12)(cid:30)(cid:29)(cid:21)(cid:11)(cid:23)(cid:8)(cid:14)(cid:21)(cid:29)(cid:18)(cid:30) (cid:16)(cid:23)(cid:19)(cid:30)(cid:19)(cid:15)
(cid:12)(cid:22)(cid:24)(cid:21)(cid:9)(cid:22)(cid:29)(cid:23)(cid:20)(cid:29)(cid:8)(cid:28)(cid:31)
(cid:25)(cid:19)(cid:20)(cid:24)
(cid:16)(cid:10)(cid:19)(cid:18)(cid:19)(cid:15)(cid:12)(cid:10)(cid:27)(cid:24)(cid:9) (cid:24)(cid:23)(cid:22)(cid:21)(cid:20)(cid:19)(cid:18)(cid:17)(cid:29)(cid:23) (cid:16)(cid:23)(cid:19)(cid:30)(cid:19)(cid:15) (cid:24)(cid:23)(cid:22)(cid:21)(cid:14)(cid:21)(cid:29)(cid:18)(cid:30) (cid:16)(cid:23)(cid:19)(cid:30)(cid:19)(cid:15)
(cid:15)ˆ(cid:11)ˆ(cid:11)(cid:127)(cid:5)(cid:11)‰(cid:10) (cid:5)(cid:12)(cid:4)(cid:29)(cid:10)(cid:129)(cid:31)(cid:141)(cid:29)(cid:28)(cid:9)(cid:22)(cid:24)(cid:19)(cid:21)(cid:24)(cid:143)(cid:144)(cid:31)
(cid:24)(cid:23)(cid:22)(cid:21)(cid:27)(cid:5)(cid:12)(cid:4)(cid:29)(cid:10) (cid:16)(cid:11)(cid:18)(cid:1)(cid:19)(cid:17)(cid:29)(cid:18)(cid:15)(cid:29)(cid:129)(cid:31)(cid:141)(cid:157) (cid:143)(cid:144)(cid:31)(cid:31)
€(cid:29)(cid:28)(cid:23)(cid:29)(cid:157)(cid:29)(cid:18)(cid:30)(cid:12)(cid:30)(cid:19)(cid:143)(cid:29)(cid:157)(cid:129)(cid:31)(cid:3)(cid:11)Š(cid:11)‹(cid:14)(cid:12)(cid:25)(cid:11)(cid:3)(cid:144)(cid:31)(cid:127)(cid:13)(cid:12)€(cid:14)(cid:12)(cid:25)(cid:11)(cid:3)(cid:144)(cid:31) (cid:15)(cid:14)(cid:23)(cid:24)(cid:28)(cid:30)(cid:17)(cid:13)(cid:31)(cid:13)(cid:12)(cid:11)(cid:10) (cid:127)(cid:23)(cid:11)(cid:4)(cid:12)(cid:4)(cid:19)(cid:10)(cid:19)(cid:30)(cid:8)(cid:129)(cid:31)(cid:141) (cid:157)(cid:143)(cid:144)(cid:31)
(cid:19)(cid:28)(cid:27)(cid:31)‡‹(cid:13)(cid:3)(cid:13)(cid:12)(cid:25)(cid:11)(cid:3)(cid:31)ˆ(cid:13)(cid:3)‡(cid:13)€‡ (cid:20)(cid:23)(cid:29)(cid:129)(cid:22)(cid:29)(cid:18)(cid:15)(cid:8)(cid:129)(cid:31)(cid:141)(cid:22)(cid:19)(cid:22)(cid:24)(cid:143)(cid:144)(cid:31)(cid:31)
(cid:144)(cid:22)(cid:157)(cid:30)(cid:19)(cid:1)(cid:19)(cid:15)(cid:12)(cid:30)(cid:19)(cid:11)(cid:18)(cid:129)(cid:31) (cid:31)(cid:2)(cid:19)(cid:21)(cid:24)(cid:27)(cid:31)(cid:8)(cid:28)(cid:31)(cid:20)‚(cid:24)(cid:31)(cid:16)(cid:21)(cid:19)(cid:26)(cid:24)(cid:31)(cid:22)(cid:19)(cid:20)(cid:24)(cid:21)(cid:31)(cid:7)(cid:22)(cid:8)(cid:4)(cid:31) (cid:141)(cid:143)(cid:19)(cid:17)(cid:29)(cid:18)(cid:15)(cid:29)(cid:129)(cid:31)(cid:141)(cid:21)(cid:20)(cid:22)(cid:8)(cid:28)(cid:26)(cid:143)(cid:144)
(cid:20)‚(cid:24)(cid:31)(cid:4)(cid:24)(cid:27)(cid:29)(cid:9)(cid:19)(cid:1)(cid:31)(cid:27)(cid:19)(cid:20)(cid:19)(cid:2)(cid:19)(cid:21)(cid:24)(cid:144)(cid:31)(cid:19)(cid:22)(cid:24)(cid:31)(cid:3)(cid:29)(cid:21)(cid:29)(cid:28)(cid:8)(cid:23)(cid:22)(cid:29)(cid:1)(cid:31)(cid:15)Œ(cid:157)Ž‘’(cid:31) (cid:6)(cid:29)(cid:15)(cid:30)(cid:11)(cid:23)(cid:27)(cid:24)(cid:9) (cid:144)(cid:22)(cid:157)(cid:30)(cid:19)(cid:1)(cid:19)(cid:15)(cid:12)(cid:30)(cid:19)(cid:11)(cid:18)(cid:129)(cid:31)€‚(cid:24)(cid:31)(cid:24)(cid:18)(cid:29)(cid:27)(cid:24)(cid:28)(cid:9)(cid:24)(cid:31)(cid:7)(cid:22)(cid:8)(cid:4)(cid:31)(cid:30)(cid:17)(cid:13)ƒ(cid:19)(cid:28)(cid:27)(cid:1)(cid:24)(cid:22)(cid:31)
(cid:23)(cid:22)(cid:24)(cid:21)(cid:9)(cid:22)(cid:29)(cid:23)(cid:20)(cid:29)(cid:8)(cid:28)(cid:21)(cid:10)(cid:144)(cid:31)(cid:127)(cid:19)(cid:23)(cid:20)(cid:8)(cid:23)(cid:22)(cid:29)(cid:1)(cid:31)(cid:15)(cid:157)“(cid:157)”’(cid:31)(cid:23)(cid:22)(cid:24)(cid:21)(cid:9)(cid:22)(cid:29)(cid:23)(cid:20)(cid:29)(cid:8)(cid:28)(cid:21)(cid:10)(cid:144)(cid:31) (cid:20)(cid:24)(cid:14)(cid:7)(cid:12)(cid:18)(cid:17)(cid:10)(cid:29)(cid:23) (cid:19)(cid:28)(cid:27)(cid:31)(cid:27)(cid:22)(cid:16)(cid:26)(cid:31)(cid:1)(cid:19)(cid:2)(cid:24)(cid:1)(cid:21)(cid:31)(cid:9)(cid:8)(cid:28)(cid:21)(cid:29)(cid:21)(cid:20)(cid:24)(cid:28)(cid:20)(cid:1)(cid:6)(cid:31)(cid:22)(cid:24)(cid:23)(cid:8)(cid:22)(cid:20)(cid:21)(cid:31)(cid:19)(cid:28)(cid:31)
(cid:19)(cid:28)(cid:27)(cid:31)‡(cid:28)(cid:19)(cid:1)(cid:19)(cid:23)(cid:22)(cid:29)(cid:1)(cid:31)ˆ(cid:19)(cid:1)(cid:24)(cid:19)(cid:20)(cid:24)(cid:31)(cid:15)•Œ•‘(cid:31)(cid:23)(cid:22)(cid:24)(cid:21)(cid:9)(cid:22)(cid:29)(cid:23)(cid:20)(cid:29)(cid:8)(cid:28)(cid:21)(cid:10)(cid:31) (cid:29)(cid:28)(cid:9)(cid:22)(cid:24)(cid:19)(cid:21)(cid:24)(cid:27)(cid:31)(cid:22)(cid:29)(cid:21)„(cid:31)(cid:8)(cid:7)(cid:31)(cid:19)(cid:28)(cid:26)(cid:29)(cid:8)(cid:24)(cid:27)(cid:24)(cid:4)(cid:19)(cid:31)
Figure 1: Real-world demonstration of our proposed multi-agent orchestration system,
MALADE.Handlingtheuserquery,“AreACEInhibitorsassociatedwithAngioedema?”,involves
a sequence of subtasks performed by three Agents: DrugFinder, DrugAgent, CategoryAgent
(each instantiated with GPT-4 Turbo or GPT-4o). Each Agent generates a response and justifica-
tion, which are validated by a corresponding Critic agent, whose feedback is used by the Agent to
reviseitsresponse.
central problem in PhV is ADE Extraction: given a drug category C and an adverse event E,
determine whether (and how strongly) C is associated with E. This task demands the analysis of
a vast corpus of textual data sources from a variety of sources, such as patient medical records,
clinical notes, social media, spontaneous reporting systems, drug labels, medical literature, and
clinical trial reports. Besides the sheer volume of text from these sources, ADE extraction is
further complicated by variability in the names of drugs and outcomes, and the fact that ADE
descriptionsareoftenburiedinlargeamountsofnarrativetext[14].
Traditionally, various classical natural language processing (NLP) and deep learning techniques
have been used to address this problem [22, 21, 35, 2]. Compared to classical NLP methods,
today’sbestLargeLanguageModels(LLMs)(andevenweakeropen-source/localLLMs[36,11])
exhibit a significant advancement in text understanding and generation capabilities, and there is
a great opportunity to use these models to not only improve existing ADE extraction methods,
but also consider data sources that were previously not feasible to use. Recent attempts to apply
LLMstoADEExtractiononlyleverageoff-the-shelfChatGPT[38],withlimitedperformanceand
inconsistent reasoning for their extraction rationales [32]. These limitations stem primarily from
two factors: (a) accurate ADE Extraction requires access to specific data sources which LLMs
may not have “seen” during their pre-training, hence relying on an LLM’s “built-in” knowledge
yields inaccurate results, and (b) LLMs, being probabilistic next-token predictors, may produce
incorrect or unreliable results when used naively without carefully breaking down the task into
simplersub-tasks,orwithoutmechanismstovalidateandcorrecttheirresponses.
In this paper, we introduce MALADE2(Multiple Agents powered by LLMs for ADE Extraction),
thefirsteffectivemulti-agentRetrieval-AugmentedGeneration(RAG)systemforADEExtraction.
Our approach leverages two key techniques to address the above two limitations respectively: (a)
RAG, equipping an LLM with up-to-date knowledge by augmenting an input query with relevant
2PronouncedliketheFrenchwordmalademeaning“sick”or“ill.”
2MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
portionsoftextdata,andpromptingtheLLMtogenerateresponsesconsistentwiththeaugmented
information [15]; and (b) strategic orchestration of multiple LLM-based agents, each responsible
for a relatively smaller sub-task of the overall ADE Extraction task [41]. Specifically, our system
has agents for these sub-tasks (see Figure 1): (1) identifying representative drugs for each drug
category from a medical database (e.g., MIMIC-IV), (2) gathering information on side effects of
those drugs from external text knowledge bases (e.g., FDA drug label database), and finally, (3)
composing final answers summarizing the effect of the drug category on an adverse event. Each
agent is assigned a specific sub-task and collaborates with others to accomplish the the ultimate
goal of ADE identification. Furthermore, we enhance the reliability of our multi-agent system
even further by pairing each agent with a critic agent, whose role is to verify the behaviors and
responsesofitscounterpart.
The system, though applied here for ADE extraction specifically, illustrates how a Multi-Agent
approachcanbeusedtogeneratetrustworthy,evidence-basedsummariesandconfidencescoresin
response to challenging medical questions requiring synthesis of evidence from multiple sources
of clinical knowledge and data. As such, MALADE may be viewed as a case study illustrating an
approach that could later be applied to other problems in PhV, including identification of possible
drug-to-drug interactions, as well as clinical problems outside of PhV, such as identifying known
symptomsofaconditionofinterestdocumentedinclinicalnotes.
Insummary,ourpapermakesthefollowingcontributions.
Precise Evaluation. In contrast to simpler systems that only produce a binary label indicating
whether or not a drug category C is associated with an adverse event E, our method produces
distinctscores,includingaconfidencescorethatindicateshowconfidentanLLMisaboutitslabel
assignment. Thesescorespermitarigorousquantitativeevaluationagainstthewell-establishedOb-
servational Medical Outcomes Partnership (OMOP) Ground Truth table of ADEs associated with
common drug classes [19]. We achieve an Area Under the ROC Curve (AUC) of approximately
0.85 with GPT-4 Turbo, and 0.90 with GPT-4o (Section 5). To the best of our knowledge, this is
thebestperformanceamongthebaselines,eventhoughthedirectcomparisonmaybelimited3.
Grounded generation of responses and justifications. The design of MALADE offers key
features essential for high-stakes applications like ADE identification: (1) A structured format for
drug-to-outcomeassociations,includingscoresindicatingthestrengthoftheassociationandrarity
of the adverse event; this is important to ensure robust downstream processing of the extracted
associations. (2) Justifications for the extracted drug-outcome associations, allowing human ex-
perts to understand and validate the associations. This is possible due to the RAG component
of the MALADE architecture, which allows leveraging various external sources such as medical
literature,druglabels,FDAtools(e.g.,OpenFDAdruginformationAPI),aswellascommonclin-
ical data sources such as OMOP or PCORI, and even specific EHR systems where available. (3)
Observability, i.e., complete, detailed logs of inter-agent dialogs and intermediate steps; these are
essential for debugging and auditing the system’s behavior. See Figure 1 for a real-world demon-
strationofMALADE.
3Because none of the original clinical data-based analyses reached this high of accuracy, followup investigations have since
arguedthatroughlythislevelisthebestachievablebyanymethodbasedonanysourcesfortheOMOPtask. In2016,Gruberet
al.[6]arguedtherewerereproducibleerrorsthatcouldbeblamedontheOMOP2010groundtruthitselfthatcouldplaceaceiling
ontheAUCachievable,andHaubenetal.[7]morespecificallyarguedthatonthenegative-labeleddrugeventpairstheerrorinthe
groundtruthshouldbeestimatedat17%. Theremaybedisagreementonvaryingstrengthsofdifferentliteratureevidence,butif
theirestimateisexactlyright,itcouldplaceaceilingaslowas0.83ontheAUCachievable.
3MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
GeneralizableInsightsaboutMachineLearningintheContextofHealthcare. Ourproposed
multi-agent architecture is agnostic to LLMs and data sources and is based on design primitives
intended to be universal building blocks for the orchestration of multiple LLM-based agents (Sec-
tion 3). Hence, although MALADE is instantiated specifically for ADE identification, our design
methodology provides a generalizable blueprint for the effective construction of multi-agent sys-
tems for trustworthy medical knowledge synthesis and summarization with wide-ranging medical
applications.
2 Related Work
The advent of highly-capable Large Language Models (LLMs) has sparked significant inter-
est in applying these models to medical tasks, including diagnostics [28], medical question-
answering [29, 23], and medical evidence summarization [33]. An important application area is
pharmacovigilance, the science of identifying and preventing adverse drug events (ADEs) caused
by pharmaceutical products after they are introduced to the market. The specific problem of ADE
Extraction, namely, identifying whether a specific drug (or category) is associated with a specific
adverseevent,isachallengingtaskduetovariationsindrugandoutcometerminologies,thepres-
ence of ADE descriptions in large amounts of narrative text, and the disparate sources of such
textdata,whichcanincludepatientmedicalrecords,clinicalnotes,druglabels,medicalliterature,
clinicaltrials,messageboards,socialmedia. Priorresearchinthisfield,notablyworksdrawingon
large-scaleresearchinitiativesincludingSentinel[25],OMOP[27],andOHDSI[31],hasfocused
ondevelopingnewmethodsforcausaldiscoveryfrompurelyobservationaldata. Huangetal.[10]
investigate the use of social forums for constructing predictive models of ADEs, focusing on the
performance of different data processing techniques and BERT architectures. von Csefalvay [37]
introducesanovelLLM,DAEDRA,fordetectingregulatory-relevantoutcomesfrompassivephar-
macovigilance reports. Sorbello et al. [30] use LLMs like GPT to improve the capture of opioid
drugandadverseeventmentionsfromelectronichealthrecords. Finally,Sunetal.[32]investigate
theperformanceofChatGPTforextractingadverseeventsfrommedicaltextsources.
These early applications of LLMs to ADE Extraction are limited in at least one of two ways: (a)
they either use only the bare LLM (such as ChatGPT, or its API) without access to any external
APIs,tools,orknowledgebases[38]. ADEextractionusingonlytheLLM’s“built-in”knowledge
(i.e., text it was exposed to during pre-training) is likely to be inaccurate and incomplete, since
adverse events may be discovered in any new studies or reports; (b) all prior works use a single
LLM(evenwhenaugmentedwithexternaldata/tools)withoutanycollaborationorfeedbackfrom
other LLMs. Since LLMs are after all probabilistic next-token prediction models, there is no
guarantee that the generated text is accurate or complete. The only way to improve the reliability
ofanLLM’sresponsesinthisscenarioistoeitherresorttoelaboratepromptingtechniques[40,45],
orhaveahuman(oranLLM[18])inthelooptoverifythegeneratedtextanditerativelyrefinethe
promptsuntilasatisfactoryresponseisobtained.
To address these limitations, three paradigms have emerged in LLM practitioners’ toolboxes. The
first limitation is addressed by two techniques: Retrieval Augmented Generation (RAG) and tool-
use. RAGaddressestheknowledgelimitationsofLLMsbyaugmentingtheinputpromptorquery
withrelevantinformationretrievedfromexternalknowledgebases(usingsimilaritybasedonvec-
tor embeddings, keywords, or a combination of both), and instructing the LLM to respond to the
original query in a way that is consistent with the augmented data, and also to provide a justifica-
4MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
tion for its response by citing the relevant external data [15]. Thus the RAG approach not only
alleviates the limitations of relying only on an LLM’s pre-trained knowledge, but also provides
evidence-citation ability, which is crucial to engender trust in the LLM’s responses, especially in
high-stakes applications like medical decision-making. This approach has shown promise in en-
hancingLLMperformanceinbiomedicine,particularlyinliteratureinformation-seekingandclin-
icaldecision-making[5,12,39,46]. Thesecondtechnique,tool-use,involvesinstructingtheLLM
to produce structured text (typically JSON) which can then be easily parsed by downstream code
to perform a variety of actions, including web-search, querying APIs for information, querying
databases,andperformingcomputations[26,16].
The emergence of multi-agent systems addresses the second limitation (of using single LLMs)
– this approach aims to harness the collective capabilities of multiple LLMs [43, 9]. Such sys-
temsintroducecooperativelearningandfeedbackmechanismsbetweenLLM-basedagents,which
simulate human-like communication, consultation and debate processes, enabling them to tackle
even more complex tasks than a single-agent with RAG. In medical reasoning tasks, for instance,
multi-agent collaboration can mirror hospital consultation mechanisms [34]. Our work extends
this trajectory of research; to the best of our knowledge, our system MALADE is first effective
multi-agent orchestration system with RAG and tool-use, tailored for a specific task in pharma-
covigilance, namely ADE Extraction. In our approach, LLM-based agents collaborate, leveraging
their collective expertise and the latest medical knowledge. This approach aims to improve the
analysisofADEs,offeringamorerobustandreliablesystemforpharmacovigilance.
3 Preliminaries on LLM-based Agents
While today’s LLMs exhibit impressive capabilities, they remain constrained by technical and
practicallimitationssuchasbrittleness,non-determinism,limitedcontextwindow,inferencecosts,
and latency [17], with the implication that one cannot simply give high-level instructions to an
LLM and expect it to accomplish a complex task. Consequently, to best harness the capabilities
of LLMs as components of a complex application, it is necessary to decompose the task into
smaller sub-tasks and manage multiple LLM conversations, each with its own set of specifically-
defined instructions, state, and data sources. This leads naturally to the notion of an agent as an
LLM-powered entity responsible for a well-defined small sub-task. In Section 3.1, we introduce
the key abstractions and components needed for agent-oriented programming, and Section 3.2
describes multi-agent orchestration. Our implementation leverages the open-source multi-agent
LLMframeworkLangroid[3],whichsupportstheseabstractionsandmechanisms.
3.1 Agent-orientedProgramming
Agent,asanintelligentmessagetransformer. Anaturalandconvenientabstractionindesign-
ing a complex LLM-powered system is the notion of an agent that is instructed to be responsible
for a specific aspect of the overall task. In terms of code, an Agent is essentially a class rep-
resenting an intelligent entity that can respond to messages, i.e., an agent is simply a message
transformer. An agent typically encapsulates an (interface to an) LLM, and may also be equipped
with so-called tools (as described below) and external documents/data (e.g., a vector database,
as described below). Much like a team of humans, agents interact by exchanging messages, in
a manner reminiscent of the actor framework in programming languages [8]. An orchestration
mechanism is needed to manage the flow of messages between agents, to ensure that progress is
5MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
made towards completion of the task, and to handle the inevitable cases where an agent deviates
frominstructions. Inthisworkweadoptthismulti-agentprogrammingparadigm,whereagentsare
first-classcitizens,actingasmessagetransformers,andcommunicatebyexchangingmessages.
TobuildusefulapplicationswithLLMs,weneedtoendowthemwiththeabilitytotriggeractions
(such as API calls, computations, database queries, etc) and access external documents. Tools and
RetrievalAugmentedGeneration(RAG)providethesecapabilities,describednext.
Tools, also known as functions or plugins. An LLM is essentially a text transformer; i.e., in
responsetosomeinputtext(knownasaprompt),itproducesaresponse. Free-formtextresponses
areidealwhenwewanttogenerateadescription,answer,orsummaryforhumanconsumption,or
evenaquestionforanotheragenttoanswer. However,insomecases,wewouldliketheresponses
totriggerexternalactions,suchasanAPIcall,codeexecution,oradatabasequery. Insuchcases,
wewouldinstructtheLLMtoproduceastructured output,typicallyinJSONformat,withvarious
pre-specified fields, such as code, an SQL query, parameters of an API call, and so on. These
structured responses have come to be known as tools, and the LLM is said to use a tool when it
produces a structured response corresponding to a specific tool. To elicit a tool response from an
LLM,itneedstobeinstructedontheexpectedtoolformatandtheconditionsunderwhichitshould
use the tool. To actually use a tool emitted by an LLM, a tool handler method must be defined as
well. The tool handler for a given tool is triggered when it is recognized in the LLM’s response.
SeeAppendixA.1foradescriptionoftheLLM’sinteractionwithadatabase.
StartingwiththeviewofanLLMasatexttransformer,itturnsoutthatonecanexpressthenotion
of an agent, a tool, and other related concepts in terms of different function signatures, as shown
inTable4inAppendixA.3.
Retrieval Augmented Generation (RAG). Using an LLM in isolation has two major con-
straints: (a)theresponsesareconfinedtotheknowledgefromitspre-training,hencecannotanswer
questionsspecifictoprivate/enterprisedocuments,orup-to-dateinformationpastitstrainingcutoff
date;and(b)thereisnowaytoverifythevalidityofthegeneratedanswers. RAGisthemostpop-
ular technique to address both limitations by making LLMs generate responses based on specific
documents or data and justify the answer by presenting source citations [15]. The basic idea of
RAG is as follows: when a query Q is made to an LLM-agent, a set of k documents (or portions
thereof) D = {d ,d ,...,d } most “relevant” to the query are retrieved from a document-store,
1 2 k
and the original query Q is augmented with D to a new prompt of the form, “Given the passages
below: [d , d , ..., d ], answer this question: Q based ONLY on these passages, and indicate
1 2 k
whichpassagessupportyouranswer”. SeeAppendixA.2formoredetailsonRAG.
3.2 Multi-AgentOrchestration
As mentioned above, when building an LLM-based multi-agent system, an orchestration mech-
anism is critical to manage the flow of messages between agents, to ensure task progress, and
handle deviations from instructions. In this work, we leverage a simple yet versatile orchestra-
tion mechanism that seamlessly handles user interaction, tool handling, and sub-task delegation.
As in Figure 2, the orchestration mechanism is encapsulated in a Task class that wraps an Agent,
andoneinitiatesataskbyinvokingitsrunmethodwhichhastypesignaturestring → string,
identicaltothetypesignatureofanAgent’sownnative“response”methods(correspondingtothe
LLM, tool-handler, and human user). The Task maintains a “current pending message” (CPM)
6MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
(cid:21)(cid:17)(cid:19)(cid:31)(cid:30)(cid:29)
(cid:21)(cid:19)(cid:31)(cid:30)(cid:29)
(cid:25)(cid:24)(cid:29)(cid:23)(cid:22)
(cid:21)(cid:20)(cid:19)(cid:31)(cid:30)(cid:29)
(cid:21)(cid:17)(cid:19)(cid:31)(cid:30)(cid:29) (cid:25)(cid:19)(cid:21)(cid:20)(cid:25)(cid:29)(cid:19)(cid:26)(cid:31)(cid:25)(cid:24)(cid:23)(cid:22)(cid:29)(cid:24)(cid:25)
(cid:31)(cid:30)(cid:29)(cid:28) (cid:27)(cid:27)(cid:26)
(cid:25)(cid:24)(cid:29)(cid:23)(cid:22)
(cid:21)(cid:18)(cid:19)(cid:31)(cid:30)(cid:29)
(cid:25)(cid:19)(cid:28)(cid:28)(cid:27)(cid:26)(cid:31)(cid:25)(cid:24)(cid:23)(cid:22)(cid:29)(cid:24)(cid:25)
(cid:21)(cid:18)(cid:19)(cid:31)(cid:30)(cid:29)
(cid:31)(cid:30)(cid:29)(cid:28) (cid:27)(cid:27)(cid:26)
(cid:25)(cid:24)(cid:29)(cid:23)(cid:22) (cid:25)(cid:19)(cid:30)(cid:24)(cid:25)(cid:31)(cid:26)(cid:31)(cid:25)(cid:24)(cid:23)(cid:22)(cid:29)(cid:24)(cid:25)
(cid:21)(cid:20)(cid:19)(cid:31)(cid:30)(cid:29)
(cid:27)(cid:27)(cid:26)
(cid:31)(cid:30)(cid:29)(cid:28)
Figure 2: Example of how iteration among responder methods works when a task T has sub-tasks
[T1,T2]andT1hasasub-taskT3.
to be acted on by one of the “responders” of the Task, which includes the agent’s own response
methods as well as run methods of sub-tasks. The run method executes a series of “steps” until
a task termination condition is reached. In each step, a valid response to the CPM is sought by
iterating over the responders, and the CPM is updated with the response. See Appendix A.4 for
moredetails.
4 MALADE: Proposed Multi-Agent System for ADE Extraction
In this section, we describe our RAG-based Multi-Agent architecture, MALADE, for identifying
associationsbetweendrugcategoriesandoutcomes. Wefirstgiveahigh-leveloutlineoftheobjec-
tivesofthekeysub-tasksinSection4.1,anddelveintotheirimplementationdetailsinSection4.2
-4.5. SeeFigure1foranillustrativedepictionoftheoverallpipeline.
We emphasize that developing a multi-agent RAG system tailored for ADE extraction is a highly
non-trivial undertaking, requiring careful handling of several issues: (a) the complex structure of
FDA label data, which can be challenging for naively applied RAG techniques; (b) the difficulty
ofcorrectlygroupingprescribeddrugs(e.g.,assigningtheappropriateNationalDrugCode)based
onthevariedtextdescriptionspresentinmedicaldatabases;(c)LLMbrittlenesssuchasdeviation
from instructions, hallucinations, and inaccurate or incorrect responses; (d) Infinite loops, fixed
points,anddeadlocks,whichcanariseininter-agentinteractionsunlesscarefullymanaged.
4.1 ObjectivesofKeySub-tasks
Our ultimate goal is to identify the risk of an adverse event associated with a drug category. We
developedoursystem,MALADE,tobeabletorespondtoquestionsoftheform:
“DoesdrugcategoryC increasestheriskofaspecific(adverse)healthoutcomeH,
decreaseit,oristherenocleareffect?. Andwhatistheevidence?” Forinstance,C
couldbe“ACEinhibitors”,andH couldbe“angioedema”.
7MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
Givenaqueryofthisform,thesystemexecutesthefollowingsteps: givenC andH,
STEP1: Find the extensive list of drug names that belong to C by searching the FDA’s National
DrugCode(NDC)database. Amongthem,DrugFinderidentifiesdrugsDrepresenting
eachcategory;top-kdistinctdrugnamesthataremostcommonlyprescribedinaclinical
database(e.g.,MIMIC-IV).
STEP2: For each representative drug D in C, DrugAgent generates a free-form (i.e., unstruc-
tured) text summary about the effect of D on H. These summaries are generated by
referring to up-to-date external pharmaceutical reference sources (e.g., FDA drug label
database),whichindicatepotentialadverseoutcomesandevidencefortherisks.
STEP3: CategoryAgent combines the drug-level information from STEP 2, and generates a
structured report; consisting of a label (one of “increase”, “decrease”, or “no-effect”)
indicating the potential effect of C on the risk of H, a confidence score for this label,
structureddescriptionsoflevelsofrisk,andstrengthofevidence.
Our system extracts the association between C and H by establishing the associations between
each drug within C and H, rather than directly linking C to H. This construction is motivated
by that the reference sources for drug label data, such as the FDA drug label database in our im-
plementation,aretypicallystructuredbyindividualdrugsratherthanbroaddrugcategories;hence
necessitating STEP 1. It is important to note that applying our system to real patient data requires
a complete list of drugs, including both brand and generic names, which can be used to map the
actual prescribed drugs recorded in electronic health record (EHR) data to their corresponding
categories.
Each of DrugFinder, DrugAgent, and CategoryAgent is coupled with a Critic agent, which
provides feedback on the primary agent’s output. The primary agent then regenerates its output
basedonthisfeedback. ThisAgent-CriticinteractioncontinuesuntiltheCriticapprovestheagent’s
response. Thisdesignpatternsignificantlyenhancesthereliabilityofoursystem,asdetailedfurther
inSection4.2.
4.2 Agent-CriticInteraction
This is the core multi-agent interaction pattern that underlies our system, and is reminiscent of
Actor/Criticmethodsinreinforcementlearning[13].
Agent. InanAgent-Criticpair,theAgentistheprimaryentitythathandlesexternal-facinginput
and output. It receives a specific goal, instructions on how to accomplish the goal, and access to
toolsandresources. Inourcontext,thegoalisgenerallyaformofspecializedquestion-answering;
resourcescanbedatasources,orevenotheragentsormulti-agentsystems,thattheagentcandraw
upon when answering the question; tools are structured responses needed to trigger calls to APIs,
databaselook-ups,orcomputations.
TheprimaryfunctionoftheAgentistoconstructasequenceofqueriestotheseresourcestofulfill
itsgoal. TheAgentisinstructedtocomposeasemi-structuredmessageconsistingofitsanswer,its
reasoningstepsandajustification(citingsourceswherepossible)ofitsanswerinasemi-structured
format,andseekfeedbackonthesefromtheCritic,asbelow.
Critic. Thisisanotheragent,pairedwiththeonedescribedabove. TheCritic’sroleistovalidate
the Agent’s reasoning steps and compliance with instructions, and provide feedback to the Agent,
8MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
which has been shown to improve the quality of LLM-generated outputs [18]. The Agent iterates
onitsresponsebasedonthisfeedback,untiltheCriticissatisfied,atwhichpointtheAgentsignals
completionandoutputstheresults(seeFigure3).
While the Agent/Critic pattern may appear simple, this interaction is extremely powerful, and can
significantly improve the reliability of the task completion. This synergistic relationship mirrors
a pattern in interactive proof systems used in complexity theory; a prover (i.e., Agent) presents a
solution,andaverifier(i.e.,Critic)checksthevalidityofthissolution. Theverifiercannotsolvethe
problem on its own but is capable of checking the prover’s solution efficiently, which is relatively
easier [1]. This way, even if the Agent’s task is complex, the Critic can efficiently verify the
correctnessofthesolution,therebyenhancingreliability.
(cid:31)(cid:30)(cid:29)(cid:28)(cid:27)(cid:26)(cid:25)(cid:27)(cid:31)(cid:30)(cid:29)(cid:28)(cid:27)(cid:26)(cid:25)(cid:24)(cid:23)(cid:25)(cid:27)(cid:22)(cid:31)(cid:21)(cid:20)(cid:19)(cid:22)(cid:18)(cid:17)(cid:19)(cid:26)(cid:16)(cid:15)(cid:14)(cid:28)(cid:31)(cid:13)(cid:12)(cid:12)(cid:15)(cid:16)(cid:25)(cid:11)(cid:26)(cid:25)(cid:15)(cid:27)(cid:12) (cid:31)(cid:30)(cid:29)(cid:28)(cid:27)(cid:4)(cid:25)(cid:27)(cid:31)(cid:5)(cid:11)(cid:4)(cid:28)(cid:3)(cid:25)(cid:27)(cid:22)(cid:31)(cid:2)(cid:11)(cid:22)(cid:28)(cid:26)(cid:15)(cid:20)(cid:23)(cid:18)(cid:17)(cid:19)(cid:26)(cid:16)(cid:15)(cid:14)(cid:28)(cid:31)(cid:13)(cid:12)(cid:12)(cid:15)(cid:16)(cid:25)(cid:11)(cid:26)(cid:25)(cid:15)(cid:27)(cid:12)
(cid:144)(cid:141) €(cid:28)(cid:31)(cid:8)(cid:21)(cid:13)(cid:31)(cid:3)(cid:11)(cid:4)(cid:28)(cid:3)(cid:31)(cid:24)(cid:15)(cid:20)(cid:31)(cid:6)(cid:21)(cid:20)(cid:23)(cid:144)(cid:29)(cid:28)(cid:23)(cid:157)(cid:31)(cid:29)(cid:15)(cid:28)(cid:12)(cid:31)(cid:27)(cid:15)(cid:26)(cid:31)(cid:141)(cid:141)(cid:141) €(cid:28)(cid:20)(cid:28)(cid:31)(cid:25)(cid:12)(cid:31)(cid:27)(cid:15)(cid:31)(cid:16)(cid:3)(cid:28)(cid:11)(cid:20)(cid:31)(cid:28)‰(cid:28)(cid:16)(cid:26)(cid:141)
‡(cid:141) €(cid:28)(cid:31)(cid:8)(cid:21)(cid:13)(cid:31)(cid:3)(cid:11)(cid:4)(cid:28)(cid:3)(cid:31)(cid:24)(cid:15)(cid:20)(cid:31)(cid:13)(cid:16)(cid:23)(cid:144)(cid:29)(cid:28)(cid:23)(cid:157)(cid:31)(cid:29)(cid:15)(cid:28)(cid:12)(cid:31)(cid:27)(cid:15)(cid:26)(cid:31)(cid:9)(cid:20)(cid:15)…(cid:25)(cid:29)(cid:28)(cid:31) Š(cid:15)(cid:27)(cid:28)(cid:31)(cid:15)(cid:24)(cid:31)(cid:26)€(cid:28)(cid:31)(cid:9)(cid:20)(cid:15)…(cid:25)(cid:29)(cid:28)(cid:29)(cid:31)(cid:9)(cid:11)(cid:12)(cid:12)(cid:11)(cid:22)(cid:28)(cid:12)(cid:31)(cid:15)‰(cid:28)(cid:20)(cid:31)(cid:16)(cid:15)(cid:27)(cid:16)(cid:3)(cid:19)(cid:12)(cid:25)…(cid:28)(cid:31)(cid:28)…(cid:25)(cid:29)(cid:28)(cid:27)(cid:16)(cid:28)(cid:141)(cid:31)
(cid:25)(cid:27)(cid:24)(cid:15)(cid:20)(cid:14)(cid:11)(cid:26)(cid:25)(cid:15)(cid:27)(cid:31)(cid:15)(cid:27)(cid:31)(cid:26)€(cid:28)(cid:31)(cid:20)(cid:25)(cid:12) (cid:31)(cid:15)(cid:24)(cid:31)€(cid:25)(cid:9)(cid:31)(cid:24)(cid:20)(cid:11)(cid:16)(cid:26)(cid:19)(cid:20)(cid:28)(cid:141) (cid:31)(cid:30)(cid:29)(cid:28)(cid:27)(cid:26)(cid:25)(cid:24)(cid:31)(cid:31)(cid:31)(cid:30)(cid:29)(cid:28)(cid:27)(cid:26)(cid:25)(cid:24)(cid:23)(cid:28)(cid:22)(cid:27)(cid:26)(cid:21)(cid:20)(cid:19)(cid:18)(cid:26)(cid:17)(cid:19)(cid:16)(cid:15)(cid:20)(cid:21)(cid:25)(cid:28)(cid:15)(cid:19)(cid:23)(cid:25)(cid:16)(cid:19)(cid:26)
ˆ(cid:141) €(cid:28)(cid:31)(cid:8)(cid:21)(cid:13)(cid:31)(cid:3)(cid:11)(cid:4)(cid:28)(cid:3)(cid:31)(cid:24)(cid:15)(cid:20)(cid:31)(cid:24)(cid:10)(cid:21)(cid:17)(cid:23)(cid:144)(cid:29)(cid:28)(cid:23)(cid:157)(cid:31)(cid:14)(cid:28)(cid:27)(cid:26)(cid:25)(cid:15)(cid:27)(cid:12)(cid:31)ƒ(cid:24)(cid:20)(cid:11)(cid:16)(cid:26)(cid:19)(cid:20)(cid:28)(cid:31) (cid:22)(cid:28)(cid:27)(cid:19)(cid:14)(cid:20)(cid:13)(cid:12)(cid:26)(cid:20)(cid:11)(cid:26)(cid:21)(cid:13)(cid:10)(cid:14)(cid:18)(cid:26)(cid:29)(cid:28)(cid:9)(cid:19)(cid:26)(cid:20)(cid:16)(cid:26)(cid:29)(cid:25)(cid:23)(cid:26)(cid:11)(cid:13)(cid:28)(cid:22)(cid:27)(cid:10)(cid:13)(cid:19)(cid:8)(cid:7) (cid:17)(cid:129)(cid:23)(cid:10)(cid:16)(cid:11) (cid:31)‹(cid:28)(cid:27)‚(cid:15)(cid:29)(cid:25)(cid:11)‚(cid:28)(cid:9)(cid:25)(cid:27)(cid:28)(cid:12)(cid:31)(cid:11)(cid:20)(cid:28)(cid:31) (cid:27)(cid:15)(cid:157)(cid:27)(cid:31)(cid:26)(cid:15)(cid:31)(cid:16)(cid:11)(cid:19)(cid:12)(cid:28)(cid:31)(cid:12)(cid:28)(cid:29)(cid:11)(cid:26)(cid:25)(cid:15)(cid:27)(cid:127)(cid:31)(cid:157)€(cid:25)(cid:16)€(cid:31)
(cid:26)(cid:20)(cid:11)(cid:19)(cid:14)(cid:11)(cid:26)(cid:25)(cid:16)ƒ(cid:31)(cid:11)(cid:12)(cid:31)(cid:11)(cid:27)(cid:31)(cid:25)(cid:27)(cid:24)(cid:20)(cid:28)„(cid:19)(cid:28)(cid:27)(cid:26)(cid:31)(cid:11)(cid:29)…(cid:28)(cid:20)(cid:12)(cid:28)(cid:31)(cid:28)…(cid:28)(cid:27)(cid:26)(cid:31)(cid:4)(cid:19)(cid:26)(cid:31)(cid:29)(cid:15)(cid:28)(cid:12)(cid:31) (cid:16)(cid:11)(cid:27)(cid:31)(cid:3)(cid:28)(cid:11)(cid:29)(cid:31)(cid:26)(cid:15)(cid:31)(cid:11)(cid:27)(cid:31)(cid:25)(cid:27)(cid:16)(cid:20)(cid:28)(cid:11)(cid:12)(cid:28)(cid:29)(cid:31)(cid:20)(cid:25)(cid:12) (cid:31)(cid:15)(cid:24)(cid:31)(cid:24)(cid:11)(cid:3)(cid:3)(cid:12)(cid:127)(cid:31)(cid:11)(cid:27)(cid:29)(cid:31)(cid:16)(cid:15)(cid:27)(cid:12)(cid:28)„(cid:19)(cid:28)(cid:27)(cid:26)(cid:3)(cid:23)(cid:127)(cid:31)€(cid:25)(cid:9)(cid:31)
(cid:27)(cid:15)(cid:26)(cid:31)(cid:28)(cid:12)(cid:26)(cid:11)(cid:4)(cid:3)(cid:25)(cid:12)€(cid:31)(cid:11)(cid:31)(cid:16)(cid:11)(cid:19)(cid:12)(cid:11)(cid:3)(cid:31)(cid:20)(cid:28)(cid:3)(cid:11)(cid:26)(cid:25)(cid:15)(cid:27)(cid:12)€(cid:25)(cid:9)(cid:31)(cid:157)(cid:25)(cid:26)€(cid:31)€(cid:25)(cid:9)(cid:31)(cid:24)(cid:20)(cid:11)(cid:16)(cid:26)(cid:19)(cid:20)(cid:28)(cid:12)(cid:141) (cid:24)(cid:20)(cid:11)(cid:16)(cid:26)(cid:19)(cid:20)(cid:28)(cid:12)(cid:141)(cid:31) €(cid:28)(cid:31)(cid:9)(cid:20)(cid:28)(cid:12)(cid:28)(cid:27)(cid:16)(cid:28)(cid:31)(cid:15)(cid:24)(cid:31)ƒ(cid:24)(cid:20)(cid:11)(cid:16)(cid:26)(cid:19)(cid:20)(cid:28)(cid:31)(cid:26)(cid:20)(cid:11)(cid:19)(cid:14)(cid:11)(cid:26)(cid:25)(cid:16)ƒ(cid:31)(cid:11)(cid:12)(cid:31)(cid:11)(cid:27)(cid:31)(cid:11)(cid:29)…(cid:28)(cid:20)(cid:12)(cid:28)(cid:31)
(cid:28)…(cid:28)(cid:27)(cid:26)(cid:31)(cid:25)(cid:27)(cid:31)(cid:26)€(cid:28)(cid:31)(cid:2)(cid:3)(cid:15)(cid:27)(cid:11)‚(cid:28)(cid:9)(cid:11)(cid:14)(cid:31)(cid:3)(cid:11)(cid:4)(cid:28)(cid:3)(cid:31)(cid:12)(cid:19)(cid:22)(cid:22)(cid:28)(cid:12)(cid:26)(cid:12)(cid:31)(cid:26)€(cid:11)(cid:26)(cid:31)(cid:141)(cid:141)(cid:141)
€(cid:28)(cid:31)(cid:4)(cid:28)(cid:27)‚(cid:15)(cid:29)(cid:25)(cid:11)‚(cid:28)(cid:9)(cid:25)(cid:27)(cid:28)(cid:31)(cid:16)(cid:11)(cid:26)(cid:28)(cid:22)(cid:15)(cid:20)(cid:23)(cid:31)(cid:15)(cid:24)(cid:31)(cid:29)(cid:20)(cid:19)(cid:22)(cid:12)(cid:31)(cid:14)(cid:11)(cid:23)(cid:31)(cid:9)(cid:15)(cid:26)(cid:28)(cid:27)(cid:26)(cid:25)(cid:11)(cid:3)(cid:3)(cid:23)(cid:31)(cid:25)(cid:27)(cid:16)(cid:20)(cid:28)(cid:11)(cid:12)(cid:28)(cid:31)
(cid:26)€(cid:28)(cid:31)(cid:20)(cid:25)(cid:12) (cid:31)(cid:15)(cid:24)(cid:31)€(cid:25)(cid:9)(cid:31)(cid:24)(cid:20)(cid:11)(cid:16)(cid:26)(cid:19)(cid:20)(cid:28)(cid:31)(cid:141)(cid:141)(cid:141)
(cid:13)(cid:20)(cid:7)(cid:22)(cid:18)(cid:22)(cid:29)(cid:17)(cid:30) (cid:24)(cid:20)(cid:16)(cid:30)(cid:16)(cid:15) (cid:24)(cid:23)(cid:30)(cid:29)(cid:22)(cid:21)(cid:20)(cid:19)(cid:18)(cid:22)(cid:29)(cid:17)(cid:30) (cid:24)(cid:20)(cid:16)(cid:30)(cid:16)(cid:15) (cid:25)(cid:27)(cid:17) (cid:22)(cid:129) (cid:31)(cid:23) (cid:26)€(cid:10)(cid:16) (cid:28)(cid:11) (cid:31) (cid:9)(cid:31) (cid:15)€ (cid:26)(cid:28)(cid:28) (cid:27)(cid:31)(cid:20) (cid:26)(cid:28) (cid:25)(cid:11)… (cid:3)(cid:25) (cid:31)(cid:12) (cid:20)(cid:28) (cid:25)(cid:12)(cid:29) (cid:31) (cid:31)(cid:20) (cid:25)(cid:28) (cid:27)(cid:11) (cid:16)(cid:12) (cid:20)(cid:15) (cid:28)(cid:11)(cid:27) (cid:12)(cid:25)(cid:27) (cid:28)(cid:22) (cid:31)(cid:24)(cid:15)(cid:31)(cid:25)(cid:12) (cid:20)(cid:31) (cid:31)(cid:14) €(cid:25)(cid:9)(cid:15) (cid:31)(cid:20) (cid:24)(cid:28) (cid:20)(cid:11)(cid:31)(cid:11) (cid:16)(cid:16) (cid:26)(cid:16) (cid:19)(cid:19) (cid:20)(cid:28)(cid:20)(cid:11) (cid:12)(cid:26) (cid:31)(cid:141)(cid:28) (cid:141)(cid:141)(cid:31) (cid:31)(cid:25)(cid:27)(cid:31)(cid:11)(cid:16) (cid:27)(cid:15)(cid:157)(cid:3)(cid:28)(cid:29)(cid:22)(cid:18)
†(cid:15)(cid:157)(cid:28)…(cid:28)(cid:20)(cid:127)(cid:31)(cid:26)€(cid:28)(cid:31)(cid:11)(cid:27)(cid:12)(cid:157)(cid:28)(cid:20)(cid:31)(cid:12)€(cid:15)(cid:19)(cid:3)(cid:29)(cid:31)(cid:12)(cid:26)(cid:25)(cid:3)(cid:3)(cid:31)(cid:20)(cid:28)(cid:24)(cid:3)(cid:28)(cid:16)(cid:26)(cid:31)(cid:11)(cid:31)(cid:29)(cid:28)(cid:22)(cid:20)(cid:28)(cid:28)(cid:31)(cid:15)(cid:24)(cid:31)(cid:19)(cid:27)(cid:16)(cid:28)(cid:20)(cid:26)(cid:11)(cid:25)(cid:27)(cid:26)(cid:23)(cid:31)
(cid:13)(cid:20)(cid:7)(cid:22)(cid:27)(cid:6)(cid:23)(cid:5)(cid:29)(cid:10) (cid:6)(cid:23)(cid:5)(cid:29)(cid:10)(cid:1)(cid:31)(cid:25)(cid:27)(cid:16)(cid:20)(cid:28)(cid:11)(cid:12)(cid:28)(cid:127)(cid:31) (cid:29)(cid:19)(cid:28)(cid:31)(cid:26)(cid:15)(cid:31)(cid:26)€(cid:28)(cid:31)(cid:3)(cid:11)(cid:16) (cid:31)(cid:15)(cid:24)(cid:31)(cid:16)(cid:15)(cid:27)(cid:16)(cid:3)(cid:19)(cid:12)(cid:25)…(cid:28)(cid:31)(cid:28)…(cid:25)(cid:29)(cid:28)(cid:27)(cid:16)(cid:28)(cid:141)(cid:31)(cid:141)(cid:141)(cid:141)
(cid:10)(cid:17)(cid:9)(cid:28)(cid:27)(cid:8)(cid:21)(cid:13)(cid:31)(cid:13)(cid:7)(cid:30)(cid:6) (cid:24)(cid:21)(cid:17)(cid:3)(cid:16)(cid:11)(cid:29)(cid:17)(cid:15)(cid:29)(cid:1)(cid:31)(cid:129)(cid:141)(cid:143)(cid:127)(cid:31)(cid:31)(cid:2)(cid:20)(cid:21)(cid:5)(cid:23)(cid:5)(cid:16)(cid:10)(cid:16)(cid:30)(cid:19)(cid:1)(cid:31)(cid:129)(cid:141)(cid:144)(cid:127)(cid:31)(cid:14)(cid:20)(cid:29)(cid:1)(cid:7)(cid:29)(cid:17)(cid:15)(cid:19)(cid:1)(cid:31)(cid:20)(cid:11)(cid:20)(cid:28)(cid:127)(cid:31)(cid:31)(cid:127)(cid:129)(cid:16)(cid:11)(cid:29)(cid:17)(cid:15)(cid:29)(cid:1)(cid:31)(cid:157)(cid:28)(cid:11)
(cid:141)(cid:7)(cid:143)(cid:30)(cid:16)(cid:3)(cid:16)(cid:15)(cid:23)(cid:30)(cid:16)(cid:21)(cid:17)(cid:1)(cid:31) €(cid:28)(cid:31)(cid:8)(cid:21)(cid:13)(cid:31)(cid:3)(cid:11)(cid:4)(cid:28)(cid:3)(cid:31)(cid:24)(cid:15)(cid:20)(cid:31)(cid:2)(cid:3)(cid:15)(cid:27)(cid:11)‚(cid:28)(cid:9)(cid:11)(cid:14)(cid:31)(cid:3)(cid:25)(cid:12)(cid:26)(cid:12)(cid:31)ƒ(cid:24)(cid:20)(cid:11)(cid:16)(cid:26)(cid:19)(cid:20)(cid:28)(cid:31)(cid:26)(cid:20)(cid:11)(cid:19)(cid:14)(cid:11)(cid:26)(cid:25)(cid:16)ƒ(cid:31)
(cid:11)(cid:12)(cid:31)(cid:11)(cid:27)(cid:31)(cid:25)(cid:27)(cid:24)(cid:20)(cid:28)„(cid:19)(cid:28)(cid:27)(cid:26)(cid:31)(cid:11)(cid:29)…(cid:28)(cid:20)(cid:12)(cid:28)(cid:31)(cid:28)…(cid:28)(cid:27)(cid:26)(cid:127)(cid:31)(cid:12)(cid:19)(cid:22)(cid:22)(cid:28)(cid:12)(cid:26)(cid:25)(cid:27)(cid:22)(cid:31)(cid:11)(cid:31)(cid:9)(cid:15)(cid:26)(cid:28)(cid:27)(cid:26)(cid:25)(cid:11)(cid:3)(cid:31)(cid:3)(cid:25)(cid:27) (cid:31)(cid:141)(cid:141)(cid:141) €(cid:28)(cid:20)(cid:28)(cid:31)(cid:25)(cid:12)(cid:31)(cid:11)(cid:31)(cid:9)(cid:15)(cid:26)(cid:28)(cid:27)(cid:26)(cid:25)(cid:11)(cid:3)(cid:31)(cid:25)(cid:27)(cid:16)(cid:20)(cid:28)(cid:11)(cid:12)(cid:28)(cid:31)(cid:25)(cid:27)(cid:31)(cid:26)€(cid:28)(cid:31)(cid:20)(cid:25)(cid:12) (cid:31)(cid:15)(cid:24)(cid:31)€(cid:25)(cid:9)(cid:31)(cid:24)(cid:20)(cid:11)(cid:16)(cid:26)(cid:19)(cid:20)(cid:28)(cid:31)(cid:141)(cid:141)(cid:141)(cid:31)(cid:4)(cid:19)(cid:26)(cid:31)(cid:26)€(cid:28)(cid:31)
(cid:26)€(cid:28)(cid:12)(cid:28)(cid:31)(cid:29)(cid:20)(cid:19)(cid:22)(cid:12)(cid:31)(cid:16)(cid:15)(cid:19)(cid:3)(cid:29)(cid:31)(cid:25)(cid:27)(cid:16)(cid:20)(cid:28)(cid:11)(cid:12)(cid:28)(cid:31)(cid:26)€(cid:28)(cid:31)(cid:20)(cid:25)(cid:12) (cid:31)(cid:15)(cid:24)(cid:31)(cid:24)(cid:11)(cid:3)(cid:3)(cid:12)(cid:31)(cid:11)(cid:27)(cid:29)(cid:31)(cid:16)(cid:15)(cid:27)(cid:12)(cid:28)„(cid:19)(cid:28)(cid:27)(cid:26)(cid:3)(cid:23)(cid:31)€(cid:25)(cid:9) (cid:28)…(cid:25)(cid:29)(cid:28)(cid:27)(cid:16)(cid:28)(cid:31)(cid:25)(cid:12)(cid:31)(cid:27)(cid:15)(cid:26)(cid:31)(cid:12)(cid:26)(cid:20)(cid:15)(cid:27)(cid:22)(cid:31)(cid:28)(cid:27)(cid:15)(cid:19)(cid:22)€(cid:31)(cid:26)(cid:15)(cid:31)(cid:29)(cid:28)(cid:24)(cid:25)(cid:27)(cid:25)(cid:26)(cid:25)…(cid:28)(cid:3)(cid:23)(cid:31)(cid:28)(cid:12)(cid:26)(cid:11)(cid:4)(cid:3)(cid:25)(cid:12)€(cid:31)(cid:11)(cid:31)(cid:16)(cid:11)(cid:19)(cid:12)(cid:11)(cid:3)
(cid:9)(cid:29)(cid:15)(cid:30)(cid:21)(cid:20)(cid:27)(cid:13)(cid:8) (cid:24)(cid:20)(cid:11)(cid:16)(cid:26)(cid:19)(cid:20)(cid:28)(cid:12)(cid:127)(cid:31)(cid:28)(cid:12)(cid:9)(cid:28)(cid:16)(cid:25)(cid:11)(cid:3)(cid:3)(cid:23)(cid:31)(cid:25)(cid:27)(cid:31)(cid:26)€(cid:28)(cid:31)(cid:28)(cid:3)(cid:29)(cid:28)(cid:20)(cid:3)(cid:23)(cid:141)(cid:31)†(cid:15)(cid:157)(cid:28)…(cid:28)(cid:20)(cid:127)(cid:31)(cid:26)€(cid:28)(cid:31)(cid:28)…(cid:25)(cid:29)(cid:28)(cid:27)(cid:16)(cid:28)(cid:31)(cid:25)(cid:12)(cid:31)(cid:27)(cid:15)(cid:26)(cid:31) (cid:20)(cid:28)(cid:3)(cid:11)(cid:26)(cid:25)(cid:15)(cid:27)(cid:12)€(cid:25)(cid:9)(cid:31)(cid:4)(cid:11)(cid:12)(cid:28)(cid:29)(cid:31)(cid:15)(cid:27)(cid:31)(cid:26)€(cid:28)(cid:31)(cid:9)(cid:20)(cid:15)…(cid:25)(cid:29)(cid:28)(cid:29)(cid:31)(cid:9)(cid:11)(cid:12)(cid:12)(cid:11)(cid:22)(cid:28)(cid:12)(cid:141)
(cid:14)(cid:13)(cid:18)(cid:12)(cid:23)(cid:17)(cid:11)(cid:10)(cid:29)(cid:20) (cid:12)(cid:26)(cid:20)(cid:15)(cid:27)(cid:22)(cid:31)(cid:141)(cid:141)(cid:141)(cid:127)(cid:31)(cid:11)(cid:27)(cid:29)(cid:31)(cid:26)€(cid:28)(cid:31)(cid:8)(cid:21)(cid:13)(cid:31)(cid:3)(cid:11)(cid:4)(cid:28)(cid:3)(cid:12)(cid:31)(cid:24)(cid:15)(cid:20)(cid:31)(cid:5)(cid:15)(cid:20)(cid:11)‚(cid:28)(cid:9)(cid:11)(cid:14)(cid:31)(cid:11)(cid:27)(cid:29)(cid:31)(cid:21)(cid:25)(cid:11)‚(cid:28)(cid:9)(cid:11)(cid:14)(cid:31)(cid:29)(cid:15)(cid:31)(cid:27)(cid:15)(cid:26)(cid:31)
(cid:27)(cid:9)(cid:23)(cid:10)(cid:16)(cid:11)
(cid:9)(cid:20)(cid:15)…(cid:25)(cid:29)(cid:28)(cid:31)(cid:12)(cid:9)(cid:28)(cid:16)(cid:25)(cid:24)(cid:25)(cid:16)(cid:31)(cid:25)(cid:27)(cid:24)(cid:15)(cid:20)(cid:14)(cid:11)(cid:26)(cid:25)(cid:15)(cid:27)(cid:31)(cid:20)(cid:28)(cid:22)(cid:11)(cid:20)(cid:29)(cid:25)(cid:27)(cid:22)(cid:31)€(cid:25)(cid:9)(cid:31)(cid:24)(cid:20)(cid:11)(cid:16)(cid:26)(cid:19)(cid:20)(cid:28)(cid:31)(cid:20)(cid:25)(cid:12) (cid:141)
Figure 3: Real-world demonstration of Agent-Critic interactions in MALADE. Given the
question of identifying the association between Benzodiazepines and Hip Fracture, we illustrate
how CategoryAgent corrects its answers over iterations until the paired Critic is satisfied. See
Appendix3.3forfullpromptsbetweenthetwoagents. AgentsareinstantiatedusingGPT-4Turbo.
4.3 STEP1: FindingRepresentativeDrugs
We first construct a reasonably complete set of all drugs that can possibly belong to the category,
by querying FDA’s NDC database, which contains records of specific drugs, tagged with pharma-
cological class information of various types (including chemical classes, mechanisms of action,
and established pharmacologic classes). Specifically, we extract all drugs with names or classes
matching the relevant search term or terms (e.g., “antibiotic” or any of the sub-categories consid-
ered by OMOP, for example, erythromycin). Since this list may contain some drugs that do not
actually belong to the class (e.g., a search for “typical antipsychotics” returns atypical antipsy-
choticsaswell),werelyonanadditionalfilteringphasetoconstructthefinal,reasonablyaccurate
listofdrugsinthecategory. ForeachdrugD inthis“complete”list,weobtainitsprescriptionrate
viaaSQLquerytotheMIMIC-IVprescriptionstable.
Note that we chose to implement the above two SQL query steps directly without using an LLM
to generate the queries. This is an instance of an important design principle we adhere to in our
system, which we call the LLM Minimization principle: for tasks that can be expressed determin-
istically and explicitly in a standard programming paradigm, handle them directly without using
LLMstoenhancereliabilityandreducetokenandlatencycosts.
9MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
DrugFinder. Nowthatwehaveareasonablycompletelistofcandidatedrugnamesthatbelong
to the category of interest, along with their prescription rates, we want to identify three distinct,
most commonly prescribed drugs that belong to the category. This task is complicated by several
difficulties: the same drug may appear in this list with different names; some pairs of drugs may
be essentially the same but only differ in formulation and delivery method, and a judgment must
be made as to whether these are sufficiently different to be considered pharmacologically distinct;
and some of these drugs may not actually belong to the category. This task thus requires a group-
ing operation, related to the task of identifying standardized drug codes from text descriptions,
well known to be challenging [14]. Hence, this is very difficult to explicitly define in a deter-
ministic manner that covers all cases (unlike the above database tasks), and hence is well-suited
to LLMs, particularly those such as GPT-4 Turbo which are known to have been trained on vast
amounts of medical texts in general (and drug-related ones in particular). We assign this task to
theDrugFinder,whichisanAgent/CriticsystemwheretheCriticagenthelpsimprovethepaired
agent’soutputviaiterativefeedback;inparticular,theCriticcorrectstheAgentwhenitincorrectly
classifiesdrugsaspharmacologicallydistinct.
4.4 STEP2: IdentifyingDrug-OutcomeAssociations
DrugAgent is an Agent/Critic system whose task is to identify whether a given drug has an es-
tablished effect on the risk of a given outcome, based on FDA drug label database, and output a
summary of relevant information, including the level of identified risk and the evidence for such
an effect. This agent does not have direct access to the FDA Drug Label data, but can receive
thisinformationviaanotheragent,FDAHandler. FDAHandlerisequippedwithtoolstoinvokethe
OpenFDA API for drug label data, and answers questions in the context of information retrieved
based on the queries. Information received from this API is ingested into a vector database, so the
agent first uses a tool to query this vector database, and only resorts to the OpenFDA API tool if
thevectordatabasedoesnotcontaintherelevantinformation.
4.5 STEP3: LabelingDrugCategory-OutcomeAssociations
To identify the association between a drug category C and an adverse health outcome H, we
concurrently run a batch of queries4 to copies of DrugAgent, one for each drug D in the category,
of the form: “Does drug D increase or decrease the risk of condition H?”. The results are sent to
CategoryAgent,describednext.
CategoryAgent is an Agent/Critic system that performs the final classification step; its goal
is to generate a label identifying whether a category of drugs increases or decreases the risk
of a condition, or has no effect. In addition to the label, CategoryAgent produces a num-
ber of additional outputs, all of which are combined into a JSON-structured string, including:
(a) a confidence score in [0,1], indicating the confidence in the assigned label, (c) strength of
evidence, one of “none”, “weak”, or “strong”, and (d) frequency of the effect, one of “none,”
“rare”, or “common”. In this sense, DrugAgent serves as a function of the following type:
[string]→{‘‘increase’’,‘‘decrease’’,‘‘no-effect’’}×[0,1]×{‘‘non-
e’’,‘‘weak’’,‘‘strong’’}×{‘‘none’’,‘‘rare,’’,‘‘common’’}. The structured output
4For any OMOP drug categories which contain multiple sub-categories, we execute the full process for each sub-category
(identifyingasetofrepresentativesforeachsub-category),mergingtheoutputsoftheclassificationagent,takingthehighestrisk
indicatedforanysub-categoryastheriskforthefullcategory.
10MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
of CategoryAgent facilitates downstream post-processing to produce a final evaluation, with no
furtherLLMinvolvement(Section5.1).
5 Experiments
ThispaperpresentsMALADE,thefirstLLM-basedmulti-agentarchitecturethatiscapableofpro-
ducingastructuredreportwithcharacterizationsandscoresrelatedtotheriskofanadversehealth
outcomeH fromadrugcategoryC,basedonFDAdruglabeldata. Weevaluateourmethodagainst
awidelyusedbenchmark,theOMOPEvaluationGroundTruthtask[19],henceforthreferredtoas
theOMOPADEtask(Section5.1),toanswerthefollowingthreeresearchquestions:
RQ1: HoweffectivelydoesMALADEidentifyADEs? (Section5.2)
RQ2: DoesAgent-Criticinteraction,thecoredesignpatternunderlyingMALADE,effectively
enhancethereliabilityofthesystem? (Section5.3)
RQ3: What useful insights do the justifications by MALADE provide for further system im-
provement? (Section5.4)
5.1 EvaluationSetup
The objective of OMOP ADE task is to assign one of three labels (“increase,” “decrease,” and
“no-effect”) to each (C, H) pair, denoting whether C increases, decreases, or has no effect on the
risk of H, respectively. There are 10 drug categories, some of which consist of a single drug, and
10 health outcomes (refer to Table 6 for the complete list). Notably, while only three labels are
valid outputs, not all (C, H) pairs are deemed sufficiently certain to be used in the evaluation.
The authors of OMOP ADE task mark certain pairs as uncertain, to which we assign “no-effect”
labels with the special restriction that it should not be used in the evaluation. See Appendix B.3
forfurtherdetails.
Metrics. For quantitative evaluation, we convert the task into binary classification with two
different focuses of analysis: (1) classifying effect vs no-effect, where the labels “increase” and
“decrease” are considered the positive class, and “no-effect” is the negative class (namely, effect-
based classification); and (2) classifying ADE vs. non-ADE, where only “increase” is considered
the positive class, and the other two labels are the negative class (namely, ADE-based classifica-
Drug Category Drug Category
ACE In Ahi mbi pt hor o Ats ne tr ii bc ii on t AiB nc tis epil Be ep nti zc os Bdi ea tz a e Bp li Bion sce pks her o Ts s rip ch yo cln i Ta c yt s pe is cal
W
A an rt fi ap ris
nychotics
ACE In Ahi mbi pt hor o Ats ne tr ii bc ii on t AiB nc tis epil Be ep nti zc os Bdi ea tz a e Bp li Bion sce pks her o Ts s rip ch yo cln i Ta c yt s pe is cal
W
A an rt fi ap ris
nychotics
Angioedema Angioedema
Aplastic Anemia Aplastic Anemia
Acute Liver Injury Acute Liver Injury
Bleeding Bleeding
e e
m Hip Fracture m Hip Fracture
o o
utc Hospitalization utc Hospitalization
O Myocardial Infarction O Myocardial Infarction
Mortality After MI Mortality After MI
Renal Failure Renal Failure
GI Ulcer Hospitalization GI Ulcer Hospitalization
Figure4: Groundtruth(left)vs. predictionsbyMALADE(right)forOMOPADEtask. Red,
green,andwhitecellsrepresent“increase”,“decrease”,and“no-effect”labels,respectively.
11MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
tion). For both choices, we report AUC and F1 scores, which are common evaluation metrics for
binary classification [19, 2]. Corresponding to the above two binary-classification methods, this
resultsin“effect-basedAUC,F1”and“ADE-basedAUC,F1.”TheAUCmetriccaptureshowwell
the scores produced by MALADE discriminate between the classes, while the F1 score assesses
theaccuracyoftheassignedlabelsinclassifyingbothpositiveandnegativeinstances.
5.2 RQ1: MALADEeffectivelyidentifiesADEs
In the evaluations of MALADE, we consider two LLMs, GPT-4 Turbo and GPT-4o. For GPT-4o,
we limit the number of rounds of feedback from Critics to 5, after which it is required to accept.
Figure 4 compares the ground truth labels of OMOP ADE task with ADE labels identified by
MALADE (with GPT-4 Turbo). Considering the uncertainty inherent in the label of certain (drug
category, outcome) pairs [19], these indicate strong performance on the task. See Figure 10 of
Appendix B for results on GPT-4o. We also present the confusion matrix of the MALADE labels
inFigure5.
Moreover,wereporttheperformanceofMALADEintermsofAUCandF1metrics(seeTable1).
RecallthatCategoryAgentoutputsaconfidencescorerangingfrom0to1foritspredictedlabels,
namely ”increase,” ”no-effect,” or ”decrease.”. This score reflects the agent’s certainty regarding
the accuracy of the predicted outcome. For quantitative evaluation as in Table 1, we transform
these tripartite label-confidence scores into binary classification probabilities, suitable for effect-
based or adverse drug event (ADE)-based analysis. Converting the three-class labels to a binary
format requires a clear method for correlating each confidence score with a probabilistic value for
therespectivebinaryclassificationtask.
The three labels exhibit a natural progression: “decrease”, “no-effect”, and “increase” imply an
ascendinglikelihoodthatadrugcategoryisassociatedwiththeadverseoutcomeofinterest,signi-
fyingarisingprobabilityscoreforthepositiveclassinADE-basedclassification. Furthermore,an
increase in confidence of ”no-effect” or ”decrease” corresponds to a decrease in the ADE score,
while an increase in confidence of the ”increase” label corresponds to an increase in the ADE
score. These observations guide us in formulating an intuitive conversion of the label-confidence
scores into ADE probability scores; taking (1−c )/3,(2−c )/3, and (2+c )/3, respectively,
de no in
where c ,c , and c are the LLM output confidence score when the assigned label is “decrease”,
de no in
“no-effect”, and “increase”, respectively. This transformation preserves the semantic ordering of
the classes, as well as the valence of confidence in each class. To illustrate, increasing confidence
in“decrease”or“no-effect”suggeststhattheLLMislessconfidentthatC causesH. Wederivean
effect-score similarly, except that both “increase” and “decrease” are now positive classes; taking
(1+c )/2and(1−c )/2,respectively.
in/de no
The results in Table 1 indicate that the confidence scores output by the model are well-calibrated.
We observe that MALADE performs well both at distinguishing ADEs from non-ADEs and at
identifyingthepresence/absenceofaneffectingeneral. WeincludeROCcurvesandsensitivityvs.
specificitycurvesinFigure11andFigure12ofAppendixB,respectively. Weconductexperiments
with additional scoring functions, in particular, the model’s estimates of the probabilities that C
willcauseorpreventH;seeAppendixB.1.
5WeobservethatGPT-4Turbotendstoassign“increase”ratherconfidentlyevenwhentheevidenceisweak.Tofurtherenhance
thereliabilityoftheassignedlabels,wetakeanadditionalpostprocessingstep;replacingunreliablepredictionswith“no-effect”.
SeeAppendixB.4fordetaileddiscussionsonlabelpostprocessing.
12MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
1.0 1.0
Decrease (21 /2) (00 /2) (00 /2) 0.8 Decrease (21 /2) (00 /2) (00 /2) 0.8
0.6 0.6
0.023 0.89 0.091 0.023 0.77 0.2
No Effect (1/44) (39/44) (4/44) No Effect (1/44) (34/44) (9/44)
0.4 0.4
0 0.44 0.56 0 0.22 0.78
Increase (0/9) (4/9) (5/9) 0.2 Increase (0/9) (2/9) (7/9) 0.2
Decrease No Effect Increase 0.0 Decrease No Effect Increase 0.0
Predicted label Predicted label
(a)WithGPT-4Turbo5 (b)WithGPT-4o.
Figure5: ConfusionmatrixforMALADE.
Model Metric Effect-based ADE-based
GPT-4o AUCwithconfidence 0.883 0.903
GPT-4o F1score 0.600 0.560
GPT-4Turbo AUCwithconfidence 0.831 0.851
GPT-4Turbo F1score5 0.609 0.556
Table 1: Quantitative evaluation of MALADE. “Effect-based” captures the classification be-
tween the presence and the absence of any ADE, while “ADE-based” represent’s the ability of
MALADEtodistinguishdrugswithincreasedriskfromthosewithdecreasedriskornoeffect.
5.3 RQ2: Agent-Criticinteractionenhancesreliability
ConfidenceAUC F1Score
Critics RAG
ADE Effect ADE Effect Agent Correction
✓ ✓ 0.851 0.831 0.556 0.609 DrugAgent 4.24%
× ✓ 0.825 0.819 0.556 0.609 CategoryAgent 44.52%
✓ × 0.924 0.929 0.526 0.609
Table 3: Percentage of agent responses
× × 0.920 0.926 0.556 0.636
correctedbytheCritic.
Table2: AblationresultsonMALADE.
Our primary tool to analyze the effectiveness of the Agent-Critic pattern in MALADE is by abla-
tion;inparticular,weevaluatemodifiedversionsofMALADE,withandwithoutfeedbackfromthe
Critic components of DrugAgent and CategoryAgent, with and without RAG for FDAHandler.
TheresultsareshowninTable2.
We observe that, both in the case with and without RAG, Critics improve the quality of the confi-
dencescores,increasingbothADE-basedandEffect-basedAUCs. Weadditionallyobservestrong
performance without RAG (in which case Critics slightly improve AUCs but decrease F1 scores),
13
lebal
eurT
lebal
eurTMALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
suggesting that GPT-4’s internal medical knowledge is frequently sufficient for the OMOP ADE
task. However, to ensure that MALADE is a realistic prototype for future pharmacovigilance
systems, we consider only instances of MALADE with RAG for our main analysis; LLM-based
systems without RAG are prone to hallucinations, and are limited by a static pool of information
to draw upon. They lack the ability to produce citations, which is vital for trust in these systems,
particularly in the medical domain. Integrating RAG enables the system to access and leverage
the most current information from (for example) FDA label data, ensuring the system’s responses
are grounded with the up-to-date knowledge available. Refer to Appendix D for further details on
ablationresultsanddiscussions.
We continue our investigation of the effectiveness of Agent-Critic interaction by analyzing the
frequency of Critic interventions to rectify errors in Agent responses. We identify corrections
made by the Critic as examples in which the Agent and Critic engaged in more than one round of
interaction. ResultsareshowninTable3.
We find that the frequency with which the Critic catches a flaw varies significantly by Agent.
CategoryAgent in particular incurs errors, necessitating the help of the Critic and is generally
corrected due to flaws in its medical reasoning, hence the Critic can directly prevent an incorrect
response. IntheexampleofanactualrunofMALADE(Figure3),whenaskedabouttheeffectsof
benzodiazepines on hip fracture, CategoryAgent first answered “no-effect”, which was flagged
asanerror,asthesedativeandmusclerelaxantpropertiesofbenzodiazepinescanincreasetherisk
of falls and hence hip fractures, and as DrugAgent had noted that traumatic fractures were listed
asanADEinthedruglabels. ThisfeedbackwasforwardedtoCategoryAgentandusedtorevise
its answer to “increase”. We find that DrugAgent generally produces reliable responses; however
note that it occasionally makes no calls to the Critic, hence the Agent fails to validate its answer.
We observe that this can occur when the FDA drug label does not contain information related to
thecondition,andtheAgentconcludesthatnovalidationisnecessary.
5.4 RQ3: MALADEprovidesjustificationsthatarealignedwithhumanexpertreasoning,
andhelpunderstanditsfailuremodes
WeextractthejustificationsproducedbyCategoryAgentfromafullrunofMALADEforOMOP
ADE task for review by a clinician. We observe that the agent exhibits valid medical reasoning in
mostcases,inparticular,85%ofitsjustificationsalignwiththereasoningoftheclinician.
More importantly, examining the provided justifications helps us understand the common pat-
terns of failures and provides guidance on the further improvement of the system. For instance,
CategoryAgentoccasionallyassigns“increase”todrugcategoriesbasedonweakevidence,over-
estimating its strength It may also overlook risks not explicitly mentioned in the drug label data,
particularlywhenDrugAgentfailstoprovidesufficientcontext. Inaddition,CategoryAgentmay
fail to identify potential therapeutic effects not specified in the drug label data in association with
a condition. We observe that it does not recognize the antihistamine properties of tricyclic antide-
pressants. In one case, evidence against gastric and duodenal ulcers caused by alendronate led
CategoryAgenttodismissresultsregardingesophagealulcers.
While MALADE exhibits correct medical reasoning in general and hence achieves strong and
reliableperformanceonADEidentification,wehighlightthatunderstandingitsfailuresisessential
foritsfurtherimprovements,asdiscussedinSection6. Extractsfromthelogsshowingbothcorrect
14MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
andincorrectbehaviorbyMALADEareinAppendixC.SeeAppendixB.5foradiscussionofthe
justificationsproducedbyDrugFinder.
6 Discussion
Generalizable insights about collaborative LLM-powered agents in the context of health-
care. We have observed the strong performance of MALADE for ADE extraction, indicating
the potential of multi-agent systems toward broader PhV application. Importantly, the principles
guiding the design of our system, including 1) the Agent-Critic interaction, 2) the decomposition
of a complex task into sub-tasks, and 3) LLM minimization, are quite general. These principles
extendbeyondPhV,andcanbeappliedtomanyotherproblemsinclinicalmedicinewhichrequire
trustworthy, automated responses to challenging questions that must be answered based on multi-
plecompeting,andpotentiallyconflicting,sourcesofknowledgeordata. Thus,MALADEmaybe
viewed not only as a system for ADE extraction, but also as a roadmap for development of other
multi-agentsystemsthatgenerateprecise,evidence-basedresponsestosuchquestions.
General principle 1) Agent-Critic interaction. The Agent/Critic pattern, as discussed in Sec-
tion 4, is essential to the design of our system, and serves as a powerful tool to enhance accuracy
of an LLM-based system. Indeed, we have observed several instances where the Critic corrected
the parent Agent’s initial response, as in the example mentioned in Section 4.2. However, we
should note that if improperly configured, Critics can be harmful to the performance of a sys-
tem, both in terms of efficiency (since the repeated rounds of interaction between the Agent and
Critic can significantly increase token cost and runtime), and reliability. Since a Critic strictly en-
forces the provided guidelines, incorrect guidelines can significantly harm performance; in some
cases, excessively strict requirements can lead to infinite loops, as the Agent and Critic will dead-
lock, neither able to satisfy the other’s requirements. We observed this effect in early versions of
MALADE;resolvingtheinfiniteloopissuerequiredspecificinstructionslistingacceptablebehav-
ior. For instance, the Critic for DrugAgent needed to be explicitly told to accept statements that
the effect of a drug was uncertain due to a lack of information from the FDA labels; without this,
infiniteloopsoccurredinsomedrug-outcomecombinations.
Generalprinciple2) Decomposition ofacomplextask. Theprincipleof decomposition, mir-
roringtheanalogousprincipleofgeneralsoftwaredevelopment,istheUnixphilosophyasapplied
tomulti-agentsystems. Individualagentsshouldbeminimal,inthattheyshould“doonethingand
do it well”. This decomposition principle is evident in the hierarchy of specialized agents in the
design of MALADE (i.e., DrugFinder, DrugAgent, and CategoryAgent taking charge of each
sub-task in Section 4.3 - 4.5). In addition to promoting modularity and maintainability, decompo-
sitionalsopromotesreliability,especiallywhencombinedwithanotherkeydesignprinciple,LLM
onlywhennecessary.
General principle 3) LLM only when necessary. As LLMs have surprising capabilities, one
might be tempted to take an “LLM-maximalist” approach, where LLMs are responsible for all
aspects of the task. Unfortunately, this can be both costly and unreliable, since using proprietary
LLMs(e.g.,GPT-4)behindpaidAPIsincursasignificant“tokencost”aswellas“timecost”(dueto
thelatencyoftheresponsesAPIcalls). Instead,wecarefullyidentifieddeterministic,well-defined
algorithmic parts of the task and performed these in standard code. We relied on LLM-powered
15MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
agentsonlyforthespecifictasksrequiringlanguageunderstanding,reasoning,andtextgeneration.
ThisprincipleguideskeychoicesinMALADE:forinstance,toretrieveprescriptionfrequenciesof
drugsinacategory,insteadofhavinganLLMgeneratetheneededSQLqueriestotheMIMIC-IV
database, we observed that these queries are a simple function of the list of drugs, and directly
generated the query in standard code. A similar choice was made for the FDA API queries to
retrievedruglabels.
Such “LLM only when necessary” principle also illustrates the key utility of tool-use (also known
as function-calling): in addition to providing the LLM the ability to perform external actions and
to retrieve external data, it allows offloading execution of complex code from the LLM, hence
dramatically reducing cost and increasing reliability. A multi-agent orchestration system, in this
sense,canbeseenascontrolflowfortheLLM.
Limitations and Future Work. One key limitation of MALADE is that we rely entirely on
textual FDA label data. In particular, if the information is not specifically included in the label
data, MALADE cannot reliably identify the strength of any associations raised in the data. This
resultedinseveralflawedpredictions,asdiscussedinSection5.4. Toremedythis,weenvisionthat
extractingADEsfromEHRdataisapromisingdirectionforfuturework. Asafirststep,thiswould
enable estimating the rarity of certain adverse events noted withoutfurther detail in the label data;
in principle, a multi-agent system with access to EHR data may be able to identify ADEs directly.
This would require the LLM to perform causal discovery from historical data (answering, “Is the
drugcausingthisevent?”).
Another interesting avenue for future work is a detailed evaluation with local, open-source LLMs
suchasLlaMA[36],Grok[42],andMistral[11],whichhaveprivacyandcostadvantagesoverthe
proprietaryLLMs(suchasGPT-4,Claude,andvariants)behindpaidAPIs. Unfortunately,ourini-
tialexperimentswithlocalLLMsexhibitedmanyfailuremodesduetodeviationfrominstructions
and incorrect tool use. These are in principle possible to remedy by further breaking down tasks
intosimplersubtasks,andmoresophisticatedmulti-agentvalidationandcorrectionmechanisms.
Besides these broad limitations and avenues of future work, a few specific improvements are pos-
sible. Our system requires some minimal human input at the initial step, in particular, the names
of the drug categories must be put into the form expected by the FDA’s databases; in particular,
acronymsareexpandedandpluralsandpunctuationareremoved. Thistaskisquitelikelyamenable
to LLMs, which are capable of acronym identification and could attempt additional transforma-
tions for more robust output (for example, identifying all synonyms of a pharmacological class;
the union of the drugs identified with each search would then be forwarded to DrugFinder). In
addition, increased usage of structured input and output is a potential enhancement; for example,
DrugAgent’s reliability might be enhanced by replacing the free-form text output, using instruc-
tions enforcing the presence of certain information, such as the reliability of information and the
risk.
7 Conclusion
We consider the problem of ADE Extraction from FDA Drug Labels, a key task in Pharmacovig-
ilance (PhV), and propose a solution using MALADE, based on collaboration among multiple
LLM-powered agents equipped with Retrieval Augmented Generation (RAG). Our system goes
significantly beyond simplistic techniques that only produce a binary label of presence/absence of
16MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
association between a drug category and an ADE: it produces a structured report containing jus-
tification for the generated label, and scores characterizing probability of occurrence, confidence,
strength of evidence, and rarity of the association between a drug category and an ADE. The
scorespermitrigorousquantitativeevaluationofthesystem’sperformanceagainstthewidely-used
OMOP Ground Truth table of ADEs, and the results are impressive. We introduce the agent/critic
pattern, a powerful and general design pattern for reliable multi-agent systems. We hope that our
multi-agentarchitectureandguidingprincipleswillinspirefutureworkonmulti-agentapproaches
tobroaderPhVandgeneralmedicaltasks.
References
[1] La´szlo´ Babai. Trading group theory for randomness. In Proceedings of the seventeenth
annualACMsymposiumonTheoryofcomputing,pages421–429,1985.
[2] SamuelBayer,CherylClark,OanhDang,JohnAberdeen,SonjaBrajovic,KimberleySwank,
Lynette Hirschman, and Robert Ball. Ade eval: an evaluation of text processing systems for
adverse event extraction from drug labels for pharmacovigilance. Drug safety, 44:83–94,
2021.
[3] PrasadChalasani,NilsPalumbo,MohannadAlhanahnah,andSomeshJha. Langroid: Multi-
agentframeworkforllmapplications. https://github.com/langroid/langroid,2023.
[4] Jeff Devlin, Ming-Wei Chang, Kenton Lee, and Kristina Toutanova. Bert: Pre-training of
deepbidirectionaltransformersforlanguageunderstanding. InProceedingsofthe2019Con-
ference of the North American Chapter of the Association for Computational Linguistics:
HumanLanguageTechnologies,2019.
[5] Giacomo Frisoni, Miki Mizutani, Gianluca Moro, and Lorenzo Valgimigli. Bioreader: a
retrieval-enhanced text-to-text transformer for biomedical literature. In Proceedings of the
2022 conference on empirical methods in natural language processing, pages 5770–5793,
2022.
[6] Susan Gruber, Aloka Chakravarty, Susan R Heckbert, Mark Levenson, David Martin, Jen-
niferCNelson,BruceMPsaty,SimonePinheiro,ChristianGReich,SengweeToh,etal. De-
signand analysischoices forsafety surveillanceevaluations needto betuned tothe specifics
of the hypothesized drug–outcome association. Pharmacoepidemiology and drug safety,
25(9):973–981,2016.
[7] Manfred Hauben, Jeffrey K Aronson, and Robin E Ferner. Evidence of misclassification of
drug–event associations classified as gold standard ‘negative controls’ by the observational
medicaloutcomespartnership(omop). Drugsafety,39:421–432,2016.
[8] CarlHewitt. Actormodel. arXiv:1008.1459[cs.PL],Aug2010. arXiv: 1008.1459.
[9] Sirui Hong, Mingchen Zhuge, Jonathan Chen, Xiawu Zheng, Yuheng Cheng, Jinlin Wang,
Ceyao Zhang, Zili Wang, Steven Ka Shing Yau, Zijuan Lin, Liyang Zhou, Chenyu Ran,
Lingfeng Xiao, Chenglin Wu, and Ju¨rgen Schmidhuber. MetaGPT: Meta programming for
multi-agent collaborative framework. In The Twelfth International Conference on Learning
Representations,2024.
17MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
[10] Jhih-Yuan Huang, Wei-Po Lee, and King-Der Lee. Predicting adverse drug reactions from
social media posts: Data balance, feature selection and deep learning. Healthcare, 10(4),
2022.
[11] Albert Q Jiang, Alexandre Sablayrolles, Arthur Mensch, Chris Bamford, Devendra Singh
Chaplot, Diego de las Casas, Florian Bressand, Gianna Lengyel, Guillaume Lample, Lucile
Saulnier,etal. Mistral7B. arXivpreprintarXiv:2310.06825,2023.
[12] QiaoJin,RobertLeaman,andZhiyongLu.Retrieve,summarize,andverify: howwillchatgpt
affect information seeking from the medical literature? Journal of the American Society of
Nephrology,34(8):1302–1304,2023.
[13] Vijay Konda and John Tsitsiklis. Actor-critic algorithms. Advances in neural information
processingsystems,12,1999.
[14] Huyen Le, Ru Chen, Stephen Harris, Hong Fang, Beverly Lyn-Cook, Huixiao Hong,
WeigongGe,PaulRogers,WeidaTong,andWenZou. Rxnormfordrugnamenormalization:
a case study of prescription opioids in the fda adverse events reporting system. Frontiers in
Bioinformatics,3,2024.
[15] Patrick Lewis, Ethan Perez, Aleksandra Piktus, Fabio Petroni, Vladimir Karpukhin, Naman
Goyal, Heinrich Ku¨ttler, Mike Lewis, Wen-tau Yih, Tim Rockta¨schel, et al. Retrieval-
augmented generation for knowledge-intensive nlp tasks. Advances in Neural Information
ProcessingSystems,33:9459–9474,2020.
[16] MinghaoLi,YingxiuZhao,BowenYu,FeifanSong,HangyuLi,HaiyangYu,ZhoujunLi,Fei
Huang,andYongbinLi. API-bank: Acomprehensivebenchmarkfortool-augmentedLLMs.
In Houda Bouamor, Juan Pino, and Kalika Bali, editors, Proceedings of the 2023 Confer-
ence on Empirical Methods in Natural Language Processing, pages 3102–3116, Singapore,
December2023.AssociationforComputationalLinguistics.
[17] Percy Liang, Rishi Bommasani, Tony Lee, Dimitris Tsipras, Dilara Soylu, Michihiro Ya-
sunaga, Yian Zhang, Deepak Narayanan, Yuhuai Wu, Ananya Kumar, et al. Holistic eval-
uation of language models. Transactions on Machine Learning Research, 2023. Featured
Certification,ExpertCertification.
[18] Aman Madaan, Niket Tandon, Prakhar Gupta, Skyler Hallinan, Luyu Gao, Sarah Wiegr-
effe, Uri Alon, Nouha Dziri, Shrimai Prabhumoye, Yiming Yang, Shashank Gupta, Bod-
hisattwa Prasad Majumder, Katherine Hermann, Sean Welleck, Amir Yazdanbakhsh, and
Peter Clark. Self-refine: Iterative refinement with self-feedback. In A. Oh, T. Naumann,
A. Globerson, K. Saenko, M. Hardt, and S. Levine, editors, Advances in Neural Information
ProcessingSystems,volume36,pages46534–46594.CurranAssociates,Inc.,2023.
[19] David Madigan and Patrick Ryan. Learning from observational databases: Lessons from
omopandohdsi. 2015.
[20] TomasMikolov,IlyaSutskever,KaiChen,GregSCorrado,andJeffDean. Distributedrepre-
sentations of words and phrases and their compositionality. Advances in neural information
processingsystems,26,2013.
18MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
[21] Justin Mower, Devika Subramanian, and Trevor Cohen. Learning predictive models of drug
side-effectrelationshipsfromdistributedrepresentationsofliterature-derivedsemanticpredi-
cations. JournaloftheAmericanMedicalInformaticsAssociation,25(10):1339–1350,2018.
[22] Sriraam Natarajan, Vishal Bangera, Tushar Khot, Jose Picado, Anurag Wazalwar, Vitor San-
tosCosta,DavidPage,andMichaelCaldwell. Markovlogicnetworksforadversedrugevent
extractionfromtext. Knowledgeandinformationsystems,51:435–457,2017.
[23] Harsha Nori, Nicholas King, Scott Mayer McKinney, Dean Carignan, and Eric Horvitz. Ca-
pabilitiesofgpt-4onmedicalchallengeproblems. arXivpreprintarXiv:2303.13375,2023.
[24] Jeffrey Pennington, Richard Socher, and Christopher Manning. Glove: Global vectors for
wordrepresentation. InProceedingsofthe2014conferenceonempiricalmethodsinnatural
languageprocessing(EMNLP),pages1532–1543,2014.
[25] Richard Platt, Marcus Wilson, K Arnold Chan, Joshua S Benner, Janet Marchibroda, and
Mark McClellan. The new sentinel network—improving the evidence of medical-product
safety. NewEnglandJournalofMedicine,361(7):645–647,2009.
[26] Jingqing Ruan, YiHong Chen, Bin Zhang, Zhiwei Xu, Tianpeng Bao, Hangyu Mao, Ziyue
Li, Xingyu Zeng, Rui Zhao, et al. Tptu: Task planning and tool usage of large language
model-basedaiagents. InNeurIPS2023FoundationModelsforDecisionMakingWorkshop,
2023.
[27] Patrick B Ryan, Martijn J Schuemie, Emily Welebob, Jon Duke, Sarah Valentine, and Abra-
hamGHartzema. Definingareferencesettosupportmethodologicalresearchindrugsafety.
Drugsafety,36:33–47,2013.
[28] Karan Singhal, Shekoofeh Azizi, Tao Tu, S Sara Mahdavi, Jason Wei, Hyung Won Chung,
Nathan Scales, Ajay Tanwani, Heather Cole-Lewis, Stephen Pfohl, et al. Large language
modelsencodeclinicalknowledge. Nature,620(7972):172–180,2023.
[29] Karan Singhal, Tao Tu, Juraj Gottweis, Rory Sayres, Ellery Wulczyn, Le Hou, Kevin Clark,
StephenPfohl,HeatherCole-Lewis, Darlene Neal,etal. Towardsexpert-level medicalques-
tionansweringwithlargelanguagemodels. arXivpreprintarXiv:2305.09617,2023.
[30] Alfred Sorbello, Syed Arefinul Haque, Rashedul Hasan, Richard Jermyn, Ahmad Hus-
sein, Alex Vega, Krzysztof Zembrzuski, Anna Ripple, and Mitra Ahadpour. Artificial
intelligence–enabledsoftwareprototypetoinformopioidpharmacovigilancefromelectronic
healthrecords: Developmentandusabilitystudy. JMIRAI,2:e45000,Jul2023.
[31] Paul E Stang, Patrick B Ryan, Judith A Racoosin, J Marc Overhage, Abraham G Hartzema,
Christian Reich, Emily Welebob, Thomas Scarnecchia, and Janet Woodcock. Advancing the
science for active surveillance: rationale and design for the observational medical outcomes
partnership. Annalsofinternalmedicine,153(9):600–606,2010.
[32] ZhaoyueSun,GabrielePergola,ByronWallace,andYulanHe. LeveragingChatGPTinphar-
macovigilanceeventextraction: Anempiricalstudy. InYvetteGrahamandMatthewPurver,
editors, Proceedings of the 18th Conference of the European Chapter of the Association for
Computational Linguistics (Volume 2: Short Papers), pages 344–357, St. Julian’s, Malta,
March2024.AssociationforComputationalLinguistics.
19MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
[33] LiyanTang,ZhaoyiSun,BetinaIdnay,JordanGNestor,AliSoroush,PierreAElias,Ziyang
Xu, Ying Ding, Greg Durrett, Justin F Rousseau, et al. Evaluating large language models on
medicalevidencesummarization. npjDigitalMedicine,6(1):158,2023.
[34] XiangruTang,AnniZou,ZhuoshengZhang,YilunZhao,XingyaoZhang,ArmanCohan,and
Mark Gerstein. Medagents: Large language models as collaborators for zero-shot medical
reasoning. arXivpreprintarXiv:2311.10537,2023.
[35] Mert Tiftikci, Arzucan O¨zgu¨r, Yongqun He, and Junguk Hur. Machine learning-based iden-
tification and rule-based normalization of adverse drug reactions in drug labels. BMC bioin-
formatics,20:1–9,2019.
[36] HugoTouvron,ThibautLavril,GautierIzacard,XavierMartinet,Marie-AnneLachaux,Tim-
othe´e Lacroix, Baptiste Rozie`re, Naman Goyal, Eric Hambro, Faisal Azhar, et al. Llama:
Openandefficientfoundationlanguagemodels. arXivpreprintarXiv:2302.13971,2023.
[37] ChrisvonCsefalvay. Daedra: Alanguagemodelforpredictingoutcomesinpassivepharma-
covigilancereporting. arXivpreprintarXiv:2402.10951,2024.
[38] H. Wang, Y.J. Ding, and Y. Luo. Future of chatgpt in pharmacovigilance. Drug Safety,
46:711–713,2023.
[39] Yubo Wang, Xueguang Ma, and Wenhu Chen. Augmenting black-box llms with medical
textbooksforclinicalquestionanswering. arXivpreprintarXiv:2309.02233,2023.
[40] Jason Wei, Xuezhi Wang, Dale Schuurmans, Maarten Bosma, Fei Xia, Ed Chi, Quoc V Le,
Denny Zhou, et al. Chain-of-thought prompting elicits reasoning in large language models.
Advancesinneuralinformationprocessingsystems,35:24824–24837,2022.
[41] Qingyun Wu, Gagan Bansal, Jieyu Zhang, Yiran Wu, Shaokun Zhang, Erkang Zhu, Beibin
Li, Li Jiang, Xiaoyun Zhang, and Chi Wang. Autogen: Enabling next-gen llm applications
viamulti-agentconversationframework. arXivpreprintarXiv:2308.08155,2023.
[42] xAI. grok-1.
[43] Zhiheng Xi, Wenxiang Chen, Xin Guo, Wei He, Yiwen Ding, Boyang Hong, Ming Zhang,
Junzhe Wang, Senjie Jin, Enyu Zhou, et al. The rise and potential of large language model
basedagents: Asurvey. arXivpreprintarXiv:2309.07864,2023.
[44] Miao Xiong, Zhiyuan Hu, Xinyang Lu, YIFEI LI, Jie Fu, Junxian He, and Bryan Hooi. Can
LLMs express their uncertainty? an empirical evaluation of confidence elicitation in LLMs.
InTheTwelfthInternationalConferenceonLearningRepresentations,2024.
[45] Shunyu Yao, Dian Yu, Jeffrey Zhao, Izhak Shafran, Tom Griffiths, Yuan Cao, and Karthik
Narasimhan. Tree of thoughts: Deliberate problem solving with large language models.
AdvancesinNeuralInformationProcessingSystems,36,2024.
[46] Cyril Zakka, Rohan Shad, Akash Chaurasia, Alex R. Dalal, Jennifer L. Kim, Michael Moor,
Robyn Fong, Curran Phillips, Kevin Alexander, Euan Ashley, Jack Boyd, Kathleen Boyd,
Karen Hirsch, Curt Langlotz, Rita Lee, Joanna Melia, Joanna Nelson, Karim Sallam, Stacey
20MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
Tullis, Melissa Ann Vogelsong, John Patrick Cunningham, and William Hiesinger. Almanac
—retrieval-augmentedlanguagemodelsforclinicalmedicine. NEJMAI,1(2):AIoa2300068,
2024.
21MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
Supplementary Material
Section A includes an in-depth description of the core primitives of our multi-agent framework.
Section B offers the experimental details, including the system prompts for each agent, the de-
tails on our OMOP evaluation, and discussions of the postprocessing of the generated scores and
justifications. In Section C, we analyze both successful and unsuccessful instances of MALADE,
presenting comprehensive logs for selected examples. Section D presents an ablation study that
evaluatestheindividualcontributionsofkeycomponentstotheoverallsystemefficacy;namely,the
iterative refinement facilitated by Agent-Critic interactions, and the integration of external knowl-
edge through RAG. Finally, in Section E, we assess how much the variance of numerical outputs
by the random sampling of LLMs affects the variance of scores output by the entire MALADE
system.
A Agent-Oriented Programming
This section describes the core abstractions needed to implement a complex LLM-based applica-
tionsuchasMALADE.Theopen-sourcemulti-agentLLMframeworklangroid[3]hasanelegant,
intuitive and flexible implementation of these abstractions, and MALADE is built on top of this
library.
A.1 ToolUse: Example
As a simple example, a SQL query tool can be specified as a JSON structure with a sql field
(containing the SQL query) and a db field (containing the name of the database). The LLM may
beinstructedwithasystempromptoftheform:
When the user asks a question about employees,
use the SQLTool described in the below schema,
and the results of this tool will be sent back to you, and you can use these
to respond to the user’s question, or correct your SQL query
if there is a syntax error.
The tool handler would detect this specific tool in the LLM’s response, parse this JSON structure,
extract the sql and db fields, run the query on the specified database, and return the result if the
query ran successfully, otherwise return an error message. Depending on how the multi-agent
system is organized, the query result or error message may be handled by the same agent (i.e., its
LLM), which may either summarize the results in narrative form, or revise the query if the error
messageindicatesasyntaxerror.
A.2 RetrievalAugmentedGeneration
RAG involves two phases: (a) a ingestion phase, where documents are sharded into reasonable-
sizechunksandingestedintoasuitabletypeofdocument-store,and(b)aqueryphase,wheretop-k
document-chunks most relevant to the query are retrieved from the document-store, and the LLM
isprompted toanswerthe querygiventhesechunks (seeFigure6 forillustrativedescription). Not
surprisingly,theperformance(i.e.,precisionandrecallofanswers)ofaRAGsystemdependscrit-
ically on how we define the relevance of document chunks to the query so that they will contain
22MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
Figure6: AsimpleagentwithRAG.Duringtheingestionphase,documentsareshardedintodoc-
ument chunks. At the query phase, top-k chunks most relevant to the original query are retrieved,
based on lexical relevance and semantic relevance. Now we prompt the LLM with the augmented
querytogrounditsresponsetothedocuments.
sufficientinformationfortheLLMtocomposeareasonableanswer. Inthiswork,weuseacombi-
nation of two standard notions of relevance: (a) lexical relevance, which is based on word overlap
between the query and the document-chunk (i.e., keyword search), while (b) semantic relevance
focuses on the similarity of “meaning”. The latter is based on the intuition that specially-trained
embedding models can encode text as fixed-length embedding vectors that roughly capture the
“meaning” of the text, and thus two texts are considered semantically similar if their embedding
vectorsare“close”asmeasuredbyametricsuchascosinesimilarity[20,24,4]. Duringtheinges-
tion phase, each document chunk is mapped to an embedding vector using an embedding model
and this vector is indexed into a vector database, along with a pointer to the chunk contents as
metadata. During the query phase, the same embedding model is used to map the query into a
vector, and then the top-k nearest-neighbors of this vector (based on cosine similarity) are found
fromthevectordatabase,andtheircorrespondingdocumentchunksareretrieved.
A.3 FromLLMtoAgent-OrientedProgramming
If we view an LLM as a function with signature string → string, it is possible to express the
conceptofanagent,tool,andotherconstructsintermsofderivedfunctionsignatures,asshownin
Table4.
A.4 DetailedDescriptionofMulti-AgentOrchestration
When building an LLM-based multi-agent system, an orchestration mechanism is critical to man-
age the flow of messages between agents, to ensure task progress, and handle deviations from
instructions. In this work, we leverage Langroid’s simple yet versatile orchestration mechanism
thatseamlesslyhandles:
• userinteraction
• toolhandling
• sub-taskdelegation
23MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
FunctionDescription FunctionSignature
LLM string →string string fortheoriginalquery.
Chatinterface [string] × string →string [string] isforpreviousmessages6.
Agent string × [string] × string →string string isforsystemprompt.
Agentwithtool string ×(string→T)×(T→string)× [string] × string →string
ParserwithtypeT string→T
CallbackwithtypeT T→string
GeneralAgentwithstatetypeS S× string ×(string→T)×(S×T→S×string)× [string] × string →S×string
Table 4: From LLM to agent-oriented programming. An LLM is essentially a message trans-
former. Adding“tool”(orfunctioncalling)capabilitytoLLMrequiresaparserandacallbackthat
performs arbitrary computation and returns a string. The serialized instances of T correspond to a
languageL;as,byassumption,theLLMiscapableofproducingoutputsinL,thisallowstheLLM
to express the intention to execute Callback with arbitrary instances of T. Finally, we incorporate
statebymakingAgentandCallbacktransducers,andhavethegeneralforminthelastrow.
Recall that we view an agent as a message transformer; it may transform an incoming message
using one of its three “native” responder methods, all of which have the same function signature:
string → string:
• llm response returns the LLM’s response to the input message. Whenever this method
is invoked, the agent updates its dialog history (typically consisting of alternating user and
LLMmessages).
• user responsepromptstheuserforinputandreturnstheirresponse.
• agent response by default only handles a “tool message,” i.e., one that contains an llm-
generated structured response, performs any requested actions, and returns the result as a
string. An agent response method can have other uses besides handling tool messages,
suchashandlingscenarioswhereanLLM“forgot”touseatool,orusedatoolincorrectly,
andsoon.
To see why it is useful to have these responder methods, consider first a simple example of
creating a basic chat loop with the user. It is trivial to create such a loop by alternating be-
tween user response and llm response . Now suppose we instruct the agent to either di-
rectly answer the user’s question or perform a web-search. Then it is possible that sometimes
the llm response will produce a ”tool message”, say WebSearchTool, which we would handle
with the agent response method. This requires a slightly different, and more involved, way of
iterating among the agent’s responder methods. From a coding perspective, it is useful to hide the
actual iteration logic by wrapping an Agent class in a separate class, which we call a Task, which
encapsulatesalloftheorchestrationlogic. UsersoftheTaskclasscanthendefinetheagent,tools,
and any sub-tasks, wrap the agent in a task object of class Task, and simply call task.run(), letting
the Task class deal with the details of orchestrating the agent’s responder methods, determining
taskcompletion,andinvokingsub-tasks.
The orchestration mechanism of a Task object works as follows. When a task object is created
from an agent, a sequence of eligible responders is created, which includes the agent’s three “na-
tive”responderagentsinthesequence: agent response,llm response,user response. The
24MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
type signature of the run is string → string, just like the Agent’s native responder methods,
and this is the key to seamless delegation of tasks to sub-tasks. A list of subtasks can be added
to a task object via task.add sub tasks([t1, t2, ... ]), where t1, t2, ... are other
Taskobjects. Theresultofthisisthattherunmethodofeachsub-taskisappendedtothesequence
ofeligiblerespondersintheparenttaskobject.
Ataskalwaysmaintainsacurrentpendingmessage(CPM),whichisthelatestmessage”awaiting”
a valid response from a responder. At a high level the run method of a task attempts to repeatedly
find a valid response to the CPM, until the task is done. This is achieved by repeatedly invoking
the step method, which represents a ”turn” in the conversation. The step method sequentially
tries the eligible responders from the beginning of the eligible-responders list, until it finds a valid
response, defined as a non-null or terminating message (i.e. one that signals that the task is done).
In particular, this step() algorithm implies that a Task delegates to a sub-task only if the task’s
nativerespondershavenovalidresponse.
Thereareafewsimplerulesthatgovernhowstepworks: (a)aresponderentity(eitheranativeen-
tityorasub-task)cannotrespondifitjustrespondedinthepreviousstep(thispreventsaresponder
from ”talking to itself”, (b) when a response contains ”DONE” the task is ready to exit and return
the CPM as the result of the task, (c) when an entity ”in charge” of the task has a null response,
the task is considered finished and ready to exit, (d) if the response of an entity or subtask is a
structured message containing a recipient field, then the specified recipient task or entity will be
theonlyoneeligibletorespondatthenextstep.
Once a valid response is found in a step, the CPM is updated to this response, and the next step
starts the search for a valid response from the beginning of the eligible responders list. When a
response signals that the task is done (e.g. contains the special string ”DONE”), the run method
returns the CPM as the result of the task. This is a highly simplified account of the orchestration
mechanism,andtheactualimplementationismoreinvolved.
The above simple design is surprising powerful and can support a wide variety of task struc-
tures, including trees and DAGs. As a simple illustrative example, tool-handling has a natural
implementation. The LLM is instructed to use a certain JSON-structured message as a tool, and
thus the llm response method can produce a structured message. This structured message is
then handled by the agent response method, and the resulting message updates the CPM. The
llm responsemethodthenbecomeseligibletorespondagain,andtheprocesscontinues.
Figure2showsaschematicofthetaskorchestrationanddelegationmechanism.
B Detailed Descriptions on MALADE Implementation
B.1 PromptstoEachAgent
STEP1: finding representative drugs under each drug category. This is the full prompt to
DrugFinder:
You are a helpful assistant with general medical and pharmacological knowledge. I will provide
you with a list of drugs, and the result of a query on a medical database with their usage
rates; your goal is to find N representative drugs in category \{cat\} out of the provided
drugs.
Prefer generic names if possible, and do not include both a brand and generic name for the same
drug in your list.
25MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
If possible, prefer drugs with different active ingredients
(i.e. avoid derivatives of a drug already in the list),
keeping your choices to the most basic variant of a given drug
from the list (use the total prescription rate of variants of the same base drug to select the
top drugs); disregard this if you cannot find N with this restriction. If fewer than N meet
the conditions, you may include fewer than N (but never more).
The names of the selected representatives must EXACTLY match one of the provided drugs; choose
the names from the original list, not the database query.
You must provide your final answer with the ‘final_answer‘ tool/function; make sure to clearly
state my question, as well as the reasoning used to derive the answer. Include the
requirements on your answer in the ‘question‘ field.
Once the critic is satisfied with your answer, send me the answer with the ‘submit_answer‘ tool
/function.
ThisisthefullprompttotheCriticagent:
You are also an expert in medical and pharmacological reasoning.
Your goal is to ensure that the selected drugs are distinct members of the category \{cat\} of
drugs. You will consider information provided directly to the user to be reliable (for
example, this might include prescription rates and a complete list of drugs in category \{
cat\}). Unless this contradicts your pharmacological knowledge, the user’s choices of
representatives for a category are acceptable unless they do not represent the basic form
of a given drug.
STEP2: identifying the interaction between each drug and each outcome. Below is the full
prompttoDrugAgent.
You will receive questions involving medical data.
You are experienced in general medical reasoning, but must consult references for any specific
medical knowledge required to answer my questions.
You have access to ‘FDAHandler‘, who will answer questions you ask about specific drugs using
FDA data. You must use the ‘recipient_message‘ tool/function to ask these questions, and
the ‘intended_recipient‘ MUST be ‘FDAHandler‘ anytime you use this tool.
Ensure that you ask FDAHandler for the specific information you need.
As some potential complications are listed in FDA labels as lacking a verified causal
relationship, make certain that your final answer expresses the degree of reliability of
your answer. Similarly, make sure to clearly express the degree of risk associated (i.e. is
the condition a rare or a common side effect, or does a drug rarely or frequently result
in reduced risk of a condition).
If FDAHandler cannot answer your question then your answer
should be {NO_ANSWER}, because the FDA label data does not
specify the answer. If FDAHandler answers with {NO_ANSWER}
that means that the FDA label for the drug does not
contain the information requested (and, in particular, it
means that it does not mention the condition); hence, your
answer should be {NO_ANSWER}. This indicates that there
may not be any effect on the risk of the condition, make sure to explain this in your
justification.
IMPORTANT: if multiple attempts fail to retrieve any relevant information, there is no need to
continue asking questions to FDAHandler; assume that the information is not in the FDA
labels and so FDAHandler cannot answer.
You MUST specifically tell the critic why you could not
find an answer to the question; be sure to specify that
26MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
the FDAHandler answered with {NO_ANSWER} if that is the reason.
You must provide your final answer with the ‘final_answer‘
tool/function; make sure to clearly state my question, the
reasoning used to derive the answer, including the questions asked to FDAHandler and a summary
of the results, as well as your final answer in the ‘answer‘ field.
Once the critic is satisfied with your answer, say {DONE},
and give me the answer and justification for it. Make sure
to provide your answer again, do not just use the answer
sent to the critic. Include any relevant details provided by FDAAgent.
If the critic is satisfied and your answer is {NO_ANSWER},
say {DONE} {NO_ANSWER} and provide a justification.
IMPORTANT: say {DONE} specifically, not DONE.
ThisisthefullprompttotheCriticagent:
You are also experienced in medical reasoning, and have general medical knowledge. Unless the
responses are inconsistent with your medical (or common-sense) knowledge, you generally
trust responses from FDAHandler.
The answer should express the strength of evidence for the answer and the magnitude of the
effect. If the user states that FDAAgent does not have this information, you should accept
it.
If the answer given contains {NO_ANSWER}, accept it as long as the answer clearly expresses why
it was not possible to answer the question. If it states that this is because FDAHandler
responded with {NO_ANSWER}, you should accept it as sufficient justification.
Otherwise, ask the user to express whether FDAHandler responded with {NO_ANSWER}, and, if not,
to state why it was not possible to answer the question. If it does so, the answer is
acceptable and the other requirements need not be enforced.
In this case, the Critic agent similarly behaves as a medical expert; in general, the Critic must
alwaysbehaveasifproficientwithanytaskthattheorchestratoragentwilldo;thisisspecifiedas:
“You are also experienced in medical reasoning, and have general medical knowledge. Unless the
responses are inconsistent with your medical (or common-sense) knowledge, you generally trust
responsesfromFDAHandler.”
It is told to trust the agents’ responses as any necessary validation of the responses from the two
agentsshouldhappenontheirside;thecriticismshouldfocusontheorchestratoritself.
BelowisthefullprompttoFDAHandler:
You will try your best to answer my questions, in this order of preference:
1. Ask me for some relevant text, and I will send you.
Use the ‘relevant_extracts‘ tool/function-call for this purpose.
Once you receive the text, you can use it to answer my question.
If the question asks for information about a specific drug, make sure to begin by including
that drug in the ‘filter_drugs‘ field. If I say {NO_ANSWER}, it means I found no
relevant docs, and you can try the next step, using a web search.
2. If you are still unable to answer, you can use the ‘relevant_search_extracts‘ tool/function-
call to get some text from a web search. Once you receive the text, you can use it to
answer my question. If you need to identify the drugs in a category, use the ‘
drug_category_search‘ tool/function-call instead.
3. If you are still unable to answer, and used ‘filter_drugs‘ in your initial attempt with ‘
relevant_extracts‘, try again without a filter.
4. If you still can’t answer, simply say {DONE} {NO_ANSWER}
If given a question asking about a drug "X and Y", this is a
combination drug, so your initial searches should be for "X and Y" not "X" or "Y".
27MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
If asked a question about drugs in broad category, make to consider EVERY drug in the category,
and in particular, if the question asks for which drugs in the category something is true,
make CERTAIN that your answer correctly lists ALL drugs in the category where the
condition holds.
IMPORTANT: some fields in the FDA label data retrieved
by ‘relevant_search_extracts’ and ‘relevant_extracts‘ have the level of reliability of
information specified prior to it (for example, statements of the level of reliability may
precede each section of adverse reactions, the immediately preceding such statement is the
one that corresponds to any given reported interaction). Make certain that your answer
reflects the specified level of reliability.
Similarly, when asked about the effect of a drug on a condition, ALWAYS express the magitude of
the effect (i.e. how frequently the drug results in the condition or how frequently the
drug improves the condition); whenever possible, make sure to explicitly state whether a
condition is rarely or commonly reported.
ANSWER FORMAT:
ALWAYS present your answer in one of the below 2 formats:
1. In case you COULD NOT find an answer:
{DONE} {NO_ANSWER}
2. In case you ARE able to find an answer:
{DONE}
ANSWER: [Your concise answer, with a brief summary of necessary context. ALWAYS clarify the
level of reliability of the information, if specified in the extracts. If applicable,
ALWAYS express the magnitude of any increase or decrease in risk and any associated
information.]
SOURCE: aspirin label
EXTRACT_START_END: Aspirin can cause ... with any medicine.
For the EXTRACT_START_END, ONLY show up to the first 3 words and last 3 words.
STEP3: labelingtheassociationbetweeneachdrugcategoryandeachoutcome. Thisisthe
fullprompttoCategoryAgent:
You are experienced in general medical reasoning and have general medical knowledge.
You will be provided a list of passages answering, for each of a set of drugs X, whether drug X
increases or decreases the risk of {condition}. They all belong to category {cat_name}.
You must provide your final answer with the ‘final_answer‘ tool/function; make sure to clearly
state my question, the reasoning used to derive the answer,
including the evidence from the passages, as well as your final answer in the ‘answer‘ field.
Once the critic is satisfied, submit your answer with the ‘category_effect‘ tool, making sure
that the answer, ‘label‘, is one of the following: "increase," "decrease," or "no-effect,"
and make sure to include your justification. DO NOT use this tool before you have used the
‘final_answer‘ tool and have had your answer accepted by the critic.
Your ‘justification‘ must clearly express the magnitude of risk indicated and the strength of
evidence. Provide a ‘confidence‘ value between 0 and 1 indicating the confidence in your
assigned ‘label‘ and a ‘probability‘ value indicating the probability that the drug will
cause the condition (or prevent the condition) in a given patient.
Express the frequency that the drug has an effect as either "none," "rare," or "common" with
the ‘frequency‘ field and express the strength of ‘evidence‘ as either "strong" (for
example, evidence is strong when shown in a cal trial) or "weak" (for example, this applies
to purely correlational evidence) or "none" if no evidence exists.
28MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
ThisisthefullprompttotheCriticagent:
You are also experienced in medical reasoning, and have general medical knowledge. Unless the
responses are inconsistent with your medical (or common-sense) knowledge, you generally
trust responses from FDAHandler. Similarly, you trust that the user’s statements about
passages are correct without the need to review them directly.
The answer provided should indicate an increase, decrease, or no effect on the risk, and must
be no effect if no evidence linking the drug category to the risk of the condition exists.
The answer should be drawn from the specified passages, hence, the absence of information
related to a condition in the FDA data for all drugs in a category should be enough to
conclude that there is no effect for that drug.
The answer should express the degree of certainty and the magnitude of change in risk, ensure
that the provided answer is consistent with the evidence.
B.2 Probability-basedscoring
In addition to the confidence-based scoring discussed in Section 5, we consider probability-based
scoring. In particular, we ask the model to specify the probability of an evant, specifically, the
eventthatadrugincategoryC causesorpreventsH.
1.0 Decreased Risk
No Effect OR Increased Risk
0.8
0.6
0.4
0.2
0.0
0.0 0.2 0.4 0.6 0.8 1.0
Estimated Probability of Effect
Figure 7: Derivation of ADE Scores from Event Probability. The x-axis represents the LLM’s
outputprobabilityestimate,andthecolorindicatesthemappingforthecorrespondingsetoflabels.
As in Section 5, we must derive confidence scores in ADE and effects from the output probability
estimate; as the probability is already in terms of the probability of any effect, either harmful or
beneficial,weusetheprobabilitydirectlyforEffectAUC.ForADEAUC,weusethetranformation
showninFigure7.
We make the assumption that, if the LLM specifies a probability p with a label other than “de-
crease,” that probability expresses the probability of a harmful effect. Hence, the derived score
decreases linearly with increasing probability when the label is “decrease,” and increases linearly
when the label is anything else. With this assumption, we additionally maintain the semantic or-
deringoftheLLM’simpliedconfidenceinADE,andhencethisisawell-definedconfidencescore.
29
erocS
EDAMALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
Model Metric Effect-based ADE-based
GPT-4o AUCwithconfidence 0.8833 0.9034
GPT-4o AUCwithprobability 0.6715 0.6534
GPT-4Turbo AUCwithconfidence 0.8306 0.8514
GPT-4Turbo AUCwithprobability 0.8058 0.7935
Table 5: Comparison of confidence and probability based scoring for MALADE. “Effect-
based”capturestheclassificationbetweenthepresenceandtheabsenceofanyADE,while“ADE-
based”represent’stheabilityofMALADEtodistinguishdrugswithincreasedriskfromthosewith
decreasedriskornoeffect.
The results with probability-based scoring are shown in Table 5, we observe that the probabilities
are less reliable (unsurprising as the FDA label data does not always contain the information nec-
essaryforareliableestimate). SeeAppendixDforfurtherdiscussiononthepotentialunreliability
oftheprobabilityestimates.
B.3 OMOPADEtaskDetails
Drug Category
ACE Inhibitors Amphotericin B Antibiotics Antiepileptics Benzodiazepines Beta Blockers Bisphosphonates Tricyclics Typical
Antipsychotics
Warfarin
Angioedema Label
Decreased Risk
Aplastic Anemia
No Effect
Acute Liver Injury Increased Risk
Bleeding No Effect (Evaluated)
me
Hip Fracture
Outco
Hospitalization
Myocardial Infarction
Mortality After MI
Renal Failure
GI Ulcer Hospitalization
Figure8: OMOPgroundtruth.
ThegroundtruthfortheOMOPADEtaskisshowninFigure8. AsnotedinSection5.1,whilethe
OMOPADEtaskpermitsonlythreeoutputlabelsfortheeffectofadrugcategoryonanoutcome,
some drug category, outcome pairs are considered uncertain (which we treat as a “no-effect” label
which is not used in evaluation). In Figure 8 the “No Effect” cells considered reliable are shown
ACEInhibitors,AmphotericinB,Antibiotics(Erythromycin,Sulfonamide,Tetracycline),
DrugCategories Antiepileptics(Carbamazepine,Phenytoin),Benzodiazepines,Betablockers,
Bisphosphonates(Alendronate),Tricyclicantidepressants,Typicalantipsychotics,Warfarin
Angioedema,Aplasticanemia,Acuteliverinjury,Bleeding,Hipfracture,
Outcome Hospitalization,Myocardialinfarction,Mortalityaftermyocardialinfarction,
Renalfailure,Gastrointestinalulcerhospitalization
Table 6: OMOP drug categories and conditions. Parenthesized lists contain the subcategories of
thebroaddrugcategoryconsidered.
30MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
inblue,whiletheuncertain“no-effect”cellsarethoseinwhite. Inparticular,thecellsinwhiteare
not used in evaluation (i.e., for AUC computation, confusion matrices, and F1 scores). The cells
usedforevaluationareshowninred,blue,andgreen.
Table 7 present the representatives selected for each category of drugs, respectively, produced by
GPT-4Turbo.
DrugorDrugCategory RepresentativeDrug(s)
ACEInhibitors Lisinopril,Captopril,andEnalaprilMaleate
AmphotericinB Ambisome,AmphotericinB,andAbelcet
Erythromycin Erythromycin,ErythromycinEthylsuccinate,andErythromycin
Sulfonamides SilverSulfadiazine,Bactrim,andSulfadiazine
Tetracyclines DoxycyclineHyclate,Tigecycline,andMinocycline
Carbamazepine Carbamazepine
Phenytoin PhenytoinSodium,Phenytoin,andExtendedPhenytoinSodium
Benzodiazepines Lorazepam,Diazepam,andClonazepam
BetaBlockers MetoprololTartrate,Labetalol,andAtenolol
Alendronate AlendronateSodiumandAlendronate
Tricyclics DoxepinHCL,Desipramine,andAmitriptylineHCL
TypicalAntipsychotics Haloperidol,Thiothixene,andPimozide
Warfarin Warfarin
Table7: DrugRepresentativesselectedforeachOMOPcategory(orsubcategory).
B.4 EffectivenessofLabelPostprocessingwithGPT-4Turbo
In this subsection, we illustrate that the postprocessing of labels in Section 5.1 significantly im-
provestheaccuracyofADEidentificationbyMALADEinstantiatedwithGPT-4Turbo.
We take an additional postprocessing step to further enhance the quality of the assigned labels,
replacingunreliablepredictionswith“no-effect,”unlessstatedotherwise. Specifically,weconsider
outputs for which the LLM reported weak evidence and rare incidences of effects as unreliable.
Additionally,wedeemoutputsforwhichtheLLMselectedsmallroundnumbersfortheprobability
(i.e.,0.1and0.01)asunreliable,assuchvaluesareoftenchosenintheabsenceofstrongevidence,
resembling typical human preferences for round numbers. We apply this postprocessing except in
thecaseofAUC,asuncertaintyshouldbereflecteddirectlyintheconfidencescores.
We obtain an effect-based F1 score of 0.5294 without postprocessing, and 0.6087 with postpro-
cessing. We obtain an ADE-based F1 score of 0.4828 without postprocessing, and 0.5556 with
postprocessing. Figures ?? and ?? show the confusion matrices and predictions, respectively, of
MALADEwithoutpostprocessingonGPT-4Turbo(comparedtotheresultsinSection5.2).
31MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
1.0
Decrease (21 /2) (00 /2) (00 /2) 0.8
0.6
0.023 0.66 0.32
No Effect (1/44) (29/44) (14/44)
0.4
0 0.22 0.78
Increase (0/9) (2/9) (7/9) 0.2
Decrease No Effect Increase 0.0
Predicted label
(a)ConfusionmatrixforMALADE
Drug Category
ACE Inhibitors Amphotericin B Antibiotics Antiepileptics Benzodiazepines Beta Blockers Bisphosphonates Tricyclics Typical
Antipsychotics
Warfarin
Angioedema Label
Decreased Risk
Aplastic Anemia
No Effect
Acute Liver Injury Increased Risk
Bleeding
me
Hip Fracture
o
utc Hospitalization
O
Myocardial Infarction
Mortality After MI
Renal Failure
GI Ulcer Hospitalization
(b)PredictionsofMALADE
Figure9: ResultswithGPT-4Turbo,withoutpostprocessing.
Drug Category
ACE Inhibitors Amphotericin B Antibiotics Antiepileptics Benzodiazepines Beta Blockers Bisphosphonates Tricyclics Typical
Antipsychotics
Warfarin
Angioedema Label
Decreased Risk
Aplastic Anemia
No Effect
Acute Liver Injury Increased Risk
Bleeding
me
Hip Fracture
o
utc Hospitalization
O
Myocardial Infarction
Mortality After MI
Renal Failure
GI Ulcer Hospitalization
Figure10: PredictionsofMALADErunonGPT-4o.
B.5 DiscussionofJustificationsProducedbyDrugFinder
AsinSection5.4,weextractthejustificationsproducedbyDrugFinderinarunofMALADEfor
review by a clinician. The most common flaw in its reasoning is that DrugFinder frequently fails
torecognizeOMOPcategorieswhichconsistofasingledrug;beyondthat,theagent’sjustifications
aregenerallycorrect,withonlyonesignificantothererroroccurring.
Thiserrorisn’tdirectlycausedbyDrugFinder,but,rather,wasaresultofourOpenFDAretrieval
process failing to identify certain common typical antipsychotics, for example, fluphenazine is
labeledasaphenothiazineintheNationalDrugCodeDBbutnotasatypicalantipsychotic;hence
amorerobustsearch,takingsubcategoriesintoaccount,fordrugsinacategoryisneeded.
32
lebal
eurTMALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
Effect ROC Curve ADE ROC Curve
1.0 1.0
0.8 0.8
0.6 0.6
0.4 0.4
0.2 0.2
0.0 0.0
0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0
False Positive Rate False Positive Rate
(a)Usingthemodel’sgeneratedconfidencevalues.
Effect ROC Curve ADE ROC Curve
1.0 1.0
0.8 0.8
0.6 0.6
0.4 0.4
0.2 0.2
0.0 0.0
0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0
False Positive Rate False Positive Rate
(b)Derivingconfidencefromthemodel’sgeneratedprobabilityvalues.
Figure11: ROCcurvesforMALADEonOMOP
C Detailed behavior of MALADE: Successful and Failed Behavior
C.1 SuccessfulBehavior
For an example of a successful run of MALADE, consider the effect of ACE inhibitors on
agioedema. As we will see, DrugAgent will retrieve the reports of ADEs from the FDA labels,
andCategoryAgentwillconcludethattheyarestrongevidenceforincreasedrisk.
3.1 DrugAgentStep
This step will be run three times, for each of the representative drugs (Lisinopril, Captopril, and
EnalaprilMaleate). We’llshowtheresultsforLisinopril.
The original question to DrugAgent is “Does LISINOPRIL increase or decrease the risk of an-
gioedema?”
As DrugAgent requires evidence from the drug labels to answer the question, the agent immedi-
atelyasksFDAHandler,specifyingitastherecipient ofthemessageusingatoolcall,asfollows:
FUNC: {
"name": "relevant_extracts",
"to": "",
"arguments": {
33
etaR
evitisoP
eurT
etaR
evitisoP
eurT
etaR
evitisoP
eurT
etaR
evitisoP
eurTMALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
Effect Sensitivity-Specificity Curve ADE Sensitivity-Specificity Curve
1.0 1.0
0.8 0.8
0.6 0.6
0.4 0.4
0.2 0.2
0.0 0.0
0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0
Sensitivity Sensitivity
(a)Usingthemodel’sgeneratedconfidencevalues.
Effect Sensitivity-Specificity Curve ADE Sensitivity-Specificity Curve
1.0 1.0
0.8 0.8
0.6 0.6
0.4 0.4
0.2 0.2
0.0 0.0
0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0
Sensitivity Sensitivity
(b)Derivingconfidencefromthemodel’sgeneratedprobabilityvalues.
Figure12: Sensitivityvs. specificitycurvesforMALADEonOMOP
"query": "Does LISINOPRIL increase the risk of angioedema?",
"filter_drugs": [
"Lisinopril"
]
}
}
The agent searches its vector DB for relevant passages from the drug’s label, using another tool
call:
FUNC: {
"name": "relevant_extracts",
"to": "",
"arguments": {
"query": "Does LISINOPRIL increase the risk of angioedema?",
"filter_drugs": [
"Lisinopril"
]
}
}
Alargenumberofpassagesareretrieved,including:
LISINOPRIL: warnings: WARNINGS General Lisinopril Anaphylactoid and
Possibly Related Reactions: Presumably because angiotensin-converting
34
yticificepS
yticificepS
yticificepS
yticificepSMALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
enzyme inhibitors affect the metabolism of eicosanoids and
polypeptides, including endogenous bradykinin, patients receiving ACE
inhibitors (including lisinopril and hydrochlorothiazide tablets) may
be subject to a variety of adverse reactions, some of them
serious. Head and Neck Angioedema: Angioedema of the face,
extremities, lips, tongue, glottis and/or larynx has been reported
rarely in patients treated with angiotensin converting enzyme
inhibitors, including lisinopril. ACE inhibitors have been associated
with a higher rate of angioedema in Black than in non-Black patients.
withwhichFDAHandlerproducesitsanswer,statingthatitisdone:
<DONE>
ANSWER: Yes, LISINOPRIL has been associated with an increased risk of
angioedema. Angioedema of the face, extremities, lips, tongue,
glottis, and/or larynx has been reported rarely in patients treated
with angiotensin-converting enzyme inhibitors, including LISINOPRIL.
This can occur at any time during treatment. The incidence of
angioedema is higher in Black patients compared to non-Black
patients. In very rare cases, fatalities have been reported due to
angioedema associated with laryngeal edema or tongue edema. Patients
with a history of angioedema unrelated to ACE-inhibitor therapy may
be at increased risk of angioedema while receiving an ACE inhibitor.
Intestinal angioedema has also been reported in patients treated
with ACE inhibitors, presenting with abdominal pain, with or without
nausea or vomiting.
SOURCE: LISINOPRIL label
EXTRACT_START_END: Head and Neck Angioedema: Angioedema of the
face...associated with laryngeal edema or tongue edema.
DrugAgentexpressesitsreasoninginstructuredform,whichissenttotheCritic:
FUNC: {
"name": "final_answer",
"to": "",
"arguments": {
"question": "Does LISINOPRIL increase or decrease the risk of angioedema?",
"steps": [
"I asked FDAHandler if LISINOPRIL increases the risk of angioedema.",
"FDAHandler confirmed that LISINOPRIL has been associated with
an increased risk of angioedema. Angioedema involving the face,
extremities, lips, tongue, glottis, and/or larynx has been
reported rarely in patients treated with angiotensin-converting
enzyme inhibitors, including LISINOPRIL. The incidence is higher
in Black patients compared to non-Black patients, and very rare
cases have resulted in fatalities. Patients with a history of
angioedema unrelated to ACE-inhibitor therapy may be at
increased risk of angioedema while receiving an ACE
inhibitor. Intestinal angioedema has also been reported rarely."
],
"answer": "LISINOPRIL increases the risk of angioedema."
}
}
ThisisprocessedintonaturallanguageformbeforebeingforwardedtotheLLM.
Question: Does LISINOPRIL increase or decrease the risk of angioedema?
-----
Reasoning:
35MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
1. I asked FDAHandler if LISINOPRIL increases the risk of angioedema.
2. FDAHandler confirmed that LISINOPRIL has been associated with an
increased risk of angioedema. Angioedema involving the face,
extremities, lips, tongue, glottis, and/or larynx has been reported
rarely in patients treated with angiotensin-converting enzyme
inhibitors, including LISINOPRIL. The incidence is higher in Black
patients compared to non-Black patients, and very rare cases have
resulted in fatalities. Patients with a history of angioedema
unrelated to ACE-inhibitor therapy may be at increased risk of
angioedema while receiving an ACE inhibitor.
Intestinal angioedema has also been reported rarely.
-----
Final answer: LISINOPRIL increases the risk of angioedema.
TheCritichasnofeedback(whichindicatesacceptance):
FUNC: {
"name": "feedback",
"to": "",
"arguments": {
"critique": ""
}
}
Aswiththestructureddescriptionofthereasoningsteps,thisisprocessedintonaturallanguage:
Your reasoning is valid, no feedback was provided.
Fromhereon,wewillshowonlythenaturallanguageformforthesesteps. Theagentthenoutputs
itsanswertotheoriginalquestion,withtheadditionalcontextfromFDAHandler.
<DONE>
LISINOPRIL increases the risk of angioedema. This has been confirmed
by FDAHandler, who referenced the LISINOPRIL label indicating that
angioedema of the face, extremities, lips, tongue, glottis, and/or
larynx has been reported rarely in patients treated with
angiotensin-converting enzyme inhibitors, including LISINOPRIL. The
incidence of angioedema is higher in Black patients compared to
non-Black patients, and in very rare cases, fatalities have been
reported due to angioedema associated with laryngeal edema or tongue
edema. Patients with a history of angioedema unrelated to
ACE-inhibitor therapy may be at increased risk of angioedema while
receiving an ACE inhibitor. Intestinal angioedema has also been
reported rarely in patients treated with ACE inhibitors.
3.2 CategoryAgentStep
Together with the query “Does the angiotensin converting enzyme inhibitor category of drugs
increasetheriskofangioedema,decreaseit,oristherenocleareffect?” theagentisprovidedwith
theinformationfromtheoutputsfromthelaststep,foreachofthethreedrugs,asfollows:
Passages:
1. Drug LISINOPRIL: LISINOPRIL increases the risk of
angioedema. This has been confirmed by FDAHandler, who referenced the
LISINOPRIL label indicating that angioedema of the face, extremities,
lips, tongue, glottis, and/or larynx has been reported rarely in
patients treated with angiotensin-converting enzyme inhibitors,
36MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
including LISINOPRIL. The incidence of angioedema is higher in Black
patients compared to non-Black patients, and in very rare cases,
fatalities have been reported due to angioedema associated with
laryngeal edema or tongue edema. Patients with a history of
angioedema unrelated to ACE-inhibitor therapy may be at increased
risk of angioedema while receiving an ACE inhibitor. Intestinal
angioedema has also been reported rarely in patients treated with ACE
inhibitors.
2. Drug CAPTOPRIL: CAPTOPRIL increases the risk of angioedema. This
has been reported in approximately one in 1000 patients, and can
involve various parts of the body including extremities, face, lips,
mucous membranes, tongue, glottis, or larynx. Fatal airway
obstruction has occurred in some cases, and the risk is higher in
black patients compared to non-black patients.
3. Drug ENALAPRIL MALEATE: The final answer to the question "Does
ENALAPRIL MALEATE increase or decrease the risk of angioedema?" is
that ENALAPRIL MALEATE increases the risk of angioedema. This
information is based on the response from FDAHandler, which
referenced the ENALAPRIL MALEATE label indicating that angioedema has
been reported in patients receiving the drug. The incidence is higher
in black patients compared to non-black patients, and angioedema
associated with laryngeal edema can be fatal. If angioedema occurs,
treatment with ENALAPRIL MALEATE should be discontinued and
appropriate therapy instituted immediately.
---------
Does the angiotensin converting enzyme inhibitor
category of drugs increase the risk of angioedema, decrease it, or is
there no clear effect?
CategoryAgent immediately concludes that ACE inhibitors increase the risk of angioedema, and
sendsitsreasoningtotheCritic:
Question: Does the angiotensin converting enzyme inhibitor
category of drugs increase the risk of angioedema, decrease it, or is
there no clear effect?
-----
Reasoning:
1. All three passages provided indicate that the respective
angiotensin converting enzyme inhibitors (LISINOPRIL, CAPTOPRIL, and
ENALAPRIL MALEATE) increase the risk of angioedema.
2. Passage 1 states that LISINOPRIL increases the risk of angioedema,
with rare reports of angioedema in patients treated with ACE
inhibitors, including LISINOPRIL.
3. Passage 2 indicates that CAPTOPRIL increases the risk of
angioedema, with an incidence reported in approximately one in 1000
patients.
4. Passage 3 confirms that ENALAPRIL MALEATE increases the risk of
angioedema, as reported in patients receiving the drug.
5. The increased risk of angioedema is consistent across all three
drugs mentioned, which are part of the angiotensin converting enzyme
inhibitor category.
6. The evidence is strong as it is based on drug labels and FDAHandler
references, which are authoritative sources.
-----
Final answer: The angiotensin converting enzyme inhibitor
category of drugs increases the risk of angioedema.
Thecriticapproves:
Feedback: The reasoning provided is sound and consistent with
medical knowledge. Angiotensin converting enzyme inhibitors are known
37MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
to increase the risk of angioedema. The user has correctly identified
that all three passages from the FDA data indicate an increased risk
of angioedema with the use of LISINOPRIL, CAPTOPRIL, and ENALAPRIL
MALEATE, which are all ACE inhibitors. The conclusion that the ACE
inhibitor category of drugs increases the risk of angioedema is
supported by the evidence provided and is in line with established
medical understanding.
If any flaws in the reasoning used to produce your answer were
identified, you must try again.
Andtheagentoutputs“increase”withveryhighconfidence:
FUNC: {
"name": "category_effect_tool",
"to": "",
"arguments": {
"label": "increase",
"confidence": 1,
"probability": 0.001,
"frequency": "rare",
"evidence": "strong",
"justification": "The evidence from FDAHandler and drug labels for
LISINOPRIL, CAPTOPRIL, and ENALAPRIL MALEATE consistently reports an
increased risk of angioedema with the use of these ACE
inhibitors. The incidence of angioedema is reported as rare, with
occurrences such as one in 1000 patients for CAPTOPRIL. The evidence
is considered strong due to the authoritative nature of the sources."
}
}
3.3 CategoryAgentandCritic
HerewepresentthefullpromptofinteractionsbetweenCategoryAgentandCritic,giventhetask
ofidentifyingtheassociationbetween“benzodiazepine”and“hipfracture”.
Atround1,theoutputfromCategoryAgent:
Question: Does the benzodiazepine category of drugs increase the risk of hip fracture, decrease it,
or is there no clear effect?
-----
Reasoning:
1. The FDA label for Lorazepam does not specify information regarding the risk of hip fracture.
2. The FDA label data for Diazepam does not provide information on the risk of hip fracture.
3. The FDA label for Clonazepam mentions ’fracture traumatic’ as an infrequent adverse event but
does not establish a causal relationship with hip fractures or provide specific data on hip
fracture risk.
4. Since none of the provided passages offer conclusive evidence regarding the effect of
benzodiazepines
on the risk of hip fracture, we cannot determine if the category as a whole has a clear effect
on hip fracture risk.
-----
Final answer: There is no clear effect of the benzodiazepine category of drugs on the risk of hip
fracture
based on the provided passages.
FeedbackbyCritic:
The reasoning provided is flawed. While it is correct that the FDA label for Lorazepam and Diazepam
does not specify information regarding the risk of hip fracture, the mention of ’fracture
traumatic’ as an infrequent adverse event in the Clonazepam label should not be dismissed.
Benzodiazepines are known to cause sedation and muscle relaxation, which can lead to an
38MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
increased risk of falls, and consequently, hip fractures, especially in the elderly. The
presence of ’fracture traumatic’ as an adverse event in the Clonazepam label suggests that
there may be a link between benzodiazepine use and fractures. Therefore, the conclusion should
reflect a potential increase in the risk of hip fracture associated with benzodiazepines, even
if the evidence is not conclusive for a causal relationship.
If any flaws in the reasoning used to produce your answer were identified, you must try again.
Atround2,thecorrectedoutputfromCategoryAgent:
Question: Does the benzodiazepine category of drugs increase the risk of hip fracture, decrease it,
or is there no clear effect?
-----
Reasoning:
1. The FDA label for Lorazepam does not specify information regarding the risk of hip fracture.
2. The FDA label data for Diazepam does not provide information on the risk of hip fracture.
3. The FDA label for Clonazepam mentions ’fracture traumatic’ as an infrequent adverse event but
does not establish a causal relationship with hip fractures or provide specific data on hip
fracture risk.
4. Considering the pharmacological effects of benzodiazepines, which include sedation and muscle
relaxation, there is a plausible mechanism by which these drugs could increase the risk of
falls and consequently hip fractures, especially in the elderly.
5. The mention of ’fracture traumatic’ as an infrequent adverse event in the Clonazepam label,
while not conclusive, suggests that there may be a link between benzodiazepine use and
fractures.
6. Given the plausible mechanism and the mention of fractures as an adverse event for Clonazepam,
it is reasonable to infer that benzodiazepines may potentially increase the risk of hip
fracture, even though the evidence is not definitive for a causal relationship.
-----
Final answer: The benzodiazepine category of drugs may potentially increase the risk of hip
fracture, although the evidence is not definitive for a causal relationship based on the
provided passages.
FeedbackbyCritic:
The revised reasoning is more accurate in acknowledging the potential risk increase for hip
fractures associated with benzodiazepines, given the pharmacological effects and the mention of
’fracture traumatic’ as an adverse event for Clonazepam. However, the final answer should
still reflect a degree of uncertainty due to the lack of conclusive evidence. It would be more
appropriate to state that there is a potential increase in the risk of hip fracture with
benzodiazepine use, but the evidence is not strong enough to definitively establish a causal
relationship.
If any flaws in the reasoning used to produce your answer were identified, you must try again.
Atround3,thecorrectedoutputfromCategoryAgent:
Question: Does the benzodiazepine category of drugs increase the risk of hip fracture, decrease it,
or is there no clear effect?
-----
Reasoning:
1. The FDA label for Lorazepam does not specify information regarding the risk of hip fracture.
2. The FDA label data for Diazepam does not provide information on the risk of hip fracture.
3. The FDA label for Clonazepam mentions ’fracture traumatic’ as an infrequent adverse event but
does not establish a causal relationship with hip fractures or provide specific data on hip
fracture risk.
4. Considering the pharmacological effects of benzodiazepines, which include sedation and muscle
relaxation, there is a plausible mechanism by which these drugs could increase the risk of
falls and consequently hip fractures, especially in the elderly.
5. The mention of ’fracture traumatic’ as an infrequent adverse event in the Clonazepam label,
while not conclusive, suggests that there may be a link between benzodiazepine use and
fractures.
6. Given the plausible mechanism and the mention of fractures as an adverse event for Clonazepam,
it is reasonable to infer that benzodiazepines may potentially increase the risk of hip fracture,
even though the evidence is not definitive for a causal relationship.
39MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
7. However, due to the lack of conclusive evidence, the final answer should reflect uncertainty
regarding the causal relationship between benzodiazepine use and hip fracture risk.
-----
Final answer: There is a potential increase in the risk of hip fracture associated with
benzodiazepine use, but the evidence is not strong enough to definitively establish a causal
relationship based on the provided passages.
FeedbackbyCritic:
Your reasoning is valid, no feedback was provided.
FinaloutputbyCategoryAgent:
"label": "increase",
"confidence": 0.6,
"probability": 0.1,
"frequency": "rare",
"evidence": "weak",
"justification": "The FDA label for Clonazepam lists ’fracture traumatic’ as an infrequent adverse
event, suggesting a potential link between benzodiazepine use and fractures.
Given the pharmacological effects of benzodiazepines, which include sedation and muscle relaxation,
there is a plausible mechanism by which these drugs could increase the risk of falls and
consequently hip fractures, especially in the elderly. However, the evidence is not strong
enough to definitively establish a causal relationship, and the FDA labels for Lorazepam and
Diazepam do not provide specific information regarding hip fracture risk."
C.2 FailedBehavior
MALADE, however, fails to identify the effect of alendronate on gastrointestinal ulcer hospital-
ization. In particular, DrugAgent misinterprets a statement in the FDA labels indicating a lack
of evidence in clinical trials and forwards an overly broad statement that indicates that clinical
trials failed to show evidence of an effect to CategoryAgent; hence CategoryAgent outputs the
incorrectpredictionof“NoEffect.”
3.1 DrugAgentStep
Thisstepwasruntwice,foreachoftherepresentativedrugs,AlendronateSodiumandAlendronate
(noting that in this case only one drug should have been selected). We’ll consider the results for
Alendronate.
The original question to DrugAgent is “Does ALENDRONATE SODIUM increase or decrease
theriskofgastrointestinalulcerhospitalization?”
DrugAgentqueriesFDAHandler:
FUNC: {
"name": "recipient_message",
"to": "",
"arguments": {
"intended_recipient": "FDAHandler",
"content": "Does ALENDRONATE SODIUM increase
the risk of gastrointestinal ulcer hospitalization?"
}
}
whichqueriestheFDAlabeldatabasewith:
40MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
FUNC: {
"name": "relevant_search_extracts",
"to": "",
"arguments": {
"query": "Does ALENDRONATE increase the risk of gastrointestinal
ulcer hospitalization?",
"drug": "ALENDRONATE"
}
}
whichreturnsanumberofpassagesfromtheFDAlabels,including:
ALENDRONATE: warnings_and_cautions: 1 Upper Gastrointestinal Adverse
Reactions BINOSTO, like other bisphosphonates administered orally,
may cause local irritation of the upper gastrointestinal
mucosa. Because of these possible irritant effects and a potential
for worsening of the underlying disease, caution should be used when
BINOSTO is given to patients with active upper gastrointestinal
problems (such as known Barrett’s esophagus, dysphagia, other
esophageal diseases, gastritis, duodenitis, or ulcers). Esophageal
adverse experiences, such as esophagitis, esophageal ulcers and
esophageal erosions, occasionally with bleeding and rarely followed
by esophageal stricture or perforation, have been reported in
patients receiving treatment with oral bisphosphonates including
alendronate sodium. In some cases these have been severe and required hospitalization.
and
ALENDRONATE: warnings_and_cautions: There have been post-marketing
reports of gastric and duodenal ulcers with oral bisphosphonate use,
some severe and with complications, although no increased risk was
observed in controlled clinical trials.
Usingthese,FDAHandlerrespondswith:
<DONE>
ANSWER: Alendronate, like other bisphosphonates administered orally,
may cause local irritation of the upper gastrointestinal
mucosa. Esophageal adverse experiences such as esophagitis,
esophageal ulcers, and esophageal erosions, occasionally with
bleeding and rarely followed by esophageal stricture or perforation,
have been reported in patients receiving treatment with alendronate
sodium. In some cases, these have been severe and required
hospitalization. There have also been post-marketing reports of
gastric and duodenal ulcers with oral bisphosphonate use, some severe
and with complications, although no increased risk was observed
in controlled clinical trials.
SOURCE: ALENDRONATE label
EXTRACT_START_END: ...esophageal erosions, occasionally with bleeding
and rarely followed by... ...gastric and duodenal ulcers with oral
bisphosphonate use, some severe...
DrugAgent now concludes that the effect is uncertain, and sends its reasoning to the Critic. Here
is where the error occurs: the phrasing “However, no increased risk was observed in controlled
clinical trials.” is overly broad and suggests that alendronate was shown not to increase the risk
of all gastrointestinal ulcers in clinical trials, while, in reality, that was shown only for gastric and
duodenalulcersspecifically. ThiswillleadtotheincorrectpredictionbyCategoryAgent.
41MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
Question: Does ALENDRONATE increase or decrease the risk of
gastrointestinal ulcer hospitalization?
-----
Reasoning:
1. I asked FDAHandler whether ALENDRONATE increases the risk
of gastrointestinal ulcer hospitalization.
2. FDAHandler responded that Alendronate can cause local irritation of
the upper gastrointestinal mucosa and has been associated with
esophageal adverse experiences such as esophagitis, esophageal ulcers,
and erosions, occasionally with bleeding and rarely followed by
esophageal stricture or perforation, which have required
hospitalization in some cases. There have also been post-marketing
reports of gastric and duodenal ulcers with oral bisphosphonate use,
some severe and with complications. However, no increased risk was observed
in controlled clinical trials.
-----
Final answer: Alendronate may increase the risk of
gastrointestinal ulcer hospitalization, as it has been
associated with severe esophageal adverse experiences and
post-marketing reports of gastric and duodenal ulcers that
required hospitalization in some cases. However, it is
important to note that no increased risk was observed in
controlled clinical trials, indicating that while there is a potential risk,
it may not be common.
As the critic is unaware of the failure to correctly summarize the output from FDAHandler, it
concludesthattheanswerisjustified,returningnofeedback;DrugAgentrecieves:
Your reasoning is valid, no feedback was provided.
anditoutputstheanswerwiththeflawedstatement:
<DONE>
Alendronate may increase the risk of gastrointestinal ulcer hospitalization, as it has been
associated with severe esophageal adverse experiences and post-marketing reports of gastric and
duodenal ulcers that required hospitalization in some cases.
However, it is important to note that no increased risk was observed in controlled clinical trials,
indicating that while there is a potential risk, it may not be common.
3.2 CategoryAgentstep
ThequestionposedtoCategoryAgentwiththeresultsfromDrugAgentisasfollows:
Passages:
1. Drug ALENDRONATE SODIUM: ALENDRONATE SODIUM has
been associated with gastrointestinal adverse effects that can be
severe and may lead to hospitalization, such as esophageal ulcers and
erosions. However, it is important to note that while there have been
post-marketing reports of severe gastric and duodenal ulcers with
complications, no increased risk of gastrointestinal ulcer
hospitalization was observed in controlled clinical
trials. Therefore, while there is a potential risk, the degree of
reliability of this association is not fully established, and the
risk of hospitalization due to gastrointestinal ulcers appears to be rare.
2. Drug ALENDRONATE: Alendronate may increase the risk of
gastrointestinal ulcer hospitalization, as it has been associated
with severe esophageal adverse experiences and post-marketing reports
of gastric and duodenal ulcers that required hospitalization in some
cases. However, it is important to note that no increased risk was
observed in controlled clinical trials, indicating that while there
42MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
is a potential risk, it may not be common.
---------
Does the alendronate category of drugs increase the
risk of gastrointestinal ulcer hospitalization, decrease it, or is there no clear effect?
Given the overly broad statement from DrugAgent regarding clinical trial evidence,
CategoryAgent immediately concludes that there is no clear effect and sends its reasoning steps
totheCritic:
Question: Does the alendronate category of drugs increase the risk of gastrointestinal ulcer
hospitalization, decrease it, or is there no clear effect?
-----
Reasoning:
1. Both passages mention that alendronate and alendronate sodium have been associated with
gastrointestinal adverse effects, including severe gastric and duodenal ulcers.
2. Both passages also note that these associations come from post-marketing reports, which are less
controlled than clinical trials.
3. Passage 1 states that no increased risk of gastrointestinal ulcer hospitalization was observed
in controlled clinical trials for alendronate sodium.
4. Passage 2 similarly notes that for alendronate, no increased risk was observed in controlled
clinical trials.
5. Both passages conclude that while there is a potential risk, the risk of hospitalization due to
gastrointestinal ulcers appears to be rare and may not be common.
6. The evidence suggests that while there are reports of severe cases, the controlled clinical
trials did not show an increased risk, indicating that the effect is not consistent or well-
established.
-----
Final answer: There is no clear effect of the alendronate category of drugs on the risk of
gastrointestinal ulcer hospitalization.
andtheCriticapproves:
Feedback: The reasoning provided is consistent with the
information from the passages. It correctly identifies that while
there are post-marketing reports of gastrointestinal adverse effects,
controlled clinical trials did not show an increased risk of
gastrointestinal ulcer hospitalization for drugs in the alendronate
category. The conclusion that there is no clear effect on the risk of
gastrointestinal ulcer hospitalization is supported by the evidence
provided. Therefore, there are no flaws in the reasoning process.
If any flaws in the reasoning used to produce your answer were identified,
you must try again.
Finally,CategoryAgentoutputstheincorrectfinallabel,withhighconfidence:
FUNC: {
"name": "category_effect_tool",
"to": "",
"arguments": {
"label": "no-effect",
"confidence": 0.8,
"probability": 0.05,
"frequency": "rare",
"evidence": "weak",
"justification": "The alendronate category of drugs has been
associated with gastrointestinal adverse effects in post-marketing
reports, but controlled clinical trials did not show an increased
risk of gastrointestinal ulcer hospitalization. The evidence suggests
a potential risk, but it is not consistent or well-established, and
the risk of hospitalization due to gastrointestinal ulcers appears to be rare
43MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
and may not be common."
}
}
D Ablations
The objective of our ablation study is to examine the individual impact of two principal elements
onoursystem’sperformance:
(1) theiterativerefinementprocessamongmultipleagents(i.e.,Agent-Criticinteraction)
(2) theincorporationofexternalknowledgeviaRAG.
We do not conduct an ablation of our multi-agent design as MALADE cannot be naturally ex-
pressed as a single-agent system; while expressing all agents and control flow of MALADE in a
single highly complex agent is possible in principle, it is not straightforward to achieve that with
anylevelofreliability.
For (1), we evaluate the system’s performance with and without the involvement of the Critics
paired with DrugAgent and CategoryAgent, respectively, by toggling them on and off individu-
ally. RefertothefirsttwocolumnsinTable8. Forcompuationalreasonswedonotablatethecritic
onDrugFinder.
For (2), we substitute FDAHandler with a simple agent which answers the questions from
DrugAgentpurelybasedonLLM’sinternalknowledgeandgeneratesresponsesinasimilaroutput
formatasFDAHandler.mRefertothethirdcolumn,labeledas“RAG”,inTable8.
ResultsareobtainedbytheOMOPADEtaskevaluationwiththecorrespondingmodifiedversions
of MALADE, all of which were run with GPT-4 Turbo. To alleviate the computational burden
of ablations, when an ablated system’s configuration is identical to MALADE’s (i.e., Critics on
all agents and RAG enabled) up to a given step of the pipeline, we retain the output originally
produced by MALADE. We address the effects of variance due to random sampling from the
LLM in Appendix E. We maintain consistency with the evaluation metrics and output label post-
processing as detailed in Section 5.1, reporting ADE and effect-based AUC scores (with both the
outputconfidencescoresandprobabilities)andADE-andeffect-basedF1scores.
Critics ADE-basedAUC Effect-basedAUC F1Score
RAG
DrugAgent CategoryAgent Confidence Probability Probability(Modified) Confidence Probability Probability(Modified) ADE Effect
✓ ✓ ✓ 0.8514 0.7935 0.8043 0.8306 0.8058 0.8151 0.5556 0.6087
✓ × ✓ 0.8647 0.7126 0.7693 0.8512 0.7376 0.7862 0.5714 0.6154
× ✓ ✓ 0.9034 0.8889 0.9143 0.8864 0.8833 0.9050 0.6316 0.6667
× × ✓ 0.8249 0.8865 0.8804 0.8192 0.8812 0.8760 0.5556 0.6087
✓ ✓ × 0.9239 0.7609 0.8659 0.9287 0.7955 0.8853 0.5263 0.6087
✓ × × 0.9239 0.7633 0.8599 0.9287 0.7975 0.8802 0.5556 0.6364
× ✓ × 0.9203 0.7403 0.8623 0.9256 0.7779 0.8822 0.5263 0.6087
× × × 0.9203 0.7428 0.8563 0.9256 0.7800 0.8771 0.5556 0.6364
Table8: AblationresultsonMALADE.
Results in Table 8 show that, in the case with RAG, the best results are obtained with the Critic
on CategoryAgent active but the Critic on DrugAgent disabled (row 3); this suggests that the
feedback from CategoryAgent’s Critic is important for producing the most reliable results, but
44MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
that DrugAgent’s Critic may reduce the performance of MALADE. The case with a Critic on
DrugAgent but not CategoryAgent does not confirm this hypothesis (row 2), however, showing
slightly improved confidence scores and F1 scores, but much worse results in terms of proba-
bilities compared to full MALADE (row 1). Compared to this case, removing the DrugAgent’s
Critic worsens results with the exception of probability-based evaluations; hence, it is difficult to
confidently determine from these results whether DrugAgent’s Critic is helpful or harmful. The
extremely strong results in the case with the Critic on CategoryAgent active but the Critic on
DrugAgent disabled do, however, appear to outweigh the improvements observed in the second
row, suggesting that the Critic on CategoryAgent does in fact improve the overall reliability of
MALADE.
The results without RAG show, slightly improved AUCs in the presence of DrugAgent’s Critic;
CategoryAgent’s Critic, on the other hand, reduces F1 scores and slightly reduces probability-
basedAUCs.
Despite strong performance observed with probability-based metrics with some settings, these re-
sults suggest that direct estimates of effect probabilities may not be reliable measures in future
pharmacovigilance systems; to see this, compare the columns labeled “Probability” and “Proba-
bility (Modified).” The “Probability (Modified)” column is the same as “Probability” except that
output probabilities are incremented by 1 when the label is “increase” for ADE-based AUC and
“increase” or “decrease” for effect-based AUC. In the ADE case, this modification enforces the
separationbetweenthederivedscoresfromsamplesGPT-4Turbolabeledasincreasingriskandas
havingnoeffect;theimprovedresultsobservedindicatethatGPT-4’sprobabilityestimatesarenot
consistent: substantial numbers of “no-effect” cells are assigned higher probabilities of an effect
occurringascomparedtocellswhereGPT-4itself identifiesincreasedrisk.
E Variance of MALADE’s outputs
We wish to evaluate how much random sampling from LLM outputs affects MALADE’s outputs,
and, in particular, given the potential unreliability of numerical outputs produced by LLMs [44],
how much variance there is in MALADE’s output confidence scores. Moreover, we aim to un-
derstand whether key components of MALADE’s design, namely Critic agents and RAG, affect
these numerical outputs, and, in particular, affect their consistency, as well as whether variance
in the outputs by the first two agents in MALADE’s pipeline (DrugFinder and DrugAgent) is a
significantcontributortotheoverallvarianceoftheseoutputs.
We proceed by selecting three representative cells from the OMOP table, restricting ourselves to
thecellsusedforevaluationand,toensureawell-definedgroundtruthlabelforeachrepresentative,
to drug categories without subcategories. Each representative corresponds to one of the three
ground truth labels (increased risk, decreased risk, and no effect). We then run ten trials on each
cellwithablatedversionsofMALADE(constructedasinAppendixD;however,weonlyconsider
enabling or disabling Critics on all agents, including DrugFinder here). The results are shown in
Figure13;theseexperimentswererunwithGPT-4Turbo.
We observe that in all cases, MALADE maintains a clear separation between the confidences for
each ground truth label, with the sole exception being the case with RAG but without Critics; that
caseistheonlyoneinwhichweobserveanysampleswithincorrectlabels;thevarianceissimilarly
increasedsignificantlyinthatcase.
45MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
Next,weinvestigatehowthevarianceintheoutputsofDrugFinderandDrugAgentcontributeto
theoverallvarianceofMALADE.WecomparethevarianceofMALADE’soutputswiththeinitial
steps of the pipeline held fixed; They indicate that holding the initial steps of the pipeline fixed
does not substantially reduce variance and that CategoryAgent is the primary source of variance
in MALADE. However, note that the variance for “no-effect” is, somewhat surprisingly, highest
withtheoutputsofDrugFinderandDrugAgentheldconstant. Weobservethatthevarianceinthe
representative drugs affects output confidence, in particular, it affects mean confidence in ADEs
for the “no effect” representative. With the representatives held fixed, that mean confidence is
higher (or, equivalently, mean confidence in “no effect” is lower) compared to the case in which
weresamplerepresentativesineachtrial.
CriticsandRAG Criticsonly RAGonly
Criticsonly <,p = 0.044 — —
RAGonly <,p = 0.098 ̸=,p = 1.000 —
NeithercriticsnorRAG <,p = 0.027 <,p = 0.224 <,p = 0.255
Table 9: Relationship of mean confidence in ADE for “decrease” for ablated versions of
MALADE,withp-values.
CriticsandRAG Criticsonly RAGonly
Criticsonly <,p = 0.022 — —
RAGonly >,p = 0.076 >,p = 0.017 —
NeithercriticsnorRAG <,p = 0.022 ̸=,p = 1.000 <,p = 0.017
Table 10: Relationship of mean confidence in ADE for “no-effect” for ablated versions of
MALADE,withp-values.
CriticsandRAG Criticsonly RAGonly
Criticsonly <,p = 0.330 — —
RAGonly >,p = 0.314 >,p = 0.178 —
NeithercriticsnorRAG >,p = 0.144 >,p = 0.067 >,p = 0.278
Table 11: Relationship of mean confidence in ADE for “increase” for ablated versions of
MALADE,withp-values.
Now,tounderstandthesignificanceoftheseeffects,wewillperformpairedt-testsforeachpairof
ablated variants of MALADE, for each representative. The results for “decrease” are in Table 9,
results for “no-effect” are shown in Table 10, and results for “increase” are shown in Table 11.
Overall, we have that the mean confidence in ADE for the representative for “decrease” is lowest
(i.e. the confidence in “decrease” is highest) in the case with neither Critics nor RAG, and we
have that confidence in ADE for the representative of “no-effect” is lower (and so confidence in
“no-effect” is higher) in the case that we have neither Critics nor RAG as compared to the cases
46MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
with both Critics and RAG and RAG alone and, in addition, that confidence in ADE is increased
(withRAGaloneascomparedwithCriticsalone,allwithp-valuesbelow0.05foreachpair.
With p-values below 0.1, we additionally have that mean confidence in ADE for “decrease” is de-
creasedinthecasewithRAGaloneascomparedtothecasewithbothCriticsandRAG,confidence
inADEisincreasedwithRAGaloneascomparedtocriticsandRAG,and,finally,thatconfidence
inADEfor“increase”isincreasedwithneitherCriticsnorRAGascomparedtoCriticsalone.
Notethat,while,asseeninFigure13,byfarthelargestabsoluteshiftinconfidenceoccursbetween
RAGaloneandallothersforthe“no-effect”representative,thelargevarianceobservedinthatcase
isresponsibleforthereducedsignificance.
Extrapolating from these representative samples, these results suggest that MALADE without
RAGorCriticsperformsatleastaswellasanyotherconfiguration(withap-value< 0.05),butthat
in the presence of RAG, Critics improve reliability on instances with no strong effect, i.e. those
where the ground truth is “no-effect,” with a p-value less than 0.1. Notably, we do not have clear
evidence that Critics are necessary when there is clear evidence, unsurprising as the FDA labels
may explicitly state that a condition H is a potential ADE of a drug category C or that drugs in C
areindicatedforH.
As discussed in Section 5.3, we consider RAG an essential component of a generalizable phar-
macovigilance system. Hence, we focus on the results in the case with RAG, in which case these
resultssuggestthattheCriticcomponentsofMALADEimprovereliability.
47MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
10 12 2.0 Ground Truth
Decreased Risk
9
Increased Risk
8 10 1.5 No Effect (Evaluated)
7
Critics
and
RAG
Count of
Records
456
Critics
and
RAG
Count of
Records 468
Confidence
in
ADE 001 ... 050
3
2
2 −0.5
1
0 0 −1.0
1 7890 11 802
MACritics
and
RAG
LACritics
only
DE
sNeither
critics
nor
RAG
ettiRAG
only
ngs
Critics
only
Count
of
Records
456
Critics
only
Count
of
Records
6
4
3
2
2
E
settings 01
E
settings
0
D 10 D 12
A A
AL AL
M 9 M
10
8
7
Neither
critics
nor
RAG
Count
of
Records
456
Neither
critics
nor
RAG
Count
of
Records 468
3
2
2
1
0 0
10 12
9
10
8
7
8
RAG
only
Count
of
Records
456
RAG
only
Count
of
Records
6
4
3
2
2
1
0 0
−−10−..090−.80−.70−.60−.50−.40−.30 C−.2 o0. n01. f0 i0 d.1 e0 n.20 c. e30 . i40 n. 5 A0. D60. E70 . (8 b0. i9 n1. n01 e.1 d1. )21.31.41.51.61.71.812.9.0
Decreased
Risk
Increased
Risk
No
Effect
Predicted Label
Figure13: HistogramsofconfidenceinADEproducedbyablationsofMALADE.
48MALADE:OrchestrationofLLM-poweredAgentswithRAGforPharmacovigilance
10 10 2.0 Ground Truth
Decreased Risk
9 9
Increased Risk
DrugFinder
and
DrugConditionInteractionAgent
Count
of
Records
2345678
DrugFinder
and
DrugConditionInteractionAgent
Count
of
Records
2345678
Confidence
in
ADE
−00011 ..... 50505 No Effect (Evaluated)
1 1
0 0 −1.0
1 890 1 890
ConditionInteract…
DrugFinder
only None
7 7
Drug
Agents
held
fixed
DrugFinder
only
Count
of
Records
456
Agents
held
fixed
DrugFinder
only
Count
of
Records
456 AgeDrugFinder
and
nts held fixed
3 3
2 2
1 1
0 0
10 10
9 9
8 8
7 7
None
Count
of
Records
456
None
Count
of
Records
456
3 3
2 2
1 1
0 0
−−10−..090−.80−.70−.60−.50−.40−.30 C−.2 o0. n01. f0 i0 d.1 e0 n.20 c. e30 . i40 n. 5 A0. D60. E70 . (8 b0. i9 n1. n01 e.1 d1. )21.31.41.51.61.71.812.9.0
Decreased
Risk
Increased
Risk
No
Effect
Predicted Label
Figure 14: Histograms of confidence in ADE produced by MALADE with the outputs of each
initialsequenceofagentsinthepipelineheldfixed.
49