Enhancing predictive imaging biomarker discovery
through treatment effect analysis
Shuhan Xiao1,2,*, Lukas Klein3,4,5, Jens Petersen1, Philipp Vollmuth1,6,7,8, Paul F. Jaeger3,5,+,
and Klaus H. Maier-Hein1,2,5,9,+
1GermanCancerResearchCenter(DKFZ),DivisionofMedicalImageComputing,69120Heidelberg,Germany
2FacultyofMathematicsandComputerScience,HeidelbergUniversity,69120Heidelberg,Germany
3GermanCancerResearchCenter(DKFZ),InteractiveMachineLearningGroup,69210Heidelberg,Germany
4InstituteforMachineLearning,ETHZu¨rich,8092Zu¨rich,Switzerland
5GermanCancerResearchCenter(DKFZ),HelmholtzImaging,Heidelberg,69210Heidelberg,Germany
6ClinicforNeuroradiology,UniversityHospitalBonn,53127Bonn,Germany
7DivisionforComputationalRadiologyClinicalAI(CCIBonn.ai),ClinicforNeuroradiology,UniversityHospitalBonn,
53127Bonn,Germany
8MedicalFacultyBonn,UniversityofBonn,53127Bonn,Germany
9PatternAnalysisandLearningGroup,DepartmentofRadiationOncology,HeidelbergUniversityHospital,69120
Heidelberg,Germany
*s.xiao@dkfz-heidelberg.de
+theseauthorscontributedequallytothiswork
ABSTRACT
Identifyingpredictivebiomarkers,whichforecastindividualtreatmenteffectiveness,iscrucialforpersonalizedmedicineand
informsdecision-makingacrossdiversedisciplines. Thesebiomarkersareextractedfrompre-treatmentdata,oftenwithin
randomizedcontrolledtrials,andhavetobedistinguishedfromprognosticbiomarkers,whichareindependentoftreatment
assignment. Ourstudyfocusesonthediscoveryofpredictiveimagingbiomarkers,aimingtoleveragepre-treatmentimages
tounveilnewcausalrelationships. Previousapproachesreliedonlabor-intensivehandcraftedormanuallyderivedfeatures,
whichmayintroducebiases. Inresponse,wepresentanewtaskofdiscoveringpredictiveimagingbiomarkersdirectlyfromthe
pre-treatmentimagestolearnrelevantimagefeatures. Weproposeanevaluationprotocolforthistasktoassessamodel’s
abilitytoidentifypredictiveimagingbiomarkersanddifferentiatethemfromprognosticones. Itemploysstatisticaltestinganda
comprehensiveanalysisofimagefeatureattribution. Weexplorethesuitabilityofdeeplearningmodelsoriginallydesignedfor
estimatingtheconditionalaveragetreatmenteffect(CATE)forthistask,whichpreviouslyhavebeenprimarilyassessedfor
theprecisionofCATEestimation,overlookingtheevaluationofimagingbiomarkerdiscovery. Ourproof-of-conceptanalysis
demonstratespromisingresultsindiscoveringandvalidatingpredictiveimagingbiomarkersfromsyntheticoutcomesand
real-worldimagedatasets.
Introduction
Identifying predictive biomarkers is crucial for determining which subgroup of individuals will have a positive treatment
effectandultimatelyformakinginformedtreatmentdecisionsinnumerousdisciplineswithtreatmentsrangingfrommedical
treatments and health programs to environmental strategies and public policies. Precision medicine, for example, relies
onpredictivebiomarkerstotailorinterventionstoindividualpatientsandensureoptimizedpatientoutcomes. Generally,a
biomarkerisameasurablecharacteristicassociatedwithanindividual’soutcomesuchasdiseaseprogression,patientwell-being,
orphysiologicmeasures1. Althoughthetermoriginallystemsfromthebiomedicalfield,itcanalsorefertocovariatesingeneral
contexts. Predictivebiomarkersactasdriversoftreatmenteffectheterogeneity2andarethereforetreatment-specific. Theydo
notinfluencetheoutcomeofthecontrolgroup,unliketreatment-independentprognosticbiomarkers,whichareassociated
withtheoutcomeindependentoftreatmentassignment3,asillustratedinFig.1. Thediscoveryofpredictivebiomarkersplays
animportantrolenotonlyinexplainingthecausalmechanismsbehindtreatmenteffectsandsupportinginformedtreatment
decisionsbutalsoindrivingthedevelopmentofnoveltreatmentsacrossvariousdomains.Inparticular,therehasbeenagrowing
interestinleveragingthevastamountofnon-invasivelyacquiredinformationprovidedacrossdifferentimagingmodalities
to discover so-called imaging biomarkers, especially predictive imaging biomarkers4. In previous research, the discovery
processofpredictiveimagingbiomarkersinvolveshandcraftedradiomicsfeatures(e.g.shape,intensity,andtextureoftumors
orlesions5–8)ascandidatestodeterminetheirpredictiveperformance. Thisprocesstypicallycontainsseveralstepsincluding
4202
nuJ
4
]VI.ssee[
1v43520.6042:viXraUnobserved Observed
Predictive Treatment (Disease)
Biomarker Effect τ Outcomes Y
Xpred τ Y(T=1)
Image Treatment
Treatment
Group
I T
Prognostic
Biomarker
Xprog Y(T=0)
observed unobserved C Go rn ot ur po l
variables variables
Figure1. Relationshipbetweenbiomarkersx andx ,potentialoutcomesY(T)dependingonthetreatmentvariableT
prog pred
andthetreatmenteffectτ. Itisimpossibletoinfertheindividualtreatmenteffectdirectlysinceitisimpossibletoobserveboth
potentialoutcomesY(T =0)andY(T =1)forthesameindividualsimultaneously.
i i
segmentationtodefineregionsofinterest,featureextraction,andfeatureselection.
WhileMLanddeeplearningapproacheshavebeenemployedtofacilitatethediscoveryofimagingbiomarkers5,6,9–13,
thetrainingprocessesrelyonhandcraftedradiomics-basedfeaturesandhavetheriskofintroducinghumanbias,asshownby
Hosnyetal.14. Someapproachesdirectlyaimatdiscoveringpredictivebiomarkersanddistinguishingthemfromprognostic
ones15–18,butarelimitedtotabularinputdata. Moreflexibilityandadaptabilityareofferedbydeep-learning-basedconditional
averagetreatmenteffect(CATE)estimationmethods19–24,whichhavethepotentialtoidentifypredictivebiomarkercandidates
fromasetoftabularcovariatesaswell16,25. CATEestimationdiffersfromastandardsupervisedlearningtaskandrequires
differentmodelingapproachesasthegroundtruthforourquantityofinterest–theindividualtreatmenteffect–isnotavailable.
Thisisduetothefundamentalproblemofcausalinference26: Itisimpossibletoobservebothpotentialoutcomes,treatedand
untreated,fromthesameindividualsimultaneously,yettheyarenecessarytocomputetheindividualtreatmenteffect.ForCATE
estimation,thepresenceofstrongprognosticbiomarkers,whichisfrequentlyencounteredinpractice,cannegativelyimpact
theperformanceofCATEestimationmethods,eventhoughtheyarenotrelevantforthetreatmenteffectand,thus,fortreatment
decision-making. Forinstance,CATEestimationmethodscanmistakenlyidentifyprognosticaspredictivebiomarkers,as
studieshaveshown15,25,27,whichmayleadtoineffectiveorevenharmfultreatmentrecommendations. Itisthereforeessential
toensurethatthesemethodscandistinguishthesetwotypesofbiomarkers. CATEestimationmethodshavebeenoriginally
designedfortabularinputsandremainawidelyunexploredtopicinthecontextofimageinputs. Inresponsetothisgap,recent
advancementshaveadapteddeep-learning-basedCATEestimationmethodstoestimatetreatmenteffectsnotonlyfrommedical
images28–31butalsoothertypesofimages32–34.
Yet,noneoftheseimage-basedmethodsdirectlydescribehowpredictivebiomarkerscanbeidentifiedandinterpretedor
addresshowwellmodelsmanagetodoso,whichisanimportantbutoftenoverlookedperformancemetrictoconsiderwhen
evaluatingCATEestimationmethods,asnotedbyCurthetal.2. Toconductsuchanevaluation,abenchmarkingenvironment
wasproposedbyCrabbéetal.25,albeitonlyapplicabletotabulardata.Adaptingtheevaluationofpredictivebiomarkerdiscovery
fromtabulardatatoimagingbiomarkersintroducesasignificantchallenge: Extractingimagingbiomarkersiscomplicatedby
thehigh-dimensionalandstructurednatureofimagedata,whichlacksdistinctpre-definedfeatures. Consequently,acritical
stepininterpretingthesebiomarkersisdeterminingthespecificimagefeaturesuponwhichtheblack-boxMLmodeldepends.
Thisstepisvitalfordrugdevelopmentandclinicaldecision-making.
In this paper, we define a novel task in response to the challenges mentioned above: discovering predictive imaging
biomarkersdirectlyfromimagedatainadata-drivenway,withoutrequiringhandcraftedfeaturesoraseparatefeatureextraction
step. Weintroduceanevaluationprotocoltailoredtothistaskandprovideexperimentsasaproof-of-concept,demonstrating
how a multi-task learning CATE estimation model can be used to discover predictive biomarker candidates (Fig. 2). We
use statistical testing to investigate how the estimated treatment effect depends on varying predictive signal strengths and
enabletheverificationandinterpretationofthediscoveredpredictiveimagingbiomarkercandidatesbyevaluatingourmodel
usingexplainableartificialintelligence(XAI)methods35–39. ByapplyingXAImethodsweprovidevisualexplanationsofthe
black-boxmodelpredictionsbycreatingattributionmapsbasedoninputimagesandtherebyfacilitatetheinterpretationof
thepredictiveimagingbiomarkerscandidatesidentifiedbyourmethod. Ourexperimentaldesignutilizespre-definedimaging
biomarkers with varying predictive and prognostic effects on synthetic outcomes, enabling us to benchmark our model’s
performanceonrealimagedata. Theexperimentsonnaturalandmedicalimagesdemonstratethatourimage-basedCATE
estimationmodelcanidentifypredictiveimagingbiomarkerswithamuchhigherpredictivestrengthcomparedtoabaseline
thatdoesnotdistinguishbetweenprognosticandpredictiveeffects. Ourexperimentaldesignfurtherallowsustoinvestigate
2/19a. Method Training b. Method Inference
Multi-task learning Group-specific loss Treatment effect
estimation
Image Image
Prognostic biomarker Predictive biomarker Subtract Network layer Outcome Treatment effect
c. Evaluating the Estimated Treatment Effect d. Experiments: Simulation of Outcome
Fitting strength parameters
t-test t-test
Control group data (T=0) Image
Treatment group data (T=1)
Biomarker strength (pre-
Prognostic/predictive: Effect strength Biomarkers (from image)
defined)
Figure2. Overviewoftheidentificationofpredictivebiomarkersfrompre-treatmentimages. The(a)trainingand(b)
inferencestepemploysamulti-tasklearningarchitecturetoestimatetreatmenteffectsτˆfromimages. Intheevaluationstep(c)
thepredictivestrengthoftheestimatedτˆ,thepredictivebiomarkercandidate,isassessedusingregression. Inoursimulation
experiments(d),theoutcomedataY usedinourexperimentsaresimulatedwithimagefeaturesfromgroundtruthannotations
i
andrandomlyassignedtreatmentsT.
whetherthepredictiveimagingbiomarkersidentifiedbyourimage-basedCATEestimatorcanbeattributedtothecorrect
groundtruthfeatures.
Methods
Treatmentheterogeneityandpredictivebiomarkers
Wedescribehowtreatmenteffects,whichcannotbeobserveddirectly,canbeestimatedfromdatabyintroducingtheconceptof
potentialoutcomes. Here,weconsiderpre-treatmentimagesanddatacollectedthroughrandomizedcontrolledtrials(RCTs),
the typical experimental setting for discovering biomarkers in clinical research. The relation between outcomes, defined
by aproblem-specific measure of interest, and treatmenteffect has beendescribed by theNeyman-Rubincausal model40,
wheretheindividualtreatmenteffect(ITE)foranindividualiisdefinedasthedifferencebetweenpotentialoutcomesY(T),
i
ITE:=Y(T =1)−Y(T =0). Here,weassumeabinarytreatmentvariableT ∈{0,1}forwhetheratreatmentisappliedor
i i
not. InRCTs,T israndomlyassignedandindicateswhetheranindividualbelongstothecontrolgroup(T =0)ortreatment
group(T =1). SinceitisnotpossibletoobservethecounterfactualoutcomesandthusmeasuretheITEduetothefundamental
problemofcausalinference,inpractice,theconditionalaveragetreatmenteffect(CATE)τ
τ(x):=E[Y(T =1)−Y(T =0)|X =x] (1)
isestimatedinstead. TheCATEdependsonobservablepre-treatmentcovariatesx∈X,whichcanforexamplebeextracted
fromimagesI. Inmedicalapplications,suchcovariatesthatmeasureimagefeaturesarecalledimagingbiomarkers. Only
heterogeneoustreatmenteffects,i.e. effectsthatvaryamongindividualsandcovariatesx,arerelevantformakingtreatment
decisionsorsubgroupselection. Therefore,weareinterestedinidentifyingcovariatesthatdirectlycontributetowardsthe
heterogeneoustreatmenteffectandinteractwiththetreatment,alsoknownaspredictivebiomarkers. Undertheassumptionthat
prognosticeffects f andpredictiveeffects f areadditiveasin
prog pred
E[Y(x)]= f (x)+f (x)T, (2)
prog pred
theCATEdefinedinequation(1)yields f (x),whichonlydependsonpredictivebiomarkersx . Inthiscase,treatment
pred pred
effect estimation automatically separates prognostic and predictive effects and thus identifies predictive biomarkers x .
pred
3/19Generally,abiomarkercanbebothprognosticandpredictiveatthesametimeifitcontributestoboth f (x)and f (x).
prog pred
Figure1depictstherelationshipbetweenbiomarkersx orx andoutcomesY.
pred prog
Image-basedtreatmenteffectestimator
Toenablethediscoveryofpredictiveimagingbiomarkers,weleverageaneuralnetwork-basedCATEestimator. Specifically,
we adapt a TARNet model19 originally designed for tabular inputs to image inputs, similar to the network described by
Durso-Finleyetal.28. Thenetworkhassharedconvolutionallayersasencoderstofacilitatelearningthesimilaritiesbetweenthe
controlandtreatmentgroupsarisingfromprognosticeffects41,alongsidetwotreatment-specificoutputheadsforpredicting
thecorrespondingoutcomeY(T). Duringthetrainingofourmulti-tasklearningmodel(Fig.2a), weapplythelosstothe
correspondinghead,dependingonwhichRCTgrouptheinputdatabelongsto. Ineachtrainingstep,thetotallossiscalculated
asthesumofthelossofthecontrolgroupheadoutputandthetreatmentgroupheadoutput,sothattheweightsofbothheads
areupdatedindependently. Subsequentlyduringinference(seeFig.2b),theCATEisestimatedbysubtractingthemodel’s
controlgroupoutputfromthetreatmentgroupoutput: τˆ=Yˆ(T =1)−Yˆ(T =0). Incontrasttothetwo-headedmodel,we
i i
expectastandardpredictionmodelwithasingleheadtolearntopredicttheaverageoutcomeacrossgroupsfrombothpredictive
andprognosticbiomarkers,asitdoesnotdifferentiatebetweenthetreatmentgrouporcontrolgroup. Thepredictedoutcome
ofsuchanetworkisthecompositionofbothpredictiveandprognosticeffects. Itisthereforeusedasabaselinetovalidate
whethertheCAestimatorcouldsuccessfullydiscoverapredictivebiomarker.
Proposedevaluation
Statisticalevaluationofthepredictivestrength
Wetesttheinteractionbetweenthebiomarkercandidateandtreatment,asseeninFig.2c,toverifywhethertheestimatedCATE
τˆisindeedpredictiveandcanbeconsideredapredictivebiomarkercandidate. Suchanevaluationisalsoperformedinclinical
practice3,42. Weassumealinearrelationshipbetweenbiomarkersandoutcome(equation(2))andperformalinearregression
oftheoutcomesY withtheformula
β +β T+β τˆ+β τˆT ∼Y, (3)
0 T τˆ τˆ,T
whichincludesaninteractiontermβ τˆandcoefficientsβ.Wetestthenullhypothesisthatthebiomarker-treatmentinteraction
τˆ,T i
coefficientisβ =0usingtheStudent’st-testwiththet-valuet teststatistic,whichisproportionaltotheestimatedβˆ .
τˆ,T βτˆ,T τˆ,T
Thistestisadditionallyrepeatedwiththeotherfitcoefficientsβ. Thet-valueratiot /t =:t /t canbeusedasan
i βτˆ,T βτˆ pred prog
indicatorforthepredictivestrengthoftheestimatedCATEτˆiscomparedtoitsprognosticstrength.Toestimatetheexperimental
lower(prognostic)andupper(predictive)boundfortherelativepredictivestrength,weconductthesameevaluationwitheither
apurelyprognosticorapurelypredictivegroundtruthbiomarkerandreplaceτˆinequation(3).
Interpretationusingfeatureattributionmethods
WealsoinvestigatewhichinputimagefeaturesthetrainedmodelissensitivetowhenpredictingtheCATEτˆ andwhether
theycorrespondtopredictiveimagingbiomarkers. Sinceadirectquantitativeassessmentisnotstraightforwardforgeneral
imagefeatures,unlikefortabulardata,werelyonvisualexplanationsthroughattributionmaps35 instead. Tothisend,we
employtheXAImethodsexpectedgradients(EG)37andguidedgradient-weightedclassactivationmapping(GGCAM)38,39to
generateattributionmapsfromthetrainedmodelandinputimages. Theattributionmapsenableustovisuallyanalyzehow
muchindividualpixelscontributetoeithertheprognosticeffectviatheattributionmapofthecontrolgroupheadprediction
Yˆ(T =0)orthepredictiveeffectviatheattributionmapoftheestimatedCATEYˆ(T =1)−Yˆ(T =0).
Simulationofimagingbiomarkersandoutcomesforvalidation
To study the CATE estimator’s ability to identify predictive imaging biomarkers in the presence of prognostic imaging
biomarkers,weconductexperimentsondatawithvaryingpredictiveandprognosticbiomarkerstrengths. Sincegroundtruth
counterfactualtreatmentoutcomesareunavailableinrealdata,wegeneratesyntheticdatatoexperimentallyverifyourmodel
andsimulatethegroundtruthtreatmentoutcomes(Fig.2d). Weintroduceanovelapproachforsimulatingoutcomesbased
onimagingbiomarkerswhereweassignimagefeaturestobiomarkervaluesx insteadofdirectlysimulatingoutcomes
prog,pred
fromtabularbiomarkers. Thisentailsselectingfeaturesfromavailableimageinformationsuchasattributes,classlabels,or
radiomicsfeatures,asshowninFig.3. Inourexamples,thebiomarkersareeitherpurelyprognosticorpredictiveandcantake
onbinaryorcontinuousvaluesdependingonthedataset. TheoutcomesY arethengeneratedaccordingtoasimplelinear
function,whereweassumethatnooffsetb andconstanttreatmenteffectb arepresentforsimplicity
0 T
Y(T,x)=b x +b x T, (4)
prog prog pred pred
4/19similartoacaseconsideredbyKrzykallaetal.43. Animportantaspectofusingsimulatedoutcomesisthatwecancontrolthe
sizeofprognosticorpredictiveeffectsbychoosingdifferentvaluesforparametersb . Thebiomarkerparameterstrength
prog,pred
ratiob /b canbeinterpretedasameasureofthesignal-to-noiseratioofthepredictiveeffectintheinputdata. Sincewe
pred prog
consideranRCTsetting,thetreatmentvariableT ∈{0,1}ischosenrandomlywithprobabilities p(T)=0.5.
ExperimentalSetup
Datasetsandimagingbiomarkerfeatures
1 2 1 2 1 2 1 2
Discrete digit is 1, 2, 3, 4, digit is primary color bill is longer has has pigment Continuous energy flatness
features 5 or 7” (i.e. green is white than head globules network features (i.e. magnitude of voxel (i.e. ratio of principal
has no circle) values incl. offset) components)
Both Both
features features
true high
Both Both
features features
false low
Figure3. ImagefeaturesfromtheCMNIST,CUB-200-2011,ISIC2018,andNSCLC-Radiomicsdatasets. Eitherfeature1or
2isdesignatedasapredictiveorprognosticbiomarkerinourexperiments. ISIC2018skinlesionfeaturesareshownwiththe
correspondinggroundtruthmasks. Globules(lightgreenmask)manifestasdarkerdots,whereaspigmentnetworksare
characterizedbydarkgrid-likepatternsofstreakswithlighter“holes”(darkbluemask). TheNSCLC-Radiomicsimages
displaytumorsegmentationoutlinesofa2Dslice(left)orcorresponding3Dsegmentationvolumes(right). Examplesonthe
bottomrowdepictimageswherebothbiomarkersareeitherabsent(firstthree)orhavealowvalue(NSCLC-Radiomics).
WeevaluateourCATEestimatoronfourdiversepubliclyavailabledatasetsalsoshowninFig.3:coloreddigits(MNIST44,45)
withsemi-synthetic imagefeatures, imagesof differentbird species(CUB-200-201146)as anexample ofa naturalimage
dataset,aswellasskinlesionimages(ISIC201847,48)and3Dlungcomputedtomography(CT)scansofnon-smallcelllung
cancer(NSCLC)tumors(NSCLC-Radiomics49)asexamplesofreal-worldmedicaldatasets.
ColoredMNIST(CMNIST). WeadapttheMNISTdatasetconsistingof60,000trainingimagesofhandwrittendigitsofsize
28×28andintroducecolorasanimagefeature. Thecoloroftheforegroundpixelsofthedigitsisdeterminedbasedonthe
randomvariablex sampledfromabinomialdistribution(withequalprobability p=0.5). Wedefinethefollowingsetofbinary
i
featuresasimagingbiomarkersx ∈{0,1}: (a)thecolorofthedigitbeinggreenornotasprognosticfeatureanddigits
pred,prog
nothavingaloopornot(i.e. {1,2,3,4,5,7}vs. {0,6,8,9})asthepredictivefeatureor(b)viceversa.
Birdspeciesdataset(CUB-200-2011). ThedatasetincludesRGBimagesof200differentbirdspecies,5,794fortestingand
5,994fortraining,whichwefurthersplitintotrainingandvalidationdatawitha80%/20%split. Fromthebinaryattributesof
thebirds,weselecttwovisuallydistinctbiomarkersx ∈{0,1}withhighannotatorcertainty: (a)“hasprimarycolor:
pred,prog
white”astheprognosticfeatureand“hasbilllength: longerthanhead”asthepredictivefeatureor(b)viceversa.
Skinlesiondataset(ISIC2018). TheISIC2018datasetcontainsRGBimagesofskinlesionswithadesignatedtraining
datasetof2,594images,whichissplitintoatrainingandvalidationsetofsizes2,075and519respectively. Finalevaluationsare
performedonthedesignatedvalidationsetwith100images. Weidentifydermoscopicattributes,i.e.visualskinlesionpatterns,
usinggroundtruthsegmentationmasksandassigntheirpresencetobiomarkers. Infeatureset(a)thepresenceofglobules
isprognosticandthepresenceofapigmentnetworkispredictive,orin(b)viceversa. Bothfeatureshavebeenevaluatedas
imagingbiomarkersfordiagnosingmelanoma50,51 makingthemrealisticexamplesofbiomarkers. Unlikethefeaturesofthe
previousdatasets,thesefeaturesarebasedonthepresenceofpatternsratherthanlocalizedfeaturesorcolorvalues.
LungcancerCTdataset(NSCLC-Radiomics). Thisdatasetcomprises4153DCTvolumesofpre-treatmentscansofNSCLC
patientsandgroundtruthsegmentationmasksofthelungtumorvolumes. Wecropthevolumestothelargestconnectedtumor
volumeboundingbox, use332samplesfor5-foldcross-validation, andreserve83fortesting. Wedefinetwocontinuous,
uncorrelatedradiomicsfeaturesdescribedbyZwanenburgetal.52 asbiomarkers,whichhavebothbeenevaluatedfortheir
prognosticorpredictivevaluebefore8,53: (a)theshaped-basedfeature“flatness”describingtheratiobetweenthesmallestand
largestprincipaltumorcomponentsasaprognosticfeatureandthefirst-orderstatisticsfeature“energy”characterizingthe
sumofsquaresoftumorintensityvaluesasapredictivefeatureor(b)viceversa. Theflatnessfeatureisinversetotheactual
5/19flatnessofthetumor. Valuescloseto0indicateflatshapes,whereasvaluescloseto1indicatesphere-likeshapes. Energy
dependsstronglyonbothvolumeandminimumpixelintensityvalueastheminimumintensityvalueisaddedasanoffset. The
radiomicsfeatureswereextractedfromthetumorvolumewithPyRadiomics54usingthegroundtruthsegmentationmaps.
We split all datasets randomly into two equally sized subsets: a control group (T =0) and a treatment group dataset
(T =1)andgenerategroup-specificoutcomesY(T,x)accordingtoequation(4). ForeachCMNISTfeatureset,wechoosethe
biomarkerstrengthparametersb ∈{0.0,0.1,...,1.0},resultingintraining121models. Fortheremainingdatasets,we
pred,prog
choosethebiomarkerstrengthparametersb ∈{0.0,0.2,0.4,0.6,0.8,1.0},resultingin36differenttrainedmodels.
pred,prog
Implementationdetails
Inourexperiments,thetwo-headedCATEestimationmodelsareallbasedontheResNetarchitecturetailoredtoeachdataset.
FortheCMNISTexperiments,weutilizeaMiniResNet(ResNet-14)with14layers,0.20Mparameters,andonlythreebuilding
blocks. IntheCUB-200-2011andISIC2018experiments,weemployatwo-headedResNet-18with11.18Mparameters,and
fortheNSCLC-Radiomicsatwo-headed3DResNetwith33.30Mparameters. Inallarchitectures,thetreatment-specificheads
consistofeitherthelastfullyconnectedlayerorthelastfourfullyconnectedlayersforNSCLC-Radiomicsexperiments. Its
precedingconvolutionallayerslearnsharedpresentationsofcontrolandtreatmentgroupdata. Weusetheclassic(one-headed)
versionofthecorrespondingResNetarchitecturesasourbaselinemodels. ThemodelsforCMNISTaretrainedfor400epochs
withamini-batchsizeof1000. ForCUB-200-2011andISIC2018,themodelsaretrainedwithamini-batchsizeof64andfor
1000or2000epochsrespectively. TheNSCLC-Radiomicsmodelsaretrainedwithabatchsizeof8and2000epochs. Fordata
alldatasets,weusethemeansquarederrorlossfunction,alearningrateoflr=0.001,andtheSGDoptimizer.
Forpreprocessing,weapplyzeropaddingofsize2toeachedgeoftheCMNISTimages. TheCUB-200-2011imagesare
resizedsotheirsmalleredgehasthesize256. Weaugmentthedatabyperformingrandomcropandhorizontalflipssothat
allfinalimageshavethesize224×224. WeresizetheISIC2018imagesto224fortheshorteredge,cropthemtobetween
40%and100%oftheirprevioussize,andresizethemagaintosize224×224. Weaugmentthemwithrandomhorizontaland
verticalflips,randomlyappliedrotationsby90degreesandcolorjitters. DuringtheinferenceofbothCUB-200-2011and
ISIC2018images,centercropsareused. All2Dimagesarenormalizedbysubtractingthemeananddividingbythestandard
deviationoftherespectivechannelfromthetrainingdataset. FortheNSCLC-Radiomicsdataset,weaddedpaddingofvalue
-1024(HU)sothatall3Dpatchesareofthesize162×162×54. Allradiomicsfeaturesarenormalizedbysubtractingthe
meananddividingbythestandarddeviationofeachfeature. 3DimageaugmentationsareimplementedusingtheMONAI
deep-learningframework55andincluderandomflipping,randomrotationby90degreesalongthexyaxis,andrandomzooming
withprobability0.5byafactorintherange[0.9,1.1]. Resamplingtothemedianspacingofthedataset[0.9765625,0.9765625,
3.0]mmisbasedonIsenseeet.al56andusesathird-ordersplinein-planeandnearest-neighborinterpolationout-of-plane.
Forthestatisticalevaluations,linearregressionusingordinaryleastsquaresandt-testsforthefitcoefficientsasdescribed
insection“ProposedEvaluation”areperformedusingthestatsmodelspythonmodule57. Tocreateattributionmaps,weuse
expectedgradients(EG)37forCMNISTandguidedgradient-weightedclassactivationmapping(GGCAM)38,39fortheother
threedatasets. UsingEGallowsustodeterminetheattributionofeachcolorchannelincontrasttoCAMmethods,whichis
vitalfordiscoveringthecolor-relatedCMNISTbiomarkers. BothmethodsareimplementedusingCaptum58andenhancedby
SmoothGrad59tomaketheattributionmapslessnoisyandmorerobust.
Results
PredictivestrengthoftheestimatedCATE
WepresenttheresultsofourquantitativeexperimentalvalidationprotocolinFig.4,wheretheestimatedrelativepredictive
strength|t /t |providesinsightsintoitsdependencyontherelativesizeofthetruepredictiveeffectb /b usedinthe
pred prog pred prog
outcomesimulationasdescribedinFig.2c-d. Absoluteratiosareplottedforabettercomparison.
Acrossthefourdatasets,ourCATEestimationmodelshowsincreasingrelativepredictivestrengtht /t withincreasing
pred prog
relativepredictivebiomarkersignalstrengthb /b . Itsurpassesthebaselinemodelsinmostcases,especiallyforlow
pred prog
b /b . WhiletheCMNISTresultsaresimilarforbothmodelstrainedonbiomarkersets(a)and(b),thedifferenceismore
pred prog
pronouncedfortheotherthreedatasets,indicatingagreaterinfluenceofthechoiceofbiomarkersonthepredictions.
OurmodeldemonstratesthebestperformanceontheCMNISTdatasetoutofallfourdatasets. Thisisevidentfromthe
significantlylargergapbetweenourmodelandbaseline,forexample,reachingafactorintheorderof102forb /b inthe
pred prog
rangeof0and1,andfromtheresultsbeingmuchclosertotheupperboundthanthelowerbound.
Although the relative predictive strength for the CUB-200-2011 dataset is lower than that for the CMNIST, it is still
significantlyabovethelowerbound,andclosertotheupperbound.Forb /b intherangeof0and1,themediant /t
pred prog pred prog
differsfromthebaselinebyafactorof10and5forbiomarkersets(a)and(b)respectively. Here,thedependencyonthechoice
ofbiomarkersisevidentfromthesmallergapbetweentheboxplotsofourmodelandbaselineinset(b)comparedto(a).
6/19CMNIST CUB-200-2011 ISIC 2018 NSCLC-Radiomics
(Colored Digits) (Bird Species) (Skin Lesions) (Lung Cancer CT)
a 104 103 103 103
103 102 102 102
102
101 101 101
101
100 100 100 100
10−1 x 2*10² signal
10−1 10−1 10−1
10−2
10−2 10−2 10−2
10−3
10−4 10−3 10−3 10−3
0 1 2 3 4 5 0 1 2 3 4 5 0 1 2 3 4 5 0 1 2 3 4 5
bpred/bprog bpred/bprog bpred/bprog bpred/bprog
b 104 103 103 103
103 102 102 102
102
101 101 101
101
100 100 100 100
x 2*10² signal
10−1
10−1 10−1 10−1
10−2
10−2 10−2 10−2
10−3
10−4 10−3 10−3 10−3
0 1 2 3 4 5 0 1 2 3 4 5 0 1 2 3 4 5 0 1 2 3 4 5
bpred/bprog bpred/bprog bpred/bprog bpred/bprog
ours (two heads) baseline (single head) upper bound (predictive) lower bound (prognostic)
Figure4. Modelperformancebasedontherelativepredictivestrengtht /t oftheCATEshownonalogarithmicscale.
pred prog
Wecompareourtwo-headedCATEestimatorwithaone-headedbaselinemodelacrossdifferentsimulationparameters
b /b (i.e.relativesizeofthepredictiveeffectinthesimulatedoutcomes). Theboxplotssummarizedataaveragedover
pred prog
b /b -binwidthsindicatedbythehorizontalerrorbarsoverthemedianline. Rows(a)and(b)indicateadifferentsetof
pred prog
prognosticandpredictivefeaturesusedforgeneratingthedata(seesection“Datasets”andFig.3). Thehorizontalgreydotted
lineislocatedatt /t =1. Thevarianceofboxplotsisaffectedbythedifferingnumberofsampleseachbincontains.
pred prog
TheISIC2018resultsshowsmallerabsolutevaluest /t ,yettherelativepredictivestrengthmeanvaluesremainabove
pred prog
1,exceptfortwooutliersathighb /b astheyarebasedononlyasinglesample. Inset(a),theabsolutet /t values
pred prog pred prog
arehigherandmuchclosertotheupperboundthanthelowerboundbutexhibitgreaterboxplotoverlapswiththebaseline
forlowb /b comparedtoset(b),where“hasglobules”ispredictive. Inset(b),themediansdifferbyafactorof4for
pred prog
relativeb /b intherangeof0and1. Thelargebaselinevaluessuggestthatthebaselinemodelalsostronglyreliesonthe
pred prog
predictivebiomarker“haspigmentnetworks”.
On the NSCLC-Radiomics dataset, our model demonstrates larger gaps in terms oft /t between our model and
pred prog
baselineparticularlyforsmallerb /b . However,thegapsdecreaseslightlywithincreasingb /b forbiomarkerset
pred prog pred prog
(b). Theperformancediffersbetweenbiomarkersets(a)and(b),withmediansofourmodelsandbaselinedifferingbyafactor
of13and4respectivelyforb /b intherangeof0and1.
pred prog
Interpretationofpredictiveimagingbiomarkersusingfeatureattribution
InFig.5,weillustrateourXAI-basedevaluationschemetoassesswhethertheimagefeaturesidentifiedbyourCATEestimation
modelaspredictiveandprognosticbiomarkerscorrespondtothegroundtruthbiomarkers. Byapplyingattributionmethods36–39
toourmodelandaninputimage,weobtainanattributionmap,indicatingpositive(blue)andnegative(red)attributionfrom
eachpixeltotheprediction. WeshowattributionmapsofthepredictedCATEoutputYˆ(T =1)−Yˆ(T =0),whichisexpected
tobesensitivetoonlythepredictivebiomarkersasdepictedinFig.2bandthecontrolgroupheadYˆ(T =0),whichisexpected
tobesensitivetotheprognosticfeature. Here,theresultsarebasedonmodelstrainedwithb ,b =1.0.
pred prog
FortheCMNISTexamples,theattributionmapsofthepredictedCATEoutputYˆ(T =1)−Yˆ(T =0)showmostlynegative
attributioninthegreenchannelofthefirstexample,whichcorrespondstothefactthatthepredictivebiomarker“hasnocircle”
isabsentintheinputimage. Similarly,thetreatmenteffectattributionmapsofthesecondexample(reddigitfour)showweaker
negativeattributionfromthedigitintheredchannelwithsomenoisypositiveattributioninthebackground. Morepositive
attributioncanbeobservedinthegreenchannel,indicatingthatthemodelcorrectlyinfersthatthepredictivebiomarker“hasno
circle”ispresent. ThecontrolgroupheadoutputYˆ(T =0)correctlyidentifiestheprognosticbiomarker,i.e.“digitisgreen”,in
7/19
|gorpt/derpt|
|gorpt/derpt|
|gorpt/derpt|
|gorpt/derpt|
|gorpt/derpt|
|gorpt/derpt|
|gorpt/derpt|
|gorpt/derpt|CMNIST CUB-200-2011 ISIC 2018 NSCLC-Radiomics
Slice 33/54 Slice 27/54
Image feature ground truth: False True True False False True True False True False 3.65 (High) 0.95 (High) -0.28 (Low) -0.44 (Low)
Treatment effect “has no circle” “has no circle” “bill > head” “bill > head” “has pigment network” “energy” “energy”
attribution
Predictive
biomarker
defined as…
Control group “is green” “is green” “is white” “is white” “has globules” “flatness” “flatness”
head attribution
Prognostic
biomarker
defined as…
Tumor segmentation Positive attribution Negative attribution
Figure5. Attributionmapsforthecontrolgroupnetworkhead(lastrow)andthepredictedCATEoutput(middlerow)for
differentexampleimagesfromeachdataset(toprow). SpecificallyfortheCMNISTdataset,wepresenttheattributionforeach
RGBcolorchanneloftheimage(red: left,green: top,blue: right),asthecolorisvitalinformationtothebiomarkerprediction.
Theadditionalzoomed-inpatchoftheISIC2018attributionmapisoverlaidwithagrayscaleversionoftheoriginalimage. For
theNSCLC-Radiomicsdataset,sagittalslicesofthe3Dpatchesareshownwithoutlinesofsegmentedtumorsinorange.
therespectivecolorchannel,whichisevidentfromthemainlypositiveattributioninthegreencolorchannelinthefirstexample
andnegativeattributionintheredcolorchannelforthesecondexample. Fortheattributionmapsofbothoutputs,onlynoisy
attributionispresentforthebluechannel,suggestingthatthemodeldoesnotusethischannelforprediction.
InthefirstCUB-200-2011example,wherethepredictivebiomarker“billislongerthanhead”isabsent,theattributionmap
fortheYˆ(T =1)−Yˆ(T =0)outputispredominantlynegative. Itmainlycoverstheeye,andoutlinesofthethroatandbreast.
However,theattributionisnotaslocalizedtoaspecificregionasinthesecondexample,wherethepredictivebiomarkeris
presentandtheoverallattributionispositive. Here,itisapparentthatfeaturesoftheheadareprimarilyusedforthepredictions,
whilethemainbodyandwingsareignored,reinforcingtheimportanceofthebillandheadregionfordeterminingthepredictive
biomarker. TheattributionmapfortheYˆ(T =0)outputshowsoverallpositiveattribution,especiallyinthewhiteheadand
breastregionfromthefirstimageofaprimarilywhitebird. Forthesecondimageofadarkerbird,theattributionmapisoverall
negative,particularlyinthedarkwing,mainbody,andpouchregion. Thesepatternsindicatethatthemodelcorrectlyidentifies
thepresenceorabsenceoftheprognosticbiomarkerinthecorrespondingexample.
TheISIC2018imagedepictsapigmentnetworksurroundingadarkerpigmentedcenter. Uponcloserexaminationofthe
attributionmapoverlaidwiththeoriginalimage,severalpatternsbecomeapparent. However,theallocationofpositiveor
negativeattributiononlyprovideslimitedinsight,possiblyduetotheintricatenatureoftheimagefeatures. Intheattribution
mapsofthetreatmenteffectYˆ(T =1)−Yˆ(T =0),positiveattributionsaregiventotheperipherysurroundingoutsideofthe
darkcenterwherealsothepigmentnetworkislocated. Notably,themodelreliesonthelighter,lesspigmentedgapsbetweenthe
darkgrid-likeorvein-likestructurestodetectthepigmentnetwork. Thissuggeststhatthegapscontainsufficientinformation
fordetectingthepigmentnetwork,astheyonlyattributepositivelytothepigmentnetworkoutput. Theattributionmapforthe
Yˆ(T =0)headrevealsthatthemodelprimarilyusesthedarkcenterofthelesionforcontrolgrouppredictions. Theredand
bluespotsinthemapindicatethemodel’ssearchforthesmallglobuledots.
InthefirstNSCLC-Radiomicsexample,thehighestabsolutevaluesoftheYˆ(T =1)−Yˆ(T =0)outputattributionmapsare
observedwithinthetumorarea. Whiletheattentionmapsshownegativeattributionsinthedarkerareaofthetumor,positive
attributionscanbeseeninthesurroundingareas,indicatingthepresenceofastrongpredictivebiomarker. Thisobservationis
consistentwiththegroundtruth,wheretheenergyvalueiscomparablyhigh,whereasmostlynegativeattributionsareobserved
forthesecondexamplewithalowerenergyvalue. However,theattributionsaremainlygiventotheareasoutsidetheoutlineof
thetumor,potentiallyduetothenetwork’sdifficultyincorrectlyidentifyingthetumorboundary. Theattributionmapsforthe
Yˆ(T =0)headshowstrongattributionsmainlyoutsidethetumoroutline,whichrelatestotheprognosticbiomarkerflatness.
Additionally,artifactsaroundthebordersuggestthatthepatchshapescontributepartiallytotheprediction.
FurtherresultsandamoredetailedqualitativeXAIanalysiscanbefoundinSupplementaryFig. 1-6andSupplementary
section“Additionalfeatureattributionsresultsforinterpretingofpredictiveimagingbiomarkers”.
8/19Discussion
Inthispaper,weintroducethetaskofidentifyingpredictiveimagingbiomarkersandanapproachtosolvingthistaskusing
image-basedCATEestimators,whichenablethediscoveryofnewpredictiveimagingbiomarkerswithoutpossiblybiased
handcraftedfeaturesorimagefeatureextractors. Thisalsomakesdetectingevenabstractconceptsfromhigh-dimensionaldata
possible,asdemonstratedbyourexperiments. Weillustratehowsuchamodel’sperformanceinidentifyingvarioustypesof
predictiveimagingbiomarkerscanbestudiedintwoways: (1)thequantitativeperformancerelativetoprognosticinteractions
and(2)thequalitativeperformancebycomparingattributionmapstothepre-definedgroundtruthimagingbiomarkers.
Theresultsshowahighrelativepredictivestrengtht /t whencomparedtoourexperimentalbaselineaswellasour
pred prog
experimentalupperandlowerbound. TheseresultssuggestthattheestimatedCATEisareliablemeasureforthepredictive
effectandthepredictivebiomarkeritselfundertheassumptionofalinearbiomarker-outcomerelation. Wecanalsoconclude
fromthecomparisonwithourbaselinethat,inmostcases,ourmodelisabletoidentifythepredictivebiomarkersfromour
simulateddatawhilenotbeingaffectedbyprognosticbiomarkers. Theresultsdemonstratethatthemodelcandosofordifferent
typesofbiomarkersandinputimages,evenwhenpredictiveeffectsaresmallerthanprognosticeffectsforb /b <1,
pred prog
whichisoftenobservedinreal-worldscenarios. However,exceptionsintheperformanceoccurfortheCUB-200-2011,ISIC
2018,andNSCLC-Radiomicsdataset,particularlywhenb /b islargeandwherethet /t valuesareclosetothe
pred prog pred prog
baseline. Theweakerperformanceofthemodelinthesecasesmightbeduetothemodel’sloweraccuracyinpredictingthe
outcomesY whenfacingmoreabstractfeatures. Also,theimbalanceanddistributionofimagefeaturesfoundinthedatasets
likelycontributetothepredictionaccuracy. IntheISIC2018dataset,theareacoveredbythepigmentnetworkismuchlarger
thanthatcoveredbyglobules,causingthebaselinemodeltobebiasedtowardspredictingpigmentnetworks. Thisalsoexplains
whyt /t ishigherforbiomarkerset(a)with“hasapigmentnetwork”asthepredictivebiomarker,comparedtoset(b)
pred prog
with“hasglobules”asthepredictivebiomarker. FortheNSCLC-Radiomics, themodelperformsbetteratidentifyingthe
“flatness”featurethanthe“energy”feature,whichhasahighlyright-skeweddistributionwithsomeoutliersathighvalues. In
practicalapplicationswithunknownpredictiveeffects,aquantitativeevaluationwouldentailperformingregressionandt-tests
ontheregressionparametersasdescribedinsection“ProposedEvaluation”toassessthemodel’sabilitytoidentifyinformation
relevantfortreatmenteffects(i.e.predictivebiomarkers).
Acrossallfourdatasets,thetreatmenteffectattributionmapsgeneratedbyourmodelcorrespondtotheimagefeatures
chosenaspredictivebiomarkers,empiricallydemonstratingthattheimage-basedCATEestimatorisindeedabletoidentifythe
correctpredictivebiomarkersautomatically. Thisholdsforbothlocalizedfeaturesbasedoncolorandshape(CMNIST,CUB-
200-2011,NSCLC-Radiomics),aswellasfirst-orderstatistics(NSCLC-Radiomics)orpatterns(ISIC2018). Inapplications,
ourpreviouslydescribedXAIanalysisisessentialforidentifyingandinterpretingpredictiveandprognosticimagingbiomarkers.
Unliketabulardata,imageslackdiscretecandidatesforassigningafeatureimportancescore. Consequently,distinguishing
betweenpredictiveandprognosticimagingbiomarkersusingattributionmapsbecomeschallengingwhenlocatedinthesame
imageareas. Theheatmapfocusesonthesamepixels(asinthecaseofenergyandflatnessinthelungcancerCTexample),
makingitdifficulttodiscernwhetheranimagefeaturethatisbothpredictiveandprognosticispresent,oriftwoindependent
imaging biomarkers with distinct meanings are simply spatially overlapping. In such cases, other XAI methods such as
counterfactualexplanations60canbeemployedtoquantifytheeffectofdifferentpropertiesofthesamefeature. Eventhough
ourfeatureattributionevaluationmaybepotentiallyambiguousforabstractbiomarkers,forexample,duetonoise,itcanoffer
valuableinsightsintowhichfeaturesthemodelusesforitspredictionsandtheinterpretationofpredictivebiomarkercandidates.
Whileweacknowledgethelimitationsofusingonlysemi-syntheticdataduetothecurrentunavailabilityofpublicRCT
imagedatasetswithverifiedpredictiveimagingbiomarkers,wealsoemphasizeitsadvantage. Semi-syntheticdataenablesusto
gaininsightsanddemonstratetheperformanceofCATEestimationmodelsinareproducibleway,asdiscussedbyCurthetal.2
andCrabbéetal.25. Ourpredictiveimagingbiomarkerdiscoveryandevaluationapproachdoesnotrelyonhandcraftedfeatures
suchasradiomics. Instead,weuseradiomicsfeaturesasbiomarkerstosimulateoutcomesinourexperiments,servingmerely
asabaselineforconductingperformancecomparisons.
The approach described in this work provides a foundation for future imaging biomarker research aiming to discover
novelpredictiveimagingbiomarkersfromdiverseimagingmodalitiesandwithindifferentproblemsettings. Thismayinvolve
addressingnon-linearbiomarker-outcomerelations,e.g.survivalortime-to-eventdata,andmitigatingconfoundingeffectsin
observationaldata. Theexperimentsandanalysismethodsweoutlineinthispaperofferinitialinsightsfordevelopingimage-
basedCATEestimationmethodstailoredtospecificproblems. Thiscouldincludeusingdifferentnetworkarchitecturesfor
visiontasksandCATEestimatorsthatpreviouslyhavebeenappliedtoonlytabulardata. Overall,webelievethatimage-based
CATEestimatorscanserveasavaluabletoolfordiscoveringpreviouslyunknownpredictivebiomarkersfromimagingdata,
therebyenhancingtreatmentdecision-makingforpersonalizedmedicineandotherfields.
9/19Data availability
Alldatasetsanalyzedinthisstudyarepubliclyavailable. TheMNISTdatasetcanbeaccessedathttp://yann.lecun.
com/exdb/mnist/, theCUB-200-2011datasetathttp://www.vision.caltech.edu/datasets/cub_200_
2011/,theISIC2018datasetathttps://challenge.isic-archive.com/data/#2018,andtheNSCLC-Radiomics
datasetathttps://www.cancerimagingarchive.net/collection/nsclc-radiomics/.
References
1. Lohr,K.N. Outcomemeasurement: conceptsandquestions. Inquiry37–50(1988).
2. Curth,A.,Svensson,D.,Weatherall,J.&vanderSchaar,M. ReallydoinggreatatestimatingCATE?acriticallookat
MLbenchmarkingpracticesintreatmenteffectestimation. InThirty-fifthConferenceonNeuralInformationProcessing
SystemsDatasetsandBenchmarksTrack(Round2)(2021).
3. Ballman, K.V. Biomarker: predictiveorprognostic? J.clinicaloncology: officialjournalAm.Soc.Clin.Oncol.33,
3968–3971(2015).
4. O’Connor, J. P. B. et al. Imaging biomarker roadmap for cancer studies. Nat. Rev. Clin. Oncol. 14, 169–186, DOI:
10.1038/nrclinonc.2016.162(2017).
5. Limkin, E. et al. Promises and challenges for the implementation of computational medical imaging (radiomics) in
oncology. AnnalsOncol.28,1191–1206(2017).
6. Lambin,P.etal. Radiomics: thebridgebetweenmedicalimagingandpersonalizedmedicine. Nat.reviewsClin.oncology
14,749–762(2017).
7. Kumar,V.etal. Radiomics: theprocessandthechallenges. Magn.resonanceimaging30,1234–1248(2012).
8. Bortolotto,C.etal. Radiomicsfeaturesaspredictiveandprognosticbiomarkersinnsclc. Expert.Rev.Anticancer.Ther.
21,257–266(2021).
9. Kickingereder, P. et al. Large-scale radiomic profiling of recurrent glioblastoma identifies an imaging predictor for
stratifyinganti-angiogenictreatmentresponseradiomicprofilingofbevefficacyinglioblastoma. Clin.CancerRes.22,
5765–5771(2016).
10. Chaddad, A. et al. Radiomics in glioblastoma: current status and challenges facing clinical implementation. Front.
oncology9,374(2019).
11. Parmar,C.,Grossmann,P.,Bussink,J.,Lambin,P.&Aerts,H.J. Machinelearningmethodsforquantitativeradiomic
biomarkers. Sci.reports5,1–11(2015).
12. Park,J.E.&Kim,H.S. Radiomicsasaquantitativeimagingbiomarker:practicalconsiderationsandthecurrentstandpoint
inneuro-oncologicstudies. Nucl.medicinemolecularimaging52,99–108(2018).
13. Lou,B.etal. Animage-baseddeeplearningframeworkforindividualisingradiotherapydose: aretrospectiveanalysisof
outcomeprediction. TheLancetDigit.Heal.1,e136–e147(2019).
14. Hosny,A.,Aerts,H.J.&Mak,R.H. Handcraftedversusdeeplearningradiomicsforpredictionofcancertherapyresponse.
TheLancetDigit.Heal.1,e106–e107(2019).
15. Sechidis,K.etal. Distinguishingprognosticandpredictivebiomarkers: aninformationtheoreticapproach. Bioinformatics
34,3365–3376(2018).
16. Boileau,P.,Qi,N.T.,vanderLaan,M.J.,Dudoit,S.&Leng,N. Aflexibleapproachforpredictivebiomarkerdiscovery.
Biostatistics24,1085–1105(2023).
17. Zhu,W.,Lévy-Leduc,C.&Ternès,N. Identificationofprognosticandpredictivebiomarkersinhigh-dimensionaldata
withpplasso. BMCbioinformatics24,25(2023).
18. Bahamyirou,A.,Schnitzer,M.E.,Kennedy,E.H.,Blais,L.&Yang,Y. Doublyrobustadaptivelassoforeffectmodifier
discovery. TheInt.J.Biostat.18,307–327(2022).
19. Shalit,U.,Johansson,F.D.&Sontag,D. Estimatingindividualtreatmenteffect: generalizationboundsandalgorithms. In
InternationalConferenceonMachineLearning,3076–3085(PMLR,2017).
20. Alaa,A.M.,Weisz,M.&VanDerSchaar,M. Deepcounterfactualnetworkswithpropensity-dropout. arXivpreprint
arXiv:1706.05966(2017).
10/1921. Hassanpour, N. & Greiner, R. Learning disentangled representations for counterfactual regression. In International
ConferenceonLearningRepresentations(2019).
22. Shi,C.,Blei,D.&Veitch,V. Adaptingneuralnetworksfortheestimationoftreatmenteffects. Adv.neuralinformation
processingsystems32(2019).
23. Curth,A.&vanderSchaar,M. Nonparametricestimationofheterogeneoustreatmenteffects: Fromtheorytolearning
algorithms. InInternationalConferenceonArtificialIntelligenceandStatistics,1810–1818(PMLR,2021).
24. Zhang,W.,Liu,L.&Li,J. Treatmenteffectestimationwithdisentangledlatentfactors. InAAAIConferenceonArtificial
Intelligence(2020).
25. Crabbé,J.,Curth,A.,Bica,I.&vanderSchaar,M. Benchmarkingheterogeneoustreatmenteffectmodelsthroughthelens
ofinterpretability. InThirty-sixthConferenceonNeuralInformationProcessingSystemsDatasetsandBenchmarksTrack
(2022).
26. Holland,P.W. Statisticsandcausalinference. J.Am.statisticalAssoc.81,945–960(1986).
27. Hermansson,E.&Svensson,D. Ondiscoveringtreatment-effectmodifiersusingvirtualtwinsandcausalforestmlinthe
presenceofprognosticbiomarkers. InInternationalConferenceonComputationalScienceandItsApplications,624–640
(Springer,2021).
28. Durso-Finley,J.,Falet,J.-P.,Nichyporuk,B.,Douglas,A.&Arbel,T. Personalizedpredictionoffuturelesionactivity
andtreatmenteffectinmultiplesclerosisfrombaselinemri. InInternationalConferenceonMedicalImagingwithDeep
Learning,387–406(PMLR,2022).
29. Durso-Finley,J.etal. ImprovingImage-BasedPrecisionMedicinewithUncertainty-AwareCausalModels. InGreenspan,
H.etal.(eds.)MedicalImageComputingandComputerAssistedIntervention–MICCAI2023,472–481(SpringerNature
Switzerland,Cham,2023).
30. Ma,W.etal. Treatmentoutcomepredictionforintracerebralhemorrhageviagenerativeprognosticmodelwithimaging
andtabulardata. InInternationalConferenceonMedicalImageComputingandComputer-AssistedIntervention,715–725
(Springer,2023).
31. Jiang,X.,Zhou,X.&Kosorok,M.R. Deepdoublyrobustoutcomeweightedlearning. Mach.Learn.113,815–842(2024).
32. Jerzak,C.T.,Johansson,F.&Daoud,A. Image-basedtreatmenteffectheterogeneity. arXivpreprintarXiv:2206.06417
(2022).
33. Takeuchi,K.,Nishida,R.,Kashima,H.&Onishi,M. Grabthereinsofcrowds: Estimatingtheeffectsofcrowdmovement
guidanceusingcausalinference. arXivpreprintarXiv:2102.03980(2021).
34. Jiang,Z.etal. Estimatingcausaleffectsusingamulti-taskdeepensemble. arXivpreprintarXiv:2301.11351(2023).
35. Simonyan,K.,Vedaldi,A.&Zisserman,A. Deepinsideconvolutionalnetworks: Visualisingimageclassificationmodels
andsaliencymaps. InWorkshopatInternationalConferenceonLearningRepresentations(2014).
36. Sundararajan,M.,Taly,A.&Yan,Q. AxiomaticAttributionforDeepNetworks. arXiv:1703.01365[cs](2017). ArXiv:
1703.01365.
37. Erion,G.,Janizek,J.D.,Sturmfels,P.,Lundberg,S.M.&Lee,S.-I. Improvingperformanceofdeeplearningmodelswith
axiomaticattributionpriorsandexpectedgradients. Nat.machineintelligence3,620–631(2021).
38. Selvaraju,R.R.etal. Grad-cam: Visualexplanationsfromdeepnetworksviagradient-basedlocalization. In2017IEEE
InternationalConferenceonComputerVision(ICCV),618–626,DOI:10.1109/ICCV.2017.74(2017).
39. Springenberg,J.T.,Dosovitskiy,A.,Brox,T.&Riedmiller,M. Strivingforsimplicity: Theallconvolutionalnet. InICLR
(workshoptrack)(2015).
40. Rubin,D.B. Causalinferenceusingpotentialoutcomes: Design,modeling,decisions. J.Am.Stat.Assoc.100,322–331
(2005).
41. Curth,A.&vanderSchaar,M. Oninductivebiasesforheterogeneoustreatmenteffectestimation. Adv.NeuralInf.Process.
Syst.34,15883–15894(2021).
42. Polley,M.-Y.C.etal. Statisticalandpracticalconsiderationsforclinicalevaluationofpredictivebiomarkers. J.Natl.
CancerInst.105,1677–1683(2013).
43. Krzykalla,J.,Benner,A.&Kopp-Schneider,A. Exploratoryidentificationofpredictivebiomarkersinrandomizedtrials
withnormalendpoints. Stat.Medicine39,923–939(2020).
11/1944. Deng,L. Themnistdatabaseofhandwrittendigitimagesformachinelearningresearch[bestoftheweb]. IEEESignal
Process.Mag.29,141–142,DOI:10.1109/MSP.2012.2211477(2012).
45. Arjovsky,M.,Bottou,L.,Gulrajani,I.&Lopez-Paz,D. Invariantriskminimization. CoRRabs/1907.02893(2019).
46. Wah, C., Branson, S., Welinder, P., Perona, P. & Belongie, S. The caltech-ucsd birds-200-2011 dataset. Tech. Rep.
CNS-TR-2011-001,CaliforniaInstituteofTechnology(2011).
47. Codella,N.etal. Skinlesionanalysistowardmelanomadetection2018: Achallengehostedbytheinternationalskin
imagingcollaboration(isic). arXivpreprintarXiv:1902.03368(2019).
48. Tschandl,P.,Rosendahl,C.&Kittler,H. Theham10000dataset,alargecollectionofmulti-sourcedermatoscopicimages
ofcommonpigmentedskinlesions. Sci.data5,1–9,DOI:10.1038/sdata.2018.161(2018).
49. Aerts,H.J.W.L.etal. DataFromNSCLC-Radiomics(version4). https://doi.org/10.7937/K9/TCIA.2015.PF0M9REI
(2014). Dataset.
50. Gareau,D.S.etal. Digitalimagingbiomarkersfeedmachinelearningformelanomascreening. Exp.dermatology26,
615–618(2017).
51. Gareau,D.S.etal. Deeplearning-levelmelanomadetectionbyinterpretablemachinelearningandimagingbiomarker
cues. J.Biomed.Opt.25,112906–112906(2020).
52. Zwanenburg, A. et al. The image biomarker standardization initiative: standardized quantitative radiomics for high-
throughputimage-basedphenotyping. Radiology295,328–338(2020).
53. Aerts,H.J.etal. Decodingtumourphenotypebynoninvasiveimagingusingaquantitativeradiomicsapproach. Nat.
communications5,4006(2014).
54. VanGriethuysen,J.J.etal. Computationalradiomicssystemtodecodetheradiographicphenotype. Cancerresearch77,
e104–e107(2017).
55. Cardoso,M.J.etal. Monai: Anopen-sourceframeworkfordeeplearninginhealthcare. arXivpreprintarXiv:2211.02701
(2022).
56. Isensee, F., Jaeger, P. F., Kohl, S. A., Petersen, J. & Maier-Hein, K. H. nnu-net: a self-configuring method for deep
learning-basedbiomedicalimagesegmentation. Nat.methods18,203–211(2021).
57. Seabold, S. & Perktold, J. statsmodels: Econometric and statistical modeling with python. In 9th Python in Science
Conference(2010).
58. Kokhlikyan,N.etal. Captum: Aunifiedandgenericmodelinterpretabilitylibraryforpytorch(2020). 2009.07896.
59. Smilkov,D.,Thorat,N.,Kim,B.,Viégas,F.B.&Wattenberg,M. Smoothgrad: removingnoisebyaddingnoise. CoRR
abs/1706.03825(2017). 1706.03825.
60. Goyal,Y.etal. Counterfactualvisualexplanations. InInternationalConferenceonMachineLearning,2376–2384(PMLR,
2019).
Acknowledgements
WeacknowledgefundingfromtheGermanResearchFoundation(DFG)aspartofthePriorityProgramme2177Radiomics:
NextGenerationofBiomedicalImaging(projectidentifier: 428223917)andCollaborativeResearchCenter1389(UNITE
Glioblastoma–projectidentifier: 404521405). PVisfundedthroughanElseKrönerClinicianScientistEndowedProfessorship
bytheElseKrönerFreseniusFoundation(referencenumber: 2022EKCS.17). ThisworkwaspartlyfundedbyHelmholtz
Imaging(HI),aplatformoftheHelmholtzIncubatoronInformationandDataScience. WethankDavidZimmererforthe
feedbackonthemanuscript.
Author contributions statement
S.X.,J.P.,P.V.,P.J.,andK.M.H.conceivedtheprojectdesign. S.X.conductedtheexperimentsandperformedthequantitative
analysisandevaluations,andL.K.performedtheXAIanalysisoftheresults. S.X.,L.K.,andP.J.preparedthefigures. S.X.
draftedthemainmanuscripttext. Allauthorsreviewed,edited,andapprovedthefinalmanuscript.
Additional information
Competinginterests
Theauthorsdeclarenocompetinginterests.
12/19Supplementary Information
ExplainableAIMethods
FortheattributionmapsinFig.5ofthemainpaper,weuseExpectedGradients(EG)37fortheCMNISTdatasetandguided
Gradient-weightedClassActivationMapping(GGCAM)38,39fortheothertwodatasets. Duetoitsup-samplingmechanism,
GGCAMisonlysuitabletoalimitedextenttocomputetheattributionofeachRGBchannelindividually. Fortheresults
presentedinthesupplementarysection“Additionalfeatureattributionsresultsforinterpretingpredictiveimagingbiomarkers”,
weadditionallyapplyIntegratedGradients(IG)36 withablack(i.e.zero)baselinevalueandthetraditionalGradient-weighted
ClassActivationMapping(GCAM).
IntegratedGradients. IGcalculatesapathintegralfromabaselinevaluex 0 totheactualvaluex j foreachofthe jinput
features,inourcasepixelsorvoxels.
(cid:90) 1 ∂f(x +α(x−x ))
IG (x,x )=(x −x ) 0 0 dα (5)
j 0 j 0j
α=0
∂x
j
However,selectingabaselinevaluex forIGisoftenambiguous,andexecutingmultiplepathintegralsacrossdifferent
0
baselinevaluescanbeinefficient.
ExpectedGradients. ToavoidselectingabaselinevalueaswouldbenecessaryforIG,Erionetal.37 presentedasolution
basedonaprobabilisticbaselinecomputedoverasampleofobservations:
(cid:90)
EG (x)= IG (x,x ) p (x )dx (6)
j j 0 D 0 0
x0
(cid:90) (cid:18) (cid:90) 1 ∂f(x +α(x−x )) (cid:19)
= (x −x ) 0 0 dα p (x )dx (7)
j 0j D 0 0
x0 α=0
∂x
j
(cid:20) (cid:21)
∂f(x +α(x−x ))
= E 0 0 dα , (8)
x0∼D,α∼U(0,1)
∂x
j
withx asthebaseline,x theinputfeaturenumber jandDastheunderlyingdatadistribution. Inpractice,EGiscomputed
0 j
viaamini-batchprocedurebydrawingsamplesforx andα,computingtheexpressioninsidetheexpectation,andaveraging
0
overthemini-batch.
(Guided)-GradCAM. GGCAMisthecombinationofGuidedBackpropagation(GB)39andGradCAM38.GradCAMcomputes
the attribution via backpropagation into a selected hidden layer, usually the last convolutional layer, and up-samples it to
theinputsize. GradCAMleveragestheideathatconvolutionalneuralnetworkstransformspatialtosemanticinformation
by attributing to the semantic information, which is then up-sampled back into the input space. GB, on the other hand,
backpropagates directly from a target output into the original image but via a guiding function, overriding non-negative
gradientsfromRectifiedLinearUnit(ReLU)activationfunctions. GGCAMtakestheelement-wiseproductbetweenGBand
thenon-negativeGradCAMattributions,leveragingboththesemanticinformationfromGradCAMandthemorefine-grained
spatialinformationintheinputspacefromGB.
Additionalfeatureattributionsresultsforinterpretingpredictiveimagingbiomarkers
FurtherattributionmapsforsamplesfromtheCMNIST,CUB-200-2011,ISIC2018,andNSCLC-Radiomicsdatasetandthe
controlheadYˆ(T =0),CATEYˆ(T =1)−Yˆ(T =0)andadditionallythetreatmentgroupheadoutputYˆ(T =1)arepresented
inSupplementaryFig.6,7,8and10,respectively. Eachfigureshowcasestheresultsoffourexampleswithvaryingpresenceor
valuesofpredictiveandprognosticbiomarkers.
CMNIST. WeextendouranalysisofthemainpaperandshowtwoadditionalCMNISTimagesandIGattributionmapsin
SupplementaryFig.6. ThebluecolorchannelonlyshowsnoisyattributionforbothEGandIGattributionmaps,suggesting
minimalimpactonthemodel’spredictions. Whileattributionmapsforthedigitcolorchannelshowconsistentpatternsacross
EGandIGmethods,theydifferfortheotherremainingcolorchannel. ForthecontrolgroupheadoutputYˆ(T =0),apositive
attributionisobservedfromthegreencolorchannelforboththedigit0and7inthetoprow,whereasanegativeattributionis
observedinboththeredandalsogreencolorchannelofthedigit9and4inthebottomrow. Thisindicatesthatthemodel
correctlyidentifiestheprognosticbiomarker“digitisgreen”fromtherelevantcolorchannel. Theattributionmapsofthe
13/19Predictive biomarker: Prognostic biomarker: Predictive biomarker: Prognostic biomarker:
“has no circle” = False “is green” = True “has no circle” = True “is green” = True
Control group Treatment group Treatment effect Control group Treatment group Treatment effect
head attribution head attribution attribution head attribution head attribution attribution
Expected Expected
Gradients Gradients
(SmoothGrad σ=0.1) (SmoothGrad σ=0.1)
Integrated Integrated
Gradients Gradients
(SmoothGrad σ=0.1, (SmoothGrad σ=0.1,
Baseline: black ( )) Baseline: black ( ))
Predictive biomarker: Prognostic biomarker: Predictive biomarker: Prognostic biomarker:
“has no circle” = False “is green” = False “has no circle” = True “is green” = False
Control group Treatment group Treatment effect Control group Treatment group Treatment effect
head attribution head attribution attribution head attribution head attribution attribution
Expected Expected
Gradients Gradients
(SmoothGrad σ=0.1) (SmoothGrad σ=0.1)
Integrated Integrated
Gradients Gradients
(SmoothGrad σ=0.1, (SmoothGrad σ=0.1,
Baseline: black ( )) Baseline: black ( ))
Positive attribution Negative attribution
SupplementaryFigure6. EGandIGattributionmapsofourmodelforthecontrolhead,treatmentgrouphead,andCATE
outputforthefourCMNISTdatasetsamples,showcasingthepresenceorabsenceofthepredictiveandprognosticbiomarker.
WepresenttheattributionmapforeachRGBcolorchannel(left: red,top: green,right: blue).
predictedCATEoutputYˆ(T =1)−Yˆ(T =0)exhibitednotablenegativeattributioninthecolorchannelofthedigitcolorfor
boththedigit0and9intheleftcolumn,indicatingtheabsenceofthepredictivebiomarker“hasnocircle”. Anoverallpositive
attributionwasobservedinthegreencolorchannelofdigit7,suggestingthepresenceofthepredictivebiomarker. However,a
morenegativeattributionwithsomenoisypositiveattributionisseenfortheredchannelofthedigitfour,indicatingsome
ambiguityinidentifyingthepresenceofthepredictivebiomarker.
CUB-200-2011. The extended results for the CUB-200-2011 dataset are shown in Supplementary Fig. 7. The GCAM
attributionmapsofthecontrolgroupheadoutputYˆ(T =0)indicatethatthemodelfocusesthemostonthemainbodyofthe
bird. TheGGCAMattributionmapsrevealoverallnegativeattributionsfromthewingandtail(topleftandtopright)orfrom
thebellyregion(bottomleft)andanoverallpositiveattributionfromthetailandhead/neckregion(bottomright). Whilethis
suggeststhatthemodelincorrectlyidentifiestheprognosticbiomarker“hasprimarycolor: white”ofthetopleftbirdasblack
duetotheblackwings,itcorrectlyidentifiesitintheotherthreecases. ForthepredictedCATEoutputYˆ(T =1)−Yˆ(T =0),
theGCAMattributionmapshighlightthebeakandneckareas,whichcorrespondstotheareaswherethepredictivebiomarker
“hasbilllength: longerthanhead”,butalsopartsofthebottomareasofthebirds. TheGGCAMattributionmapsshowoverall
positive attributions in all examples except the bottom right, indicating that it is more difficult for the model to correctly
distinguishtherelativebilllengths,exceptforthetopandbottomrightexamples.
ISIC2018. Asmentionedinthesection“Interpretationofpredictivebiomarkersusingfeatureattribution”andshowninFig.5
ofthemainpaper,themodellikelyusesthelightergapsor“holes”betweenthedarkvein-likegridstructuretodetectpigment
networks. WeexpectthetreatmentgroupheadYˆ(T =1)tobesensitivetobothpredictiveandprognosticbiomarkers. In
SupplementaryFig.8weobserveinthetreatmentgrouphead’sattributionmapthatthereispositiveattributionagain(shown
14/19Predictive biomarker: Prognostic biomarker: Predictive biomarker: Prognostic biomarker:
“bill > head” = False “is white” = True “bill > head” = True “is white” = False
Control group Treatment group Treatment effect Control group Treatment group Treatment effect
head attribution head attribution attribution head attribution head attribution attribution
GradCAM GradCAM
Guided Guided
GradCAM GradCAM
Predictive biomarker: Prognostic biomarker: Predictive biomarker: Prognostic biomarker:
“bill > head” = False “is white” = False “bill > head” = False “is white” = True
Control group Treatment group Treatment effect Control group Treatment group Treatment effect
head attribution head attribution attribution head attribution head attribution attribution
GradCAM GradCAM
Guided Guided
GradCAM GradCAM
Positive attribution Negative attribution
SupplementaryFigure7. GCAMandGGradCAMattributionmapsofourmodelforthecontrolhead,treatmentgroup
head,andCATEoutputforfourCUB-200-2011datasetsamples,showcasingthepresenceorabsenceofthepredictiveand
prognosticbiomarker.
Treatment effect Treatment group head
Original image
attribution attribution
“has pigment network”
with pigment network
“has pigment network” &
mask
“has globules”
Prognostic biomarker defined as… Predictive biomarker defined as… Negative attribution Positive attribution
SupplementaryFigure8. Attributionmapsforanexampleimagecontainingapigmentnetwork(shownasamask)butno
globulesforanimageoftheISIC2018dataset.
in blue) in the light interspaces but also negative attribution (in red) in the dark veins. This observation also supports the
hypothesisthatthemodelassociatesthedarkveinswiththeglobulesbutdetectsthepigmentnetworkcorrectlythroughthe
lightinterspacesasseenforthetreatmenteffectattributionmap,asthelighterinterspacesareuniquelypresentinpigment
15/19Predictive biomarker: Prognostic biomarker: Predictive biomarker: Prognostic biomarker:
“has pigment network” = True “has globules” = False “has pigment network” = False “has globules” = False
Control group Treatment group Treatment effect Control group Treatment group Treatment effect
head attribution head attribution attribution head attribution head attribution attribution
GradCAM GradCAM
Guided Guided
GradCAM GradCAM
Predictive biomarker: Prognostic biomarker: Predictive biomarker: Prognostic biomarker:
“has pigment network” = True “has globules” = True “has pigment network” = False “has globules” = True
Control group Treatment group Treatment effect Control group Treatment group Treatment effect
head attribution head attribution attribution head attribution head attribution attribution
GradCAM GradCAM
Guided Guided
GradCAM GradCAM
Positive attribution Negative attribution
SupplementaryFigure9. GCAMandGGradCAMattributionmapsofourmodelforthecontrolhead,treatmentgroup
head,andCATEoutputforfourISIC2018datasetsamples,showcasingthepresenceorabsenceofthepredictiveand
prognosticbiomarker.
networks. TheSupplementaryFig.6showstheresultsforthreeadditionalexamplesfromtheISIC2018dataset. TheGCAM
attributionmapsshowalackofclearlocalization,exceptforthebottomleftexample,indicatingthatthenetworkdoesnot
identifyaclearlocalizationofthebiomarkers. WhencomparingtheGGCAMattributionmaps,eventhoughtheattribution
mapsshowthatthenetworkidentifiessomestructures,onlythelocationofthepredictivebiomarker“haspigmentnetwork”is
likelycorrectlyidentifiedbythenetworkinthebottomleftexamplewhencomparingtothegroundtruthsegmentation.
NSCLC-Radiomics. TheadditionalattributionmapresultsfortheNSCLC-RadiomicsdatasetaredepictedinSupplementary
Fig.10. BoththeGCAMandGGCAMattributionmapsforthecontrolgroupoutputYˆ(T =0)showthemostattributionfrom
areassurroundingthetumors. Thisisespeciallyevidentinareaswherethetumorshapeisnotsphericalorround,suchasinthe
bottomrightcoloroftheupperlefttumorexampleorthethinnersectioninthemiddleofthelowerlefttumorexample. GCAM
attributionmapsfortheCATEoutputYˆ(T =1)−Yˆ(T =0)showthatthemodeltendstofocusonthedarkerpartsoftheimage
slices. ThecorrespondingGGCAMattributionmapsrevealmorenegativeattributionsfromthedarkerpartsoftheimages,but
strongpositiveattributionsfromtheneighboringlighterpartsinallfourexamples. Thisobservationalignswiththefactthatthe
minimumpixelintensityvaluecontributesstronglytothepredictivebiomarkerfeature“energy”. Toprovidedeeperinsightsinto
howthemodelidentifies3Dfeatures,wealsoshowthe3DattributionmapsforoneexampleinSupplementaryFig.11. Here,
the3DattributionmapforthecontrolgroupoutputYˆ(T =0)highlightsanareaabovethetumor,likelyerroneously. TheCATE
outputYˆ(T =1)−Yˆ(T =0)showsahighattributionontheupperrightsideofthetumorwhereitappearsflat. Thisarealikely
correspondstotheregionwheretheprincipalcomponentslieandwhichcontributestothepredictivebiomarker“flatness”.
16/19Predictive biomarker: Prognostic biomarker: Predictive biomarker: Prognostic biomarker:
“energy” = 3.65 (High) “flatness” = 0.95 (High) “energy” = 3.45 (High) “flatness” = -0.34 (Low)
Control group Treatment group Treatment effect Control group Treatment group Treatment effect
head attribution head attribution attribution head attribution head attribution attribution
Slice 33/54 Slice 24/54
GradCAM GradCAM
Guided Guided
GradCAM GradCAM
Predictive biomarker: Prognostic biomarker: Predictive biomarker: Prognostic biomarker:
“energy” = -0.05 (Medium) “flatness” = -2.84 (Low) “energy” = -0.28 (Low) “flatness” = -0.44 (Low)
Control group Treatment group Treatment effect Control group Treatment group Treatment effect
head attribution head attribution attribution head attribution head attribution attribution
Slice 23/54 Slice 27/54
GradCAM GradCAM
Guided Guided
GradCAM GradCAM
Positive attribution Negative attribution
SupplementaryFigure10. GCAMandGGCAMattributionmapsofourmodelforthecontrolhead,treatmentgrouphead,
andCATEoutputforonesagittalsliceofeachofthefourNSCLC-Radiomicsdatasetsamples,showcasingthepredictiveand
prognosticbiomarkerwithvaryingstrengths. Thetumorsegmentationoutlinesareshowninorange.
CATEestimationperformanceandbiomarkeridentificationperformance
InCATEestimation,amodel’sperformanceisusuallyevaluatedusingthePrecisionofEstimatingHeterogeneousEffects
(PEHE)65metric,whichisdefinedas
(cid:115)
1
PEHE= ∑(τ −τˆ)2, (9)
i i
n
i
wherendenotesthenumberoftestsamples,τ thetrueCATEandτˆ theestimatedCATEforatestsamplei. InSupplementary
i i
Fig.12andSupplementaryTable1,wherethePEHEmetricisreportedalongsidetherootmeansquareerror(RMSE)ofthe
predictionoffactualoutcomes, weobserveabetterCMNISTcomparedtotheotherthreedatasets. Thisobservationalso
correspondstotheperformancefortherelativepredictivestrengthasobservedinFig.4ofthemainpaper.
Therearevariationswithinthesamedatasetbetweenmodelstrainedwithbiomarkersonfeaturesets(a)and(b),whichis
likelysinceitisslightlyeasierforthemodelstoidentifyonetypeofprognosticandpredictivebiomarkercombinationsthan
theothers. AlowerRMSEbutahighPEHEindicatesthatthemodelcanonlypredictthefactualoutcomeswellbutnotthe
counterfactualoutcomes,whichslighteffectsofoverfittingcouldcause. Duetothedifferentsamplingspaceofthesimulation
parametersb andb ,onlyalimitedcomparisoncanbemadeforCMNISTwiththeothertwodatasets,however. As
pred prog
thescaleoftheCATEautomaticallychangeswithparametersb andb 25,alsothePEHEchanges,whichthereforealso
pred prog
dependsontheabsolutevalueofb andb . Thisphenomenonfurtherthecomparabilityacrossdifferentratiosb /b .
pred prog pred prog
TheRMSEandPEHEresultsforNSCLC-RadiomicsareworseandhaveaslightlylargervariancethanfortheCUB-200-
2011andISIC2018datasets,whichalsoexplainsthemodels’worseperformanceinidentifyingpredictivebiomarkersasshown
inFig.4ofthemainpaper.
17/19Predictive biomarker: “flatness” = -2.84 (Low) Prognostic biomarker: “energy” = -0.05 (Medium)
Control group head attribution Treatment group head attribution Treatment effect attribution
Tumor segmentation
3D 2D 3D 2D 3D 2D 3D 2D
Slice 23/54 Slice 23/54 Slice 23/54 Slice 23/54
SupplementaryFigure11. 3DGCAMattributionmapsofourmodelforthecontrolhead,treatmentgrouphead,andCATE
output,illustratedfora3DpatchfromtheNSCLC-Radiomicsdataset. Additionally,a3Drenderofthesegmentedtumoranda
2Dsagittalsliceareshown.
However,itisgenerallynotpossibletodirectlyconcludeamodel’sperformanceconcerningidentifyingthecorrectimaging
biomarkersjustfromthePEHEmetricsalone2,25. Inourcase,theexactvalueoftheCATEisnotdirectlyimportantforthe
evaluation,asourmaintaskofinterestisidentifyingpredictiveimagingbiomarkers. Therefore,thePEHEisonlysuitableasa
secondaryevaluationmetricalongsidetheevaluationmethodsmentionedinthesection“Proposedevaluation”ofthemain
paper.
CMNIST CUB-200-2011 ISIC 2018 NSCLC-Radiomics
(Colored Digits) (Bird Species) (Skin Lesions) (Lung Cancer CT)
a) 1.0 1.0 1.0 1.0
0.8 0.8 0.8 0.8
0.6 0.6 0.6 0.6
0.4 0.4 0.4 0.4
0.2 0.2 0.2 0.2
0.0 0.0 0.0 0.0
0 1 2 3 4 5 0 1 2 3 4 5 0 1 2 3 4 5 0 1 2 3 4 5
bpred/bprog bpred/bprog bpred/bprog bpred/bprog
b) 1.0 1.0 1.0 1.0
0.8 0.8 0.8 0.8
0.6 0.6 0.6 0.6
0.4 0.4 0.4 0.4
0.2 0.2 0.2 0.2
0.0 0.0 0.0 0.0
0 1 2 3 4 5 0 1 2 3 4 5 0 1 2 3 4 5 0 1 2 3 4 5
bpred/bprog bpred/bprog bpred/bprog bpred/bprog
SupplementaryFigure12. Performanceofourtreatmenteffectestimationmodelstrainedwithbiomarkersfromfeatureset
(a)or(b)withrespecttotheprecisionofestimatingheterogeneouseffects(PEHE)fordifferentsimulationparameters
b /b (i.e.relativesizeofthepredictiveeffectinthesimulatedoutcomes). ThelowerthePEHEthebetterthe
pred prog
performance.
18/19
EHEP
EHEP
EHEP
EHEP
EHEP
EHEP
EHEP
EHEPDataset FeatureSet PEHE RMSE
(a) 0.121 0.094
CMNIST
(b) 0.045 0.115
(a) 0.227 0.304
CUB-200-2011
(b) 0.277 0.261
(a) 0.304 0.352
ISIC2018
(b) 0.308 0.362
(a) 0.475 0.561
NSCLC-Radiomics
(b) 0.469 0.633
SupplementaryTable1. PerformancewithrespecttothemeanPEHEandRMSEforthepredictionoffactualoutcomesper
datasetforourtreatmenteffectestimationmodelstrainedwithbiomarkersfromfeatureset(a)or(b).
Supplementary References
61. Erion,G.,Janizek,J.D.,Sturmfels,P.,Lundberg,S.M.&Lee,S.-I. Improvingperformanceofdeeplearningmodelswith
axiomaticattributionpriorsandexpectedgradients. Nat.machineintelligence3,620–631(2021).
62. Selvaraju,R.R.etal. Grad-cam: Visualexplanationsfromdeepnetworksviagradient-basedlocalization. In2017IEEE
InternationalConferenceonComputerVision(ICCV),618–626,DOI:10.1109/ICCV.2017.74(2017).
63. Springenberg,J.T.,Dosovitskiy,A.,Brox,T.&Riedmiller,M. Strivingforsimplicity: Theallconvolutionalnet. InICLR
(workshoptrack)(2015).
64. Sundararajan,M.,Taly,A.&Yan,Q. AxiomaticAttributionforDeepNetworks. arXiv:1703.01365[cs](2017). ArXiv:
1703.01365.
65. Hill,J.L. Bayesiannonparametricmodelingforcausalinference. J.Comput.Graph.Stat.20,217–240(2011).
66. Crabbé,J.,Curth,A.,Bica,I.&vanderSchaar,M. Benchmarkingheterogeneoustreatmenteffectmodelsthroughthelens
ofinterpretability. InThirty-sixthConferenceonNeuralInformationProcessingSystemsDatasetsandBenchmarksTrack
(2022).
67. Curth,A.,Svensson,D.,Weatherall,J.&vanderSchaar,M. ReallydoinggreatatestimatingCATE?acriticallookat
MLbenchmarkingpracticesintreatmenteffectestimation. InThirty-fifthConferenceonNeuralInformationProcessing
SystemsDatasetsandBenchmarksTrack(Round2)(2021).
19/19