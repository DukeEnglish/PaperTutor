JOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 1
A Hierarchical Framework with Spatio-Temporal
Consistency Learning for Emergence Detection in
Complex Adaptive Systems
Siyuan Chen, and Xin Du, and Jiahai Wang, Senior Member, IEEE
Abstract—Emergence, a global property of complex adaptive Smooth Traffic Flow Network-Level Congestion
(Emergent Phenomenon) systems (CASs) constituted by interactive agents, is preva-
lent in real-world dynamic systems, e.g., network-level traffic Macro-Level
congestions. Detecting its formation and evaporation helps to Dynamics
monitor the state of a system, allowing to issue a warning
signal for harmful emergent phenomena. Since there is no
Downward
centralizedcontrollerofCAS,detectingemergencebasedoneach
Causation
agent’s local observation is desirable but challenging. Existing
works are unable to capture emergence-related spatial patterns,
and fail to model the nonlinear relationships among agents.
Micro-Level
This paper proposes a hierarchical framework with spatio-
Dynamics
temporal consistency learning to solve these two problems by Local Interactions Among Agents
learning the system representation and agent representations,
(a)
respectively. Especially, spatio-temporal encoders are tailored to
Number of Congested Streets over Time
captureagents’nonlinearrelationshipsandthesystem’scomplex
evolution. Representations of the agents and the system are
learned by preserving the intrinsic spatio-temporal consistency Emergence Emergence
inaself-supervisedmanner.Ourmethodachievesmoreaccurate Formation Evaporation
detection than traditional methods and deep learning methods
on three datasets with well-known yet hard-to-detect emergent (b)
behaviors.Notably,ourhierarchicalframeworkisgeneric,which
can employ other deep learning methods for agent-level and Fig.1. (a)Illustrationofemergence.(b)Framingemergencedetectionasa
change-pointdetectionproblem.
system-level detection.
IndexTerms—Emergencedetection,complexadaptivesystems,
self-supervised learning on dynamic graphs, spatio-temporal
bynature[1,4].Nonetheless,itwillbebeneficialtodetectthe
modeling.
formation and evaporation of emergence, specifically, weak
emergencethatisscientificallyrelevant[5].Itcanhelpmonitor
I. INTRODUCTION
some global properties of the system and issue a warning
Many real-world dynamic systems can be regarded as signalwhenanundesirablephenomenonarrives.Forexample,
complex adaptive systems (CASs) composed of autonomous, reporting a traffic jam based on the feedback of cars can
adaptive, and interacting agents, whose interactions at the help with the health management of traffic systems. It will
micro level can result in emergent phenomena at the macro complement existing monitors relying on static devices like
level,namely,emergence[1–3].Figure1(a)presentsanexam- sensors or cameras [6].
ple. When there is adequate space among cars, the road net
Emergencedetectioncanbeformulatedasanonlinechange-
enjoysasmoothtrafficflow.Whenthedistancesbetweencars
point detection (CPD) problem by regarding the time steps
significantly narrow down, network-level congestion occurs
when emergence forms or evaporates as change points [7, 8].
as an emergent phenomenon. Emergence is irreducible to the
As shown in Figure 1(b), the number of congested streets can
propertiesofagentsthatconstituteCAS,anditisunpredictable
serveasaglobalvariabletomonitortheemergence.However,
CASs are distributed by nature, i.e., there is no centralized
This work is supported by the National Key R&D Program of China
(2018AAA0101203), the National Natural Science Foundation of China controller that can access the states of all agents. Therefore,
(62072483),andtheGuangdongBasicandAppliedBasicResearchFounda- methods requiring all agents’ states to compute a global
tion(2022A1515011690,2021A1515012298).(Correspondingauthor:Jiahai
metric for emergence detection become impractical under the
Wang.)
Siyuan Chen is with the School of Computer Science and Cyber Engi- distributed setting. Hence, it is desirable to detect emergence
neering, Guangzhou University, Guangzhou 510006, China (e-mail: chen- using agents’ local observation, which is feasible because
siyuan@gzhu.edu.cn).
all agents experience the downward causation [7] when the
Xin Du is with the Civil Aviation Electronic Information Engineering
College, Guangzhou Civil Aviation College, Guangzhou 510403, China (e- emergence forms, as shown in Figure 1(a). For example, cars
mail:duxin@gcac.edu.cn). slow down in a crowded street. Based on this observation,
Jiahai Wang is with the School of Computer Science and En-
O’tooleetal.[7]proposeDETect,theonlyfeasibleemergence
gineering, Sun Yat-sen University, Guangzhou 510275, China (e-mail:
wangjiah@mail.sysu.edu.cn). detection method for the distributed setting. In DETect, each
4202
naJ
81
]AM.sc[
1v00301.1042:viXraJOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 2
agent analyzes its relationship with neighbors, communicates II. RELATEDWORK
with them, and sends feedback when finding a noticeable
A. Emergence Detection
change in the relationship. DETect concludes the formation
Detecting the emergence of CAS, generally requires at
or evaporation of emergence when the number of feedback
least one global monitor [2]. Depending on how the monitor
gets significantly larger.
acquires the information of agents for detection, existing
Thoughmakingabigstep,DETecthastwomainlimitations. methods fall into three design choices of architectures: (I)
First, it simply counts agents’ feedback to monitor the emer- a single monitor with direct access to agents’ states, (II) a
gence, which may neglect the spatial patterns that are highly monitor collecting agents’ information indirectly, e.g., from
correlatedtoemergence.Second,itadoptslinearregressionto static sensors, and (III) a monitor collecting feedback from
model an agent’s relationship with its neighbors, which may mobile agents. Our method belongs to class III.
fail to capture nonlinear relationships.
Methods from class I defined global variables to monitor
This paper tries to overcome the above limitations from the system state, e.g., information entropy [10–13], statistical
a graph perspective. CAS can be regarded as a dynamic divergence [14], and Granger-emergence [15]. These methods
graph [9], and thus emergence detection can be cast to requirecentralizedmonitoring,andarethusinapplicableunder
online CPD in dynamic graphs under the distributed setting. the distributed setting.
Based on this formulation, it suffices to learn a system- Methods from class II allow distributed monitoring. How-
level representation aware of emergence-related patterns, and ever, it requires prior knowledge of emergence to decide what
agent-level representations encoding the nonlinear relation- to detect at each sensor [16, 17], falling short in detecting
ships. When emergence forms or evaporates, the system rep- unknown emergent phenomena.
resentations between adjacent time steps are expected to be DETect [7], the only existing method from class III, over-
inconsistent, which can serve as a detecting signal for emer- comesthelimitationsofthefirsttwoclasses.Eachagentserves
gence. Specifically, a Hierarchical framework with Spatio- as a local detector, and agents’ feedback is aggregated to
Temporal Consistency Learning is proposed for Emergence monitor the emergence. Our method inherits the advantages
Detection(HiSTCLED).HiSTGLEDisofathree-layerstruc- of DETect, and further introduces region monitors between
ture, “agents-region monitors-global monitor”, which allows agents and the global monitor, allowing to analyze spatial
to capture emergence-related spatial patterns by aggregating patterns ignored by DETect. STEs are tailored to model
agent-level detecting results from bottom-up. HiSTCLED can nonlinear relationships among agents, which is difficult for
be conceptually implemented by the efficient end-edge-cloud the linear models adopted by DETect.
collaborativeframework.Spatio-temporalencoders(STEs)are Similar to region monitoring, Santos et al. [18] detect
designed to model the complex variation of agents’ nonlin- emergence by utilizing subsystem-level information. Their
ear relationships and the system states on highly dynamic work requires collecting and labeling data of pre-defined
scenarios. The corresponding representations of agents and subsystems, which is not applicable to emergence detection
the system are learned by jointly preserving the spatial and rooted in agents’ local observations.
temporal consistency through non-contrastive self-supervised More backgrounds of CAS and emergence, along with a
learning strategies. detailed description of DETect are shown in Appendix A.
Our contributions are summarized as follows.
B. Related Graph Mining Tasks
The hierarchical framework HiSTCLED can capture
• Emergence detection can be viewed as CPD in dynamic
emergence-related spatial patterns by aggregating agent-
graphs, concerning both structural [19, 20] and attributed [21]
level detecting results from bottom-up.
changes. It is also closely related to graph-level anomaly
STEs are tailored to model the nonlinear relationships
• detection(AD)[22,23],sinceemergenceisanovelgraph-level
among agents and the evolution of the system. Featured
property. The anomaly is measured by prediction error [24,
byparallelexecutionandincrementalupdateofrepresen-
25], one-class classification loss [26], contrastive loss [27],
tations, these encoders are especially suitable for online
etc.Thesemethodsrequireacentralizedcontroller.Protogerou
detection.
et al. [28] propose a distributed graph anomaly detection
The agent representations and the system representation
• method, where each node shares the latent vector with its
are learned by preserving the intrinsic spatio-temporal
neighbors. This will raise privacy concerns and increase the
consistency in a self-supervised manner. The training
communicationcost.Thus,methodsfromgraph-levelCPDand
strategyavoidsdataaugmentationsthatmaybreakspatio-
AD are inapplicable for emergence detection, but they can
temporal consistency and negative samples that increase
adapt to our framework regarding the distributed settings [7],
the computational overhead.
where agents can only sense their neighbors’ states and share
Extensiveexperimentsonthreedatasetswithwell-known
• the detecting results.
yet hard-to-detect emergent phenomena validate the su-
periority of HiSTCLED over DETect and deep learning
C. Self-Supervised Learning for Dynamic Graphs
methods. Notably, other deep learning methods can be
incorporatedinourhierarchicalframeworkforemergence Self-supervised learning leverages rich attributed and struc-
detection. tural information of graphs to train graph neural networksJOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 3
System-Level STCL
System-Level MG olo nb ita ol r Online Branch T Sa Trg Eet & P Pr oo oj l𝑇 // CT oe nm sip sto er na cl y
Detection Target Branch 𝑆
(Cloud Server) Loss
 System-Level Region Online Proj 𝑆 Proj 𝑇 ℒ
Region
C D R Re ep gr ie os ne -n Lt ea vti eo lns States STE & Pool 𝑆 & Pool 𝑇 Spatial System
GC ro aia nr is ne
g
(EdM geo n Si et ro vr
er)
B A
//
R Ste op pr e Gse ran dta ieti no tns T Sa Trg Eet
&
PP oro oj l𝑆
𝑇
// Con Lsi os st sency
Feedback
Agent-Level STCL Online Proj 𝑇 Temporal
Online Branch STE & Pool 𝑇 Consistency
Agent-Level Agent Target Branch Agent Target // Loss
Detection (End) Agent-Level States STE ℒ
 Representations Online Proj 𝑆 MLP Agent
Sensing Representations Neighbor STE & Pool 𝑆 CoS np sia st ti ea nl cy
STCL OveralC l Fom ram mu en wic oa rti kon // Sof to N pe Gig rh ab do ier ns t States T Sa Trg Eet & P Pr oo oj l𝑇 𝑆 // Loss
Fig.2. OverviewofHiSTCLED.HiSTCLEDcontainsthreehierarchies,agents,regionmonitors,andaglobalmonitor,whichcanbeconceptuallyimplemented
by the end-edge-cloud collaborative framework. Agents sense the states of neighbors, measure the change in relationships, and communicate with them to
makeagent-leveldetection.Thedetectingresultsarecoarse-grainedtoregionstates,whosespatialpatternsareusedforsystem-leveldetection.Representations
ofagentsandthesystemarelearnedviaspatio-temporalconsistencylearning(STCL)techniquetosupportagent-levelandsystem-leveldetection,respectively.
(GNNs) without labels [29]. Despite its success in static hoodofagentjattimetisdefinedas t = i:dt δ ,
Nj { ij ≤ }
graphs, efforts in dynamic graphs are limited. Contrastive where dt is the Euclidean distance.
ij
learningisatypicalparadigm,butitisnon-trivialtoconstruct Condition 2. An agent j only communicates with its
•
different views of a node or a graph that preserve spatio- neighbors in t.
Nj
temporal semantics [30–33]. Besides, the large number of Condition 3. The only message that an agent j shares
•
negative samples substantially increases the computational with its neighbors or uploads to some monitor is its
overhead. To avoid these issues, this paper develops non- detecting score for emergence, i.e., a scalar st [0,1].
j ∈
contrastive spatio-temporal learning strategies.
Inspired by Ranshous et al. [34], this paper uses a dissim-
ilarity function to calculate the detecting scores, and defines
III. METHOD
the criterion for CPD as follows.
A. Problem Formulation
Definition 4 (Criterion for CPD). Given a graph series and
Regarding the time steps when the emergence forms or
a dissimilarity function d( , ′) R 0, a change point t is
evaporates as change points, emergence detection in CAS can detected when d( t, t 1)G >G c an∈ d d(≥t, t+1) c for some
−
be formulated as CPD in dynamic graphs as follows. G G G G ≤
threshold c.
Definition 1 (Dyanmicgraph). Adynamicgraphiscomposed
of a graph series {Gt }T t=1, where Gt = ( V, Et,Xt) is a B. Motivation and Overview of HiSTCLED
snapshot at time t, with as the set of nodes over all time
V The distributed setting stated in Definition 3 poses severe
steps, t as the set of edges at time t, and Xt as the node
E challenges to existing spatio-temporal modeling techniques
features at time t.
and emergence detection methods:
Definition 2 (CPD in dynamic graphs). The task of CPD (1) Conditions 1 and 3 state that the hidden vectors of
in dynamic graphs aims to find a set of change points agents are not shared. Thus, the common practice of
T∗ = {t ∗k}K k=1 from a graph series {Gt }T t=1. The change stacking multiple GNN layers [35] to capture long-range
points split [1,T] into contiguous segments such that [1,T]= dependence over multi-hop neighbors is inapplicable.
K k=∗ 1−1[t ∗k,t ∗k+1], with t ∗1 =1 and t ∗K =T. (2) Conditions 2 and 3 state that it is hard to reach con-
sensus among agents via local communication within a
SThe node set is assumed time-invariant for simplicity.
V limited time, because the communication graph changes
One can always include nodes appearing at all time steps to
constantly and it is not necessarily connected [36]. See
form . The node feature xt R4 is an agent’s 2D position
V ∈ Appendix A for further demonstration.
and velocity in this paper.
(3) Condition 3 states that the global monitor is unable to
Under the distributed setting, the global monitor does not
make global detection by utilizing agents’ states in an
have direct access to agents’ states. Each agent as a local
end-to-end manner.
detector has limited vision and shares limited messages.
These challenges motivate the key design choice of HiST-
Definition 3 (Distributed Setting for Emergence Detection). CLED, that is, modeling the spatio-temporal dependency at
A qualified emergence detection method under the distributed different levels and aggregating the information hierarchi-
setting should satisfy the following three conditions: cally. An overview of HiSTCLED is shown in the left part
Condition 1. An agent only senses the states of other of Figure 2. It contains three hierarchies from bottom-up,
•
agents within a certain radius. Formally, the neighbor- agents, region monitors, and a global monitor. It can beJOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 4
conceptuallyimplementedbytheend-edge-cloudcollaborative et et measuresthespatialdifferencebetweenagentj andits
i− j
framework [37]. The area where all agents move is split into neighbor i in the latent space. It may capture nonlinear rela-
several connected regions. In each region, every agent senses tionsthatarenotfullyreflectedinquantitiesoftherawspace,
the states of its neighbors and detects if its relationship with e.g., relative positions and velocities. f is a value function
V
neighbors changes significantly. Each agent communicates implemented by a linear mapping. αt = softmax( at : i
ij { ij ∈
withitsneighborstoenhancetheagent-leveldetectingresults. t ) is the normalized attention score, with at defined as
Nj} ij
The detecting results of agents within the same region are
aggregated by the corresponding region monitor. The regional at ij = √1 Df Q et j T f K et i , (4)
results are analyzed by the global monitor to make a system-
(cid:0) (cid:1) (cid:0) (cid:1)
level detection that is aware of emergence-related patterns. where f Q and f V are linear layers accounting for the query
The agent-level and system-level detection are supported function and the key function, respectively.
by agent-level and system-level representation learning, re- The spatial transformer does not require temporal embed-
spectively. STEs are designed to capture nonlinear agent- dings of neighbors within a time window, which is desirable
to-agent and region-to-region relationships. Self-supervised because the neighbors frequently change.
Thetemporaltransformerisinstantiatedasastandardtrans-
learning strategies are designed to learn agent representations
former [40], because it is powerful for sequential modeling,
and the system representation that preserve spatio-temporal
and it allows parallel execution, which is favorable for online
consistency.Theinconsistencyinsystemrepresentationserves
detection. At its core is a temporal attention mechanism that
asadetectionsignalforemergence.Formally,HiSTCLEDcan
maps spatial representations to temporal representations,
bedescribedasathree-stepprocess,correspondingtoitsthree-
level structure, 1 T
hτ(w):τ =softmax qτ(w):τ kτ(w):τ vτ(w):τ, (5)
s1:T =AgentDetect X1:T RT ×|V|,
j (cid:18)√D j
(cid:16)
j
(cid:17) (cid:19)
j
∈
y1:T =CoarseGrain (cid:0)s1:T
(cid:1)
RT ×M, (1) where qτ j(w):τ,kτ j(w):τ and v jτ(w):τ are query, key and value
∈
s1:T =SystemDetec (cid:0)t y1: (cid:1)T RT. vectors transformed from zτ(w):τ, respectively.
G ∈ Disentangling the spatial and temporal information also
s1:T areagent-leveldetectingscor(cid:0)es,wh(cid:1)icharecoarse-grained makes the spato-temporal encoder friendly to streaming data
to M regions’ states y1:T. s1:T are system-level detecting because the agent representations can be updated incremen-
scores based on region statesG. The following sections will tally.Asthetimestepτ increasesby1,onlythecurrentspatial
describe the process of HiSTCLED in detail. representation zτ+1 needs to be computed, while zτ(w)+1:τ
j j
can be reused. For the temporal transformer, intermediate
results like the unnormalized attention scores and the query
C. Agent-Level Detection
vectors that only involve
zτ(w)+1:τ
can be stored. The nor-
j
Theprocedureofagent-leveldetectionisshownintheright malized attention scores and the temporal representations can
bottom part of Figure 2. be computed by further incorporating zτ+1. Details can be
j
1) Spatio-Temporal Encoder: To make online detection at found in Appendix C.
time τ, each agent records its state and its neighbors’ states 2) Spatio-Temporal Consistency Learning (STCL): Since
in the last w time steps. Denoting τ(w) = τ w+1 as the the labels of emergence are rarely known a priori, this pa-
−
initial step of the time window, these states are transformed per proposes to train STE in a self-supervised manner by
to agent representations by the agent-level STE, preserving the spatio-temporal consistency of the agent repre-
sentations. STCL is inspired by an influential non-contrastive
h jτ(w):τ =STE
A
x jτ(w):τ, xt
i
:i ∈Njt τ
t=τ(w)
∈Rw ×D, method called bootstrapping your own latent (BYOL) [41],
(cid:16) (cid:8) (cid:9) (cid:17) (2) which avoids explicit negative samples by aligning different
Due to Conditions 1 and 3 of the distributed setting, each views of the same sample encoded by asymmetric neural
agent cannot acquire their neighbors’ latent representations. networks. BYOL is briefly introduced in Appendix A.
Thus, the popular design choice of integrated dynamic GNNs Unlike BYOL that uses a single objective, STCL disen-
that model spatio-temporal entangled relations [38, 39] is tangles the learning objectives of temporal consistency and
inapplicable. Instead, this paper adopts a stacked architecture spatial consistency since they characterize different aspects
composed of a spatial transformer and a temporal trans- of the dynamic system. For each aspect, an online network
former [40], disentangling spatial and temporal dependency. and a target network with asymmetric network structures are
designed to process different views of the same agent. These
The spatial transformer models the relationship between an
views are constructed by leveraging the intrinsic spatial and
agentanditsneighborsateachtimestep.Thestateofanagent
xt is first embedded as a hidden vector through a single-layer temporalrelationswithinthedataotherthandataaugmentation
j
perceptron, i.e., et = Emb(xt). Then, a scaled-dot product that may damage the spatio-temporal semantics [31]. Given a
j j
view of some agent, the online network is trained to align the
attention mechanism [40] with a skip connection is applied to
output of the target network for another view.
calculate the spatial representation
In the following subsections, a symbol with a tilde stands
zt =et + αt f et et . (3) for an element from the target branch, e.g., a vector h and
j j ij V i− j
iX∈Njt
(cid:0) (cid:1)
a function f. Symbols without a tilde come from the online
e
eJOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 5
branch. A vector with a superscript t is called a transient rep- where η [0,1] is a decay rate. The final Θ for emergence
A
∈
resentation at time t, e.g., ht. A vector with a superscript (τ) detection is obtained when the iterative process converges.
stands for a short-term representation within a time window 3) Communication: Although each agent can make detec-
[τ(w),τ], e.g., h(τ). tion independently, sharing the detecting scores will make
a) Temporal Consistency Loss: When emphasizing the the detection more robust. In DETect [7], an agent only
temporal consistency, the agent representation ht is mapped communicates with a randomly selected neighbor. Taking a
j
to a temporal space via the temporal projection Proj . The step further, our method allows each agent to update its own
T
resultingvectorsvt arereducedtoashort-termrepresentation score st by combining the scores of all neighbors and the
j j
via a temporal pooling function Pool , mean pooling here: dissimilarity between representations of adjacent steps,
T
v jt =Proj T ht j , v j(τ) =Pool T v jτ(w):τ . (6) sτ j+1 =α ·d h( jτ),h( jτ −1) + (1 τ− +α)
1
sτ i. (13)
To ensure that the s(cid:0)hort(cid:1)-term representation(cid:16) is consi(cid:17) stent with (cid:16) (cid:17) |Nj | i ∈NXjτ ∪{j }
the transient representations, and thus capturing the tendency where h(τ) =p hτ(w):τ . α [0,1] is a mixing coefficient.
withinthetimewindow,thispaperminimizesthedissimilarity j T ∈
When α = 1, the messages from neighbors are ignored, and
between them. The dissimilarity is defined as the complement (cid:0) (cid:1)
when α = 0, the agent is overwhelmed by its neighbors’
of the cosine similarity,
detecting scores. The communication cost can be controlled
d v(τ),ht = 1 1 cos v(τ),ht . (7) by setting a budget for the number of neighbors.
j j 2 − j j
Then, the te(cid:16) mporal co(cid:17) nsisten(cid:16) cy loss is(cid:16) defined(cid:17) as(cid:17) the average D. Coarse Graining and System-Level Detection
e e
temporal dissimilarity of all agents within the time window, The procedure of system-level detection is shown in the
τ right top part of Figure 2.
1
= d v(τ),ht . (8) 1) Coarse Graining: The area where all agents move is
LT w j j
|V|j X∈Vt=Xτ(w) (cid:16) (cid:17) split into several adjacent regions {Rm }M m=1 in a grid shape.
e The detecting scores of agents within a region are aggregated
b) Spatial Consistency Loss: When emphasizing the
spatial consistency, ht is mapped to a spatial space via the as the region’s state,
j
spatial projection Proj S. To avoid disturbing the optimization y mt = st j. (14)
of the temporal counterpart, this paper further transforms
the resulting vectors with a multi-layer perceptron (MLP) to
j ∈XRm
Theseregionsformaregiongraph t =( , ,yt),with
construct an asymmetric branch, i.e., RG RV RE
as the set of regions, as the set of edges between
nt =Proj ht , m(τ) =Pool MLP nτ(w):τ . (9) R regV ions, and yt as the regionR sE tates at time t. The formulation
j S j j T j
can be naturally extended to regions with irregular boundaries
By minimi(cid:0)zing(cid:1) the dissimilarity (cid:16) betwee(cid:16) n the sh(cid:17) o(cid:17) rt-term
and complex graph structures [45, 46]. This paper considers
representation of each agent and its neighbors, the model
grid-shape region graphs for a proof of concept, while more
learns to preserve spatial consistency, i.e.,
complex scenarios are left for future work.
= 1 d m(τ),n(τ) , (10) 2) Region Representation: As in agent-level detection, a
LS κ j i region-level ST STE with a similar network structure is
R
|V|j X∈Vi X∈Nj (cid:16) (cid:17) applied to the region graph for obtaining the representation
where j contains κ random neighbors efrom the temporal rt for each region, i.e.,
neighboN rhood τ t. The sampling probability of a m
neighbor is pro∪ pot= rtτ io(w na)N l tj o its frequency. rτ m(w):τ =STE R y mτ(w):τ, y nt :n ∈RNm τ t=τ(w) , (15)
As STE A is responsible for representation, while Proj T where is th(cid:16) e set of (cid:8)region m’s neigh(cid:9)boring(cid:17) regions.
and Proj are responsible for projections, they are simply RNm
S Based on region representations, a system representation is
implemented as MLPs. Mean pooling is adopted for Pool
T learned to gain a global view of the system. Hence, the
and Pool for simplicity, and more advanced spatial pool-
S variation in system representations indicates the formation or
ing [35, 42] and temporal pooling [43] methods are left for
evaporationofemergence.Likewise,temporalandspatialcon-
future work.
sistency losses are designed to guide the learning procedure.
c) Optimization: Combining the temporal consistency
3) Spatio-Temporal Consistency Learning:
lossandthespatialconsistencyloss,theoveralllossforagent-
a) TemporalConsistencyLoss: Aregionalspatialprojec-
level learning is
tion Proj with a regional spatial pooling function Pool
= + . (11) RS RS
LAgent LT LS is applied to obtain the transient system representation,
Directly minimizing the above loss will lead to collapsed rt =Pool Proj rt :m . (16)
representations [41]. To avoid this, the parameters Θ A of the G RS RS m ∈RV
online branch are optimized by a gradient-based algorithm, Then, a regional temp(cid:0)o(cid:8)ral proje(cid:0)ction(cid:1) Proj RT fo(cid:9)ll(cid:1)owed by a
e.g., Adam [44], while parameters Θ A of the target branch regionaltemporalpoolingfunctionPool RT isappliedtoobtain
are updated by exponential moving average [41], the short-term system representation,
Θ A ←Opt( LAgent,Θ A), Θ A ←ηe Θ A+(1 −η)Θ A, (12) u(τ) =Pool RT Proj RT rτ G(w):τ . (17)
(cid:16) (cid:16) (cid:17)(cid:17)
e eJOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 6
By minimizing the dissimilarity between u(τ) and rt, the F. Characteristics of HiSTCLED
model learns to preserve system-level temporal consisteGncy,
HiSTCLED is characterized by the following features.
1 τ e (1) By hierarchically aggregating agent-level detecting re-
= d u(τ),rt . (18)
LST w G sults, HiSTCLED can capture emergence-related spatial
t=Xτ(w) (cid:16) (cid:17) patterns ignored by DETect, where agents’ feedback is
b) Spatial Consistency Loss: The esystem-level spatial summed up indiscriminately.
consistencylossensuresthatthesystemrepresentationu(τ) is (2) Thanks to the spatio-temporal disentangled architecture,
consistent with the representation of each region. A regional STE can capture agents’ nonlinear relationships under
spatial projection Proj RS together with a regional temporal the distributed setting, where popular designs of spatio-
pooling function Pool RT is applied to obtain the region temporal integrated GNNs are infeasible.
representation within a time window, (3) STCL preserves the spatio-temporal consistency within
w(τ) =Pool Proj rτ(w):τ . (19) both agent-level and system-level representations. Com-
m RT RS m pared with BYOL, it avoids potentially harmful data
(cid:16) (cid:16) (cid:17)(cid:17)
By minim eizing the dissimiglarity be etween u(τ) and w m(τ) , augmentations, and can handle multiple objectives in a
the characteristics of each region are preserved in the system disentangled way. It is free of negative samples, sig-
representation, e nificantly reducing the computational cost for spatio-
temporal data.
1
= d u(τ),w(τ) , (20)
LSS κ m
m X∈D (cid:16) (cid:17) IV. EXPERIMENTS
where containsκsampledregionsfroem .Forsimplicity,
D RV A. Datasets
Proj and Proj are implemented as MLPs, while Pool
ST SS RT
and Pool are mean pooling, as in agent-level detection. Evaluating the performance of online emergence detection
RS
The overall loss for system-level learning is the sum of methods generally requires building simulation environments
temporal consistency loss and spatial consistency loss to simulate the state evolution of agents. This paper adopts
three simulation environments from DETect [7] implemented
= + . (21)
LSystem LST LSS by NetLogo [47]. They are equipped with well-known yet
The parameters of region-level online and target networks hard-to-detect emergent phenomena. Agents move in a 2D
areupdatedinthesamewayasEq.(12).Currently,agent-level bounded world composed of patches. The resulting datasets
andsystem-levelSTCLaretrainedseparately.Thereasonsare are briefly described as follows.
twofold: (1) the construction of region states requires high- Flock [48]: Each agent is a bird. The emergence is the
•
quality agent-level detecting scores; (2) it is hard to define flocking behavior. The objective measure of emergence
meaningfulsystem-leveltrainingsignalforagent-levelmodels is the number of patches that contain no birds.
withoutthetruthchangepoints.Ajointoptimizationofthetwo Pedestrian [11]: Each agent is a pedestrian walking
•
hierarchies is left for future work. either from left to right or in the opposite position. The
The system-level detecting score is defined as the dissimi- emergence is the counter-flow. The objective measure of
larity between system representations of adjacent time steps, emergence is the number of lanes formed by pedestrians.
sτ =d u(τ),u(τ −1) . (22) • Traffic [7]: Each agent is a car running on the road net
G of Manhattan, New York City. The road net contains
(cid:16) (cid:17)
A summary of notations used in this paper is shown in 6,657 junctions and 77,569 road segments. The cars are
Appendix B. The pseudo codes for STCL and emergence routed by a routing engine GraphHopper [49] based on
detection are shown in Appendix C. real-world car records. The emergence happens when
a significant number of streets get congested. Thus,
E. Time Complexity Analysis of HiSTCLED the objective measure of emergence is the number of
At the agent level, the time complexity of spatial encoding congested road segments.
at time t is O( t ), and the time complexity of temporal OnFlockandPedestriandatasets,real-worlddataisunavail-
|E |
encoding within a time window is O( w2). Thus, the able.Thus,reasonablebehavioralrulesaredesignedforagents.
|V|
total complexity of spatio-temporal encoding is O( w2 + On Traffic dataset, the real-world data is combined with
τ t ). The time complexity for evaluating | tV he| tem- simulation rules to mimic agents’ behaviors. Visualizations of
t=τ(w)|E |
poral consistency loss and the spatial consistency loss is emergent behaviors on all datasets are shown in Appendix D.
P
O(w )andO(κ ).Thetimecomplexityofcommunication A summary of important statistics of the datasets is shown in
|V| |V|
isO( t )ateachtimestep.Therefore,atboththetrainingand Table I. Each dataset contains 20 times of simulations, with
|E |
inference stages, the time complexity is linear of the number 5 times as the training set, 5 times as the validation set, and
of agents and the number of edges. the rest as the testing set. Following O’toole et al. [7], the
Similarly, the time complexity of system-level spatio- objectivemeasureisevaluatedevery50steps.Thegroundtruth
temporalencodingisO( w2+ w).Thecomplexityof change points are labeled by running offline CPD algorithms
|RV| |RE|
evaluating system-level temporal consistency loss and spatial providedbyruptures[50].OfflineCPDalgorithmshaveaccess
consistency loss are O(w) and O(κ), respectively. to the whole series, and thus the labeled change points areJOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 7
TABLEI C. Baselines
STATISTICSOFDATASETS.
To demonstrate the effectiveness of our method, this pa-
Datasets Flock Pedestrian Traffic per compares it with DETect and some state-of-the-art deep
#Agents 150 382 2,522 learningmethodsincloselyrelatedfields,includingtimeseries
Shapeofgrid 51 51 40 40 841 841 CPDmethodTS-CPP[54],timeseriesADmethodGDN[24],
× × ×
#Simulationsteps 50,000 50,000 60,000 and graph-level AD method OCGTL [27]. Advanced tech-
niques like GNNs and contrastive learning are used in these
#Evaluationsteps 1,000 1,000 1,200
methods. They are adapted to our framework at both agent-
#Changepoints 10 10 10
≈
level and system-level detection. They are renamed with a
suffix “+HED”, short for Hierarchical Emergence Detection.
more reliable and accurate. The results are checked manually. DETect: A decentralized method for online emergence
•
It turns out that change points make up no more than 1% detection. Each agent detects the change in relationships
of all evaluation steps. The severe imbalance between change between its neighbors and itself via a linear model. The
pointsandnormalpointsincreasesthechallengeofemergence detectingresultsareaggregatedtomakeaglobaldecision.
detection. TS-CPP+HED:AtimeseriesCPDmethodbasedoncon-
•
trastive learning. Temporal convolutional networks [55]
are used for time series encoding, and the similarity
B. Evaluation Metrics
between two contiguous time segments is used as the
Due to the unpredictability of emergence, it can be difficult indicator for CPD.
todetecttheexactchangepoints.Theformationorevaporation GDN+HED:AGNN-basedmethodformulti-variatetime
•
of emergence can happen in a short period rather than a series AD. It uses graph attention to capture the re-
specific time step. Therefore, it is reasonable to accept more lationships between sensors and defines the maximum
than one detection around a true change point in practice. deviation score for AD.
In this paper, the detections within a given tolerance θ are OCGTL+HED: A graph-level AD method that combines
•
regarded as one true positive (TP), while the rest detections one-class classification and neural transformation learn-
are regarded as negative positive (FP), i.e., ing [56], an advanced self-supervised learning technique.
The codes of all baselines are publicly available. The code
TP= t
∗ ∈T∗
: ∃t ∈T,s.t. |t −t
∗
|≤θ ,
of DETect1 is directly applied to our experiments. The code
(cid:12)n o(cid:12) of TS-CPP2, GDN3 and OCGTL4 are adapted to our frame-
FP=(cid:12) t : t ∗ b∗, t t ∗ >θ , (cid:12)
(cid:12) ∈T ∀ ∈T | − | (cid:12) work. Implementation details of HiSTCLED are described in
(cid:12)n o(cid:12)
where ∗ and(cid:12) (cid:12) arebthe set of true change point(cid:12) (cid:12)s and the set Appendix D.
T T
of detected ones, respectively. This paper sets θ = 20 for all
datasets. Definibng the precision Prec = TP and the recall D. Comparison with Baselines
TP+FP
rate Rec= TP , the F1 score can be computed as The detecting performance of different methods are shown
|T∗| in Table II. The metrics of DETect are relatively low on all
2 Prec Rec datasets, showing that emergence detection can be difficult
F1= × × .
Prec+Rec for traditional methods even on the simulation datasets. Deep
learning methods generally outperform DETect in both met-
The F1 score measures the overall accuracy of CPD. This
rics, and HiSTCLED achieves the highest performance. The
paper further uses the covering metric [51, 52] to measure the
results verify the superiority of our framework, which can
overlappingdegreebetweenthegroundtruthsegmentsandthe
captureemergence-relatedspatialpatternsandmodelnonlinear
detectedsegments.Let bethesetofgroundtruthsegments
∗
A spatio-temporaldynamics.GDN+HEDcalculatesthedetecting
,withasimilardefinitionfor and .Thecoveringmetric
∗
I A I score based on next-step prediction error, which can be sensi-
is defined as
tive to the noise in the states. HiSTCLED calculates the score
1 b b
Cover ∗, = ∗ maxJ ∗, , based on the consistency of representations, which is resistant
A A T |I |· I I
to potential noise. HiSTCLED jointly preserves spatial and
(cid:16) (cid:17) I∗X∈A∗ I∈A (cid:16) (cid:17)
b b temporalconsistency,andthusoutperformsTS-CPP+HEDthat
b b
where J ∗, = |I∗∩I| is the Jaccard index [53] measur- ignores spatial consistency and OCGTL+HED that ignores
I I
ing the o(cid:16)verlapp(cid:17)ing
d|I e∗ g∪ reIbe|
between two segments.
temporal consistency.
b b
In the original paper of DETect [7], the detecting perfor-
E. Ablation Study
mance is quantitatively evaluated by checking if the number
of detected events is significantly larger during the emergent Some variants of HiSTCLED are introduced to verify the
periods than the non-emergent periods. Nonetheless, the de- necessity of capturing emergence-related patterns and mod-
viation between detected change points and the ground truth
1https://github.com/viveknallur/DETectEmergence/
is not assessed. Therefore, this paper hopes to fill the gap
2https://github.com/cruiseresearchgroup/TSCP2
by introducing the two metrics, and push the current research 3https://github.com/d-ailin/GDN
towards more timely emergence detection. 4https://github.com/boschresearch/GraphLevel-AnomalyDetectionJOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 8
TABLEII
DETECTINGPERFORMANCEOFDIFFERENTMETHODS.BOTHTHEMEANVALUEANDTHESTANDARDDEVIATIONAREREPORTED.THEBESTRESULTS
AREINBOLD.THEIMPROVEMENTSARESIGNIFICANT(p-VALUE<0.05).THERELATIVEIMPROVEMENTSARECOMPUTEDW.R.T.DETECT.
Datasets Flock Pedestrian Traffic
Metrics F1 Cover F1 Cover F1 Cover
↑ ↑ ↑ ↑ ↑ ↑
TS-CPP+HED 0.7003 0.0029 0.6444 0.0148 0.7105 0.0260 0.6720 0.0320 0.3673 0.0370 0.5315 0.0313
± ± ± ± ± ±
GDN+HED 0.6755 0.0441 0.6902 0.0254 0.7181 0.0319 0.7123 0.0132 0.3473 0.0067 0.5276 0.0040
± ± ± ± ± ±
OCGTL+HED 0.7092 0.0301 0.7299 0.0437 0.9248 0.0207 0.8854 0.0134 0.3674 0.0379 0.5713 0.0194
± ± ± ± ± ±
DETect 0.4862 0.0507 0.6559 0.0284 0.2064 0.0807 0.4408 0.0416 0.3479 0.0875 0.5479 0.0558
± ± ± ± ± ±
HiSTCLED 0.7757 0.0026 0.7810 0.0116 0.9352 0.0096 0.9235 0.0107 0.3928 0.0235 0.5872 0.0093
± ± ± ± ± ±
Improvement +59.54% +19.07% +353.10% +109.51% +12.91% +7.17%
20 20
18 18
16 16
14 14
12 12
10 10
8 8
6 6
4 4
2 2
2 4 6 8 10 12 14 16 18 20 2 4 6 8 10 12 14 16 18 20
(a)Statesofroadnets. (b)Statesofregions.
Fig.3. CasestudyofspatialpatternsonTrafficdataset.In(a),eachlinesegmentrepresentsaroadsegment.Segmentsinredarecongested,whilethosein
grayarenormal.In(b),eachgridrepresentsaregionstate.Thedarkerthecolor,themoreagent-leveldetectionsarecollected.Bestviewedincolor.
eling agents’ relationships with neighbors. HiSTCLED  2 E M H F W L Y H  0 H D V X U H  R I  ( P H U J H Q F H
Agent  
removes system-level detection. HiSTCLED makes agent-
Self
level detection without modeling the spatial relationships, i.e.,  
                      
removing the spatial encoder and training without the spatial  ' L V V L P L O D U L W \  E H W Z H H Q  $ J H Q W V 
  D Q G  7 K H L U  1 H L J K E R U V 
  5 H S U H V H Q W D W L R Q V
consistency loss. The Results are shown in Table III.     
a) Effect of System-Level Detection: Without system-
    
leveldetection,theaverageF1scoreandthecoveringmetricof                       
 ' L V W D Q F H  W R  W K H  & H Q W H U  R I  1 H L J K E R U V
HiSTCLED Agent decrease by 0.0943 and 0.0970, respectively.    
The results verify that the spatial patterns of agent-level    
detecting results help with emergence detection.
                      
To see what patterns are captured by HiSTCLED, a case  1 X P E H U  R I  1 H L J K E R U V
study is conducted on Traffic dataset. Figure 3 visualizes the   
  
congesting states of the road net and the region states when   
the network-level congestion forms. Figure 3(a) shows that                       
 ' L I I H U H Q F H  L Q  9 H O R F L W \
congested road segments constitute a connected subnetwork    
with a diameter of 80, accounting for more than 1 of the
3    
diameter of the road net. The phenomenon confirms the                       
 6 W H S V
emergence of widespread congestion. Such emergence-related
pattern is almost faithfully reflected in region states. The
Fig. 4. Case study of agents’ relationships on Flock dataset. The variation
results also show that HiSTCLED can detect the emergence curves of the objective measure, agents’ dissimilarity in latent space, and
of widespread congestion even when the traffic flow is not agents’relationshipsw.r.t.threeindicatorsarevisualized.Bestviewedincolor.
provided.
b) Effect of Agent-Level Detection: Compared with
HiSTCLED ,theaverageF1scoreandthecoveringmetric To see how HiSTCLED captures the relationships, this
Agent Agent
ofHiSTCLED decreaseby0.0264and0.0171,respectively. paper conducts a case study on Flock dataset. Inspired by
Self
The results show that modeling the nonlinear relationship O’toole et al. [7], three indicators are used to measure the
between an agent and its neighbors is indispensable for relationships w.r.t. agents’ states, including the distance to
agent-level detection. Note that HiSTCLED is better than the center of neighbors, the number of neighbors, and the
Agent
DETect on Flock and Pedestrian datasets, and on par with it difference between an agent’s velocity and its neighbors’
on Traffic dataset, which again verifies the effectiveness of average velocity. The objective measure of emergence is set
agent-level spatio-temporal modeling. as a reference. Agents’ and their neighbors’ dissimilarity inJOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 9
TABLEIII
ABALATIONSTUDY.BOTHTHEMEANVALUEANDTHESTANDARDDEVIATIONAREREPORTED.THEBESTRESULTSOFAGENT-LEVELAND
SYSTEM-LEVELDETECTIONAREINBOLD.THEIMPROVEMENTSARESIGNIFICANT(p-VALUE<0.05).
Datasets Flock Pedestrian Traffic
Metrics F1 Cover F1 Cover F1 Cover
↑ ↑ ↑ ↑ ↑ ↑
HiSTCLEDAgent-S 0.6351 ±0.0451 0.6962 ±0.0438 0.7627 ±0.0556 0.7430 ±0.0361 0.3189 ±0.0265 0.5319 ±0.0106
HiSTCLEDAgent-T 0.6264 ±0.0271 0.6847 ±0.0275 0.7773 ±0.0119 0.7490 ±0.0250 0.3197 ±0.0361 0.5227 ±0.0164
HiSTCLEDAgent 0.6705 ±0.0114 0.6960 ±0.0168 0.7965 ±0.0163 0.7601 ±0.0108 0.3538 ±0.0027 0.5445 ±0.0090
HiSTCLEDS 0.7155 ±0.0317 0.7516 ±0.0169 0.9220 ±0.0142 0.9089 ±0.0199 0.3690 ±0.0266 0.5755 ±0.0361
HiSTCLEDT 0.7564 ±0.0620 0.7680 ±0.0310 0.9278 ±0.0122 0.9082 ±0.0187 0.3735 ±0.0233 0.5880 ±0.0219
HiSTCLEDSelf 0.6413 ±0.0303 0.6899 ±0.0319 0.7732 ±0.0128 0.7211 ±0.0325 0.3271 ±0.0227 0.5382 ±0.0088
HiSTCLED 0.7757 0.0026 0.7810 0.0116 0.9352 0.0096 0.9235 0.0107 0.3928 0.0235 0.5872 0.0093
± ± ± ± ± ±
             
    
                  
              
   
    
         
        
         
5×5 10×10 15×15 20×20 25×25 30×30                                            
 * U D Q X O D U L W \  R I  U H J L R Q V  0 L [ L Q J  F R H I I L F L H Q W    I R U  F R P P X Q L F D W L R Q
Fig.5. EffectofregiongranularityonTrafficdataset.Thedashedvertical Fig. 6. Effect of agents’ communication on Traffic dataset. The dashed
lineindicatesthebestresults.Bestviewedincolor. verticallineindicatesthebestresults.Bestviewedincolor.
     performance in most cases. Thus, the spatial consistency loss
          and temporal consistency loss are complementary to learning
          discriminative representations for emergence detection.
    
    
    
    
F. Hyperparameter Analysis
         
          a) Effect of Region Granularity: The area where agents
                               moveissplitintomanyregionsforsystem-leveldetection.The
 6 L ] H  R I  W L P H  Z L Q G R Z w
granularity of regions decides how many details are preserved
Fig.7. Effectofwindowsizeinsystem-leveldetectiononPedestriandataset. for global analysis. To study the effect of region granularity,
Bestviewedincolor.
this paper trains the system-level detector on Traffic dataset
under several N N grids, with N 5,10,15,20,25,30 .
× ∈ { }
TheresultsareshowninFigure5.TheF1scoreislowestwhen
representations stands for relationships in the latent space. N =5. Maybe coarsening too much will result in inadequate
The variation curves of the aforementioned metrics are shown
information that cannot support accurate detection. Both the
in Figure 4. As expected, during the emergent period of F1 score and covering metric increase as N grows but start to
flocking,birdsgetcrowded,andthus,thedistancesaresmaller, decrease at N =20. When N is too large, the regions are too
the neighbor count increases, and the difference in velocity
small to collect sufficient feedback from agents and present
decreases. Different metrics present different patterns, yet
stable spatial patterns. Thus, our method achieves the highest
these patterns are approximately captured by the latent repre- performance for N =20 with a moderate computational cost.
sentations.Thetendencyofthedissimilaritycurvealsoagrees
b) Effect of Mixing Coefficient for Communication:
with that of the objective measure. These results show that
Agents communicate with neighbors to make agent-level de-
our method can somehow capture the relationships defined by
tections. The mixing coefficient α in Eq. (13) balances the
some intuitive metrics w.r.t. agents’ states.
importanceofanagent’scurrentobservationanditsneighbors’
c) Effect of Spatial and Temporal Consistency Losses: detecting scores. α is set to 0.05 to keep consistent with
To validate the effectiveness of STCL for both agent-level DETect.Toseehowαaffectsthedetectingaccuracy,thispaper
and system-level detection, this paper introduces variants of evaluates HiSTCLED on Traffic dataset with α ranging
Agent
HiSTCLED and HiSTCLED trained with only the spatial from0.1to1.AsshowninFigure6,theF1scoreandcovering
Agent
orthetemporalconsistencyloss.Theresultingmethodsarede- metriccanbepromotedbyincreasingα,i.e.,assigningalarger
noted as HiSTCLED , HiSTCLED , HiSTCLED , weight to agents’ current observation. However, when α=1,
Agent-S Agent-T S
and HiSTCLED , respectively. As shown in Table III, remov- i.e., agents ignore the detecting scores of their neighbors,
T
ing any term in the loss function will lead to degenerated the F1 score drops significantly, verifying the necessity of
 H U R F V   )
 H U R F V   )
 F L U W H P  J Q L U H Y R &
 F L U W H P  J Q L U H Y R &
 H U R F V   )
 F L U W H P  J Q L U H Y R &JOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 10
     2 E M H F W L Y H  P H D V X U H
   
   
   
   
       
                      
     ' ( 7 H F W  ' H W H F W L Q J  V F R U H V  R I  ' ( 7 H F W
 + L 6 7 & / ( '
   
                              
 
 0 D U J L Q
Fig.8. Effectofthresholdθ onPedestriandataset.Bestviewedincolor.  
                      
 ' H W H F W L Q J  V F R U H V  R I  + L 6 7 & / ( '
  H 
communication. The results show the possibility of tuning
 
α to improve the detecting accuracy. Furthermore, α can be
personalized and adaptive over time. Optimizing the choices  
of α is left for future work.
 
c) Effect of Window Size for Emergence Detection: The                       
 6 W H S
window size w is the temporal scope of emergence detection.
Like the granularity of regions, there is a tradeoff between
Fig. 9. Visualization of the ground truth change points (top), and change
precision and efficacy w.r.t. w. It is set to 10 for agent-level points detected by DETect (middle) and HiSTCLED (bottom) on Pedestrian
detection, since the objective measure of emergence is evalu- dataset.Thevariationcurvesareinblack.Thechangepointsaremarkedas
stars.Theperiodsofemergenceareingreen.Thenormalperiodsareinpurple.
ated every 50 steps and the states of agents are downsampled
Bestviewedincolor.
every5steps.Inthisway,agentscanmakerelativelyaccurate
and timely detections. However, performance degeneration is
with significantly smaller deviations.
observed for system-level detection with the same window
size.Itisconjecturedthatsystem-levelneedsalargertemporal
scopewithcoarse-grainedspatialinformation.Theeffectofw
V. CONCLUSION
is studied on Pedestrian dataset, with w 10,20,...,100 . ThispaperproposesahierarchicalframeworknamedHiST-
∈ { }
As shown in Figure 7, the F1 score generally increases as w CLED for emergence detection in CAS under the distributed
grows, while the covering metric peaks at w =40. Therefore, setting. By aggregating agent-level detecting results from
to achieve better overall performance with a moderate com- bottom-up, HiSTCLED learns a system representation that
putational cost, w is set to 40 for system-level detection. This captures emergence-related patterns. Nonlinear relationships
choice is also practical since the global monitor generally has between agents and their neighbors are encoded in agent
a larger capacity than a single agent. representationsthroughSTE.Theserepresentationsarelearned
d) Effect of Threshold θ: In the experiments, the thresh- in a self-supervised manner by preserving the spatio-temporal
old θ is set to 20 on all datasets for fairly comparing the consistency.HiSTCLEDsurpassesthetraditionalmethodsand
detecting precision of different methods. Apparently, the F1 deep learning methods on three datasets with well-known yet
scoresareaffectedbythechoicesofθ.Thispaperevaluatethe hard-to-detect emergent phenomena. HiSTCLED is flexible to
F1scoresofHiSTCLEDandDETectonPedestriandatasetfor incorporate deep learning methods from graph-level CPD and
θ 10,20,...,100 , and the results are shown in Figure 8. anomaly detection for effective emergence detection.
Fo∈ r { both methods, t} he F1 score grows approximately as θ FutureworkincludesintroducingdistributedGNNsandad-
increases, because a larger tolerance allows to include more vanced CPD methods to boost the performance of emergence
detectedchangepoints.Onthewhole,HiSTCLEDconsistently detection. Designing graph learning methods for emergence-
achieves higher detecting precision than DETect for all θ, related higher-order structures is also promising. Besides, it is
yet the difference narrows down as θ increases. Besides, the crucial to construct more realistic simulation environments to
varianceofDETect’sF1scorestendstogrowupforalargerθ, evaluate the performance and identify real-world challenges.
while HiSTCLED preserves a considerably smaller variance,
showing that the performance of HiSTCLED is more stable. REFERENCES
In practice, a relatively smaller threshold is more favorable, [1] O. Artime and M. De Domenico, “From the origin of
becausedetectedchangepointswithsmallerdisplacementhelp lifetopandemics:Emergentphenomenaincomplexsys-
to detect the emergence more timely. tems,” Philosophical Transactions of the Royal Society
To further differentiate the detecting quality of DETect and A, vol. 380, no. 2227, p. 20200410, 2022.
HiSTCLED, this paper visualizes their detected change points [2] S. Kalantari, E. Nazemi, and B. Masoumi, “Emergence
on Pedestrian dataset. As shown in Figure 9, DETect fails phenomena in self-organizing systems: A systematic
to detect change points in several periods, and the detected literature review of concepts, researches, and future
points are relatively far from the nearest ground truth. By prospects,” Journal of Organizational Computing and
contrast, HiSTCLED successfully detects all change points ElectronicCommerce,vol.30,no.3,pp.224–265,2020.
 H U R F V   )JOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 11
[3] E. O’toole, “Decentralised detection of emergence in dynamic social networks,” in Proceedings of the 26th
complex adaptive systems,” Ph.D. dissertation, Trinity International Joint Conference on Artificial Intelligence,
College (Dublin, Ireland), 2016. 2017, pp. 2992–2998.
[4] J. Fromm, “Types and forms of emergence,” arXiv [20] S. Huang, Y. Hitti, G. Rabusseau, and R. Rabbany,
preprint nlin/0506028, 2005. “Laplacian change point detection for dynamic graphs,”
[5] M.A.Bedau,“Weakemergence,”PhilosophicalPerspec- in Proceedings of the 26th ACM SIGKDD International
tives, vol. 11, pp. 375–399, 1997. Conference on Knowledge Discovery & Data Mining,
[6] G. Zeng, Z. Sun, S. Liu, X. Chen, D. Li, J. Wu, 2020, pp. 349–358.
and Z. Gao, “Percolation-based health management of [21] D. Sulem, H. Kenlay, M. Cucuringu, and X. Dong,
complex traffic systems,” Frontiers of Engineering Man- “Graph similarity learning for change-point detection in
agement, vol. 8, no. 4, pp. 557–571, 2021. dynamic networks,” Machine Learning, vol. 113, pp. 1–
[7] E. O’toole, V. Nallur, and S. Clarke, “Decentralised 44, 2023.
detection of emergence in complex adaptive systems,” [22] X. Ma, J. Wu, S. Xue, J. Yang, C. Zhou, Q. Z.
ACM Transactions on Autonomous and Adaptive Sys- Sheng, H. Xiong, and L. Akoglu, “A comprehensive
tems, vol. 12, no. 1, pp. 1–31, 2017. survey on graph anomaly detection with deep learning,”
[8] S.AminikhanghahiandD.J.Cook,“Asurveyofmethods IEEETransactionsonKnowledgeandDataEngineering,
for time series change point detection,” Knowledge and vol. 35, no. 12, pp. 12012–12038, 2023.
Information Systems, vol. 51, pp. 339–367, 2016. [23] A. D. Pazho, G. A. Noghre, A. A. Purkayastha, J. Vem-
[9] J. Gignoux, G. Che´rel, I. D. Davies, S. R. Flint, and pati,O.Martin,andH.Tabkhi,“Acomprehensivesurvey
E. Lateltin, “Emergence and complex systems: The con- of graph-based deep learning approaches for anomaly
tributionofdynamicgraphtheory,”EcologicalComplex- detectionincomplexdistributedsystems,”arXivpreprint
ity, vol. 31, pp. 34–49, 2017. arXiv:2206.04149, 2022.
[10] M. Mnif and C. Mu¨ller-Schloer, “Quantitative emer- [24] A. Deng and B. Hooi, “Graph neural network-based
gence,” in Organic Computing—A Paradigm Shift for anomaly detection in multivariate time series,” in Pro-
Complex Systems. Springer, 2011, pp. 39–52. ceedings of the AAAI Conference on Artificial Intelli-
[11] J. Procha´zka and K. Olsˇevicˇova´, “Monitoring lane for- gence, vol. 35, no. 5, 2021, pp. 4027–4035.
mationofpedestrians:Emergenceandentropy,”inAsian [25] Y. Zheng, H. Y. Koh, M. Jin, L. Chi, K. T. Phan,
ConferenceonIntelligentInformationandDatabaseSys- S. Pan, Y.-P. P. Chen, and W. Xiang, “Correlation-
tems. Springer, 2015, pp. 221–228. aware spatial–temporal graph learning for multivariate
[12] Q. Liu, M. He, D. Xu, N. Ding, and Y. Wang, “A time-series anomaly detection,” IEEE Transactions on
mechanismforrecognizingandsuppressingtheemergent NeuralNetworksandLearningSystems,November2023,
behavior of UAV swarm,” Mathematical Problems in doi:10.1109/TNNLS.2023.3325667.
Engineering, vol. 2018, 2018. [26] L.ZhaoandL.Akoglu,“Onusingclassificationdatasets
[13] J. Luo, J. Xin, G. Binghui, H. Zheng, W. Wu, and to evaluate graph outlier detection: Peculiar observations
W.Lv,“Dynamicmodelandcrowdentropymeasurement and new insights,” vol. 11, no. 3, pp. 151–180, 2023.
of crowd intelligence system (in Chinese with English [27] C. Qiu, M. Kloft, S. Mandt, and M. Rudolph, “Raising
abstract),” SCIENTIA SINICA Informationis, vol. 52, thebaringraph-levelanomalydetection,”inProceedings
no. 1, pp. 99–110, 2022. of the Thirty-First International Joint Conference on
[14] D. Fisch, M. Ja¨nicke, B. Sick, and C. Mu¨ller-Schloer, Artificial Intelligence, 2022, pp. 2196–2203.
“Quantitative emergence–A refined approach based on [28] A.Protogerou,S.Papadopoulos,A.Drosou,D.Tzovaras,
divergencemeasures,”inFourthIEEEInternationalCon- and I. Refanidis, “A graph neural network method for
ference on Self-Adaptive and Self-Organizing Systems. distributed anomaly detection in IoT,” Evolving Systems,
IEEE Computer Society, 2010, pp. 94–103. vol. 12, no. 1, pp. 19–36, 2021.
[15] A.K.Seth,“Measuringemergencevianonlineargranger [29] L. Wu, H. Lin, C. Tan, Z. Gao, and S. Z. Li, “Self-
causality.” in ALIFE, vol. 2008, 2008, pp. 545–552. supervisedlearningongraphs:Contrastive,generative,or
[16] R. L. Grossman, M. Sabala, Y. Gu, A. Anand, M. Han- predictive,” IEEE Transactions on Knowledge and Data
dley, R. Sulo, and L. Wilkinson, “Discovering emergent Engineering, vol. 35, no. 4, pp. 4216–4235, 2023.
behavior from network packet data: Lessons from the [30] S. Tian, R. Wu, L. Shi, L. Zhu, and T. Xiong, “Self-
angle project,” in Next Generation of Data Mining. supervised representation learning on dynamic graphs,”
Chapman and Hall/CRC, 2008, pp. 267–284. in Proceedings of the 30th ACM International Confer-
[17] M. A. Niazi and A. Hussain, “Sensing emergence in ence on Information & Knowledge Management, 2021,
complexsystems,”IEEESensorsJournal,vol.11,no.10, pp. 1814–1823.
pp. 2479–2480, 2011. [31] X. Liu, Y. Liang, C. Huang, Y. Zheng, B. Hooi, and
[18] E. Santos, Y. Zhao, and S. Go´mez, “Automatic emer- R. Zimmermann, “When do contrastive learning signals
gence detection in complex systems,” Complex., vol. help spatio-temporal graph forecasting?” in Proceedings
2017, 2017. of the 30th International Conference on Advances in
[19] Y. Wang, A. Chakrabarti, D. Sivakoff, and Geographic Information Systems, 2022, pp. 1–12.
S. Parthasarathy, “Fast change point detection on [32] L. Pei, Y. Cao, Y. Kang, Z. Xu, and Z. Zhao, “Self-JOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 12
supervisedspatiotemporalclusteringofvehicleemissions dictionforirregularregionswithsemanticgraphattention
with graph convolutional network,” IEEE Transactions network,” ACM Transactions on Intelligent Systems and
on Neural Networks and Learning Systems, July 2023, Technology, vol. 13, no. 5, pp. 1–14, 2022.
doi:10.1109/TNNLS.2023.3293463. [47] S. Tisue and U. Wilensky, “Netlogo: A simple environ-
[33] Q.Zhang,C.Huang,L.Xia,Z.Wang,Z.Li,andS.Yiu, ment for modeling complexity,” in International Confer-
“Automated spatio-temporal graph contrastive learning,” ence on Complex Systems, vol. 21. Boston, MA, 2004,
in Proceedings of the ACM Web Conference, 2023, pp. pp. 16–21.
295–305. [48] C. W. Reynolds, “Flocks, herds and schools: A dis-
[34] S. Ranshous, S. Shen, D. Koutra, S. Harenberg, tributed behavioral model,” in Proceedings of the 14th
C. Faloutsos, and N. F. Samatova, “Anomaly detection Annual Conference on Computer Graphics and Interac-
in dynamic networks: A survey,” WIREs Computational tive Techniques, M. C. Stone, Ed. ACM, 1987, pp.
Statistics, vol. 7, no. 3, pp. 223–247, 2015. 25–34.
[35] Z. Wu, S. Pan, F. Chen, G. Long, C. Zhang, and [49] P. Karich and S. Scho¨der, “Graphhopper.” [Online].
S. Y. Philip, “A comprehensive survey on graph neural Available: https://graphhopper.com/
networks,” IEEE Transactions on Neural Networks and [50] C. Truong, L. Oudre, and N. Vayatis, “Selective review
Learning Systems, vol. 32, no. 1, pp. 4–24, 2020. of offline change point detection methods,” Signal Pro-
[36] W.RenandR.W.Beard,Distributedconsensusinmulti- cessing, vol. 167, p. 107299, 2020.
vehicle cooperative control. Springer, 2008, vol. 27, [51] G. J. Van den Burg and C. K. Williams, “An evaluation
no. 2. of change point detection algorithms,” arXiv preprint
[37] Q. He, Z. Dong, F. Chen, S. Deng, W. Liang, and arXiv:2003.06222, 2020.
Y. Yang, “Pyramid: Enabling hierarchical neural net- [52] P. Arbelaez, M. Maire, C. Fowlkes, and J. Malik, “Con-
workswithedgecomputing,”inProceedingsoftheACM tour detection and hierarchical image segmentation,”
Web Conference, 2022, pp. 1860–1870. IEEE Transactions on Pattern Analysis and Machine
[38] J. Skarding, B. Gabrys, and K. Musial, “Foundations Intelligence, vol. 33, no. 5, pp. 898–916, 2010.
andmodelingofdynamicnetworksusingdynamicgraph [53] P. Jaccard, “The distribution of the flora in the alpine
neural networks: A survey,” IEEE Access, vol. 9, pp. zone. 1,” New Phytologist, vol. 11, no. 2, pp. 37–50,
79143–79168, 2021. 1912.
[39] S.Wang,J.Cao,andP.S.Yu,“Deeplearningforspatio- [54] S. Deldari, D. V. Smith, H. Xue, and F. D. Salim,
temporal data mining: A survey,” IEEE Transactions on “Time series change point detection with self-supervised
Knowledge and Data Engineering, vol. 34, no. 8, pp. contrastivepredictivecoding,”inProceedingsoftheWeb
3681–3700, 2022. Conference, 2021, pp. 3124–3135.
[40] A. Vaswani, N. Shazeer, N. Parmar, J. Uszkoreit, [55] S.Bai,J.Z.Kolter,andV.Koltun,“Anempiricalevalua-
L.Jones,A.N.Gomez,Ł.Kaiser,andI.Polosukhin,“At- tion of generic convolutional and recurrent networks for
tention is all you need,” Advances in Neural Information sequence modeling,” arXiv preprint arXiv:1803.01271,
Processing Systems, vol. 30, pp. 5998–6008, 2017. 2018.
[41] J.-B. Grill, F. Strub, F. Altche´, C. Tallec, P. Richemond, [56] C. Qiu, T. Pfrommer, M. Kloft, S. Mandt, and
E. Buchatskaya, C. Doersch, B. Avila Pires, Z. Guo, M. Rudolph, “Neural transformation learning for deep
M. Gheshlaghi Azar et al., “Bootstrap your own latent: anomalydetectionbeyondimages,”inInternationalCon-
A new approach to self-supervised learning,” Advances ference on Machine Learning. PMLR, 2021, pp. 8703–
in Neural Information Processing Systems, vol. 33, pp. 8714.
21271–21284, 2020.
[42] C. Liu, Y. Zhan, J. Wu, C. Li, B. Du, W. Hu, T. Liu,
and D. Tao, “Graph pooling for graph neural networks:
Progress, challenges, and opportunities,” arXiv preprint
arXiv:2204.07321, 2022.
[43] D.Lee,S.Lee,andH.Yu,“Learnabledynamictemporal
pooling for time series classification,” in Proceedings of
the AAAI Conference on Artificial Intelligence, vol. 35,
no. 9, 2021, pp. 8288–8296.
[44] D.P.KingmaandJ.Ba,“Adam:Amethodforstochastic
optimization,” in International Conference on Learning
Representations, 2015.
[45] J. Sun, J. Zhang, Q. Li, X. Yi, Y. Liang, and Y. Zheng,
“Predicting citywide crowd flows in irregular regions
using multi-view graph convolutional networks,” IEEE
Transactions on Knowledge and Data Engineering,
vol. 34, no. 5, pp. 2348–2359, 2020.
[46] F.Li,J.Feng,H.Yan,D.Jin,andY.Li,“Crowdflowpre-JOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 1
Supplementary file-A Hierarchical Framework with
Spatio-Temporal Consistency Learning for
Emergence Detection in Complex Adaptive Systems
Siyuan Chen, Xin Du, and Jiahai Wang, Senior Member, IEEE
Abstract—This is the supplementary material of the paper 5) FIG. A5 Visualization of the network-level congestion
“A Hierarchical Framework with Spatio-Temporal Consistency on Traffic dataset.
Learning for Emergence Detection in Complex Adaptive Sys- 6) FIG. A6 Visualization of regions on Flock and Pedes-
tems”. Backgrounds, a summary of notations, algorithmic and
trian datasets.
experimentaldetailsofourmethodareshowninthissupplemen-
tary material due to the page limit of the paper. 7) FIG. A7 Visualization of regions on Traffic dataset.
8) FIG. A8 Visualization of region graph construction.
Appendix A: Necessary background knowledge.
List of Algorithms
A. Brief Introduction about CAS and Emergence.
1) Algorithm A1 Agent-Level STCL.
B. Procedure of DETect.
2) Algorithm A2 System-Level STCL.
C. Consensus Formation via Local Communication.
3) Algorithm A3 Procedure of Emergence Detection.
D. Brief Introduction of BYOL.
Appendix B: A summary of notations used in the main text.
Appendix C: Algorithmic details of HiSTCLED complemen-
tary to Section III in the main text.
A. Incremental Computation of The STE.
B. Pseudo Code.
Appendix D: Experimental details complementary to Sec-
tion IV in the main text.
A. Visualizations of Emergent Behaviors on All Datasets.
B. Implementation Details of HiSTCLED.
List of Tables
1) TABLE A1 Summary of notations.
List of Figures
1) FIG. A1 Procedure of DETect.
2) FIG. A2 Architecture of BYOL.
3) FIG.A3VisualizationoftheflockingbehavioronFlock
dataset.
4) FIG. A4 Visualization of the counter-flow phenomenon
on Pedestrian dataset.
This work is supported by the National Key R&D Program of China
(2018AAA0101203), the National Natural Science Foundation of China
(62072483),andtheGuangdongBasicandAppliedBasicResearchFounda-
tion(2022A1515011690,2021A1515012298).(Correspondingauthor:Jiahai
Wang.)
Siyuan Chen is with the School of Computer Science and Cyber Engi-
neering, Guangzhou University, Guangzhou 510006, China (e-mail: chen-
siyuan@gzhu.edu.cn).
Xin Du is with the Civil Aviation Electronic Information Engineering
College, Guangzhou Civil Aviation College, Guangzhou 510403, China (e-
mail:duxin@gcac.edu.cn).
Jiahai Wang is with the School of Computer Science and En-
gineering, Sun Yat-sen University, Guangzhou 510275, China (e-mail:
wangjiah@mail.sysu.edu.cn).
4202
naJ
81
]AM.sc[
1v00301.1042:viXraJOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 1
APPENDIXA direction as interval variables, and records neighbors’ average
BACKGROUNDS heading direction, average speed, the distance to its nearest
neighbor, and the number of neighbors as external variables.
A. Brief Introduction about CAS and Emergence
The relation between internal variables and external variables
CAS are dynamic systems where individual and collective
reflects the relationship between an agent and its neighbors.
behaviors can adapt to changing interactions and environ-
The three units of DETect are described as follows.
ments [? ? ]. CAS present various intrinsic macro-level a) Modeling Unit: This unit aims to model the rela-
properties like complexity, self-organization, self-similarity,
tionship between internal variables and external variables via
and emergence, which make them distinct from multi-agent
linear regression. The statistical significance test is applied to
systems that put more emphasis on micro-level and meso-
each pair of internal variable and external variable at each
level properties [? ? ]. This paper focuses on the intriguing time step. The p-value indicates the strength of the relation.
emergentproperty,whichisapplicabletostudyimportantreal-
A smaller value means a stronger relation.
worldphenomenalikeemergingtopicsinsocialnetworks[?], b) Change Detection Unit: This unit uses the p-values
synchronizationoncomplexnetworks[?]andphasetransition output by the modeling unit to make change-point detection.
on traffic networks [? ]. The CUMSUM [? ] algorithm based on cumulated change is
Specifically, the weak emergence that can be deduced applied to detect change points in the p-value sequence w.r.t
through simulations is studied in this paper [? ]. It is more each pair of internal variable and external variable. Once the
scientifically relevant, and the performance of methods can relation between any pair of variables changes noticeably, the
be evaluated empirically. The strong emergence, e.g., life relationship between an agent and its neighbors is thought to
that emerges from genes and consciousness that emerges change significantly.
from neurons are out of our scope. It can not be deduced c) Collaboration Unit: This unit allows agents to share
even in principle. The research on strong emergence can be with neighbors their belief of emergence, a scalar ranging in
substantially more difficult. [0,1], to reach a consensus on emergence. At each time step,
Theresearchofemergenceisquiteinterdisciplinary,spread- each agent selects a random neighbor to communicate, and
ingovercomplexityscience,socialscience,computerscience, updates its belief of emergence as the average value between
etc.Researchtopicsofemergenceincludeitsquantitativedefi- itself and the neighbor. The convex combination of the belief
nition,detection,prediction,control,etc.Thispaperisdevoted and a binary variable indicating the change point an agent
to emergence detection, since its prediction and control is detects serves as the final belief of emergence.
hard by nature [? ]. Traditional methods apply agent-based An agent sends feedback when its belief of emergence
modeling [? ] to study emergence. By contrast, this paper exceeds some given threshold. When the number of feedback
develops data-driven spatio-temporal learning techniques for grows significantly larger, DETect confirms the formation or
emergence detection, which may benefit the research on other evaporationofemergence.ItcanbeseenthatDETectrequires
aspects of emergence. a globalmonitor the collectall agents’ feedback.Therefore, it
is more appropriate to regard DETect as a distributed method
with a weak center rather than a fully decentralized method.
B. Procedure of DETect
DETect [? ] is a decentralized method that utilizes agents’ C. Consensus Formation via Local Communication
local observation and collaboration among agents to achieve
This subsection analyzes the conditions of consensus for-
online emergence detection. Its procedure is shown in Fig-
mation among agents via local communication. Recall from
ure A1.
the main text that the update of agent-level detecting scores
DETect is composed of three units, the modeling unit,
via communication is formulated as
the change detection unit, and the collaboration unit. They
(1 α)
are responsible for modeling the relationship between an sτ j+1 =α ·d h( jτ),h( jτ −1) + τ−
+1
sτ i. (A1)
agent and its neighbors, detecting if the relationship changes (cid:16) (cid:17) |Nj | i ∈NXjτ ∪{j
}
significantly, and communicating with neighbors to reach a
Eq.(A1)canberewritteninamatrixform.Denotethescore
consensus on the formation or evaporation of emergence. Be-
vector and the dissimilarity vector as
foredetectingemergence,eachagentrecordsitsownstateand
T
its neighbors’ states within a time window, called the internal sτ = sτ,...,sτ ,
1
variablesandtheexternalvariables,respectively.Forexample, |V| (A2)
(cid:16) (cid:17) T
inurbantrafficsystems,eachcarrecordsitsspeedandheading dτ = d h( 1τ),h( 1τ −1) ,...,d h(τ),h(τ −1) .
|V| |V|
(cid:16) (cid:16) (cid:17) (cid:16) (cid:17)(cid:17)
Collecting Variables Modeling Unit Change Detection Unit Collaboration Unit
Model
Internal Variables Selector Model Feedback Sliding Communicate to
CUSUM
Sliding Analyzer Window Reach Consensus
External Variables
Window
Fig.A1. ProcedureofDETect.JOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 2
view representation projection prediction target network, respectively. The loss function for the online
𝑓 𝑔 𝑞 online branch is the squared error between the ℓ -normalized q(z)
input 𝑡 𝐯 𝐲 𝐳 𝑞 𝐳 branch 2
and z,
𝐱 loss 2
𝑡ǁ 𝐯෤ 𝑓ሚ 𝐲෤ 𝑔෤ 𝐳෤ // sg 𝐳෤ target (Θ,Θ)= q(z) z . (A5)
branch e L (cid:13)∥q(z) ∥2 − ∥z ∥2(cid:13)2
(cid:13) e (cid:13)
It can be shown thaet (Θ(cid:13),Θ) = 2(1 cos(cid:13)(q(z),z)), which
Fig.A2. ArchitectureofBYOL[?]. L (cid:13) −e (cid:13)
coincides the dissimilarity function defined in Eq. (7) of the
main text except a constant.e e
Let Aτ 0,1 |V|×|V| be the adjacency matrix of the By exchanging the role of z and z, the loss function
∈ { }
communication graph at time τ, Aτ + I be the adjacency (Θ,Θ) for the target branch. The final loss function is a
matrix of the graph with self-loops, and Dτ be the degree sL ymmetriconebysummingupthelossesefrombothbranches,
matrix of Aτ +I. The row-normalized random walk matrix ie.e., e = (Θ,Θ) + (Θ,Θ). To avoid learning collapse
is denoted as Aτ =(Dτ) −1(Aτ +I). Then, Eq. (A1) can be repreL sentatioL ns, BYOLL only backpropagates through Θ, and
reformulated as stops the gradienet (sg)ethrouegh Θ. Θ is updated by some
e sτ+1 =α dτ +(1 α) Aτsτ. (A3) gradient-based optimizer, while Θ is update by exponential
· − · moving average, i.e., e
To analyze the effect of communication, this paper makes e
e Θ Opt( ), Θ ηΘ+(1 η)Θ, (A6)
several assumptions to simplify Eq. (A3):
← L ← −
(1) Only the effect of communication is considered, while where η [0,1] is a decay rate.
the dissimilarity is ignored, i.e., α=0. STCL∈ differs from BYOLe in sevee ral aspects:
(2) Agentsareallowedtocommunicatemultipletimeswithin
(1) STCL constructs different views by leveraging the in-
a short time period [τ,τ + 1], where Aτ remains un-
trinsicspatio-temporalconsistencyofdata,withouthand-
changed.
crafted augmentation tricks that may destroy the spatio-
(3) Thecommunicationgraphisconnected.Aeτ isirreducible
temporal semantics.
and aperiodic.
(2) The asymmetric network structure is induced naturally
Under the above assumptions, agents willereach consensus by the spatial and temporal characteristics of data rather
on detecting scores after sufficient rounds of communication, than being manually manipulated.
sτ+1 = lim (Aτ)N sτ =1πTsτ =C1, (A4) (3) The final loss function is not symmetrized, because the
N symmetric variant is found to perform poorly.
(cid:16) →∞ (cid:17)
where C = πTsτ is a constant. The existence of the limit
is assured by the stationary distribution of the normalized APPENDIXB
random walk matrix [? ? ], and π R|V| is a vector SUMMARYOFNOTATIONS
∈
representing the stationary distribution.
NotationsusedinthemaintextaresummarizedinTableA1.
However, the assumptions rarely hold in practice. The
dissimilarity is unignorable, the communication graph is not
necessarilyconnected,andchangesfrequently.Thus,itishard
APPENDIXC
to detect emergence in a fully distributed manner by utilizing
ALGORITHMICDETAILSOFHISTCLED
theconsensusofagents.Therefore,atleastoneglobalmonitor
is required for emergence detection. A. Incremental Computation of The STE
This subsection analyses how the STE updates the spatial
D. Brief Introduction of BYOL and the temporal representations incrementally. From Eq. (3)
of the main text, the spatial representations of agents are
BYOL [? ] is a representative non-contrastive self-
computed independently at each time step. Thus, for time
supervisedlearningmethod.Itavoidsexplicitnegativesamples
window[τ(w)+1,τ+1],onlyzτ+1 isneedstobecomputed,
by aligning different views of the same sample encoded by
whilezτ(w)+1:τ fromthetimewindow[τ(w),τ]canbereused.
asymmetric dual-branch neural networks. As shown in Fig-
TheextracomputationalcostisO( τ+1 ),whichisirrelevant
ure A2, BYOL trains two neural networks, an online network |N |
to the window size w.
and a target network. They share the same architecture but
Similarly, for the temporal representations, qτ(w)+1:τ,
have different parameters. Variables and functions from the
kτ(w)+1:τ and vτ(w)+1:τ can be reused. Let
target branch are denoted with a tilde, while those from the
online network are without tildes. T
Wτ =qτ(w):τ kτ(w):τ (A7)
Given a sample x, two views are constructed via data
augmentations, i.e., v = t(x) and v = t(x). In each branch, be the unnormalized attention m(cid:16) atrix. The(cid:17) n,
theviewisencodedtoalatentrepresentationyviaanencoder
f, and then projected to be z viaea proejector g. The online Wτ+1 =
Wτ[τ(w)+1:τ,τ(w)+1:τ] qτ(w)+1:τkτ+1
.
branchlearnstopredictzfromthetargetbranchviaapredictor " qτ(w)+1:τkτ+1 T qτ+1 T kτ+1 #
q.LetΘandΘbetheparametersoftheonlinenetworkandthe (A8)
(cid:0) (cid:1) (cid:0) (cid:1)
e
eJOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 3
The extra computational cost is O(w). Thus, the incremental rithm 2 and Algorithm 3, respectively.
update is more efficient than the naive calculation of Wτ+1
with a time complexity of O(w2).
Given the unnormalized attention matrix, the temporal rep-
resentations can be updated as
APPENDIXD
EXPERIMENTALDETAILS
vτ(w)+1:τ
hτ(w)+1:τ+1 =softmax D −1 2Wτ+1
"
vτ+1 T
#. (A9)
A. Visualizations of Emergent Behaviors on All Datasets
(cid:16) (cid:17)
(cid:0) (cid:1)
B. Pseudo Code Togainanintuitiveunderstandingoftheemergentbehaviors
Thepseudocodesofagent-levelSTCL,system-levelSTCL, onFlock,Pedestrian,andTrafficdatasets,thispapervisualizes
and emergence detection are shown in Algorithm 1, Algo- them in Figure A3-A5.
TABLEA1
SUMMARYOFNOTATIONS.
Notations Descriptions
t=( , t,Xt) Theinteractiongraphofagentsattimet,with asthesetofagents, t asthesetofedges,andXt asthestatesofagents.
G V E V E
t=( , ,yt) Theregiongraphattimet,with asthesetofregions, t asthesetofedges,andyt asthestatesofregions.
RG RV RE V E
T∗,
T
Thesetofgroundtruthanddetectedchangepoints,respectively.
t= i:dt δ Thesetofagentj’sneighborsattimetwitharadiusofδ.
Nj b{ ij ≤ }
[τ(w),τ] Thetimewindowforrecordingagents’states.w isthewindowsizeandτ(w)=τ w+1.
−
xt Stateofagentj attimet.
j
zt,ht Agentrepresentationsfromthespatialtransformerandthetemporaltransformer,respectively.
j j
vt,v(τ) Thetransientandshort-termrepresentationforevaluatingagent-leveltemporalconsistencyloss.
j j
nt,m(τ) Thetransientandshort-termrepresentationforevaluatingagent-levelspatialconsistencyloss.
j j
Proj ,Proj Agent-specificspatialandtemporalprojectionimplementedbyMLP.
S T
PoolS,PoolT Agent-specificspatialandtemporalpooling,respectively.
STEA Agent-levelspatio-temporalencoder.
rt Regionm’srepresentationattimet.
m
rt,u(τ) Thetransientandshort-termrepresentationforevaluatingsystem-leveltemporalconsistencyloss.
wG m(τ) Theshort-termregionrepresentationforevaluatingsystem-levelspatialconsistencyloss.
Proj ,Proj RegionalspatialandtemporalprojectionimplementedbyMLP.
RS RT
PoolRS,PoolRT Regionalspatialandtemporalpooling,respectively.
STER Region-levelspatio-temporalencoder.
α Mixingcoefficientforthecommunicationofagents.
st,st Agent-levelandsystem-leveldetectingscore,respectively.
j
G
κ Numberofpositivepairsforcomputingthespatialconsistencyloss.
LT, LS, LAgent Agent-leveltemporalconsistencyloss,spatialconsistencylossandoverallloss,respectively.
LST, LSS, LSystem System-leveltemporalconsistencyloss,spatialconsistencyloss,andoverallloss,respectively.
Algorithm 1: Agent-Level STCL
Input: States of agents X1:T from S times of simulation, size of time window w, number of positive pairs κ for
spatial consistency loss, number of training epochs E, number of selected samples B for each simulation
Output: Parameters of the online and target networks, Θ A and Θ A
1 Initialize Θ A and Θ A with random weights;
2 for e=1:E do e
3 foreach simulaetion do
4 for l=1:B do
5 Select a random slice of agent states Xτ(w):τ;
6 Compute the agent representations via Eqs. (2)-(5);
7 Compute the temporal consistency loss via Eqs. (6)-(8);
8 Compute the spatial consistency loss via Eqs. (9)-(10);
9 Compute the total loss via Eq. (11) and update Θ A and Θ A via Eq. (12);
10 end
11 end e
12 endJOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 4
Algorithm 2: System-Level STCL
Input: States of regions y1:T from S times of simulation, size of time window w, number of positive pairs κ for
spatial consistency loss, number of training epochs E, number of selected samples B for each simulation
Output: Parameters of the online and target networks, Θ R and Θ R
1 Initialize Θ R and Θ R with random weights;
2 foreach simulation do e
3 Aggregate agenet-level detecting results into region states via Eq. (14);
4 end
5 for e=1:E do
6 foreach simulation do
7 for l=1:B do
8 Select a random slice of region states yτ(w):τ;
9 Compute the region representations via Eq. (15);
10 Compute the temporal consistency loss via Eqs. (16)-(18);
11 Compute the spatial consistency loss via Eqs. (19)-(20);
12 Compute the total loss via Eq. (21) and update Θ R and Θ R via Eq. (12);
13 end
14 end e
15 end
Algorithm 3: Procedure of Emergence Detection
Input: States of agents X1:T, size of time window w, mixing coefficient α for agents’ communication, threshold c for
change-point detection
Output: A set of detected time steps of emergence formation and evaporation
T
1 for τ =1:T do
2 if τ <w then b
// Initialization
3 foreach agent j do
4 Set agent-level detection score sτ j =0;
5 Record the states of neighbors {xτ i :i ∈Njτ };
6 end
7 Set the state y mτ =0 for each region Rm;
8 Set system-level detection score sτ =0;
9 else G
// Agent-level detection
10 foreach agent j do
11 Read the states of itself and neighbors during the last time window, i.e., xτ(w):τ and {xt i :i ∈Njt }τ t=τ(w);
12 Obtain agent representations h jτ(w):τ via Eqs. (2)-(5);
13 Compute the detecting score sτ j via Eq. (13);
14 end
// System-level detection
15 foreach region m do
R
16 Collect agent-level detection scores and aggregate them to the region state y nτ via Eq. (14);
17 Obtain region representations
rτ m(w):τ
via Eq (15);
18 Obtain the system representation u(τ) via Eqs. (16)-(17);
19 end
// Detect time steps of emergence formation and evaporation using the
criterion defined in Definition 4
20 Compute the system-level detection score sτ via Eq. (22);
21 if sτ −1 >c and sτ c then G
G G ≤
22 Add τ 1 to the set ;
− T
23 end
24 end b
25 endJOURNALOFLATEXCLASSFILES,VOL.14,NO.8,AUGUST2021 5
Fig. A4. Counter-flow on Pedestrian dataset.
Fig. A5. Network-level congestion on Traffic
Fig. A3. Flocking on Flock dataset. Birds are in Pedestrians in white walk from left to right, and
dataset. Congested road segments are in red, and
yellowandpatchescontainingnobirdsareinblack. those in red walk from right to left. Pedestrians
thenormalonesareingray.
walkinginthesamedirectionsformalane.
Fig. A8. Construction of the region graph. Each
region is a node, and bidirectional edges exist
betweentwoadjacentregions.
Fig. A6. 20 20 regions covering the area of Fig.A7. RegionscoveringtheroadnetonTraffic
×
interestonFlockandPedestriandatasets. dataset.
B. Implementation Details of HiSTCLED is left for future work.
The states of all agents or regions within a time window
The dimensions of all hidden layers of models are 128.
are regarded as a single sample. All methods are trained for
All experiments are run 5 times on a machine containing
10 epochs. The thresholds for both agent-level and system-
128GB of RAM, and 8 NVIDIA RTX2080Ti graphics cards
level detection scores are determined by grid search on the
with PyTorch 1.9.1 and CUDA 11.1 in Ubuntu 20.04.
validationsetw.r.t.F1score.Thesizeoftimewindowissetto
To stay consistent with DETect, this paper sets key hy-
10foragent-leveldetection,and40forsystem-leveldetection.
perparameters as follows. The state series of agents are
A discussion is shown in Section IV.F of the main text.
downsampled every 5 steps. The radius δ for defining an
agent’s neighborhood is set to 5 on Flock and Pedestrian
datasets, and 10 on Traffic dataset. The mixing coefficient α
for communication is set to 0.05.
Forsystem-leveldetection,theareawhereallagentsmoveis
split into a 20 20 grid, resulting in 400 regions. On Traffic
×
dataset, regions that cover no streets are removed, resulting
in 186 regions. In the region graph, bidirectional edges exist
between two adjacent regions. The partitions of regions on
FlockandPedestriandatasetsareshowninFigureA6,andthe
partition of regions on Traffic dataset is shown in Figure A7.
The construction of the region graph is shown in Figure A8.
More sophisticated strategies can be designed for region
partition, e.g., regions with irregular shapes and sizes, which