GENERICCOLORIZEDJOURNAL,VOL.XX,NO.XX,XXXX2017 1
A Demographic-Conditioned Variational
Autoencoder for fMRI Distribution Sampling and
Removal of Confounds
Anton Orlichenko, Gang Qu, Ziyu Zhou, Anqi Liu, Hong-Wen Deng, Zhengming Ding, Julia M. Stephen,
Tony W. Wilson, Vince D. Calhoun, Fellow, IEEE, and Yu-Ping Wang, Senior Member, IEEE
Abstract—Objective: fMRI and derived measures such ditioned on subject demographics as well as the removal
as functional connectivity (FC) have been used to predict of the confounding effects of demographics. We identify
brain age, general fluid intelligence, psychiatric disease that FC-based prediction tasks are highly influenced by
status, and preclinical neurodegenerative disease. How- demographicconfounds.
ever,itisnotalwaysclearthatalldemographicconfounds,
Index Terms—BSNIP, confounds, demographics, fMRI,
such as age, sex, and race, have been removed from
functionalconnectivity,PNC,schizophrenia,syntheticdata,
fMRI data. Additionally, many fMRI datasets are restricted
VAE to authorized researchers, making dissemination of these
valuable data sources challenging. Methods: We create a
variational autoencoder (VAE)-based model, DemoVAE, to I. INTRODUCTION
decorrelatefMRIfeaturesfromdemographicsandgenerate
high-quality synthetic fMRI data based on user-supplied FMRI measures the time-varying blood oxygen level-
demographics. We train and validate our model using two dependent (BOLD) signal in the brain in order to infer
large, widely used datasets, the Philadelphia Neurodevel- coarse-grainedneuronalactivation[1].Ithastraditionallybeen
opmentalCohort(PNC)andBipolarandSchizophreniaNet-
used to localize specific functions such as vision [2], emotion
workforIntermediatePhenotypes(BSNIP).Results:Wefind
[3] [4] [5], attention [6] [7], and language [8] to discrete
thatDemoVAErecapitulatesgroupdifferencesinfMRIdata
whilecapturingthefullbreadthofindividualvariations.Sig- cortical areas. Functional connectivity (FC) is the temporal
nificantly,wealsofindthatmostclinicalandcomputerized PearsoncorrelationofBOLDsignalbetweendifferentregions
battery fields that are correlated with fMRI data are not in the brain [9], and has been used to predict demographics
correlatedwithDemoVAElatents.Anexceptionareseveral
such as age [10], sex [11] [12], and race [13], as well as
fields related to schizophrenia medication and symptom
clinical assessments for schizophrenia diagnosis [14] [15] and
severity. Conclusion: Our model generates fMRI data that
captures the full distribution of FC better than traditional pre-clinicalneurodegenerativedisease[16].Manygroupshave
VAEorGANmodels.Wealsofindthatmostpredictionus- also attempted to use FC as a biomarker to predict scholas-
ingfMRIdataisdependentoncorrelationwith,andpredic- tic achievement or general fluid intelligence [17]. Besides
tion of, demographics. Significance: Our DemoVAE model
Perason correlation, several other metrics have been used
allows for generation of high quality synthetic data con-
for the calculation of FC, including partial correlation [18]
Manuscript received on May 15, 2024. This work was supported in and distance correlation [19]. Others have experimented with
part by NIH grants (P20GM109068, P20GM144641, R01MH121101, calculating dynamic FC [15]. With increasing clinical field
R01MH104680, R01MH107354, R01MH103220, R01EB020407,
strength, prediction based on FC or other fMRI metrics is
R56MH124925, 5U19AG055373) and NSF grant (#1539067).
(Correspondingauthor:Yu-PingWang.) poised to become increasingly important in the research and
Anton Orlichenko, Gang Qu, and Yu-Ping Wang are with the clinical settings [20].
Department of Biomedical Engineering, Tulane University, New Or-
Concurrently, generative models such as the DALL-E [21]
leans, LA 70118. (e-mail: aorlichenko@tulane.edu, gqu1@tulane.edu,
wyp@tulane.edu). and GPT [22] series have created textual and visual content
Ziyu Zhou and Zhengming Ding are with the Department of Com- that in many cases is indistinguishable from human-generated
puter Science, Tulane University, New Orleans, LA 70118. (e-mail:
work [23]. In the computer vision domain, generative models
zzhou11@tulane.edu,zding1@tulane.edu).
Anqi Liu and Hong-Wen Deng are with the Center for Biomedi- include generative adversarial networks (GANs) [24], varia-
cal Informatics and Genomics, Tulane Integrated Institute of Data & tionalautoencoders(VAEs)[25],andmostrecently,diffusion-
Health Sciences, Tulane University, New Orleans, LA 70112. (e-mail:
based models [26]. All of these methodologies have been
aliu10@tulane.edu,hdeng2@tulane.edu).
Tony W. Wilson is with the Institute for Human Neuroscience, applied to fMRI data for the improvement of predictive
Boys Town National Research Hospital, Boys Town, NE. (email: ability or for performing image to image translation [27]
tony.wilson@boystown.org).
[28]. However, previous work has mostly overlooked subject
JuliaM.StepheniswithMindResearchNetwork,Albuquerque,NM.
(email:jstephen@mrn.org). demographics as potential input in their generative models.
VinceD.CalhouniswiththeTri-InstitutionalCenterforTranslational Since fMRI data access is often restricted to national data
ResearchinNeuroimagingandDataScience(TReNDS),GeorgiaState
repositoriesbyqualifiedresearchers,webelievethatgenerative
University, Georgia Institute of Technology, Emory University, Atlanta,
GA.(email:vcalhoun@gsu.edu). models that can produce synthetic data are useful to more
4202
yaM
31
]MQ.oib-q[
1v77970.5042:viXra2 GENERICCOLORIZEDJOURNAL,VOL.XX,NO.XX,XXXX2017
easily disseminate information, but only if they can re-create between the reconstruction xˆ and original input x. Thus, the
thedemographicdistributionandindividualvariationfoundin AE may be seen as a nonlinear version of dimensionality
the fMRI datasets. reduction techniques such as PCA or Factor Analysis.
It is well known that fMRI can be used to predict demo- By contrast, a variational autoencoder (VAE) trains the
graphics such as age, sex, and race [10] [11] [13]. It is also encoderfunctionE (x)toproducelatentfeaturesthatapprox-
ϕ
known that it is crucial to control for demographic confounds imateaknownprobabilitydistributionp (z),mostoftentaken
θ
when performing statistical analysis [29] [30]. In fact, many to be a standard multivariate Gaussian distribution p (z) =
θ
simpler models have provisions for regressing out confounds N(0,I) [25]. This allows for artificially constructing latent
[31]. There is a question, however, as to whether fMRI- samples z from the approximated distribution, followed
samp
based prediction using more complicated models is solely by the conversion of those latents to samples of the original
due to demographic signal present in fMRI [13]. To this distribution p (x|z) by passing through the decoder function
θ
end, we present a new generative model based on a VAE x =D (z ).
samp θ samp
that decorrelates latent features from subject demographics For the following, consider scalar features x and scalar
(DemoVAE).Itaccomplishesthisbyforcingsuchcorrelations latent features z. The exact calculation of p (z|x) is in
θ
to be zero during training and injecting demographic infor- most cases intractable, therefore an approximation q (z|x)≈
ϕ
mation in the decoder after calculation of the latent features. p (z|x) is made, and the Kullback-Leibler (KL) divergence
θ
We add classifier and regression-guided loss functions [32] to between the two distributions is taken:
ensurethatsyntheticsamplescontaindemographics-associated
features that are compatible with models trained on real data. D (q (z|x)∥p (z|x))
KL ϕ θ
We believe our model serves two purposes: 1) generation of (cid:20) (cid:21)
q (z|x)
representative synthetic data based on datasets that are not =E ln ϕ
z∼qϕ(·|x) p (z|x) (1)
accessible to the general public, and 2) creation of fMRI θ
(cid:20) (cid:21)
q (z|x)
latent features which are free from the confounding effects =lnp (x)+E ln ϕ
of demographics. It is also possible that DemoVAE can θ z∼qϕ(·|x) p θ(x,z)
aid in data harmonization by removing site-specific effects The evidence lower bound (ELBO) [25] is then defined as:
[33] through treating site location as a demographic. These
capabilities are validated on two large datasets accessible to (cid:20) (cid:21)
p (x,z)
qualified researchers. L =E ln θ
The rest of this manuscript is organized as follows. Sec-
θ,ϕ z∼qϕ(·|x) q ϕ(z|x) (2)
=E [lnp (x|z)−D (q (z|x)∥p (z))]
tion II gives a recapitulation of the theory of the DemoVAE z∼qϕ(·|x) θ KL ϕ θ
model and our specific training methodology, as well as a Maximizing the ELBO is equivalent to maximizing the
description of the datasets and experiments performed. Sec- reconstruction probability lnp (x|z) while minimizing the KL
θ
tion III provides experimental results. Section IV discusses divergence between our empirical and target distributions.
significant conclusions drawn from fMRI group differences Given a standard normal distribution for the latent features
found via DemoVAE and how they relate to existing work. p (z) = N(0,1), the ELBO objective to be minimized
θ
Section V concludes with a summary of the work. We make becomes:
the code publicly available at the link in the footnote 1. An
online demo is also available 2.
L =∥x−D (z)∥2+Nσ2+∥µ ∥2−Nlnσ2, (3)
θ,ϕ θ 2 z z 2 z
II. METHODS whereµ representsthemeanofthetheempiricallycalculated
z
latent features, σ2 represents the variance of the same, and
First, we discuss the architecture and training of the De- z
N represents the number of samples. This loss function can
moVAE model, shown in Figure 1. Next, we describe two
be seen to have three components: a reconstruction loss, two
datasetsusedforthevalidationofthemodel.Then,weoutline
termsthattendtomakeσ equaltoone,andonetermtomake
experimentsusedtoanalyzeDemoVAE’sabilitytodecorrelate z
the expectation of the latent features equal to zero. Given this
latent features from demographic confounds as well as to
loss function, one is able to train a network to sample the
generatehighqualitysyntheticfMRIdata.Finally,wedescribe
distribution of FC data, but not to condition the samples on
experiments using DemoVAE for imputation of fMRI data.
ancillary subject information such as demographics.
When considering a multivariate standard normal distribu-
A. VariationalAutoencoder
tionp (z)=N(0,I)forthelatentfeatures,theKLdivergence
θ
An autoencoder (AE) converts raw features into a lower- part takes the more complicated form [34]:
dimensional latent space via a learned encoder function z =
E ϕ(x), along with a decoder function to convert the latent D KL(N(µ z,Σ z)∥N(0,I))=
Dfea θt (u zr )e .s Tb ha eck Ai Ento isa ofr te ec non ts ratr iu nc et ded tove mrs ii no in mio zf et th he ein dp ifu fet rexˆ nc= e 1 2(cid:2) tr(Σ z)+µ⊤ zµ z+log(det(Σ z))(cid:3) (4)
1https://github.com/aorliche/demo-vae/ This presents a challenge due to the calculation of, and
2https://aorliche.github.io/DemoVAE/ backpropagationthrough,thelogdeterminantoftheempiricalORLICHENKOetal.:DEMOGRAPHIC-CONDITIONEDVARIATIONALAUTOENCODERFORFMRIDISTRIBUTIONSAMPLINGANDREMOVALOFCONFOUNDS3
DemoVAE Training Inference
Demographics 1. Age
12yo male AA working memory
fMRI data 2. Sex
3. Race
d(x)
4. SZ
Corr(d(x),z i) = 0 5. Scanner Task
d(x)
functional connectivity
functional connectivity input reconstruction
derive latents unbiased w.r.t. demographics
Sampling
14yo female EA resting state samples
timeseries
timeseries
d(x)
Encoder Latents Decoder
• p(zi) = (0,1)
N
• Corr(z,z) = 0
i j
• Corr(d(x),z) = 0
i
Latents are decorrelated from demographics partial correlation
funp ca tr ioti nal
a
c
l
o corr ne nla et cio tin
vity
functional connectivity
zi∈ N(0,1)
=λ • +λ • +λ • +λ • sampling recapitulates true distribution,
Ltot 1 LRecon 2 LMean 3 LCov 4 LDemo
conditioned on user-specified demographics
Fig.1. Overviewofthedemographics-conditionedanddecorrelatedvariationalautoencoder(DemoVAE)model.Insteadofreconstructionbased
onlyonlatentfeaturesz = Eϕ(x),theDemoVAEmodelusesdemographicsyasinputtothedecoderxˆ = Dθ(z,y).Thetwomainusesof
themodelareinference,whichgenerateslatentfeatureszdecorrelatedfromdemographics,andsampling,whichgeneratessyntheticfMRIdata
conditionedonuser-provideddemographics.
latent covariance matrix Σ z. We address this issue as part 2) ExtensiontoMultidimensionalLatentSpace: Second, we
of our modifications to the VAE loss function presented in note that the ELBO loss function of the standard VAE is
Section II-B. applicabletoscalarlatentfeatureszandnotmulti-dimensional
latent features z ∈ RNz. This may allow for a non-diagonal
covariance matrix in the empirical distribution of latents
B. Demographics-ConditionedandDecorrelated q (z|x)=N(0,Σ).Thus,wemodifyapartoftheELBOloss
ϕ
VariationalAutoencoder(DemoVAE) functiontospecificallytargetadiagonalcovariancematrixand
zero expected value for the latents:
Thereisanexistingbodyofacademicliterature[35][36]as
well as practical applications [37] exploring the conditioning 1
L = ∥ZZ⊤−NI∥2
ofVAEsonuser-specifiedinputs.VAEshavealsobeenapplied Cov N F
to the generation of synthetic fMRI data [28], but without
1
(cid:88)Nz (6)
consideringpatientdemographics.Inthiswork,weincludethe L Mean = NN ∥µ zi∥2 2,
known patient demographic features as input to the decoder z i=1
function xˆ =D θ(z,y), where z are the latent features and y where Z∈RNz×N is the matrix of all N
z
latent features for
are the subject demographics. During training, we decorrelate
all N subjects, z is the vector of latent feature i for all N
i
thelatentstatez=E (x)fromdemographicfeaturesysothat
ϕ subjects, and µ is its mean. We find that this loss function
all of the fMRI signal that can be attributed to demographics
zi
performs as good or better than the KL divergence part of
is based on user-provided input and not on the encoded latent
ELBO with fMRI data.
features. To this end, we make several modifications to the
3) Decorrelate Latent Features from Demographics: Third,
traditional VAE loss function.
we add a term penalizing correlations between the empiri-
1) Incorporate Demographic Information: First, the recon- cal latent features and four demographic features or clinical
struction error term of the loss function remains unchanged outcomes: age, sex, race, and disease status (schizophrenia
from the ELBO formulation, except for the injection of diagnosis).WherewehavemultiplefMRIscansusingdifferent
demographic information: scanner tasks for each subject, we also decorrelate the latents
with respect to scanner task. We define
N
1 (cid:88)
L Recon = N ∥x i−D θ(z i,y i)∥2 2, (5) 1 (cid:88)Nz (cid:88)Ny
i=1 L
Demo
=
N N
∥ρ zj,yk∥2 2, (7)
z y
where N is the number of subjects, x are the vectorized FC j=1k=1
i
features, z = E (x ) are the empirically calculated latent whereρ isthecorrelationbetweenbetweenlatentfeature
i ϕ i zj,yk
features, and y are the subject demographics for subject i. z and demographic feature y across all N subjects.
i j k4 GENERICCOLORIZEDJOURNAL,VOL.XX,NO.XX,XXXX2017
4) Classifier Guidance: Finally, while training the De- TABLEI
moVAE,wecreatesyntheticsamplesbasedonrandomchoices DEMOGRAPHICSFORTHEPNCANDBSNIPDATASETS.
of demographic inputs, and penalize miss-predictions relative PNCDataset
to pre-trained models. Given a single demographic prediction Males Females p-value
Age(years) 14.48±3.32 14.69±3.42 <0.3042
from a synthetic latent based on user-input demographics
EuropeanAnc.(EA) 316 303 <0.5415
yˆ i =f i(D θ(z samp,y)), we define AfricanAnc.(AA) 224 311 <10−5
WRATScore 103.66±16.56 101.45±15.90 <0.0212
L =
1 (cid:88)Ny (cid:40) ∥y i−yˆ i∥2 2, y
i
continuous
(8) Age(years)
14.59E ±A
3.50
14.59A ±A
3.23 <0.9994
Guide N y i=1 −(cid:80) cy i,clog(p i,c), y i categorical WRATScore 108.68±14.84 95.68±14.80 <10−48
wherethemodelsf i(·)arelinearmodelstrainedontheground BSNIPDataset
truth fMRI subject data, y is the one hot encoded true class Males Females p-value
i,c
Age(years) 35.24±11.98 38.93±12.45 <0.0026
label for demographic i, p is the predicted probability for
i,c CaucasianAnc.(CA) 139 109 <0.0221
class c and demographic i, and the loss is the Mean Square AfricanAnc.(AA) 82 75 <0.5343
Error (MSE) for continuous demographics (age) and Cross SZDiagnosis 130 55 <10−10
Entropy (CE) error for categorical demographics (sex, race,
disease status, scanner task).
The final loss function for training the DemoVAE can thus
Xˆ:
be formulated as: Σ=(1σ⊤)Xˆ(σ1⊤), (12)
L=L +λ L +λ L +
Recon 1 Cov 2 Mean where σ is a column vector of standard deviations at each
(9)
λ 3L Demo+λ 4L Guide, ROI and 1 is a column vector of ones. Given a rank-deficient
but PSD covariance matrix, we can simulate a Cholesky-like
whereλ arethehyperparameterschosenalongsidelearning
1−4
decomposition using the eigenvectors and eigenvalues of Σ
rate and latent dimension size via random grid search.
and QR decomposition in the following way:
C. GenerationofTimeseries Σ=VΛV⊤
√ √
The DemoVAE model described works on fixed length =(V Λ)(V Λ)⊤
(13)
input vectors to produce fixed length latent feature vectors =(QR)⊤(QR)
and fixed length samples from the distribution of the input.
=LL⊤.
WhencreatingfMRI-derivedsamplesofsyntheticFC,wecan
use the Cholesky decomposition [38] to generate variable- Timeseries may then be constructed based on the property
lengthBOLDtimeseriesthatarecompatiblewiththegenerated oftheCholeskydecompositionthatastandardnormalrandom
FC. These timeseries may then be used to generate alternate variable X ∈ N(0,1) multiplied by the Cholesky factor
measures of connectivity, e.g., partial correlation-based FC L creates a multivariate normal variable vector with zero
(PCFC). mean and covariance matrix Σ = LL⊤. This is compatible
For fixed-length FC input, which is a symmetric positive with fMRI data, which are usually bandpass filtered prior to
semi-definite (PSD) matrix, we can train the decoder function analysis.Itassumes,however,thatthetimeseriesBOLDsignal
Xˆ = D θ(z,y) to output a form that can be converted into is stationary, which is sufficient when producing correlation-
a symmetric matrix. This can be either the unique upper based metrics. In Table V, we show that this method of
triangular entries of the matrix Xˆ U or a low-rank factor of generating PCFC via timeseries yields features that make
size A=RNroi×Nr, where N roi is the number of regions of accuratepredictionsusingmodelstrainedontheoriginaldata,
interest (ROIs) in the atlas and N r is the rank of the factor: and vice-versa.
Xˆ(1) =Xˆ +Xˆ⊤+I
U U (10)
Xˆ(2) =AA⊤. D. Datasets
We now describe two datasets used for validation and
Note that Xˆ(1) may contain a few negative eigenvalues
exploration of the DemoVAE model. Demographics for our
whileXˆ(2)ismostlikelyrankdeficient,basedonthechoiceof
subsets of the two data sources may be found in Table I.
N . However, the Cholesky decomposition requires a positive
r 1) Philadelphia Neurodevelopmental Cohort: The Philadel-
definite(PD)matrixasinput.Inthefirstcase,wefindanegli-
phia Neurodevelopmental Cohort (PNC) is a widely-used
gible loss of predictive ability by setting negative eigenvalues
λ of Xˆ to zero or a small positive value β. dataset of children and young adults with multi-task fMRI
Xˆ,i scans for 1,529 subjects [39] and genomic data for more than
(cid:40) 9,000 [40], many of whom have both modalities. In addition,
λ , λ ≥0
λ Xˆ,i = βX ,ˆ,i otXˆ h, ei
rwise
(11) the PNC includes data for 169 questionnaire, computerized
battery, and in-scanner task parameter fields [41] [42], not all
We then choose the standard deviation of timeseries σ ∈ of which are available for every subject. Scholastic achieve-
i
N(µ ,τ2 ) at each ROI, and use it to recompute the covari- ment was measured using the Wide Range Achievement Test
σi σi
ance matrix Σ from the reconstructed or synthetic FC sample (WRAT)[43],withbotharawscoreandscorewiththeeffectsORLICHENKOetal.:DEMOGRAPHIC-CONDITIONEDVARIATIONALAUTOENCODERFORFMRIDISTRIBUTIONSAMPLINGANDREMOVALOFCONFOUNDS5
of age regressed out. The dataset is enriched for subjects
of European (EA) and African (AA) ancestry. fMRI scans Histogram of WRAT Score by Major Race Group
80
includethreein-scannertasks:arestingstate(rest),aworking European Ancestry
n-back memory (nback) [44], and an emotion identification 70 African Ancestry
task (emoid), where not all subjects have all three tasks.
60
We selected a 1,154-subject subset of the entire cohort that
included subjects with all three fMRI scanner tasks as well 50
as single nucleotide polymorphism (SNP) data, and who 40
belonged to either of the two predominant ancestry groups.
30
Acquisition [39] and preprocessing [13] of the fMRI data
has been described previously [10], but was performed using 20
a whole-body 3T scanner running an echo-planar imaging
10
sequence with a repetition time of TR = 3sec. Data was
pre-processed using SPM123, including regression for motion 0
70 80 90 100 110 120 130 140
correction, co-registration, and normalization to MNI space.
Standardized (Age-Corrected) WRAT Score
The Power Atlas [45] of 5mm spherical regions was used
Fig.2. Histogramofstandardized(age-correct)WRATscorefromthe
to parcellate the fMRI BOLD images into 264 timeseries.
PNC dataset, split among the two major race groups in the dataset.
FC was created from these timeseries via Pearson correlation. There is a clear demographic confound when predicting WRAT score
Partialcorrelation-basedFCwascreatedfromthesetimeseries fromfMRIorgenomicdata.WeshowinTableIIthatDemoVAEisable
toremovetheeffectofthisconfound,butatthesametime,removesthe
via the nilearn4 software package [46] using the Ledoit-Wolf
abilitytoaccuratelypredictWRATscore.
shrinkage estimator [47].
SNP data was collected using one of eight different plat-
forms, each subject’s data being handled using one of these
which is heavily skewed according to ethnic group (Fig-
platforms, with the largest platform annotating 1,185,051
ure 2), using fMRI FC data, SNP data, scalar race indicator,
SNPs. For our analysis, we chose a subset of 35,621 SNPs
and DemoVAE latents constructed from FC or SNPs. Ridge
that were available on all 8 platforms for all subjects. SNPs
regression models were trained and evaluated on a set of
were categorized by haplotypes as homozygous dominant,
20 repetitions of an 80/20 train/test split with the above
heterozygous, homozygous recessive, or missing.
features, where the best value for the regularization parameter
WenotetheWRATscoreswithageregressedoutinTableI
was chosen by random grid search. This experiment was
have not been adjusted for race, as seen from the very
performed to validate the ability of DemoVAE to decorrelate
significant p-value, implying the possibility of confounding
its latent features from demographics, and to demonstrate
effects.Figure2displaysthehistogramofWRATscoreamong
why demographic confounds in FC may be problematic for
the two races. One of the goals of the DemoVAE model is
downstream analysis.
to remove the effect of demographics from fMRI features in
order to give an unconfounded view of the effect of brain 2) Validation of fMRI Samples Generated by DemoVAE:
Several tests were performed to validate that the samples
network organization on phenotypic variables, e.g., removing
created by DemoVAE accurately capture the distribution of
the effects of demographics on scholastic achievement score.
fMRI data and recapitulate group differences between groups
2) BipolarandSchizophreniaNetworkforIntermediatePhe-
havingdifferentdemographics.WefirsttrainedtheDemoVAE
notypes: As an additional and independent validation dataset
model using the PNC dataset, including age, sex, and race as
containing clinical phenotypes, we use the Bipolar and
demographics, and with the scanner task being set to resting
Schizophrenia Network for Intermediate Phenotypes cohort
state. We also trained a traditional VAE using the traditional
of 933 patients, 1059 relatives, and 459 healthy controls
scalar ELBO objective in Equation 3 and no demographic
[48]. We selected a subset of 185 schizophrenia (SZ) patients
information, as well as a Wasserstein generative adversarial
and 220 healthy controls for whom we had fMRI scans,
network (W-GAN) model [24] [50] [27]. Synthetic FC sam-
excluding subjects with borderline diagnosis such as bipolar
ples were then generated for 1,000 subjects using all three
and schizoaffective disorder. fMRI data was acquired over
models, and the distribution of FC features was visualized
six sites, with acquisition and preprocessing of the data
in two dimensions using the scikit-learn implementation of t-
described elsewhere [49]. In addition to the fMRI data, the
distributed stochastic neighbor embedding (t-SNE) [51] [52].
BSNIPdatasetcontains32medicationandclinicalassessment
Subject demographics for the DemoVAE features were sam-
measures related to patients’ psychiatric condition.
pledrandomlyusinganequally-weightedBernoulli(sex,race)
ornormal(age)distribution.Thedistributionofsyntheticdata
E. Experiments was compared with ground truth data.
Additionally, we measured the ability of DemoVAE syn-
1) Prediction of WRAT Score Using DemoVAE Latents: We
thetic data to recapitulate group differences in the PNC and
used the PNC dataset to predict age-adjusted WRAT score,
BSNIP datasets. We calculated the mean difference in FC
3http://www.fil.ion.ucl.ac.UK/spm/software/spm12/ betweenyoungchildrenandyoungadults,malesandfemales,
4https://nilearn.github.io/stable/index.html EA and AA race, and SZ patients and healthy controls using
stcejbuS
fo
rebmuN6 GENERICCOLORIZEDJOURNAL,VOL.XX,NO.XX,XXXX2017
ground truth data. Then, we created synthetic FC data for TABLEII
those groups using using DemoVAE, and compared group RMSES(MEANANDSTANDARDDEVIATION)OFPREDICTING
differences of real and synthetic data. The RMSE between
STANDARDIZEDWRATSCORESUSINGFMRIFCINPUT,SNPINPUT,
DEMOVAEFMRILATENTS,DEMOVAESNPLATENTS,ANDSCALAR
FC differences of real and synthetic data was calculated and
RACEVARIABLE.
compared with a null model.
Input WRATPredictionRMSE
3) Phenotype Prediction Using DemoVAE Synthetic Data:
NullModel 15.18
The ability of DemoVAE to create synthetic data that reca- RaceOnly 13.91±0.271
pitulate the demographic content of subject FC was tested by RestFC 14.73±0.368
using real data to train demographic-prediction models that NbackFC 14.44±0.395
EmoidFC 14.46±0.414
were tested on synthetic data and vice versa. The models
SNPs 14.03±0.429
used were Ridge regression models for continuous variables RestDemoVAELatents 15.20±0.015
(age)andLogisticregressionmodelsforbinaryvariables(sex, NbackDemoVAELatents 15.18±0.013
EmoidDemoVAELatents 15.18±0.015
race, SZ diagnosis). The scikit-learn implementation of these
SNPDemoVAELatents 15.14±0.131
models were employed and optimal regularization parameters
were chosen using random grid search. Synthetic data was
createdusingthesameprocedureasinSectionII-E.2.Twenty conditionedon,orbyswitchingtaskinadditiontoadding10%
repetition of each experiment was performed and the results noise in the latent dimension z. Imputation accuracy using
averaged.Thesamenumberofsyntheticsubjectswerecreated DemoVAE, as measured by RMSE, was compared to using
as available real subjects: 1,154 for the PNC dataset and 405 uniformly zero FC, the input scanner task, adjusting by the
for BSNIP. mean difference between tasks in the training set, and a two-
4) CorrelationofClinicalMeasureswithDemoVAELatents: layer MLP model.
We tested the correlation of fMRI FC data with phenotype
and clinical data fields before and after the removal of the
III. RESULTS
confounding effects of demographics. Both the PNC and
This section presents results for the experiments described
BSNIPdatasetcontainphenotypeandclinicaldatawhichmay
in Section II-E.
be correlated with FC features. A subset of 169 phenotype,
medication, and cognitive battery fields available in the PNC
cohort was correlated with raw FC data, traditional VAE A. PredictionofWRATScorefromDecorrelatedLatents
latents, and DemoVAE latents decorrelated from demographic In Table II, we give results for predicting age-adjusted
features. Correlation was tested at a significance level of p< WRAT score in the PNC data from scalar race value, FC
0.05 and p<0.01, and the number of significant correlations data, SNP data, DemoVAE latents derived from FC data, and
was determined. Significance was determined using a t-test DemoVAE latents derived from SNPs. We observe that using
with the statistic: √ the scalar race variable yields the best prediction of standard-
ρ n−2
ized WRAT score. While FC and SNPs can predict WRAT
t= , (14)
(cid:112)
1−ρ2 score moderately well, that predictive ability disappears when
latentsaredecorrelatedfromrace,asintheDemoVAElatents.
where ρ was the correlation coefficient between FC or latent
This demonstrates that DemoVAE is able to decorrelate the
feature and clinical or computerized battery field and n was
fMRI latent state from demographics. It also demonstrates
the number of samples, i.e., number of subjects having a
that, while FC and SNPs have the ability to predict age-
value for that clinical or computerized battery field. Each FC,
adjusted WRAT score, that prediction is based on ability to
VAE, or DemoVAE feature was correlated independently and
infer demographics, and not on any cognitive signal found
Bonferronicorrectionwasappliedtothep-valuetocorrectfor
in FC that is independent of demographics. We find, as have
multiple comparisons.
previousstudies,thatpredictionofscholasticachievementmay
In additional to the PNC clinical fields, the BSNIP dataset
be highly confounded by race signal present in neuroimaging
contained 32 demographic, clinical, and medication fields
data [53] [13].
whichwerecorrelatedwithFCdataandVAElatentfeaturesin
a similar manner. Finally, the PNC dataset contained genomic
data for a 1,154-subject subset of subjects with fMRI scans. B. ValidationoffMRISamplesGeneratedbyDemoVAE
These genomic data were also correlated with phenotype and Figure 3 displays a selection of ground truth subject FC
cognitive battery fields before and after removal of confound- data compared to synthetic data generated by DemoVAE, a
ing effects with DemoVAE. traditional VAE, and a W-GAN. We note that it is visually
5) Imputation offMRI Scanner Task: DemoVAE creates la- hard to distinguish between true subject data and synthetic
tent features that are decorrelated from fMRI scanner task, data. However, this is not the case when comparing the
and can generate samples conditioned on the type of scanner entire distribution of data using t-SNE, as evident in Fig-
task. We therefore test the ability of DemoVAE to impute ure 4. Figure 4 shows the distribution of synthetic DemoVAE
scanner task fMRI given fMRI from a different scanner task data, VAE data, and W-GAN data transformed using t-SNE
asinput.Imputationwasperformedeitherdeterministically,by overlayed on ground truth resting state PNC subject data.
switchingtheidentityofthetasky thedecoderD (z,y)was DemoVAEdatawascreatedusingrandomlysampledage,sex,
i θORLICHENKOetal.:DEMOGRAPHIC-CONDITIONEDVARIATIONALAUTOENCODERFORFMRIDISTRIBUTIONSAMPLINGANDREMOVALOFCONFOUNDS7
Sample 1 Sample 2 Sample 3 Sample 4 TABLEIV
15 00 0
0
0000 .... 2468 15 00 0
0
000 ... 468 15 00 0
0
0000 .... 2468 15 00 0
0
0000 .... 2468 RMSESBETWEEN SF YC NTG HR EO TU ICP DDI EF MFE OR VE AN EC DE AS TU A.SINGREALVERSUS
150 0.0 150 0.2 150 0.0 150 0.0
200 0.2 200 0.0 200 0.2 200 0.2 Groups RMSE RMSE
250
0 50 100 150 200 250
00 .. 64 250
0 50 100 150 200 250
0.2 250
0 50 100 150 200 250
0.4 250
0 50 100 150 200 250
00 .. 64 Real/Synthetic Real/NullModel
50 0 01 .. 80 50 0 0.8 50 0 0.8 50 0 0.6 MeanofAll 0.0353 0.3091 0.6 0.6 Young/OldChildren 0.0336 0.0717
1 10 50 0 00 .. 46 1 10 50 0 00 .. 24 1 10 50 0 00 .. 24 1 10 50 0 00 .. 24 Males/Females 0.0117 0.0379
200 0.2 200 0.0 200 0.0 200 0.0 EA/AARace 0.0194 0.0359
250 0 50 100 150 200 250 0.0 250 0 50 100 150 200 250 0.2 250 0 50 100 150 200 250 0.2 250 0 50 100 150 200 250 0.2 SZ/HealthyControls 0.0090 0.0453
1
1
2
25
0
5
0
50 0
0
0
0
0
000000 ...... 012345
1
1
2
25
0
5
0
50 0
0
0
0
0
0000000 ....... 0123456
1
1
2
25
0
5
0
50 0
0
0
0
0
000001 ...... 024680
1
1
2
25
0
5
0
50 0
0
0
0
0
0000000 ....... 0123456
i Ds ev mer oy Vh Aig Eh ,aw nh de sn lit gra hi tn lyin lg owus ei rn wg hre ea nl td ra at ia nia nn gd up sr ined gic Dti en mg ou Vs Ain Eg
0 50 100 150 200 250 0 50 100 150 200 250 0 50 100 150 200 250 0 50 100 150 200 250
15 00 0
0
000 ... 345 15 00 0
0
000 ... 345 15 00 0
0
000 ... 468 15 00 0
0
0001 .... 4680 a bn ud
t
op nr eed inic st ti an ng ceu .s Pin eg arsr oe nal Fd Cat aa n, dbu pt ars tit ail ll ce ox rc ree le ad tis on9 -0 b% asei dn Fa Cll
1
2
25
0
50
0 0
000 ... 0012
.1
1
2
25
0
50
0 0
000 ... 0012
.1
1
2
25
0
50
0 0
00 .. 002
.2
1
2
25
0
50
0 0
00 .. 0002
.. 42
d sce rr ii bv ee dd iu nsi Sn eg ctt ih oe nF IIC -C-ba hs ae vd et si im me is le ar rie as ccc ur re aa ct ii eo sn
.
p Tr ho ic se vd au lr ie dad tee s-
0 50 100 150 200 250 0 50 100 150 200 250 0 50 100 150 200 250 0 50 100 150 200 250
our timeseries creation procedure, at least in the context of
Fig.3. SampledFCmatricesforrealPNCrestingstatescans(top) calculation of alternate measures of connectivity.
comparedtosyntheticDemoVAE,VAE,andW-GANFCdata.Visually,
allsyntheticmodelsgenerateconvincingdata.
D. CorrelationofClinicalMeasureswithDemoVAE
Latents
TABLEIII
BRAINFUNCTIONALNETWORKSINTHEPOWER264ATLAS[45]. Figure 6 displays the correlation between clinical ques-
Label ROIs NetworkName tionnaire and computerized battery fields of the PNC and
0 0-29 SomatomotorHand(SMT) BSNIP datasets and fMRI FC data, traditional VAE latents,
1 30-34 SomatomotorMouth(SMT) anddemographically-unconfoundedDemoVAElatents.Wesee
2 35-48 Cinguloopercular(CNG)
that removing the effects of demographic confounds from
3 49-61 Auditory(AUD)
4 62-119 DefaultMode(DMN) either fMRI data or SNP data greatly reduces the number
5 120-124 Memory(MEM) of fields that are significantly correlated with the fMRI or
6 125-155 Visual(VIS) genomic data. In fact, of 169 clinical or computerized battery
7 156-180 Frontoparietal(FRNT)
fields, only four remained significantly correlated at the p <
8 181-198 Salience(SAL)
9 199-211 Subcortical(SUB) 0.01 level after decorrelation from demographics. This result
10 212-220 VentralAttention(VTRL) corroborates the result presented in Section III-A, where it
11 221-231 DorsalAttention(DRSL)
was found that scalar race value was the best predictor of
12 232-235 Cerebellar(CB)
scholastic achievement as measured by WRAT score. While
13 236-263 Uncertain(UNK)
FCandSNPswerefoundtobesomewhatpredictiveofWRAT
score, that predictive ability disappeared when FC features
and race demographics but with scanner task set to resting were decorrelated from the demographics age, sex, and race
state. We see that DemoVAE captures the distribution of using DemoVAE.
fMRI data better than the traditional VAE and W-GAN. It Unlike the PNC dataset, from which we used 169 ques-
is evident that a GAN makes no guarantees about matching tionnaire and computerized battery fields, the BSNIP dataset
orevenapproximatingthetruedistributionofdata[34]unless included a more modest 32 clinical fields available for
additional regularization is performed. analysis. All fields including descriptions are available at
Figure 5 displays group differences between demographic the GitHub repository accompanying this manuscript. When
subsets of real data compared to group differences from syn- processing BSNIP data with DemoVAE, we used age, sex,
thetic DemoVAE data. We see that by conditioning on demo- race, and schizophrenia diagnosis as demographic variables
graphicinput,DemoVAEcanproducesamplesthataccurately to decorrelate latent features. Interestingly, the five BSNIP
recapitulate group differences in FC data. Table IV shows fields that remained correlated to DemoVAE latent features
RMSE values for deviation in group differences between at a significance of p < 0.05 were related to medication
synthetic DemoVAE data and real data. (taking or not taking anti-psychotics, p<0.0218) or Positive
and Negative Syndrome Scale (PANSS) assessment as to the
severityofschizophreniasymptoms[54].Theseincludedtotal
C. PhenotypePredictionUsingDemoVAESynthetic
positive symptom score (p<0.0098), total negative symptom
Data
score(p<0.0296),totalgeneralsymptomscore(p<0.0011),
Table V shows the predictive RMSE and accuracy when and total PANSS score (p < 0.00033). This seems to imply
trainingmodelsonrealfMRIdataandpredictingonsynthetic thattypeorseverityofschizophreniasymptoms[55]mayhave
DemoVAE data and vice versa. Predictive tasks include age, effects in fMRI data which are not accounted for by a simple
sex,race,andSZdiagnosisprediction.Thepredictiveaccuracy binary diagnosis of the condition or demographics.
CF
gnitseR
EAVomeD
EAV
ralugeR
NAG-W8 GENERICCOLORIZEDJOURNAL,VOL.XX,NO.XX,XXXX2017
t-SNE of Real vs Synthetic FC Samples
40
Resting FC Resting FC Resting FC
DemoVAE Synthetic Regular VAE Synthetic 40 W-GAN Synthetic
20 20
20
0 0
0
20 20
20
40 40 40
20 0 20 40 20 0 20 40 40 20 0 20 40
Fig.4. t-SNEembeddingsofsyntheticFCdatafromDemoVAE,traditionalVAE,andW-GANmodelsoverlayedontopoft-SNEembeddings
ofrealrestingstateFCdatafromthePNCdataset.BluecirclesrepresentembeddingsofrealsubjectFCdatawhileorangecrossesrepresent
embeddingsofsyntheticdata.WeseethatDemoVAEcapturesthedistributionoffMRIFCdataaswellasorbetterthanatraditionalVAEandbetter
thanaGAN.
VAE: Mean FC VAE: Old-Young Children Difference VAE: Male-Female Difference VAE: Race (AA-EA) Difference VAE: SZ-HC Difference
(1000 subjects) (1000 subjects) (1000 subjects) (1000 subjects) (1000 subjects)
0 0 0.100 0 0.100 0 0.100 0 0.100
0.7
0.075 0.075 0.075 0.075
50 0.6 50 50 50 50
0.050 0.050 0.050 0.050
0.5
100 100 0.025 100 0.025 100 0.025 100 0.025
0.4 0.000 0.000 0.000 0.000
150 0.3 150 0.025150 0.025150 0.025150 0.025
200 0.2 200 0.050200 0.050200 0.050200 0.050
0.1 0.075 0.075 0.075 0.075
250 250 250 250 250
0.0 0.100 0.100 0.100 0.100
0 50 100 150 200 250 0 50 100 150 200 250 0 50 100 150 200 250 0 50 100 150 200 250 0 50 100 150 200 250
Ground Truth PNC: Mean FC Ground Truth PNC: Old-Young Children Difference Ground Truth PNC: Male-Female Difference Ground Truth PNC: Race (AA-EA) Difference Ground Truth BSNIP: SZ-HC Difference
(1193 subjects) (523 subjects) (1193 subjects) (1193 subjects) (405 subjects)
0 0.8 0 0.100 0 0.100 0 0.100 0 0.100
0.7 0.075 0.075 0.075 0.075
50 50 50 50 50
0.6 0.050 0.050 0.050 0.050
100 0.5 100 0.025 100 0.025 100 0.025 100 0.025
0.4 0.000 0.000 0.000 0.000
150 150 150 150 150
0.3 0.025 0.025 0.025 0.025
200 0.2 200 0.050200 0.050200 0.050200 0.050
0.1 0.075 0.075 0.075 0.075
250 250 250 250 250
0.0 0.100 0.100 0.100 0.100
0 50 100 150 200 250 0 50 100 150 200 250 0 50 100 150 200 250 0 50 100 150 200 250 0 50 100 150 200 250
Fig.5. GroupFCdifferencesusingrealdataandsyntheticdatageneratedbyDemoVAEconditionedonappropriatedemographicinput.Top:
synthetic DemoVAE data, bottom: real data. From left to right, we see that DemoVAE qualitatively recapitulates group differences in the PNC
(mean,age,sex,race)andBSNIP(SZdiagnosis)datasets.ArrowspointoutFCfeaturesinrealdatathatarereproducedinsyntheticDemoVAE
samples.BrainfunctionalnetworksforthePoweratlas,shownlefttorightandtoptobottominFCmatrices,aregiveninTableIII.
TABLEV
TRANSFEROFMODELSBETWEENFMRIANDVAE.RMSE(AGEPREDICTION)ANDMEANACCURACY(SEX,RACE,ANDSCHIZOPHRENIA
PREDICTION)FORMLPMODELSTRAINEDONGROUNDTRUTHFMRIDATAANDTESTEDONDEMOVAEGENERATEDSAMPLESANDVICEVERSA.
FC=PEARSONFUNCTIONALCONNECTIVITY,PCFC=PARTIALCORRELATION-BASEDFUNCTIONALCONNECTIVITY
TrainonfMRI,TestonVAE
PNCDataset
PredictiveTask NullModel RestFC RestPCFC NbackFC NbackPCFC EmoidFC EmoidPCFC
Age(years,RMSE) 3.30 0.570 2.181 0.468 1.97 0.495 1.91
Sex(ACC,%) 53.2 100 99.7 100 99.6 99.9 99.4
Race(ACC,%) 53.0 100 99.8 100 99.9 100 100
TrainonVAE,TestonfMRI
PNCDataset
PredictiveTask NullModel RestFC RestPCFC NbackFC NbackPCFC EmoidFC EmoidPCFC
Age(years,RMSE) 3.30 2.032 2.752 1.848 2.567 1.953 2.597
Sex(ACC,%) 53.2 88.9 90.4 90.9 91.2 91.1 91.7
Race(ACC,%) 53.0 93.2 96.3 93 96.1 93.1 97.1
TrainonfMRI,TestonVAE TrainonVAE,TestonfMRI
BSNIPDataset BSNIPDataset
PredictiveTask NullModel FC PCFC PredictiveTask NullModel FC PCFC
Age(years,RMSE) 12.4 3.67 3.86 Age(years,RMSE) 12.4 7.98 10.3
Sex(ACC,%) 54.5 100 100 Sex(ACC,%) 54.5 97.5 94.5
Race(ACC,%) 61.2 100 100 Race(ACC,%) 61.2 96.0 93.3
Schizophrenia(ACC,%) 54.3 100 98.7 Schizophrenia(ACC,%) 54.3 93.3 92.3ORLICHENKOetal.:DEMOGRAPHIC-CONDITIONEDVARIATIONALAUTOENCODERFORFMRIDISTRIBUTIONSAMPLINGANDREMOVALOFCONFOUNDS9
Significant Correlations Between Tasks/Questionnaire/Demographic Fields
and FC/DemoVAE Latents in PNC Dataset
Resting State Task Working Memory Task Emotion Identification Task
102
100 97 100 100
88 91 88 88 91
80 80 76 80 76
70 70
60 55 60 60
40 40 40
20 20 20
13 13
5 1 4 1
0 0 0
FC FC VAE Z VAE Z DemoVAE ZDemoVAE Z FC FC VAE Z VAE Z DemoVAE ZDemoVAE Z FC FC VAE Z VAE Z DemoVAE ZDemoVAE Z
p<0.05 p<0.01 p<0.05 p<0.01 p<0.05 p<0.01 p<0.05 p<0.01 p<0.05 p<0.01 p<0.05 p<0.01 p<0.05 p<0.01 p<0.05 p<0.01 p<0.05 p<0.01
Significant Correlations Between Tasks/Questionnaire/Demographic Fields Significant Correlations Between Questionnaire/Demographic Fields
and SNPs/DemoVAE Latents in PNC Dataset 30 and FC/DemoVAE Latents in BSNIP Dataset
102
100
25
80 75 74 20
60 65 15 17 16
40 10
8
20 14 5 5 5 3
2
0 0
SNPs SNPs VAE Z VAE Z DemoVAE Z DemoVAE Z FC FC VAE Z VAE Z DemoVAE Z DemoVAE Z
p<0.05 p<0.01 p<0.05 p<0.01 p<0.05 p<0.01 p<0.05 p<0.01 p<0.05 p<0.01 p<0.05 p<0.01
Fig.6. Correlationofquestionnaire,computerizedbattery,andclinicalfieldswithfMRIFCdataversustraditionalVAEordecorrelatedDemoVAE
latentfeatures.Top:PNCdatasetfMRIdata,leftbottom:PNCdatasetSNPdata,rightbottom:BSNIPdatasetfMRIdata.Therewereatotalof
169fieldsinthePNCdatasetand32intheBSNIPdataset.WeseethatbothFCandtraditionalVAElatents,whichareconfoundedbypatient
demographics,havesignificantcorrelationswithmorethanhalfofallfields.OncedemographicconfoundsareremovedwithDemoVAE,however,
bothFCandSNPdataaresignificantlycorrelatedwithonlyasmallpercentageoffields.AlistofthefieldsusedisavailableintheGitHubrepository.
Bluecolor=correlationwithFCfeatures,Redcolor=correlationwithregularVAElatents,Orangecolor=correlationwithDemoVAElatents
E. ImputationoffMRIScannerTask from left, leftmost red arrow), of large somatomotor-visual
network connectivity differences between older and younger
Table VI displays RMSEs when imputing FC from one
children.Ficek-Tanietal.havefoundsex-relateddifferencesin
fMRI scanner task, i.e., resting state, working memory, or
thedefaultmodenetwork(DMN),withfemaleshavinghigher
emotion identification, to another. We find incorporating
intra-DMN connectivity and males having higher connectivity
the average training set difference only improved RMSE
between DMN and other regions [61] [62]. This finding is
marginally from simply reusing the input. Either an MLP
again reproduced by our own simple analysis of PNC data
or DemoVAE in deterministic mode, where only the scanner
shown in Figure 5 (middle FC matrix). While the effects of
task “demographic” was changed in the decoder D (z,y),
θ
ethnicity on fMRI have been less widely studied, it has been
gave approximately the same RMSE, which was significantly
reported that race may have a large effect on the features
better than adding the average of training set difference.
of FC data [53] [13]. Concerning schizophrenia, Li et al.
By introducing 10% noise to the latent features created by
have reported significant hypoconnectivities in multiple brain
the DemoVAE encoder E (x), the RMSE was significantly
ϕ
networks [63], including the somatomotor network, which
reduced compared to MLP or deterministic DemoVAE when
aligns with our differential FC map in Figure 5 (far right FC
taking the best of 10 samples. Interestingly, in this case the
matrix,leftarrow).Bernardetal.specificallyidentifiedmotor
averageerrorofthe10sampleswasnotincreasedsignificantly
networksascontributingtoschizophreniaendophenotype[64].
comparedtoMLPorDemoVAEindeterministicmode.These
The fact that our DemoVAE model is able to reproduce these
results suggest that there is a wide range of natural variability
group differences in synthetic data while capturing the wide
in FC, even when considering the same subject [56].
variation in individual fMRI data (see Figure 4) makes it
suitable for exploratory use by researchers who do not have
IV. DISCUSSION
permission or have not yet applied to access clinical fMRI
Previous work has found group differences in FC between
datasets. This is further supported by the results, shown in
children and young adults as well as other demographic
Table V, that models trained on synthetic DemoVAE data
groups. Sanders et al. have identified that somatomotor-visual
perform comparably to models trained on real fMRI data.
network resting state functional connectivity in the Human
Connectome Project dataset [57] is most highly correlated Moreover, previous researchers [53] [13] have highlighted
with age of child or adolescent [58]. Other investigators have the possibility of prediction based on fMRI data being con-
found that somatomotor-visual network connectivity showed founded by demographics, e.g. ethnicity in the prediction
an increase in connectivity strength in a longitudinal subset of scholastic achievement. Likewise, it is known that the
of older adults [59] from the UK Biobank [60]. These data prevalenceofschizophreniamaybeelevatedinmencompared
support our finding, shown in Figure 5 (second FC matrices to women [65], or at least that the age of onset of the disease10 GENERICCOLORIZEDJOURNAL,VOL.XX,NO.XX,XXXX2017
TABLEVI
RMSES(MEANANDSTANDARDDEVIATION)FORTHERECONSTRUCTIONOFONETASKFCFROMANOTHERSCANNERTASKINTHETESTSET,
USINGMLPMODEL,MEANDIFFERENCEONTRAININGSET,ANDDEMOVAE.DEMOVAEISUSEDINDETERMINISTICMODEANDUSINGBESTAND
AVERAGEOF10SAMPLESADDING10%NOISEINTHELATENTDIMENSION.THEABILITYOFTHEDEMOVAETOSAMPLETHEDISTRIBUTIONINTHE
LATENTSPACEALLOWSITTOGENERATEMOREACCURATESAMPLESWHENTHETRANSFERFUNCTIONISNON-DETERMINISTIC.
Rest→Nback Rest→Emoid Nback→Rest Nback→Emoid Emoid→Rest Emoid→Nback
ZeroFC 0.333±0.091 0.344±0.100 0.368±0.103 0.344±0.100 0.368±0.103 0.333±0.091
ReuseInput 0.218±0.058 0.234±0.064 0.232±0.059 0.197±0.054 0.234±0.064 0.194±0.055
AverageTrainingSetDiff. 0.210±0.057 0.231±0.064 0.230±0.059 0.194±0.055 0.231±0.064 0.197±0.054
MLP 0.191±0.047 0.200±0.050 0.216±0.047 0.190±0.048 0.217±0.050 0.180±0.039
DemoVAE(Deterministic) 0.196±0.0526 0.202±0.055 0.220±0.056 0.188±0.048 0.219±0.059 0.183±0.047
DemoVAE(Bestof10) 0.176±0.028 0.185±0.034 0.203±0.034 0.185±0.032 0.203±0.034 0.178±0.029
DemoVAE(Avg.of10) 0.197±0.052 0.202±0.056 0.220±0.056 0.189±0.048 0.219±0.059 0.183±0.047
tendstobedifferentinmenversuswomen[66].Infact,ifnot REFERENCES
regressing out the effects of age, most measures of scholastic
achievement would be highly confounded by children’s grade [1] J.W.Belliveauetal.,“Functionalmappingofthehumanvisualcortex
level. We believe the ability to generate fMRI latent features by magnetic resonance imaging.” Science, vol. 254 5032, pp. 716–9,
1991.
where the confounding effects of demographics are removed
[2] D. D. Cox and R. L. Savoy, “Functional magnetic resonance imaging
may be a valuable addition to the analysis of fMRI FC data. (fMRI)“brainreading”:detectingandclassifyingdistributedpatternsof
Alternately, given the present finding of high confounding fMRIactivityinhumanvisualcortex,”Neuroimage,vol.19,no.2,pp.
261–270,Jun.2003.
effects of demographics in FC data, it may be useful for
[3] K.L.Phanetal.,“Functionalneuroanatomyofemotion:ameta-analysis
researchers to begin to consider other and newer modalities, ofemotionactivationstudiesinPETandfMRI,”Neuroimage,vol.16,
such as FNIRS [67], MEG [68], or electrode recordings [69] no.2,pp.331–348,Jun.2002.
[4] K. N. Ochsner et al., “Rethinking feelings: An fmri study of the
in addition to fMRI.
cognitive regulation of emotion,” Journal of Cognitive Neuroscience,
Although we find significant reductions in correlations vol.14,no.8,pp.1215–1229,2002.
with clinical questionnaire or computerized battery fields af- [5] S. Koelsch et al., “Investigating emotion with music: an fMRI study,”
ter removing the confounding effects of demographics with Hum.BrainMapp.,vol.27,no.3,pp.239–250,Mar.2006.
[6] J. T. Coull and A. C. Nobre, “Where and when to pay attention: the
DemoVAE (see Figure 6), not all correlations seem to be
neural systems for directing attention to spatial locations and to time
based on demographic confounds. Among the fields that intervals as revealed by both PET and fMRI,” J. Neurosci., vol. 18,
remained significantly correlated were antipsychotics medi- no.18,pp.7426–7435,Sep.1998.
[7] K.R.Pughetal.,“Auditoryselectiveattention:AnfMRIinvestigation,”
cation use and four PANSS symptom severity fields in the
Neuroimage,vol.4,no.3,pp.159–173,Dec.1996.
BSNIP dataset. In fact, Sendi et al., among others [64], [8] A. E. Hernandez, M. Dapretto, J. Mazziotta, and S. Bookheimer,
reported changes in FC correlate with schizophrenia symp- “Language switching and language representation in Spanish-English
bilinguals: an fMRI study,” Neuroimage, vol. 14, no. 2, pp. 510–520,
toms [70]. Additionally, Chopra et al. identified differential
Aug.2001.
FC in schizophrenia patients taking antipsychotic medication
[9] M. P. van den Heuvel and H. E. Hulshoff Pol, “Exploring the brain
compared to antipsychotic-naive patients [71]. We believe the network: a review on resting-state fMRI functional connectivity,” Eur.
fact that DemoVAE quickly identifies clinical outcomes that Neuropsychopharmacol.,vol.20,no.8,pp.519–534,Aug.2010.
[10] A. Orlichenko et al., “Latent similarity identifies important functional
are measurable by FC and unconfounded with respect to
connectionsforphenotypeprediction,”IEEETransactionsonBiomedi-
demographic information makes it a worthwhile contribution calEngineering,vol.70,no.6,pp.1979–1989,2023.
to the neuroimaging communities. [11] S. ˙Ic¸er, ˙Irem Acer, and A. Bas¸, “Gender-based functional connectivity
differences in brain networks in childhood,” Computer Methods
and Programs in Biomedicine, vol. 192, p. 105444, 2020.
V. CONCLUSION
[Online]. Available: https://www.sciencedirect.com/science/article/pii/
This paper proposes a new way to condition the well- S0169260719310685
[12] B.SenandK.K.Parhi,“Predictingbiologicalgenderandintelligence
known VAE model on demographic information by decor-
from fmri via dynamic functional connectivity,” IEEE Transactions on
relating demographic information during VAE training and BiomedicalEngineering,vol.68,no.3,pp.815–825,2021.
incorporating this information into the decoder stage. This [13] A. Orlichenko et al., “ImageNomer: Description of a functional con-
nectivity and omics analysis tool and case study identifying a race
method of conditioning and training creates synthetic samples
confound,”NeuroimageRep.,vol.3,no.4,p.100191,Dec.2023.
that recapitulate both group differences as well as individual [14] S.Wangetal.,“Abnormallong-andshort-rangefunctionalconnectivity
subject variation in FC. We show that DemoVAE outperforms inadolescent-onsetschizophreniapatients:Aresting-statefMRIstudy,”
Progress in Neuro-Psychopharmacology and Biological Psychiatry,
a traditional VAE in capturing the whole distribution of
vol.81,pp.445–451,Feb.2018.
fMRI data. It is shown that most clinical questionnaire and [15] B. Rashid et al., “Classification of schizophrenia and bipolar patients
computerized battery fields that are correlated with fMRI using static and dynamic resting-state fMRI brain connectivity,” Neu-
featuresareinfactconfoundedbytheabilityoffMRIfeatures
roimage,vol.134,pp.645–657,Jul.2016.
[16] P. R. Millar et al., “Predicting brain age from functional connectivity
to predict demographics. By contrast, our DemoVAE model
in symptomatic and preclinical alzheimer disease,” NeuroImage, vol.
shows that several clinical outcomes related to schizophrenia 256, p. 119228, 2022. [Online]. Available: https://www.sciencedirect.
areindependentofdemographicfeatures.Wehopethisfinding com/science/article/pii/S1053811922003524
[17] G. Qu et al., “Ensemble manifold regularized multi-modal graph con-
can shed lights on the appropriate future use of demographic
volutionalnetworkforcognitiveabilityprediction,”IEEETransactions
information in neuroimaging. onBiomedicalEngineering,vol.68,pp.3564–3573,2021.ORLICHENKOetal.:DEMOGRAPHIC-CONDITIONEDVARIATIONALAUTOENCODERFORFMRIDISTRIBUTIONSAMPLINGANDREMOVALOFCONFOUNDS11
[18] Y.Wangetal.,“Anefficientandreliablestatisticalmethodforestimating [42] R.C.Guretal.,“Neurocognitivegrowthchartinginpsychosisspectrum
functional connectivity in large scale brain networks using partial youths,”JAMAPsychiatry,vol.71,no.4,p.366,Apr.2014.[Online].
correlation,”Front.Neurosci.,vol.10,p.123,Mar.2016. Available:http://dx.doi.org/10.1001/jamapsychiatry.2013.4190
[19] W.Huetal.,“Distancecanonicalcorrelationanalysiswithapplicationto [43] P.Sayeghetal.,“Qualityofeducationpredictsperformanceonthewide
animaging-geneticstudy,”J.Med.Imaging(Bellingham),vol.6,no.2, range achievement test-4th edition word reading subtest.” Archives of
p.026501,Apr.2019. clinicalneuropsychology:theofficialjournaloftheNationalAcademy
[20] W. Yan et al., “Deep learning in neuroimaging: Promises and chal- ofNeuropsychologists,vol.298,pp.731–6,2014.
lenges,” IEEE Signal Processing Magazine, vol. 39, no. 2, pp. 87–98, [44] J. D. Ragland et al., “Working memory for complex figures: an fmri
2022. comparisonofletterandfractaln-backtasks.”Neuropsychology,vol.16
[21] A.Rameshetal.,“Zero-shottext-to-imagegeneration,”inProceedings 3,pp.370–9,2002.
of the 38th International Conference on Machine Learning, ser. [45] J.D.Poweretal.,“Functionalnetworkorganizationofthehumanbrain,”
Proceedings of Machine Learning Research, M. Meila and T. Zhang, Neuron,vol.72,pp.665–678,2011.
Eds., vol. 139. PMLR, 18–24 Jul 2021, pp. 8821–8831. [Online]. [46] A. Abraham et al., “Machine learning for neuroimaging with scikit-
Available:https://proceedings.mlr.press/v139/ramesh21a.html learn,”FrontiersinNeuroinformatics,vol.8,2014.[Online].Available:
[22] A. Radford et al., “Language models are unsupervised multitask https://doi.org/10.3389/fninf.2014.00014
learners,” 2019. [Online]. Available: https://api.semanticscholar.org/ [47] O. Ledoit and M. Wolf, “A well-conditioned estimator for large-
CorpusID:160025533 dimensionalcovariancematrices,”J.Multivar.Anal.,vol.88,no.2,pp.
[23] Q. Mei et al., “A turing test of whether AI chatbots are behaviorally 365–411,Feb.2004.
similartohumans,”Proc.Natl.Acad.Sci.U.S.A.,vol.121,no.9,Feb. [48] C.A.Tammingaetal.,“Bipolarandschizophrenianetworkforinterme-
2024. diatephenotypes:Outcomesacrossthepsychosiscontinuum,”Schizophr.
[24] I.Goodfellowetal.,“Generativeadversarialnets,”inAdvancesinneural Bull.,vol.40,no.Suppl2,pp.S131–S137,Mar.2014.
informationprocessingsystems,2014,pp.2672–2680. [49] A.Abrol,H.Rokham,andV.D.Calhoun,“Diagnosticandprognostic
[25] D. P. Kingma and M. Welling, “Auto-Encoding Variational Bayes,” in classification of brain disorders using residual learning on structural
2ndInternationalConferenceonLearningRepresentations,ICLR2014, mri data,” in 2019 41st Annual International Conference of the IEEE
Banff, AB, Canada, April 14-16, 2014, Conference Track Proceedings, EngineeringinMedicineandBiologySociety(EMBC),2019,pp.4084–
2014. 4088.
[26] R.Rombachetal.,“High-resolutionimagesynthesiswithlatentdiffu- [50] M. Arjovsky, S. Chintala, and L. Bottou, “Wasserstein generative
sionmodels,”inProceedingsoftheIEEE/CVFConferenceonComputer adversarial networks,” in Proceedings of the 34th International
VisionandPatternRecognition,2022,pp.10684–10695. Conference on Machine Learning, ser. Proceedings of Machine
Learning Research, D. Precup and Y. W. Teh, Eds., vol. 70.
[27] M.E.Lainoetal.,“Generativeadversarialnetworksinbrainimaging:
PMLR, 06–11 Aug 2017, pp. 214–223. [Online]. Available: https:
Anarrativereview,”J.Imaging,vol.8,no.4,Mar.2022.
//proceedings.mlr.press/v70/arjovsky17a.html
[28] J.-H. Kim et al., “Representation learning of resting state fMRI with
[51] F.Pedregosaetal.,“Scikit-learn:Machinelearninginpython,”Journal
variationalautoencoder,”Neuroimage,vol.241,no.118423,p.118423,
ofmachinelearningresearch,vol.12,no.Oct,pp.2825–2830,2011.
Nov.2021.
[52] L.vanderMaatenandG.Hinton,“Visualizingdatausingt-sne,”Journal
[29] M. A. Pourhoseingholi, A. R. Baghestani, and M. Vahedi, “How
of Machine Learning Research, vol. 9, no. 86, pp. 2579–2605, 2008.
to control confounding effects by statistical analysis,” Gastroenterol.
[Online].Available:http://jmlr.org/papers/v9/vandermaaten08a.html
Hepatol.BedBench,vol.5,no.2,pp.79–83,2012.
[53] J. Li et al., “Cross-ethnicity/race generalization failure of behavioral
[30] A. C. Skelly, J. R. Dettori, and E. D. Brodt, “Assessing bias: the
prediction fromresting-state functional connectivity,” Sci. Adv., vol.8,
importance of considering confounding,” Evid. Based Spine Care J.,
no.11,p.eabj1812,Mar.2022.
vol.3,no.1,pp.9–12,Feb.2012.
[54] S.Liechtietal.,“Adevelopmentalhistoryofthepositiveandnegative
[31] M.Yuetal.,“Statisticalharmonizationcorrectssiteeffectsinfunctional
syndrome scale (PANSS),” Innov. Clin. Neurosci., vol. 14, no. 11-12,
connectivity measurements from multi-site fMRI data,” Hum. Brain
pp.12–17,Dec.2017.
Mapp.,vol.39,no.11,pp.4213–4227,Nov.2018.
[55] M. Dabiri et al., “Neuroimaging in schizophrenia: A review article,”
[32] P.DhariwalandA.Q.Nichol,“DiffusionmodelsbeatGANsonimage
Front.Neurosci.,vol.16,p.1042814,Nov.2022.
synthesis,” in Advances in Neural Information Processing Systems,
[56] M. Mantwill et al., “Brain connectivity fingerprinting and behavioural
A.Beygelzimer,Y.Dauphin,P.Liang,andJ.W.Vaughan,Eds.,2021.
predictionrestondistinctfunctionalsystemsofthehumanconnectome,”
[Online].Available:https://openreview.net/forum?id=AAWuCvzaVt
Commun.Biol.,vol.5,no.1,p.261,Mar.2022.
[33] M.Yuetal.,“Statisticalharmonizationcorrectssiteeffectsinfunctional [57] D. C. Van Essen et al., “The human connectome project: a data
connectivity measurements from multi-site fMRI data,” Hum. Brain acquisition perspective,” Neuroimage, vol. 62, no. 4, pp. 2222–2231,
Mapp.,vol.39,no.11,pp.4213–4227,Nov.2018.
Oct.2012.
[34] K.P.Murphy,ProbabilisticMachineLearning:AdvancedTopics. MIT [58] A.F.P.Sandersetal.,“Age-relateddifferencesinresting-statefunctional
Press,2023.[Online].Available:http://probml.github.io/book2 connectivity from childhood to adolescence,” Cereb. Cortex, vol. 33,
[35] K.Sohn,H.Lee,andX.Yan,“Learningstructuredoutputrepresentation no.11,pp.6928–6942,May2023.
using deep conditional generative models,” in Advances in Neural [59] A.Orlichenkoetal.,“Somatomotor-visualrestingstatefunctionalcon-
Information Processing Systems, C. Cortes, N. Lawrence, D. Lee, nectivityincreasesafter2yearsintheUKbiobanklongitudinalcohort,”
M.Sugiyama,andR.Garnett,Eds.,vol.28. CurranAssociates,Inc., J.Med.Imaging(Bellingham),vol.11,no.02,Apr.2024.
2015. [60] C.Sudlowetal.,“UKbiobank:Anopenaccessresourceforidentifying
[36] A.Razavi,A.vandenOord,andO.Vinyals,“Generatingdiversehigh- thecausesofawiderangeofcomplexdiseasesofmiddleandoldage,”
fidelity images with VQ-VAE-2,” in Advances in Neural Information PLoSMed.,vol.12,no.3,p.e1001779,Mar.2015.
ProcessingSystems32:AnnualConferenceonNeuralInformationPro- [61] B. Ficek-Tani et al., “Sex differences in default mode network con-
cessingSystems2019,NeurIPS2019,December8-14,2019,Vancouver, nectivity in healthy aging adults,” Cereb. Cortex, vol. 33, no. 10, pp.
BC,Canada,H.M.Wallachetal.,Eds.,2019,pp.14837–14847. 6139–6151,May2023.
[37] A. Ramesh et al., “Zero-shot text-to-image generation,” 2021, cite [62] M. Jung et al., “Sex differences in the default mode network with
arxiv:2102.12092.[Online].Available:http://arxiv.org/abs/2102.12092 regard to autism spectrum traits: A resting state fMRI study,” PLoS
[38] D. Dereniowski and M. Kubale, “Cholesky factorization of matrices One,vol.10,no.11,p.e0143126,Nov.2015.
in parallel and ranking of graphs,” in Parallel Processing and Applied [63] S.Lietal.,“Dysconnectivityofmultiplebrainnetworksinschizophre-
Mathematics, ser. Lecture notes in computer science. Berlin, Heidel- nia: A meta-analysis of resting-state functional connectivity,” Front.
berg:SpringerBerlinHeidelberg,2004,pp.985–992. Psychiatry,vol.10,p.482,Jul.2019.
[39] T. D. Satterthwaite et al., “Neuroimaging of the philadelphia neurode- [64] J.A.Bernard,J.R.M.Goen,andT.Maldonado,“Acaseformotornet-
velopmentalcohort,”NeuroImage,vol.86,pp.544–553,2014. workcontributionstoschizophreniasymptoms:Evidencefromresting-
[40] J. T. Glessner et al., “Strong synaptic transmission impact by copy state connectivity,” Hum. Brain Mapp., vol. 38, no. 9, pp. 4535–4545,
number variations in schizophrenia,” Proc. Natl. Acad. Sci. U. S. A., Sep.2017.
vol.107,no.23,pp.10584–10589,Jun.2010. [65] X. Li, W. Zhou, and Z. Yi, “A glimpse of gender differences in
[41] M. E. Calkins et al., “The philadelphia neurodevelopmental cohort: schizophrenia,”Gen.Psychiatr.,vol.35,no.4,p.e100823,Aug.2022.
constructing a deep phenotyping collaborative,” J. Child Psychol. Psy- [66] R.Lietal.,“Whysexdifferencesinschizophrenia?”J.Transl.Neurosci.
chiatry,vol.56,no.12,pp.1356–1369,Dec.2015. (Beijing),vol.1,no.1,pp.37–42,Sep.2016.12 GENERICCOLORIZEDJOURNAL,VOL.XX,NO.XX,XXXX2017
[67] P. Pinti et al., “The present and future use of functional near-infrared
spectroscopy(fNIRS)forcognitiveneuroscience,”Ann.N.Y.Acad.Sci.,
vol.1464,no.1,pp.5–29,Mar.2020.
[68] S. P. Singh, “Magnetoencephalography: Basic principles,” Ann. Indian
Acad.Neurol.,vol.17,no.Suppl1,pp.S107–12,Mar.2014.
[69] S. Saha et al., “Progress in brain computer interface: Challenges and
opportunities,”Front.Syst.Neurosci.,vol.15,p.578875,Feb.2021.
[70] M. S. E. Sendi et al., “Aberrant dynamic functional connectivity of
defaultmodenetworkinschizophreniaandlinkstosymptomseverity,”
Front.NeuralCircuits,vol.15,p.649417,Mar.2021.
[71] S. Chopra et al., “Functional connectivity in antipsychotic-treated and
antipsychotic-naivepatientswithfirst-episodepsychosisandlowriskof
self-harmoraggression:Asecondaryanalysisofarandomizedclinical
trial,”JAMAPsychiatry,vol.78,no.9,pp.994–1004,Sep.2021.