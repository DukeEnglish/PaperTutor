Prediction of Activated Sludge Settling Characteristics from Microscopy
Images with Deep Convolutional Neural Networks and Transfer Learning
Authors:
Sina Borzooei*(correspondingauthor)
sina.borzooei@ivl.se
Orcid:0000-0002-0694-3064
IVL Swedish EnvironmentalResearchInstitute,P.O. Box 21060,StockholmSE-100 31,
Sweden/ BIOMATH, Department ofData AnalysisandMathematical Modelling,Faculty of
Bioscience Engineering,Ghent University,Coupurelinks 653,9000Gent,Belgium
Leonardo Scabini
scabini@ifsc.usp.br
SãoCarlos Institute of Physics,University ofSãoPaulo,13560-970, SãoCarlos -SP, Brazil/
KERMIT,Department of DataAnalysisand MathematicalModelling, GhentUniversity,
Coupure links653,9000Gent,Belgium
GiseleMiranda
gmirand@kth.se
Division of Computational ScienceandTechnology,KTH RoyalInstituteofTechnology, 10044
Stockholm, Sweden
Saba Daneshgar
saba.daneshgar@ugent.be
BIOMATH, Department of DataAnalysisand MathematicalModelling, Facultyof Bioscience
Engineering, GhentUniversity, Coupurelinks 653,9000Gent,Belgium/ CAPTURE, Centrefor
AdvancedProcess Technology for UrbanResourceRecovery, FriedaSaeysstraat1,9000Gent,
Belgium
Lukas Deblieck
lukas.deblieck@pantarein.be
PantareinWater,Egide Walschaertsstraat22L, 2800Mechelen, Belgium
Piet DeLanghe
piet.delanghe@pantarein.be
PantareinWater,Egide Walschaertsstraat22L, 2800Mechelen, Belgium
OdemirBruno
bruno@ifsc.usp.br
SãoCarlos Institute of Physics,University ofSãoPaulo,13560-970, SãoCarlos -SP, Brazil
1BernardDeBaets
Bernard.DeBaets@ugent.be
ORCID: 0000-0002-3876-620X
KERMIT,Department of DataAnalysisand MathematicalModelling, GhentUniversity,
Coupure links653,9000Gent,Belgium
Ingmar Nopens
Ingmar.nopens@ugent.be
BIOMATH, Department of DataAnalysisand MathematicalModelling, Facultyof Bioscience
Engineering, GhentUniversity, Coupurelinks 653,9000Gent,Belgium/ CAPTURE, Centrefor
AdvancedProcess Technology for UrbanResourceRecovery, FriedaSaeysstraat1,9000Gent,
Belgium
ElenaTorfs
elena.torfs@ugent.be
Université Laval,1065avenuedela Médecine,Québec G1V0A6, QC,Canada/ BIOMATH,
Department of DataAnalysis andMathematical Modelling,GhentUniversity, Coupurelinks
653,9000Gent, Belgium
2Abstract
Microbial communities play a key role in biological wastewater treatment processes. Activated
sludge settling characteristics, for example, are affected by microbial community composition,
varying by changes in operating conditions and influent characteristics of wastewater treatment
plants (WWTPs). Timelyassessmentand predictionof changesinmicrobialcomposition leading
to settling problems, such as filamentous bulking (FB), can prevent operational challenges,
reductions of treatment efficiency, and adverse environmental impacts. This study presents an
innovative computer vision-based approach to assess activated sludge-settling characteristics
based on the morphological properties of flocs and filaments in microscopy images.
Implementing the transfer learning of deep convolutional neural network (CNN) models, this
approach aims to overcome the limitations of existing quantitative image analysis techniques.
The offline microscopy image dataset was collected over two years, with weekly sampling at a
full-scale industrial WWTP in Belgium. Multiple data augmentation techniques were employed
to enhance the generalizability of the CNN models. Various CNN architectures, including
Inception v3, ResNet18, ResNet152, ConvNeXt-nano, and ConvNeXt-S,were testedto evaluate
their performance in predicting sludge settling characteristics. The sludge volume index (SVI)
was used as the final prediction variable, but the method can easily be adjusted to predict any
other settling metric of choice. The results showed that the suggested CNN-based approach
provides less labour-intensive, objective, and consistent assessments, while transfer learning
notably minimises thetraining phase, resultingin ageneralizable systemthat canbeemployedin
real-time applications. The model's capability to signal early indicators of FB events makes it a
valuable tool for effective monitoring and preemptive management of WWTPs facing activated
sludge settlingproblems.
Keywords: Wastewater treatment plant; Filamentous bulking, Convolutional neural networks;
Transferlearning; Sludgesettling characteristics;Microscopy images
31. Introduction
The Activated Sludge Process (ASP) is the most commonly used suspended-growth biological
treatment technology for municipal and industrial wastewater treatment.TheASPis atwo-stage
process, including biochemical and physical solid separation stages in the settling and
clarification units. Available microorganisms in activated sludge break down the complex
substances into simple, stable substances and consume carbon, ammonium, and phosphatefrom
the wastewater. Therefore, the coreofthe ASPisthe maintenanceofmixed microbialcultures in
sludge. Flocs formed by the floc-forming species in ASP can be separated from treated
wastewater by gravity forces, which is one of the most energy-efficient and economic
solid-liquid separation technologies (Henze et al., 2008). This is essential to maintain sufficient
biomass retention time and sludge concentration in the biochemical stage. Good sludge
settleability and compatibility are crucial to ensure efficient solid-liquid separationinsecondary
clarifiers at modern Biological Nutrient Removal Activated Sludge (BNRAS) systems. A
balance between the different types of microorganisms is necessary to guarantee efficient
nutrient removal,goodsludge-settling characteristics,andeffectivesolid removal. Typicalsludge
settling issues in BNRAS systems are pinpoint flocs formation, filamentous bulking and
foaming, dispersed growth, and viscousbulking(Amaral et al.,2013). Filamentousbacteriasuch
as Sphaerotilus natans and Candidatus Microthrix parvicella (M. parvicella)arethe backbone of
floc formation and a structure tofloc-forming bacteria.When filamentousbacteriaovergrow due
to various physicochemical factors and/or changes in process conditions, it can result in open
flocs and/or inter-floc bridging (Burger et al., 2017). This phenomenon, called Filamentous
Bulking (FB), is the most commonly occurring solids settling problem, which can deteriorate
flocs settlingcharacteristics, poseoperationalchallenges andfailure,and increasetreatmentcosts
(Lu et al., 2023). FB is reported as the number one cause ofeffluent noncompliance inWWTPs
with opposing economic and environmental impacts (Richard et al.,2003). It isknown that over
50% of WWTPs worldwide reported operational issuesdueto FB(Martinset al.,2004). Despite
extensive research on FB, it appears to be a persistent issue in WWTPs. This can be because a
thorough and precise understanding ofFBis hamperedbythe complexrelationshipsbetween the
various microorganism species, their diversity, and the lack of clarity surrounding operational
conditions inducing the phenomena (Sam et al., 2022). In wastewater treatment practice,sludge
bulking can be characterized by a high Sludge Volume Index (SVI) (e.g. SVI > 150 ml g-1)
(Martins et al., 2004). However, the critical SVI value above which bulking can occur is highly
linked to the local operation, practice and design of secondary clarifiers (Henze et al., 2008).
This makes FBan empiricalphenomenon withoutan accuratescientificandquantitativeindex to
distinguishbulking from non-bulkingsludge.
Recently, various optical microscopy techniques have been widely used in BNRAS systems to
investigate the morphology and composition of activated sludge flocs and identify different
microbial species and arrangements of microorganisms (Costa et al., 2022). Identifying and
characterizing filamentous bacteria provides the most crucial information for understanding FB.
This identification is primarily based on the morphological characterization of filamentous
bacteria and their responses to a few microscopic staining tests. Initially, human-performed
determination of theflocsize andfilamentlength usingacounting chamber wasimplementedon
the offline microscope observations to distinguish the flocs and filaments based on various size
ranges (Cenens et al., 2002). As these manual methods are time-demanding, subjectively
interpretable and prone tohuman error,automated QuantitativeImage Analysis(QIA) toolshave
been employed to monitor ASPs (Costa et al., 2013). Several studies demonstrated successful
4applications of QIA techniques for determining filamentous bacteria contents, analyzing the
aggregate morphology and floc structures to assess the AS operating parameters using
phase-contrast, bright-field and fluorescence microscopy images or a combination thereof
(Banadda et al., 2003; Burger et al., 2017; Campbell etal., 2019;Costaet al.,2022;DaMottaet
al., 2001; Dias et al., 2016; Koivuranta et al., 2015; Mesquita et al., 2016, 2010; Oliveira et al.,
2018; Silva et al., 2022). However, QIA applications usually require laborious and
time-consuming image pre/processing steps such as image enhancement, object segmentation,
debris and background detection and elimination. In the reviewed QIA applications for
investigating FB phenomena, conventional image segmentation (IS) methods such as
thresholding, histogram-based bundling and region growing were implemented to differentiate
between background,bulkyobjects,filaments andflocs.These semi-automatictechniquescan be
highly influenced by the subjectivity and bias of practitioners' decisions regarding the selection
of algorithms and the pre-defined threshold values. Among various implemented IS methods,
none can be regarded as the most appropriate technique for all types of sludge images. The
method designed for a specific final application and the particular image type might not
necessarily apply to other cases. Researchers who lack computer science expertise encounter a
challengein correctlyparametrizingandusing thesemethods.
Additionally, the final goal of the majority of reviewed QIA applications was to identify the
filamentous bacteria using different morphological indicators and ultimately investigate
linear/nonlinear correlations among them, standard wastewater treatment operating parameters
and/orsettleability indicessuch asSVI (Banadda etal., 2003;Boztoprak etal., 2016;Mesquita et
al., 2009). This requires a well-trained practitioner to decide the most relevant morphological
parameters to be extracted for each application. For instance, Amaral and Ferreira (2005)
reported a group of 36 morphological descriptors, such as the aspect ratio, roundness, reduced
radius of gyration, form factor, etc., to be checked to establish relationships between
macroscopic and microscopic properties of the BNRAS system. Each descriptor encapsulates
different aspects of the microbial community. The further challenge concerns considering
combinations of these descriptors in multivariate analyses to solve the complexities of floc
formation, FB, and their subsequent impacts on system performance. Identifying a single
descriptor that fully encapsulates all factors affecting settling characteristics presents a
significant challenge, if not impossible. Hence, considering a microscopy image as an integral
entityisa viablealternativethat requiresadvancedcomputationaltechnologies.
The morphology of filamentous bacteria in BNRAS systems can vary due to environmentaland
operational changes, complicating their detection tasks. To cope with this complexity andgiven
the current transitional trend of the water industry towards digitalization due to the fourth
industrial revolution (Industry 4.0) (Bai et al., 2020), there is an urgent need for advanced
automated solutions such as the deep learning (DL) paradigm. DL is a branch of machine
learning (ML) based on Artificial Neural Networks (ANNs) designed as a multiple-layer
processing architecture that can be used to obtain high-level features from input data, including
but not limited to images, sounds, videos, and text (Goodfellow et al., 2016). DL-based
techniques have become the de-facto methodology in Computer Vision (CV) applications. By
combining preprocessing, segmentation, feature extraction and prediction into a unifed
framework, DL allows less human interventions regarding fine-tuning CV models (Chai et al.,
2021). The Convolutional Neural Network (CNN) is a class of DL methods commonly usedfor
processing grid-structured data, such as images. CNNs were designed to learn feature
5representations from low to high-level patterns through convolution operations with
filter-defined sizes. Such architecture requires extensive training on large datasets to adaptively
learn spatial hierarchies of features through backpropagation (Ghabri et al., 2023). A common
approach is to employ transfer learning (TL) by using a model already trained in a specific
dataset and then fine-tuning it for different tasks and inpute data (Chan et al.,2023). Successful
applicationsof TL were demonstratedfor the classificationofcervicalcancer microscopy images
(Nguyenetal.,2018), classificationof microbeadsinurban wastewater (YurtseverandYurtsever,
2019), concrete crack detection (Dung, 2019) andtea diseasedetection (Ramdan etal., 2020).In
the context of ASPs, the only available application of TL of CNNs was reported by Satohetal.
(2021), where the authors proposed two separate CNNs formulated for supervised classification
of binary labelled images. The models successfully detected aggregated and dispersed flocsand
theabundanceof filamentousbacteria.
Inspired by thesuccessofCNNs inCV,this paperpresents aCNN-basedapproachfor predicting
activated sludge settling characteristics based on the morphological properties of flocs and
filaments found in offline microscopy images. This is achieved by applying pre-trained CNN
models on extensive image datasets (ImageNet) and fine-tuning them using microscopy images
from a real-scale industrial WWTP. Multiple data augmentation techniques are employed to
generate supplementarytraining datato enhancethegeneralizabilityof theCNNmodels.Various
CNN architectures, including Inception v3, ResNet18, ResNet152, ConvNeXt-nano, and
ConvNeXt-S, are examined, andtheir performancein predictingsludge settling parameters,such
as the SVI, is compared. Figure 1 provides an overview of the methodology proposed in this
study. The code for our methods and experimental setup is publicly available
(https://github.com/scabini/wastewater_vision).
6Fig.1AutomatedAnalysisofSludgeSettlingCharacteristics:AVisualGuidetotheCNN-basedMethodology
2.Materialsand methods
2.1Data collectionand preparation
The dataset used in this study was collected from a WWTP servicing a maltery industry in
Antwerp, Belgium. Under the operation of Pantarein Water Bvba, the WWTP employs an
intricate, multi-stage treatment process designed to handle the wastewater produced during the
malting processefficiently.Thetreatmentprocess includesacylindrical sequencingbatch reactor
(SBR) with a BNRAS system, followed by separation in a membrane bioreactor (MBR). The
SBR unit with a 6 m depth and a volume of5200m3treats anaverage of2300m3ofwastewater
influent daily. An on-off controller for blower activation and a proportional-integral-derivative
(PID) controller regulating blower frequency are used in the SBR unit's aerating system to
control the dissolved oxygen (DO) concentration.Thewaste-activatedsludge (WAS) isremoved
from the SBR at an average flow rate of 170 m3/day. Weekly samples from the SBR unit were
collected over an extended period, from November 1, 2020, to July 31, 2022. During this time,
thesludge retentiontime(SRT)was keptat, onaverage,4.7days withastandard deviationof5.3
days, indicating different operational states. Physical, chemical, and microscopic analyses were
performed on thesamples.Thebiomass's settling capacitywasdeterminedfor each sampleusing
a cylindrical column, with sludge height variation observations conductedfor 30 minuteswithin
7a 1L settling cylinder. Total Suspended Solids (TSS) were quantified by weight determination
post-filtering a defined volume of the AS mixture to separate the liquid and solid phases. This
filtration process utilizedpre-weighedfilter papers (chm,125mm,Spain), aBüchner funnel,and
a single-stage vacuum pump. After filtration, the residual solid matterand filter weredriedin an
oven set at 103-105 °C for a duration exceeding 1 hour. The dried filter and sludge were
subsequently weighed, and the filter paper's weight was subtracted to determine the AS's dry
weightin theoriginal specific volume. TSSmeasurements werethen utilizedto calculatetheSVI
based on the APHA (American Public Health Association) protocol (Beutler et al., 2014). In
addition to the data already mentioned, wastewater quality parameters from the influent of
WWTP, influent and effluent of SBR, along with the operational parameters of the SBR, were
collected andmonitored duringthe studyperiod,as presented inTable 1.
Table1.Overviewof wastewater characteristicsandSBR operationalparameters
Parameters Locationof Unit Average±
sampling/Measuring SD
Flowrate(Q ) Influent m3/d 2300±600
in
TotalChemicalOxygenDemand (COD ) Influent mg/L 2950±500
in
TotalNitrogen(TN ) Influent mg/L 74±20
in
TotalPhosphorous(TP ) Influent mg/L 22±7
in
TotalSuspendedSolids(TSS ) Influent mg/L 350±140
in
Mixed Liquor SuspendedSolids (MLSS) SBRunit g/L 11.2±1.5
pH SBRunit - 6.5±0.5
TotalCycle Time SBRunit min 200±30
To obtain microscopy images, aBiohitProline pipette wasusedto deposita12 μLsampleonto a
microscope slide covered with an 18 mm×18 mm coverslip. Phase contrast microscopy was
employed to capture images of the flocs and filaments on the slide, utilizing an Olympus BX43
microscope with a 4× objective magnification.An average offiveimageswere taken per sample
to comprehensively cover the coverslip's surface. The number and distribution of flocs on the
slide determined the precise number of images acquired per sample. All images were
subsequently resized to a resolution of512x384pixels,areduction ofone-fourth of theoriginal
resolution, to enhance computational efficiency. Pixel normalization was achieved through
zero-centering andunity variance (z-score)bytheImageNet mean andvariance parameters.
2.2Applied CNNmodels
CNNs are ANN topologies frequently used in CV problems. They extract the most relevant
characteristics by performing a series of operations on incoming data using convolutional and
pooling layers. A defined-size filter is convolved with the inputdata togenerate anewmatrix in
the convolution operation, which is the building block of a CNN. Each convolutional layer is
made up of a collection of filters that are used to produce an activation mapfor each input.The
pooling layers are employed to reduce the spatial size of the convolution output. Maximum or
average pooling are commonly used to compress the input and decrease noise, therefore
highlighting the most important features. After the final convolution, the resulting matrix is
downscaled into a one-dimensional vector, which is then fed to a feed-forward ANN. The last
layer, be it for classification or regression, is selected based on the desired task(Li etal., 2021).
Thetraining of a CNNconsists ofa seriesof iterationsusing backpropagation.
8Over the last 20 years, different CNN architectures have been proposed. One example is the
Inception model, initially called GoogLeNet. It was introduced in an attempt to overcome the
computational costs of earlier deep models, mainly designed to stack large convolution
operations. Instead, the inception architecture is made up of modules that are connected by
parallel convolutional layers. Each module processes the signal separately before joining them
together. In this way, the network becomes wider rather than deeper. This is achieved using
different filter sizes, characterizing multiscale feature learning, and 1x1 convolutions applied
after the max pooling layer for dimensionality reduction. Through concatenating the inception
modules, the network reaches greater depths with reduced computational costs compared to
previous architectureslikeAlexNet andVGG.InceptionV3 (Szegedyetal., 2016)is employedin
this work, incorporating advancements over the originalarchitecture,such asregularizationwith
batch-normalized auxiliaryclassifiersand label-smoothing.
The ResNet architecture (He et al., 2016) was proposed to overcome problems related to the
“vanishing gradient” problem since the performance of previous models did not scale with the
increase in number of network layers.Thename comesfromresidual connections,also known as
skip connections, and has the advantage of improving the signal flow and reducing the
occurrence of exploding gradients, usually caused by exponential decay or the increase of the
signal’s magnitude, since the gradient multiplication becomes enormous over time. High
gradients result in abrupt changes in the model's weights during training. As a result, the model
is unable to learn, leading the training to stagnate. Introducing residual connections reducesthis
behaviour considerably and allows training deep models more efficiently by reducing the
network into fewer layers. In this work, two variations of the ResNet architecture were
considered, a small and a bigger one, considering their computational cost: ResNet18 and
ResNet152.
After the ResNets were proposed, most ofthe CNNarchitecturesremained similar,composedof
the same design concepts previously described until the proposal of the Vision Transformer
(ViT) (Dosovitskiy et al., 2021). ConvNeXts, for instance, are the result of updates on the
architecture of a typical ResNet by including ViT principles in the convolutional modules since
the arrival of ViTs brought new insights into the CNN study (Liu et al., 2022). ConvNeXts
architecture includes patching over input, the ResNeXt structure, an inverted bottleneck, higher
filter size, GELu activationfunctions, enhancedlayernormalization,and separatedownsampling
layers. We investigated two ConvNeXt versions in our experiments, ConvNeXt-nano and
ConvNeXt-S, withdifferentcomputationalcosts.Figure 2showsa ConvNeXtblock comparedto
Inceptionand ResNet.
9Fig.2AsummaryofthearchitecturaldifferencesbetweenthethreetypesofCNNsemployedinthiswork.
One crucial characteristic of CNNs when implementing them in real-world applications is their
computational complexity, also known as computational cost or budget. Several metrics can be
used to quantify thecost of ANNs.Oneof themost adopted onesis thenumberof Floating Point
Operations (FLOPs), which measures the computationalcomplexityof amodel andestimatesits
processing time.Anothermetricconsists ofcounting the parameters(weights), whichestimates a
model's memory consumption since weight values must be stored. A higher number of FLOPs
and parameters mayresultina morerobust andaccuratemodel, butitrequiresincreasingly more
data and computational resourcesto trainandrun. Detailsofeach CNNarchitectureemployedin
this studyaregiveninTable 2.
Table2.ComparisonofCNNarchitectures:depth,computationalcomplexity,andparameters
Model Depth GFLOPs Parameters(million)
(GigaFLOPs)
InceptionV3 48 2.85 21.79
ResNet18 18 1.82 11.18
ResNet152 152 11.58 58.15
ConvNeXt-nano 42 2.46 14.95
ConvNext-S 108 8.70 49.46
From Table 2, it can be deduced that regarding GFLOPs, gigaFLOPs persecond, ResNet152is
the most computationally complex model, followed by ConvNeXt-S. ResNet18 is the least
complex model among the five listed. Regarding the number of parameters, ResNet152isagain
the largest model, with58.15millionparameters. ConvNeXt-S hasthe second-highestnumberof
10parameters, followed by Inception v3. ResNet18 has the smallest number of parameters, with
11.18million.
2.3.Data augmentation
Data augmentation iscommonly employedtoenhancethe performanceof CNNsduring training,
mainly when working with limited sample sizes. The technique generates additional samplesby
applying label-preserving image transformations. Thisprocess enrichesthe datasetand improves
the model's generalizability while reducing the risk of overfitting (Shorten and Khoshgoftaar,
2019). For instance, random rotations and translations of training samples can enhance object
recognition tasks. However, the selection of augmentation methods should be done carefully to
avoid introducing noise. For example, random rotations in medical imaging may lead to
anatomically implausibleconfigurations. Thisstudy employeddataaugmentation techniques that
preserve critical attributes of floc and filaments morphological characteristicsfor CNNanalysis.
Suitable modifications included random flips along both axes, rotations within a range of -180º
to 180º, brightness adjustments varying from -20% to +20%, and random erasure of2% to20%
of the image area. The augmentations were applied randomly during each training iteration,
allowing the CNN model to handle variations in floc and filament position, brightness, and
potential overlap. Figure 3 displays 12 instances of augmentations implemented on a specific
image.
Fig.3.ExamplesofdataaugmentationsappliedtoamicroscopyimageforimprovingCNNtrainingdataset
variabilityandrobustness.
112.4Modeltraining and transfer learning
In this study, we employed three CNN architectures and their variations to predict SVI values
directly based on microscopy images. To this end, the last layers of CNNs were replaced by a
linear regression layer. Each CNN architecture was built from scratch or fine-tuned with
pre-training on ImageNet-1k (Deng et al., 2009), a well-known computer vision dataset of 1.2
million images categorized into 1000 classes. However, for fine-tuning the ConvNeXt-S
architecture, a moreextensive datasetwas required;hence,ImageNet-21k,a datasetwithover 14
million images categorized into more than 21,000 classes, was used.Following thecutting-edge
ANN training methods proposed by Liu et al. (2022), the final layer of the pre-trained models
was initialised with random weights and then trained on the target dataset.Thebackpropagation
approach reduced the Mean Squared Error (MSE) by adopting the AdamW optimizer for loss
function minimization, with an initial learning rate of 0.0001 that was adaptable to the depth of
the model. Models were fine-tuned using a batch size of 32 across 30 epochs, and the learning
rate was annealed throughout the epochs using cosine annealing decay. Employing stochastic
depth, layers were randomly omitted during training to reduce parameter numbers and improve
model generalization. As a regularisationprocedure, weightdecay wasimplementedbyadding a
penalty term to the loss function to lower the weights and thereby mitigate overfitting.
Experiments were conducted using Python (version 3.7) with PyTorch and timm libraries on an
Ubuntu server equipped with two Nvidia GeForce RTX 2080ti graphics cards (11 GB VRAM
each) andan AMDRyzenThreadripper3990xprocessorwith 94GBRAM.
2.5.Validation and model evaluation
The MSE was adopted as the loss function used during the training for regression of the CNNs
models evaluated in this work. The MSE was also used to assess the model’s generalization
performance on the test dataset. The models were trained for 30 epochs when using the TL
approach and 95 epochs when training from scratch. The lowest MSEonthe testset definedthe
final checkpoint. To mitigateoverfitting andobtain arobustandreliableperformance evaluation,
the 10-fold cross-validation method was used. The original dataset was divided intoten subsets.
The model was then interatively trained on nine subsets and evaluated on the remaining one,
ensuring that each sample in the dataset was used as a test sample at least once. The mean
performance wascalculatedacross allfolds.Thebest model isassessed onthe correspondingtest
set during each cross-validation iteration, considering regression metrics other than MSE. The
Mean AbsoluteError (MAE), MeanTweedie Deviance(MTD), coefficientof determination(R2),
and Mean Absolute Percentage Error (MAPE) were used to evaluate the generalization
performance of the trained models quantitatively. In our analysis, x represents the ground truth
i
SVI for input image I and y represents the model's corresponding prediction output. The MAE
i
is calculated by taking the average absolute difference between the predicted and actual values
for each testsamplein everycross-validation fold.
𝑛
1 | |
𝑀𝐴𝐸 = ∑ 𝑥 − 𝑦
𝑛 𝑖 𝑖
𝑖=1
MAPE is computed as the average of the absolute percentage errors, and R2 measures the
fractionof variance intheground truth valuesexplainedbythepredicted values:
12𝑛 | |
𝑥−𝑦
𝑀𝐴𝑃𝐸 = 1 ∑ 𝑖 𝑖
𝑛 𝑥
𝑖=1 𝑖
𝑛
2
∑(𝑥−𝑦)
2 𝑖 𝑖
𝑅 = 1 − 𝑖=1
𝑛 𝑛 2
∑(𝑥−1 ∑𝑥)
𝑖 𝑛 𝑗
𝑖=1 𝑗=1
MTD measures the deviation between the predicted and ground truth values for a Poisson
distribution:
𝑛 ( 𝑥 )
𝑀𝑇𝐷 = 1 ∑ 2(𝑥 log𝑙𝑜𝑔 𝑖 + 𝑦 − 𝑥)
𝑛 𝑖 𝑦 𝑖 𝑖
𝑖=1 𝑖
The average and standard deviation are computed across the ten cross-validation iterations for
each metric.
3.Resultsand discussion
3.1CNN comparison and selection ofthe bestmodel
The training loss (MSE) trajectories of different CNN architectures analyzed duringthe training
iterations are presented in Fig. 4. For all models, as the number of epochs increase, the training
loss decreases, indicating no big oscillations, convergence, and stabilization of weights,
complying with the expected behaviour when training CNNs (Liu et al., 2022). As a general
observation, the performance gap between the curves at the beginning of the training phase
indicates that TL starts with a lower loss for all CNN models, leading to a better final
performance (lower loss at the end of training). Additionally, it can be seen that training the
CNNs from scratch requires more epochs (100) compared totheTL approach,whichalso yields
faster learning (30 epochs). When comparing the performance of ResNetarchitectures, itcan be
observed that ResNet152 (both TL and non-TL) performed slightly better than ResNet18,
suggesting the deeper model fits the training data better. Although the ResNet18 model began
with a higher loss when using TL,the situationreversedat theend oftraining. AboutConvNeXt
models, both variantsstart withavery hightraining lossfollowedbya sharpdropover theinitial
epochs, indicatingfasterlearning oradjustment of weightsfor the trainingdata. Thebetter fitting
performance of the TL approach iseven morehighlightedfor theConvNeXt models.Whenused
with TL, the ConvNeXt-n showed better fitting and lower loss at the end of training than the
ConvNeXt-s. In this stage, it was concluded that TL isnecessaryfor achievingbetter SVI fitting
to the training data.
13Fig.4.ComparativetrainingbehaviourofthethreeCNNarchitectureswhentrainedfromscratchorwithTL
fromImageNet
In the next step, we analyzed the performance of the selected CNN architectures that were
fine-tuned with only TL on the validation datasets (Fig. 5). Both ConvNeXt-nano and
ConvNeXt-S present the lowest validation losses while maintaining stable performance. This
result aligns with other works in the CNN literature (Han et al., 2022) since ConvNeXts,
developed in 2022, incorporates more advanced techniques (see Section 2.2) than previous
models,suchasInception andResNets.
14Fig.5PerformancecomparisonofdifferentCNNs,withTLoverthevalidationsplits
Additionally, bigger CNN variants like ResNet152 and ConvNeXt-S were found to be more
challenging to train due to the occurrence of overfitting (evidenced by the gap betweentraining
and validation losses), achieving lower generalization performance than their smaller versions,
ResNet18 and ConvNeXt-nano. Thisindicates that addedmodel complexitydoes notnecessarily
improve performance. Increasing the quantity of training data may improve this issue in future.
The CNN models fine-tuned with TL and TFS using the validation data set, were compared
usingfour error measuresonthe testset:MAE, MTD,R2,and MAPE(Fig. 6).
15Fig.6.ComparativeevaluationoferrormetricsacrossTLandTFSmodelsonthetestdataset
Figure 6 shows that, in general, TL models surpass TFS models when evaluated bythe selected
error measures. This result highlights the efficacy of TL in applying pre-trained knowledge to
enhance CNN generalization andperformance for theconsidered dataset. AmongtheTL models,
ConvNeXt-nano (TL) exhibited optimal performance, securing the lowest MAE (37.51 ± 4.02)
and MTD (11.65 ± 1.94), MAPE (0.18 ± 0.02), and the highest R2 (0.75 ± 0.05). Inception v3
(TL) and ResNet18(TL) alsoperformed wellwithcomparableerror metrics.When analyzingthe
TFS models, ResNet18 (TFS) provides a higher performance, although not reaching the
ConvNeXt-nano (TL) results. Once more, this result indicates that CNN architectures that were
fine-tuned with TL aremore effectivefor this study.A possiblereasonfor the lower performance
of ResNet18 (TFS) can be linked to the random weight initialization, potentially resulting in
slower convergence leading to a suboptimal performance. ConvNeXt-S and ConvNeXt-nano
showed the weakest performances among the TFS models, resulting in the highestMAE,MTD,
and MAPE andthelowestR2.Again, thisresult canbe relatedto therandomweight initialization
and the absence of prior knowledge. The ConvNeXt-nano model was the most efficient CNN
architecturefor SVI prediction whenfine-tunedwithTL.
3.2Predictive performanceof theselected CNN
The ConvNeXt-nano CNN model underwent initial analysis for its capability to predict SVI
during training iterations, adhering to the previously outlined configuration.Figure 7depictsthe
16scatter plot of the SVI predictions by the ConvNeXt-nano CNN during the cross-validation
phase.
Fig.7.Ground-Truthvs.PredictedSVIValuesusingConvNeXt-nanoCNNduringcross-validation
An important observation from Fig. 7 is that although the model performs satisfactorily on
samples with lower SVI levels, it struggles with samples with SVI values above a certain
threshold (400 ml/g), marked byablack circle.In thesecases,actualSVI valuesoftenexceedthe
model's predictions. This issue may be linked to a bias in the training data, which mainly
includes instances of lower SVI values, limiting the ConvNeXt-nano model's capability to
analyze higher SVI levels effectively. Another intriguing observation is the variable prediction
accuracy when the ground-truth SVI values are consistent, but the predictions differ, which is
evident among observations in the red-coloured oval in Fig. 7. Despite identical SVI
measurements, variations in morphological features, floc and filament structures across images
can result in different SVI predictions. It can be due to the intrinsic multi-modality in the SVI
values, where one SVI value can reflect multiple morphological features. While SVI is a
standard metric for assessing the settling characteristics of activated sludge, it may not fully
capture all characteristics seen in microscopic evaluations. Therefore, although this study uses
SVI as the primary prediction variable, the results suggest thatmicroscopy imagesmight offer a
more thorough and detailed analysis of sludge morphology than SVI. Extending the research to
apply the CNN-based approach to differentor multiplesettling indicesmight revealmoredetails
aboutsettlingcharacteristics.
173.3Performance of the selected CNNduring filamentous bulkingevents
The performance of ConvNeXt-nano wasputtoa real-worldtestinpredicting SVI valuesduring
FB events. To this end, the first challenge was to identify the FB events during the sampling
campaign of this project. FB is characterized by poor sludge settling, resulting in high SVI
values (e.g., SVI > 150ml.g-1).We shouldrecognize that thecritical SVI threshold for bulking is
not universal but is somewhat influenced by local operational and design factors. Hence, each
WWTP may have its unique SVI "danger zone" that signals a shift towards FB. The
identification of FB events was meticulously done based on online turbidity sensor data, offline
analytical data (MLSS and SVI), in-situvisualobservationsandconfirmation by plant operators.
These episodes were identified when at least two data sources indicated compromised sludge
settling characteristics, while in-situ observations and operator inputs were the primary
indicators. Implementing this approach, the green bands marked in Fig. 8 indicate two selected
periods of FB. Figure 8 displays the ConvNeXt-nano CNN model predictions and SVI
measurements. A red linerepresents theaverage predictionfor each day,while theshaded region
indicates the standard deviation since multiple images were available per day. Plots (a) and (c)
correspond to non-bulking periods, while plots (b) and (d) contain green bands that highlight
confirmed FB episodes. An excellent model predictive performance can be observed for lower
SVI values during non-bulking periods, while the model can provide valuable insights into the
early stages of elevating SVI values, which can serve aspreliminary signalsofFB events.Inthe
context of WWTP operations, a sudden or gradual increase in SVI values can serve as an early
warning sign for FB events. In both green-banded periods in Fig. 8 (b) and (d), the model
predictions showa noticeableincreaseinSVI valuesright before theFB events.Thisemphasizes
the model's capability to beused asanearly warningsystem. Itis crucial toclarify that whilethe
model acts as a critical operational toolbydetecting elevatingtrends inSVI beforeFB, allowing
operators to take pre-emptive actions, it is not designed to forecast specific SVI values without
corresponding future image data. Therefore, the model's application dwells in its capacity to
detect initial SVI elevations to instigate timely interventions rather than predicting exact future
SVI values or FB events. Note that the system could not accurately capture some spikes inSVI
during the second bulking episode (in plot (d)).These limitationsareconsistent withthe model's
previously discussed difficulty in predicting higher SVI values due to biases in the training
dataset, which predominantly contains instances of lower SVI levels. From a practical point of
view, considering the empirical nature of FB detection, the model's capability to adapt to local
data and predict SVI values during these events is invaluable. Using the model as an early
warning system saves timeandresources byallowingfor proactive measuresrather thanreactive
solutions toactivated sludge-settlingproblems.
18Fig.8.SubplotanalysisofConvNeXt-nanopredictionsforSVI:(a)&(c)representnon-bulkingperiods,and
(b)&(d)highlightconfirmedFBepisodeswithreal-timeSVImeasurementsandmodelprediction
4. Conclusions
Prompt detection and forecasting of activated sludge settling issues, including filamentous
bulking (FB), can prevent operational challenges and financial implications. In this study, we
introduced an innovative method for assessing activated sludge settling characteristics using
computer vision techniques. Transfer learning of deep convolutional neural network (CNN)
models was proposed to studythe morphological propertiesofflocs andfilamentsinmicroscopy
images. The offline microscopy images dataset was collected over two years, with weekly
sampling at a full-scale industrial WWTP in Belgium. We explored different data augmentation
methods to make the model more adaptable to filament and floc structure variations, enhancing
its versatility. A comparative analysis of various CNN architectures, including Inception v3,
ResNet18, ResNet152, ConvNeXt-nano, and ConvNeXt-S, was conducted to evaluate their
performance inpredicting sludge volumeindex (SVI). Thefindingsshowedthat transfer learning
19significantly reduced the model's training time, reaching optimal results in just 30 epochs. This
made the model both computationally efficient and practically applicable. Notably, the
ConvNeXt-nano model outperformed othertestedmodelsacrosscritical metrics,includingMAE
(37.51 ± 4.02), MTD (11.65 ± 1.94), MAPE (0.18 ± 0.02), and R2 (0.75 ± 0.05). A real-world
application was demonstrated during filamentous bulking (FB) events and normal conditions
were recorded during the sampling campaigns. The modelcould effectivelysignalearly signsof
FB indicated by surges in SVI predictions. This makes the ConvNeXt-nano a potent tool for
proactive response planning in WWTPs. The model's performance on a limited dataset suggests
its broader applicability. This research marks a significant step towards efficiently monitoring
activated sludge settling characteristics and the real-time application of microscopy images in
wastewater treatmentoperations.
5. Acknowledgments
L. Scabini acknowledges funding from the São Paulo Research Foundation (FAPESP), Brazil
(Grants#2019/07811-0, #2021/09163-6,and#2023/10442-2).
B. De Baets received funding from the Flemish Government under the "Onderzoeksprogramma
Artificiële Intelligentie(AI) Vlaanderen"programme.
References
1. Amaral, A.L., Ferreira, E.C., 2005. Activated sludge monitoring of a wastewater treatment
plant using image analysis and partial least squares regression. Anal. Chim. Acta 544,
246–253.
2. Amaral, A.L., Mesquita, D.P., Ferreira, E.C., 2013. Automatic identification of activated
sludge disturbancesandassessment ofoperationalparameters. Chemosphere91,705–710.
3. Bai, C., Dallasega, P., Orzes, G., Sarkis, J., 2020. Industry 4.0 technologies assessment: A
sustainabilityperspective. Int. J.Prod.Econ.229,107776.
4. Banadda, E.N., Jenné, R., Smets, I.Y., Van Impe, J. van, 2003. Predicting the onset of
filamentous bulking in biological wastewatertreatment systemsbyexploitingimageanalysis
information, in: 2003European ControlConference (ECC).IEEE, pp.2935–2940.
5. Beutler, M., Wiltshire, K.H.,Meyer, B.,Moldaenke, C.,Luring, C.,Meyerhofer,M.,Hansen,
U.P., 2014. APHA (2005), Standard Methods for the Examination of Water andWastewater,
Washington DC: American Public Health Association. Ahmad, SR, and DM Reynolds
(1999), Monitoring of water quality using fluorescence technique: Prospect of on-line
processcontrol. Dissolved Oxyg DynModel CaseStudy Subtrop ShallowLake217,95.
6. Boztoprak, H., Özbay, Y., Güçlü, D., Küçükhemek, M., 2016. Prediction of sludge volume
index bulking using image analysis and neural network at afull-scale activated sludgeplant.
Desalination WaterTreat.57,17195–17205.
7. Burger, W., Krysiak-Baltyn, K., Scales, P.J., Martin, G.J., Stickland, A.D., Gras, S.L., 2017.
The influence of protruding filamentous bacteria on floc stability andsolid-liquid separation
in theactivatedsludgeprocess. WaterRes.123,578–585.
8. Campbell, K., Wang, J., Daniels, M., 2019. Assessing activated sludge morphology and
oxygen transferperformance usingimageanalysis. Chemosphere223,694–703.
209. Cenens, C., Van Beurden, K.P., Jenné, R., Van Impe, J.F., 2002. On the development of a
novel imageanalysistechniqueto distinguishbetween flocsandfilaments inactivated sludge
images. WaterSci.Technol. 46,381–387.
10.Chai, J., Zeng, H., Li, A., Ngai, E.W., 2021. Deep learning in computer vision: A critical
reviewof emerging techniquesand applicationscenarios.Mach. Learn. Appl. 6,100134.
11. Chan, J.Y.-L., Bea, K.T., Leow,S.M.H., Phoong, S.W.,Cheng,W.K.,2023.State of theart:a
review of sentiment analysis based on sequential transfer learning. Artif. Intell. Rev. 56,
749–780.https://doi.org/10.1007/s10462-022-10183-8
12.Comas, J., Rodríguez-Roda, I., Gernaey, K.V.,Rosen,C., Jeppsson,U., Poch,M.,2008.Risk
assessment modelling of microbiology-related solids separationproblems inactivated sludge
systems.Environ. Model. Softw.23,1250–1261.
13.Costa, J.C., Mesquita, D.P., Amaral, A.L., Alves, M.M., Ferreira, E.C., 2013. Quantitative
image analysis for the characterization of microbial aggregates in biological wastewater
treatment:a review.Environ. Sci.Pollut. Res.20,5887–5912.
14.Costa, J.G., Paulo, A.M., Amorim, C.L., Amaral, A.L., Castro, P.M., Ferreira, E.C.,
Mesquita, D.P., 2022. Quantitative image analysis as a robust tool to assess effluent quality
from an aerobic granular sludge system treating industrial wastewater. Chemosphere 291,
132773.
15.Da Motta, M., Pons, M.-N., Roche,N., Vivier,H., 2001.Characterisationof activatedsludge
byautomatedimageanalysis.Biochem. Eng.J. 9,165–173.
16.Deng, J., Dong, W., Socher, R., Li, L.-J., Li, K., Fei-Fei, L., 2009. Imagenet: A large-scale
hierarchical image database, in: 2009 IEEE Conference on Computer Vision and Pattern
Recognition. Ieee,pp.248–255.
17.Dias, P.A., Dunkel, T., Fajado, D.A., Gallegos, E. de L., Denecke, M., Wiedemann, P.,
Schneider, F.K., Suhr, H., 2016. Image processing for identification and quantification of
filamentous bacteriain insitu acquiredimages.Biomed. Eng.OnLine15,1–19.
18.Dosovitskiy, A., Beyer, L., Kolesnikov, A., Weissenborn, D., Zhai, X., Unterthiner, T.,
Dehghani, M., Minderer, M., Heigold, G., Gelly, S., Uszkoreit, J., Houlsby, N., 2021. An
Image isWorth 16x16 Words:Transformersfor ImageRecognition at Scale.
19.Dung, C.V., 2019. Autonomous concrete crack detection using deep fully convolutional
neural network.Autom.Constr. 99,52–58.
20.Dunkel, T., Dias, P.A., de León Gallegos, E.L., Tacke, V., Schielke, A., Hesse, T., Fajado,
D.A.S., Suhr, H., Wiedemann, P., Denecke, M., 2016. In situ microscopy as a tool for the
monitoring of filamentous bacteria: a case study in an industrial activated sludge system
dominated byM.parvicella. WaterSci. Technol.73,1333–1340.
21.Ghabri, H., Alqahtani, M.S., Othman, S.B., Al-Rasheed, A., Abbas, M., Almubarak, H.A.,
Sakli, H., Abdelkarim, M.N., 2023. Transfer Learning for Accurate Fetal Organ
Classificationfrom UltrasoundImages: A PotentialToolfor MaternalHealthcareProviders.
22.Goodfellow,I., Bengio,Y., Courville,A., 2016.Deeplearning.MIT press.
23.Han, Z., Jian, M., Wang, G.-G., 2022. ConvUNeXt: An efficientconvolution neuralnetwork
for medicalimagesegmentation. Knowl.-BasedSyst.253,109512.
24.He, K., Zhang, X., Ren, S., Sun, J., 2016.Identity MappingsinDeepResidual Networks, in:
Leibe, B., Matas, J., Sebe, N., Welling, M. (Eds.), Computer Vision – ECCV 2016, Lecture
Notes in Computer Science. Springer International Publishing, Cham, pp. 630–645.
https://doi.org/10.1007/978-3-319-46493-0_38
2125.Henze,M., vanLoosdrecht,M.C., Ekama, G.A.,Brdjanovic,D., 2008.Biologicalwastewater
treatment. IWApublishing.
26.Koivuranta, E., Stoor, T., Hattuniemi, J., Niinimäki, J., 2015. On-line optical monitoring of
activated sludgeflocmorphology.J. WaterProcessEng. 5,28–34.
27.Liu, Z., Mao, H., Wu, C.-Y., Feichtenhofer, C., Darrell, T., Xie, S., 2022. A convnet for the
2020s, in: Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern
Recognition. pp.11976–11986.
28.Lu, X., Yan, G., Fu, L., Cui, B., Wang, J., Zhou, D., 2023. A review of filamentous sludge
bulking controlsfrom conventional methodstoemergingquorum quenching strategies.Water
Res.119922.
29.Martins, Antonio MP, Pagilla, K., Heijnen, J.J., van Loosdrecht, M.C., 2004. Filamentous
bulking sludge—acritical review. WaterRes.38,793–817.
30.Martins, António MP, Pagilla, K., Heijnen, J.J., van Loosdrecht, M.C., 2004. Filamentous
bulking sludge—acritical review. WaterRes.38,793–817.
31.Mesquita, D.P., Amaral, A.L., Ferreira, E.C., 2016.Estimationof effluentqualityparameters
from an activated sludge system using quantitative image analysis. Chem. Eng. J. 285,
349–357.
32.Mesquita, D.P., Dias, O., Amaral, A.L., Ferreira, E.C., 2010. A comparison between bright
field and phase-contrast image analysis techniques in activated sludge morphological
characterization. Microsc. Microanal.16,166–174.
33.Mesquita, D.P., Dias, O., Dias, A.M.A., Amaral, A.L., Ferreira, E.C., 2009. Correlation
between sludge settling ability and image analysis information using partial least squares.
Anal. Chim.Acta642, 94–101.
34.Nguyen, L.D., Lin, D., Lin, Z., Cao, J., 2018. Deep CNNs for microscopic image
classification by exploiting transfer learning and feature concatenation, in: 2018 IEEE
International Symposium onCircuitsandSystems(ISCAS).IEEE, pp.1–5.
35.Oliveira, P., Alliet, M., Coufort-Saudejaud, C., Frances, C., 2018. New insights in
morphological analysis for managing activated sludge systems. Water Sci. Technol. 77,
2415–2425.
36.Ramdan, A.,Heryana,A., Arisal,A., Kusumo,R.B.S., Pardede,H.F.,2020.Transferlearning
and fine-tuning for deep learning-based tea diseases detection on small datasets, in: 2020
International Conference on Radar, Antenna, Microwave, Electronics, and
Telecommunications(ICRAMET). IEEE, pp.206–211.
37.Richard, M., Brown, S., Collins, F., 2003.Activatedsludge microbiology problemsandtheir
control, in: 20thAnnualUSEPA NationalOperator TrainersConference. pp. 1–21.
38.Sam, T., Le Roes-Hill, M., Hoosain, N., Welz, P.J., 2022. Strategies for Controlling
Filamentous Bulking in Activated Sludge Wastewater Treatment Plants: The Old and the
New.Water14,3223.
39.Satoh, H., Kashimoto, Y., Takahashi, N., Tsujimura, T., 2021. Deep learning-based
morphology classification of activated sludge flocs in wastewater treatment plants. Environ.
Sci. WaterRes.Technol. 7,298–305.
40.Shorten, C., Khoshgoftaar, T.M., 2019. A survey on Image Data Augmentation for Deep
Learning.J. BigData6, 60.https://doi.org/10.1186/s40537-019-0197-0
41.Silva, S.A., Del Río, A.V., Amaral, A.L., Ferreira, E.C., Alves, M.M., Mesquita,D.P., 2022.
Monitoring morphological changes from activated sludge to aerobic granular sludge under
22distinct organic loading rates and increasing minimal imposed sludge settling velocities
through quantitativeimage analysis.Chemosphere 286,131637.
42.Szegedy, C., Vanhoucke, V., Ioffe, S., Shlens, J., Wojna, Z., 2016. Rethinking the inception
architecture for computer vision, in: Proceedings of the IEEE Conference on Computer
Vision andPattern Recognition.pp.2818–2826.
43.Yurtsever, M., Yurtsever, U., 2019. Use of a convolutional neural network for the
classification of microbeads inurban wastewater.Chemosphere 216,271–280.
23