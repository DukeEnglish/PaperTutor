The Causal Chambers:
Real Physical Systems as a Testbed for AI Methodology
Juan L. Gamella∗1, Jonas Peters1, and Peter Bu¨hlmann1
1Seminar for Statistics, ETH Zu¨rich
Abstract
check foundational assumptions that underlie theoretical
work. This is because new fields come with new require-
In some fields of AI, machine learning and statistics, the ments in terms of ground truth, and few or no datasets
validation of new methods and algorithms is often hin- may have been collected that already satisfy them. For
dered by the scarcity of suitable real-world datasets. Re- example, for most sub-fields of causal inference [1, 2,
searchers must often turn to simulated data, which yields 3], we require data from phenomena whose underlying
limited information about the applicability of the pro- causalrelationshipsarealreadyexquisitelyunderstood,or
posed methods to real problems. As a step forward, we for which carefully designed intervention experiments are
have constructed two devices that allow us to quickly and available. Forsymbolicregression[4,5],thedatamustfol-
inexpensively produce large datasets from non-trivial but lowaknown,closed-formmathematicalexpression,e.g.,a
well-understood physical systems. The devices, which we naturallawinacontrolledexperimentalenvironment. For
call causal chambers, are computer-controlled laborato- thedifferenttypesofrepresentationlearning[6,7],wemay
ries that allow us to manipulate and measure an array needdataforwhichtherearesomelatent“generatingfac-
of variables from these physical systems, providing a rich tors” that we can measure directly. Such datasets can be
testbed for algorithms from a variety of fields. We illus- difficulttoobtaininpractice,andfewexistforthesetasks.
trate potential applications through a series of case stud- Asaresult,researchersareoftenlimitedtosyntheticdata
ies in fields such as causal discovery, out-of-distribution producedbycomputersimulations,whichmayfallshortof
generalization, change point detection, independent com- answeringhowwellaparticularmethodworksinpractice.
ponentanalysis,andsymbolicregression. Forapplications This is where we believe our work can contribute. We
tocausalinference,thechambersallowustocarefullyper- haveconstructedtwophysicaldevicesthatallowtheinex-
form interventions. We also provide and empirically vali- pensive and automated collection of data from two well-
date a causal model of each chamber, which can be used understood physical systems. The devices, which we call
asgroundtruthfordifferenttasks. Allhardwareandsoft- causal chambers, consist of a light tunnel and a wind tun-
ware is made open source, and the datasets are publicly nel (Fig. 2). They are, in essence, computer-controlled
available at causalchamber.org or through the Python laboratories (Fig. 1) to manipulate and measure different
package causalchamber. variables of the physical system they contain.
We believe that the chambers are well-suited to sub-
stantially improve the validation of methodological ad-
1 Introduction
vancementsacrossmachinelearningandstatistics,bypro-
viding real datasets with a ground truth for fields where
Methodological research in AI, machine learning, and
such datasets are otherwise scarce or non-existent. This
statistics often develops without a concrete application
is accomplished through two key properties of the cham-
in mind. Many impactful advances in these fields have
bers. First, the underlying physical systems are well-
beenmadeinthisway,andthereareimportanttheoretical
understood, in the sense that relationships between most
questions that are studied outside the context of a partic-
variablesaredescribedbyfirstprinciplesandnaturallaws
ular application. Crucially, progress also relies on having
involving linear, non-linear, and differential equations—
access to high-quality, real-world datasets, which bene-
seeApp.IIIandIVforadetaileddescriptionwithcarefully
fits methodological and theoretical researchers by helping
designed experiments. This allows us to provide ground
them steer research in meaningful directions, relaxing as-
truths for a variety of tasks, including a causal model of
sumptionsthatareunlikelytoholdinpractice,anddevel-
each chamber. Second, we can manipulate the systems in
oping methodologies that may work well on a variety of
a controlled and automated way, quickly producing vast
real-world problems.
amounts of data. Furthermore, the chambers produce
However, for some research areas, particularly nascent
data of different modalities, including i.i.d., time-series,
ones,itcanbedifficulttofindreal-worlddatasetsthatpro-
and image data, allowing us to provide validation tasks
vide a ground truth suitable to validate new methods and
for a wide range of methodologies.
∗CorrespondencetoJuanL.Gamella To illustrate the practical use of the chambers, we per-
juan.gamella@stat.math.ethz.ch form case studies in causal discovery, out-of-distribution
1generalization, change point detection, independent com- (C˜ ,C˜ ),andtheresultingairpressureinsidethecham-
in out
ponent analysis and symbolic regression—see Sec. 4 and ber (P˜ ,P˜ ) or at its intake (P˜ ). We can manipulate
dw up int
Fig. 5 and 6. Our choice constitutes only an initial selec- sensorparametersliketheoversamplingrateofthebarom-
tion, and we believe many other possibilities exist. eters (O ,O ,O ) or the timer resolution of the speed
dw up int
Our work complements existing datasets from more sensors (T ,T ), further affecting their measurements.
in out
complex real-world systems for which a ground truth is In the circuit that drives the speaker, we can manipulate
not or only partially available [e.g., 8], as well as efforts thepotentiometers(A ,A )thatcontroltheamplification,
1 2
to produce synthetic data that mimics such systems [e.g., monitoring the resulting signal at different points of the
9, 10, 11, 5, 12, 13]. While the good performance on the circuit (S˜ ,S˜ ) and through the microphone output (M˜).
1 2
chambers is not guaranteed to carry over to more com-
plex systems, we believe that the chambers can serve as a 2.2 The Light Tunnel
sanity check for foundational assumptions and algorithms
that are intended to work in a variety of settings. The light tunnel (Fig. 2bd) is a chamber with a control-
A list of all datasets we currently provide can be found lable light source at one end and two linear polarizers
atcausalchamber.org,togetherwithadescriptionofthe mounted on rotating frames. The relative angle between
experimental procedures used to collect them. To allow the polarizers dictates how much light passes through
otherresearcherstobuildtheirownchambers, weprovide them (see Fig. 4c and Fig. 4e) and sensors measure the
blueprints,componentlists,andsourcecodeinthereposi- light intensity before, between, and after the polarizers.
tory github.com/juangamella/causal-chamber-paper. Acameraonthesideoppositethelightsourceallowstak-
ing images from inside the tunnel.
Thetunnelprovidesimagedata(Fig.4e)and41numer-
2 The Causal Chambers
icalandcategoricalvariables(e.g.,Fig.4bcd),ofwhich32
can be manipulated. For example, we can control the in-
Eachchamberisamachinethatcontainsasimplephysical
tensity of the light source at three different wavelengths
system and allows us to measure and manipulate some of (R,GandB)andmeasurethedrawnelectriccurrent(C˜).
its variables. The chambers contain a variety of sensors,
Using motors, we can rotate the polarizer frames to de-
forexample,tomeasurelightintensityorbarometricpres-
sired angles (θ ,θ ) and measure the effect on light inten-
1 2
sure. To manipulate the physical system, actuators allow sityatdifferentwavelengths(I˜,I˜,I˜,V˜ ,V˜ ,V˜ ). Wecan
1 2 3 1 2 3
us to control, for example, the brightness of a light source
manipulate sensor parameters like the exposure time of
or the speed at which fans turn. Each sensor can also be
thecamera(T )orthephotodiodeusedbythelightsen-
Im
manipulatedbymodifyingsomeofitsparameters,suchas sors (DI,DI,DI), further affecting the readings of these
1 2 3
the oversampling rate or reference voltage.
sensors.
Throughout this manuscript, we refer to the actuators
andsensorparametersasthemanipulable variables ofthe
3 A Testbed for Algorithms
chamber. A programmable onboard computer controls all
sensor parameters and actuators, enabling the chambers
to conduct experiments and collect data without human Thechambersaredesignedtoprovideatestbedforavari-
supervision(Fig.1). Asaresult,thechamberscanquickly etyofalgorithmsfromAI,machinelearningandstatistics.
produce vast amounts of data, up to millions of observa- To set up validation tasks, we rely on two key properties
tions or tens of thousands of images per day. of the chambers: that the encapsulated physical system is
In the remainder of this section, we give an overview of wellunderstoodandthatwecanmanipulateit. Forexam-
each chamber, its physical system, and some of the mea- ple, by manipulating actuators we can evaluate a learned
sured variables. Fig. 2 provides diagrams of the chambers causal model in its prediction of interventional distribu-
and their main components, and a detailed description of tions. Or, in the case where the relationships between
all variables can be found in App. II. actuators and sensors are well described by a natural law,
we can set up a symbolic regression task where we try
to recover it from data. These are some examples of the
2.1 The Wind Tunnel
tasks we set up in our case studies in Sec. 4, but many
Thewindtunnel(Fig.2ac)isachamberwithtwocontrol- other possibilities exist.
lable fans that push air through it and barometers that In Fig. 3, we provide a graphical representation of the
measure air pressure at different locations. A hatch at physical system in each chamber under different configu-
thebackofthechambercontrolsanadditionalopeningto rations, in the form of a directed graph relating its vari-
the outside. A microphone measures the noise level of the ables. In their most basic form, the chambers operate in
fans, and a speaker allows for an independent effect on its thestandardconfiguration,wherethevalueofalltheactu-
reading. atorsandsensorparametersisexplicitlygivenbytheuser
The tunnel provides data from 32 numerical and cate- intheexperimentprotocol(Fig.1). Thelighttunneloper-
goricalvariables(seeFig.4aforsomeexamples), ofwhich ateswithoutthecameratoallowthefastestmeasurement
11 are sensor measurements, and 21 correspond to actua- rate.
tors and sensor parameters that can be manipulated. For For additional flexibility in setting up validation tasks,
example,wecancontroltheloadofthetwofans(L ,L ) the chambers can also operate in extended configurations.
in out
andmeasuretheirspeed(ω˜ ,ω˜ ),thecurrenttheydraw For example, these can include additional variables, such
in out
2Experiment Image
protocol data
# Set fans to idle
SET, load_in, 0.01
SET, load_out, 0.01
WAIT, 3000
MSR, 100, 0
# Apply impulse Numeric
SET, load_in,1 sensor
MSR,100,0
measurements
Figure 1: Data collection workflow. The user provides an experiment protocol consisting of step-by-step instruc-
tions describing the data collection procedure, which the chamber then carries out without human supervision. The
instructions specify when and to which values the actuators and sensor parameters should be set. They also specify
whenmeasurementsofallvariablesshouldbetakenandatwhichfrequency,atamaximumof10Hzforthelighttunnel
and 7 Hz for the wind tunnel. Actuators and sensor parameters can also be set automatically by the chamber as a
functionofothervariablesinthesystem, suchassensormeasurements. Thisallowsintroducingadditionalcomplexity
for some validation tasks, as described in Sec. 3.
as those from the light-tunnel camera (Fig. 3b) or addi- truths for a variety of causal inference tasks.
tional sensors included in the future. Furthermore, the Under our interpretation, the absence of an edge be-
extended configurations also allow us to assign the value tween two variables does not preclude the existence of
of actuators and sensor parameters as a function of other a causal effect between them. As with most real sys-
variablesinthesystem,suchassensormeasurements. The tems,effectsbetweenobservedvariablesmayexistbeyond
assignment is done automatically by the computer on- what we know or can validate through the procedures de-
board the chamber and allows us to introduce additional scribed in this paper, due to a lack of statistical power.
complexity into the system. For example, the “pressure- Furthermore, there are confounding effects where unmea-
control” configuration of the wind tunnel (Fig. 3d) imple- suredvariablessimultaneouslyaffectsomeofthevariables
mentsacontrolmechanismthatcontinuouslyupdatesthe in the chambers. For example, variations in the atmo-
fan power (L ,L ) to keep the chamber pressure (P˜ ) spheric pressure outside the chambers simultaneously af-
in out dw
constant. The assignment functions can be any stochas- fect all barometric measurements. We refer the reader to
tic or deterministic function that can be expressed in the App. V for more details.
Turing-completelanguagethatcontrolsthechambercom-
puter. Whilethisyieldsavastspaceofpossibleconfigura-
tions, for the moment, we only provide datasets from the 4 Case Studies
four configurations shown in Fig. 3.
In App. III, we provide a detailed description of all Wenowshow,throughpracticalexamples,howthecham-
the effects (i.e., edges) in Fig. 3, based on background bers can be used to validate algorithms from a variety of
knowledgeandcarefullydesignedexperiments(seeFig.7- fields. As a starting point, we provide a first collection
Fig.14). Furthermore,App.IVcontainsmechanisticmod- of datasets and set up tasks from a selection of research
els that describe some of the effects, ranging from simple areas. Ourchoiceisbynomeansexhaustive. Wedescribe
naturallawstomorecomplexmodelsinvolvingthetechni- each field and the corresponding tasks below and evalu-
cal specifications of the actual components. For the more ate the performance of different algorithms, showing the
complexprocessesinthechambers,suchastheimagecap- results in Fig. 5 and Fig. 6.
ture in the light tunnel or the effects on the wind tunnel For each case study, we provide a detailed description
pressure, we provide approximate models with increasing of the experimental procedure in App. I, together with
degrees of fidelity. In Fig. 6f, we compare the output of well-documentedcodetoreproducetheexperimentsinthe
some of these models to measurements gathered from the paper repository1. See Sec. 6 for details on accessing the
chambers. datasets.
3.1 Causal Ground Truth Causal discovery (Fig. 5a) By offering a causal
ground truth and the ability to carry out interventions,
For readers with a background in causal inference, the the chambers provide an opportunity to validate causal
graphs in Fig. 3 may be reminiscent of causal graphical discovery algorithms [e.g., 15, 16, 3, 17, 18], which aim
models [2, 3, 14]. In App. V, we formalize a causal inter- to recover cause-and-effect relationships from data. The
pretation of the graphs and validate them with additional chambers provide data suited to validate a wide range
randomized experiments. In short, an edge X Y signi- of approaches, including those that rely on i.i.d. or time-
→
fiesthataninterventiononX willchangethedistribution series data [19] with and without instantaneous or lagged
of subsequent measurements of Y. This interpretation al-
lows us to treat the graphs in Fig. 3 as causal ground 1github.com/juangamella/causal-chamber-paper
3a Wind Tunnel b Light Tunnel
c Wind tunnel components
Hatch Outer barometer Intake barometer
Speaker* *Speaker amplification circuit
Signal Amplifier
source
Potentiometers V
V
Measured signals
Microphone Exhaust fan Inner barometers Intake fan
d Light tunnel components
Angle Angle
sensor sensor
Light
sensor LEDs
Light Linear Linear
source polarizer polarizer
Camera variables
Lens aperture
Exposure time
LEDs
Sensor gain (ISO)
Captured image
Light Light
Red, green and blue levels LEDs Motor sensor Motor sensor
setting setting
Drawn electric current
Figure 2: The causal chambers. (a) The wind tunnel. (b) The light tunnel with the front panel removed to show
its inner components. (c,d) Diagrams of the chambers and their main components, including the amplification circuit
that drives the speaker of the wind tunnel and the variables for the light tunnel camera. The variables measured by
the chambers are displayed in black math print. Sensor measurements are denoted by a tilde. Manipulable variables,
that is, actuators and sensor parameters, are shown in bold symbols (shown as non-bold text elsewhere in the text).
A detailed description of each variable is given in App. II.
4a Light tunnel - standard configuration c Wind tunnel - standard configuration
b Light tunnel - camera
d Wind tunnel - pressure-control
Figure3: Representationoftheknowneffectsfordifferentchamberconfigurations. Boldsymbolscorrespond
to manipulable variables, such as actuators and sensor parameters (shown as non-bold text elsewhere in the text).
Sensormeasurementsaredenotedbyatilde. (a,c)Standardconfigurationsofthechambers(b)“camera”configuration
of the light tunnel, including images from the light tunnel (˜Im) and the camera parameters (Ap, ISO, T ). (d)
Im
“Pressure-control” configuration of the wind tunnel, where the load fans L ,L are set by a control mechanism to
in out
maintain the chamber pressure P˜ at a given level.
dw
causal effects, and causal structures with and without cy- predictive performance on data arising from interventions
cles [20, 21]. We consider the task of recovering the com- on the light source intensity (R,G,B), sensor parameters
pletecausalgraphdescribingtheeffectsinthesystem[22, (TI,TV,TV,TV) and polarizer alignment (θ ). For the
2 1 2 3 1
1,23],andevaluatealgorithmsthattakedifferenttypesof second task, we predict the color setting R,G,B of the
dataasinput: GES[24]forpurelyobservationaldata,UT- light source from the images captured by the camera. We
IGSP [25] for interventional data with unknown targets, employ a small convolutional neural network [30], which
andPCMCI+[26]fortime-seriesdata. Thisconstitutesan weevaluateonshiftsinducedbychangingthedistribution
example selection of methods that is not exhaustive. Per- of colors, the polarizer angles, and the camera parame-
formance ismeasured by therecoveryof the ground-truth ters. The goal of the last task is to predict the hatch po-
graph (see Sec. 3.1). The results are shown in Fig. 5a. sition H from the pressure curve (P˜ ) that results from
dw
For the i.i.d. data, GES and UT-IGSP recover the strong, applying a short impulse to the load L of the intake
in
lineareffectsfromthelight-sourcesetting(R,G,B)tothe fan. We fit a simple feed-forward neural network and val-
light-sensor readings and drawn current. However, both idate its performance on curves collected under different
methods struggle with the nonlinear effects of the polar- loads of the exhaust fan L , different barometer preci-
out
izer angles (θ ,θ ) and the weak effects of the additional sion (O ), and from a barometer in a different position
1 2 dw
LEDs(L ,...,L ),whichareapparentonlyinthecases (P˜ ). As expected, the performance of the methods de-
11 32 up
whenthelight-sourcebrightnessisloworthepolarizersare grades under distribution shifts. Interestingly, the notion
crossed (Fig. 15). For the time-series data from the wind of causal invariance [31] predicts the drop in performance
tunnel (task a3), PCMCI+ displays a low recall, recover- of some models. For example, the mean absolute error
ing the lagged and instantaneous effects of the fan loads (MAE) incurred by predicting the training-set mean (i.e.,
(L ,L )ontheotherfanvariables(ω˜ ,ω˜ ,C˜ ,C˜ ), the empty model) remains constant across environments,
in out in out in out
but failing to identify most other effects. except in those where the causal parents of the response
(see Fig. 3a) receive an intervention (i.e., R,G,B in tasks
Out-of-distribution generalization (Fig. 5b) By b1 and b2). In task b1, the model which includes only
manipulating the chamber actuators and sensor parame- causal parents (I˜ 1 R,G,B) is most stable across all en-
∼
ters,wecaninducedistributionshiftsinacontrolledman- viroments, whereas models that include additional (non-
ner. This enables us not only to test the performance of causal)variablesachieveabetterMAEinthetrainingdis-
prediction and inference algorithms on data sets with a tribution but perform worse in environments where these
distributionthatdiffersfromthetrainingdistribution,but variables directly or indirectly receive an intervention.
also to investigate under which assumptions on the shifts
suchmethodsperformwell[27,28,29]. Asanillustration, Change point detection (Fig. 5c) Change point de-
we set up three simple tasks with different data modali- tection aims to identify abrupt changes or transitions in
ties, as shown in Fig. 5b. The first consists of predicting time-series data or its underlying data-generating process
thelight-intensityreadingI˜ fromtheothernumericvari- [32]. By manipulating actuators and sensor parameters,
1
ables of the light tunnel. We fit a simple linear regression wecaninducechangesinthemeasurementsoftheaffected
with an increasing number of predictors and evaluate its sensors,providingrealdatasetswithaknowngroundtruth
5a b c d
Relative polarizer angle
e
Time index Reference Higher gain ( ) Larger aperture ( ) Faster shutter ( ) Crossed polarizers ( )
Figure 4: Examples of data produced by the chambers. (a) Numeric time-series data produced by the wind
tunnel under an impulse on the intake fan load (L , red), affecting other variables in the system. (b,c) numerical
in
data from the light tunnel illustrating the effect of LED brightness (L ,L ) and polarizer angles (θ ,θ ) on the
11 12 1 2
light-intensity readings (I˜,I˜,I˜). (d) Effect of the light source setting (R,G,B) on the light intensity reading of the
1 2 3
first sensor (I˜) and drawn current (C˜). (e) Examples of images from the light tunnel for a fixed light source setting
1
(reference) and interventions on other variables that affect the resulting image.
intermsofchangepoints. Tovalidateofflinechangepoint complexityofthemixingtransformation,whichisapprox-
detectionalgorithms[32,33],wegeneratetime-seriesdata imatelylinearforthefirsttask(seeFig.4d)andnon-linear
with smooth and abrupt changes of increasing difficulty. for the other two. As a first baseline, we apply FastICA
We evaluate the non-parametric change-point detection [38], which assumes a linear mixing function. Indeed, the
algorithm changeforest [34], displaying the results in methodsucceedsinestimatingtheactuatorinputsforthe
Fig. 5c. As expected, the method correctly recovers all first task, but struggles with the other two.
change points in the deterministic time-series of the actu-
ator input L . For the affected sensors, the method suc-
in
cessfullydetectsabruptchangesinthesignaloritsregime,
Symbolic regression (Fig. 6e) Symbolic regression
but fails to detect more subtle changes (see C˜ or M˜ in
in [12, 39] aims to discover mathematical equations or ex-
Fig. 5c).
pressions that best describe the underlying relationships
in data, enabling interpretable and compact model repre-
Independent component analysis (Fig. 6d) Inde- sentations. Acommonmotivationistheautomaticdiscov-
pendent component analysis (ICA) is a family of tech- ery of natural laws from data [4]. Because simple natural
niques that treat data as a mixture of latent components laws well describe some of the relationships in the cham-
and aim to discover a demixing transformation that can bers, it is possible to provide symbolic regression tasks
accurately recover them [35, 36]. The linear variants of from real data, and evaluate the performance of such al-
ICA[37,38]arewellestablished,andrecentdevelopments gorithms. As an example, we set up two tasks: recov-
innonlinearICAhavecastitasaframeworkthatholdspo- ering Bernoulli’s principle, which relates the barometric
tentialforeffectivelytacklingthechallengeofdisentangle- measurements of the upwind and downwind barometers
ment in complex data [35, 6]. We propose tasks that con- (P˜ ,P˜ ), and Malus’ law, which describes the effect of
up dw
sist of recovering (up to indeterminacies such as scaling) thelinearpolarizers(θ ,θ )onthelight-intensityreadings
1 2
the values of independently set actuators from the mea- of the third sensor (I˜,V˜ ). More details can be found in
3 3
surements of the sensors they affect. As a starting point, App. IV.1.3andIV.2.1,respectively. Bernoulli’sprinciple
we set up three tasks, shown in Fig. 6d: recovering the providesataskwithasimpleground-truthfunctionbuta
light-sourcesetting(R,G,B)fromthelight-intensitymea- lowsignal-to-noiseratio,whileMalus’lawprovidesamore
surements (I˜,I˜,I˜, V˜ ,V˜ ,V˜ ); recovering the fan loads complexfunctionwithweakernoise,representingtwocom-
1 2 3 1 2 3
(L ,L ) and hatch position (H) from the barometric mon challenges for symbolic regression algorithms. We
in out
readings (P˜ ,P˜ ,P˜ ,P˜ ), and recovering the config- apply the method described in [40] and show the results
dw up amb int
uration of the light source and polarizers (R,G,B,θ ,θ ) in Fig. 6e. Without fine-tuning its hyperparameters, the
1 2
fromtheimagedataofthelighttunnel. Thetasksdisplay methodrecoversbothlawsinatleastoneoffiverunswith
increasing difficulty in terms of dimensionality and the different random initializations.
6Physics-informed machine learning (Fig. 6f) to suggestions of additional experiments that may prove
Physics-informed machine learning integrates physical interesting—pleasereachouttothecorrespondingauthor.
laws or domain-specific knowledge into machine learning We provide, also at causalchamber.org, the resources
modelstoenhancetheiraccuracyandgeneralizability[41]. to allow other researchers to build their own chambers.
Tovalidatesuchapproaches,inApp.IVweprovidemech- We believe this to be a key contribution of our work, as
anistic models of several processes in the chambers, de- having direct access to the chambers may be crucial for
rived from first principles. For each process, we consider some validation tasks. To begin with, the datasets we
models of increasing complexity, allowing us to simulate currently provide amount only to a small fraction of all
sensormeasurementswithvaryingdegreesoffidelity. This possible experiments, and are unlikely to cover many in-
provides a testbed for simulation-based inference [42] and teresting applications of the chambers. For perspective,
approaches that exploit potentially misspecified models consider that the total number of distinct configurations
for inference or generation [43, 44, 45]. As an illustra- ofactuatorsandsensorparametersexceeds7 1015 forthe
×
tion, in Fig. 6f we compare measurements gathered from windtunneland7 1041 forthelighttunnel. Forthisrea-
×
the chambers with the output of some of these models. son, having access to the chambers appears necessary to
In particular, we show the models describing the image validate active learning, reinforcement learning, and con-
capture process of the light tunnel, and the effects of fan trol algorithms, since schemes such as a look-up table can
loads (L ,L ) and hatch position (H) on other wind quickly become unfeasible. Furthermore, the value of any
in out
tunnel variables (P˜ ,ω˜ ,ω˜ ). Their description, to- benchmark based on a few static datasets will decrease
dw in out
gether with additional models and their outputs, can be withitsrepeateduse,duetoover-fittingandothereffects.
foundinApp.IV. Tofacilitatebuildingadditionalmodels
and simulators, we provide in App. VI the datasheets for
6 Data availability
every chamber component, detailing its technical specifi-
cations and physical properties.
Alldatasetscanbedownloadedfromcausalchamber.org.
We also provide a Python API to directly download and
import them into your code, through the Python package
5 Discussion
causalchamber. The package can be installed via pip,
e.g., by running
We have constructed two devices to collect real-world
datasetsfromwell-understoodbutnon-trivialphysicalsys- >>> pip install causalchamber
tems, with the aim of providing a testbed beyond simu-
lateddataforavarietyofempiricalinferencealgorithmsin in an appropriate shell. Datasets can then be accessed
thebroadfieldofAI.Toillustratetheiruse,wehavegath- directly from Python code. For example, to access the
ered an initial collection of datasets and employed them data from Malus’ law in the symbolic regression task of
in case studies exemplifying several validation tasks. We Fig. 6e:
believe many other possibilities exist. For example, the
from causalchamber.datasets import Dataset
fact that a computer controls the chambers makes it pos-
sibletovalidateavarietyofactivelearning,reinforcement
# Download the dataset
learning, and control algorithms.
# and store it in the current directory
Well-understood systems allow us to provide suitable
dataset = Dataset(name='lt_malus_v1', root='./')
ground truths for different tasks without relying on com-
putersimulationsandtheirsimplifyingassumptions. Fun-
# Load the observations
damentally though, well-understood mechanisms repre-
experiment = dataset.get_experiment('white_255')
sent only a small spectrum of complex, real systems. The
df = experiment.as_pandas_dataframe()
success of an algorithm on the chambers may not neces-
sarily transfer to more complex systems. For example, Further examples can be found at causalchamber.org,
a causal discovery algorithm that excels in the chambers together with a list of all currently available datasets.
may fail to recover the signaling network of a cell from
protein expression data.
7 Code availability
Our aim is that the chambers become a sanity check
for algorithms designed to work in a variety of situations.
The code to reproduce the case studies and figures
Failuresinthesetestbedscanindicatepotentialshortcom-
can be found in the paper repository at github.com/
ings in applications to more complex systems. This will
juangamella/causal-chamber-paper. The repository
allow researchers to test and refine algorithms and meth-
also contains the blueprints, component lists and control
ods, and consider fundamental assumptions.
code for the chambers.
We make all datasets collected from the chambers pub-
licly available, including those used in the case studies of
Sec. 4. Researchers can access them at causalchamber.
org and through the Python package causalchamber, for
which we provide an example in Sec. 6. We will con-
tinue to expand this dataset repository, and we are open
7a Causal Discovery b Out-of-distribution generalization
Task a1 From observational data Task a2 From interventional data
Task b1 Sensor measurements Training
X distribution
Y :
Models
size =
GES estimate UT-IGSP estimate color =
precision.60 .55 precision0.56
recall.62 .56 recall0.69
Training set mean
Task a3 From time series data Task b2 Images Training
distribution
PCMCI+ estimate X Y Brighter
precision.40 .33 Crossed colors
recall.25 .21 121 polarizers
4
18
Higher
69 gain
111
25
15 Faster
58 shutter Models
125 Smaller CNN +/- 1 std.
aperture Training set mean
contemporaneouseffects lagged effects
Task b3 Impulse-response curves Training Models
distribution MLP +/- 1 std.
c Change point detection Actuator Changeforest Training set mean
change point estimate
Different barometer Lower exhaust load
Higher barometer Higher
precision exhaust load
X Y
Lower barometer precision
Time index
Figure 5: Validating algorithms using the chambers (1/2). (a) Causal discovery from light-tunnel and wind-
tunneldata. Thetasksconsistofrecoveringthecausalgraphfromobservationaldataandinterventionaldatafromthe
light tunnel (tasks a1 and a2), and from time-series data from the wind tunnel (task a3). We run a suitable method
for each task (GES [16], UT-IGSP with hyperparameter tuning [25], and PCMCI+ [26], respectively), and evaluate
their performance in the recovery of the causal structure of the corresponding ground truth (see Sec. 3.1). GES and
PCMCI+ return a set of 12 and 2 plausible graphs, respectively, encoded by a graph with undirected edges [see e.g.,
16, section 2.4.]. For these methods, we show the precision and recall in the recovery of the directed ground-truth
edges (c.f. equation 1, App. I) for the best- (bold) and worst-scoring graph in each set. (b) Evaluating the out-of-
distribution performance of regression methods. For each task, we try to predict a sensor measurement or actuator
value (Y) from predictors (X) such as numeric measurements (task b1), images (task b2), or impulse-response curves
(task b3). We evaluate the predictive performance of each method in terms of its mean absolute error (MAE) on a
separate validation set from the training distribution and shifted distributions arising from manipulating the chamber
variables. We display the MAE with spider charts, where each axis corresponds to a different setting. As a baseline,
we show the MAE incurred when using the average of Y in the training set as prediction (black, dashed). For tasks
b2 and b3, the MAE is averaged over 16 random initializations of the model, with error bands corresponding to 1
±
standard deviation. (c) Detecting change points in the time series of different sensor measurements. We change the
intakefanload(L )atrandomtimepointswhilekeepingallotheractuatorsandsensorparametersconstant. Because
in
theloadaffectsallthedisplayedsensors,wetakethesetimepointsasgroundtruth(verticaldottedlines)andcompare
them with the output of the change point detection algorithm (black crosses).
8d Independent component analysis
Task d1Recover light-source color from Task d2 Recover actuators from presssure readings Task d3 Recover light-source color and polarizer
light-intensity readings angles from images
Independent Independent Independent
components components components
Mixed Mixed Mixed
signals signals signals
Algorithm Algorithm Algorithm
output output output
FastICA FastICA FastICA
e Symbolic regression f Mechanistic models & simulators
Ground Truth: Bernoulli's principle Wind Tunnel Dynamics
Model input
actuators
Estimates (5 random seeds)
Model output
sensor
readings
Measurement
Model A1+C2
Model A1+C3
Model A2+C3
Ground Truth: Malus' law
Image Capture
Model input actuators Model output simulated images
Estimates (5 random seeds)
72 0
165 0
106
234 0
175 0
65
128 90
0 0
128
True image Model F1Model F2 Model F3
Figure 6: Validating algorithms using the chambers (2/2). (d) Applying independent component analysis to
disentangle the actuator inputs from sensor readings (tasks d1 and d2) and image data (task d3). For each task,
we show the actuator values (top), the resulting images and measurements (center), and the sources recovered by
the FastICA algorithm [38] (bottom). For each actuator, we show the recovered source with the highest Pearson
correlation coefficient. (e) Applying symbolic regression to recover (top) Bernoulli’s principle from the difference in
pressure at the up- and downwind barometers, and (bottom) Malus’ law from light-intensity measurements. We show
the output of the method described in [40] for five runs with different random initializations. The colors correspond
(top) to the residual of the observation w.r.t. the red line and (bottom) to the value of θ . (f) Mechanistic models
2
of the chambers to simulate sensor measurements from actuator inputs with varying degrees of fidelity. For a given
set of inputs, we show the outputs of models describing the fan speeds and air pressure in the wind tunnel (top), and
the image generation process of the light tunnel (bottom). We compare the model outputs against the images and
measurements collected from the chambers (black lines). Higher model numbers imply more complex models with
increased fidelity. The models are defined in App. IV.
9Acknowledgements
We would like to thank Manuel Cherep, Christopher
Fuchs, Konstantin G¨obler, Christina Heinze-Deml, J¨orn
Jakobsen, Niklas Pfister, Antoine Wehenkel and Tobias
Windisch for their valuable discussions and comments on
the manuscript. We would also like to thank Niklas Stolz
for his help with the design of the polarizer frames of the
light tunnel, and Claudio Linares and Helena B¨orjesson
for their help with the diagrams and photographs of the
chambers. J.L. Gamella and P. Bu¨hlmann have received
fundingfromtheEuropeanResearchCouncil(ERC)under
the European Union’s Horizon 2020 research and innova-
tion program (grant agreement No. 786461).
10References
[1] Peter Spirtes, Clark N. Glymour, Richard Scheines, and David Heckerman. Causation, Prediction, and Search.
MIT Press, 2000.
[2] Judea Pearl. Causality. Cambridge University Press, 2009.
[3] JonasPeters,DominikJanzing,andBernhardSch¨olkopf.Elements of Causal Inference: Foundations and Learn-
ing Algorithms. MIT Press, 2017.
[4] Michael Schmidt and Hod Lipson. “Distilling Free-Form Natural Laws from Experimental Data”. In: Science
324.5923 (2009), pp. 81–85.
[5] William La Cava, Patryk Orzechowski, Bogdan Burlacu, Fabricio Olivetti de Franca, Marco Virgolin, Ying Jin,
Michael Kommenda, and Jason H. Moore. “Contemporary Symbolic Regression Methods and their Relative
Performance”. In: 35th Conference on Neural Information Processing Systems Datasets and Benchmarks Track
(Round 1). 2021.
[6] FrancescoLocatello,StefanBauer,MarioLucic,SylvainGelly,BernhardSch¨olkopf,andOlivierBachem.“Chal-
lenging Common Assumptions in the Unsupervised Learning of Disentangled Representations”. In: Proceedings
of the 36th International Conference on Machine Learning. 2019, pp. 4114–4124.
[7] Bernhard Sch¨olkopf, Francesco Locatello, Stefan Bauer, Nan R. Ke, Nal Kalchbrenner, Anirudh Goyal, and
YoshuaBengio.“Towardcausalrepresentationlearning”.In:Proceedings of the IEEE 109.5(2021),pp.612–634.
[8] Pang W. Koh, Shiori Sagawa, Henrik Marklund, Sang Michael Xie, Marvin Zhang, Akshay Balsubramani,
Weihua Hu, Michihiro Yasunaga, Richard L. Phillips, Irena Gao, Tony Lee, Etienne David, Ian Stavness, Wei
Guo, Berton Earnshaw, Imran Haque, Sara M. Beery, Jure Leskovec, Anshul Kundaje, Emma Pierson, Sergey
Levine, Chelsea Finn, and Percy Liang. “Wilds: A benchmark of in-the-wild distribution shifts”. In: Proceedings
of the 38th International Conference on Machine Learning. 2021, pp. 5637–5664.
[9] Juan L. Gamella and Christina Heinze-Deml. “Active invariant causal prediction: experiment selection through
stability”. In: Advances in Neural Information Processing Systems 33 (2020), pp. 15464–15475.
[10] Konstantin G¨obler, Tobias Windisch, Mathias Drton, Tim Pychynski, Martin Roth, and Steffen Sonntag.
“causalAssembly:GeneratingRealisticProductionDataforBenchmarkingCausalDiscovery”.In:CausalLearn-
ing and Reasoning. PMLR. 2024, pp. 609–642.
[11] Yuxiao Cheng, Ziqian Wang, Tingxiong Xiao, Qin Zhong, Jinli Suo, and Kunlun He. “CausalTime: Realistically
Generated Time-series for Benchmarking of Causal Discovery”. In: The Twelfth International Conference on
Learning Representations. 2023.
[12] Silviu-Marian Udrescu and Max Tegmark. “AI Feynman: A physics-inspired method for symbolic regression”.
In: Science Advances 6.16 (2020), eaay2631.
[13] AlexGreenfield,AvivMadar,HarryOstrer,andRichardBonneau.“DREAM4:Combininggeneticanddynamic
information to identify biological networks and dynamical models”. In: PloS one 5.10 (2010), e13397.
[14] Steffen L. Lauritzen. “Causal inference from graphical models”. In: Monographs on Statistics and Applied Prob-
ability 87 (2001), pp. 63–108.
[15] Judea Pearl. “Causal inference in statistics: An overview”. In: Statistics Surveys 3 (2009), pp. 96–146.
[16] David M. Chickering. “Optimal structure identification with greedy search”. In: Journal of Machine Learning
Research 3 (2002), pp. 507–554.
[17] Clark Glymour, Kun Zhang, and Peter Spirtes. “Review of Causal Discovery Methods Based on Graphical
Models”. In: Frontiers in Genetics 10 (2019).
[18] ChristinaHeinze-Deml,MarloesH.Maathuis,andNicolaiMeinshausen.“Causalstructurelearning”.In:Annual
Review of Statistics and Its Application 5 (2018), pp. 371–391.
[19] Jakob Runge. “Causal network reconstruction from time series: From theoretical assumptions to practical esti-
mation”. In: Chaos: An Interdisciplinary Journal of Nonlinear Science 28.7 (2018).
[20] Stephan Bongers, Patrick Forr´e, Jonas Peters, and Joris M. Mooij. “Foundations of structural causal models
with cycles and latent variables”. In: The Annals of Statistics 49.5 (2021).
[21] Tom Claassen and Joris M. Mooij. “Establishing Markov equivalence in cyclic directed graphs”. In: Proceedings
of the 39th Conference on Uncertainty in Artificial Intelligence. 2023, pp. 433–442.
[22] Shohei Shimizu, Patrik O. Hoyer, Aapo Hyv¨arinen, and Antti Kerminen. “A linear non-Gaussian acyclic model
for causal discovery”. In: Journal of Machine Learning Research 7 (2006), pp. 2003–2030.
[23] PeterSpirtes, Christopher Meek,andThomasRichardson. “Analgorithmforcausalinferenceinthepresenceof
latent variables and selection bias”. In: Computation, Causation, and Discovery 21 (1999), pp. 211–252.
11[24] David M. Chickering. “A Transformational Characterization of Equivalent Bayesian Network Structures”. In:
Proceedings of the 11th Conference on Uncertainty in Artificial Intelligence. Montr´eal, Qu´e, Canada, 1995,
pp. 87–98.
[25] ChandlerSquires,YuhaoWang,andCarolineUhler.“Permutation-basedcausalstructurelearningwithunknown
intervention targets”. In: Proceedings of the 36th Conference on Uncertainty in Artificial Intelligence. 2020,
pp. 1039–1048.
[26] Jakob Runge. “Discovering contemporaneous and lagged causal relations in autocorrelated nonlinear time series
datasets”. In: Proceedings of the 36th Conference on Uncertainty in Artificial Intelligence. 2020, pp. 1388–1397.
[27] Vaishnavh Nagarajan, Anders Andreassen, and Behnam Neyshabur. “Understanding the failure modes of out-
of-distributiongeneralization”.In:Proceedings of the 8th International Conference on Learning Representations.
2020.
[28] Robert Geirhos, J¨orn-Henrik Jacobsen, Claudio Michaelis, Richard Zemel, Wieland Brendel, Matthias Bethge,
and Felix A. Wichmann. “Shortcut learning in deep neural networks”. In: Nature Machine Intelligence 2.11
(2020), pp. 665–673.
[29] Dominik Rothenh¨ausler, Nicolai Meinshausen, Peter Bu¨hlmann, and Jonas Peters. “Anchor regression: Hetero-
geneousdatameetcausality”.In:Journal of the Royal Statistical Society Series B (Statistical Methodology) 83.2
(2021), pp. 215–246.
[30] Kunihiko Fukushima. “Neocognitron: A hierarchical neural network capable of visual pattern recognition”. In:
Neural Networks 1.2 (1988), pp. 119–130.
[31] JonasPeters,PeterBu¨hlmann,andNicolaiMeinshausen.“Causalinferencebyusinginvariantprediction:identi-
ficationandconfidenceintervals”.In:Journal of the Royal Statistical Society: Series B (Statistical Methodology)
78.5 (2016), pp. 947–1012.
[32] Charles Truong, Laurent Oudre, and Nicolas Vayatis. “Selective review of offline change point detection meth-
ods”. In: Signal Processing 167 (2020), p. 107299.
[33] Samaneh Aminikhanghahi and Diane J Cook. “A survey of methods for time series change point detection”. In:
Knowledge and information systems 51.2 (2017), pp. 339–367.
[34] MalteLondschien,PeterBu¨hlmann,andSoltKov´acs.“RandomForestsforChangePointDetection”.In:Journal
of Machine Learning Research 24.216 (2023), pp. 1–45.
[35] AapoHyv¨arinen,IlyesKhemakhem,andHiroshiMorioka.“Nonlinearindependentcomponentanalysisforprin-
cipled disentanglement in unsupervised deep learning”. In: Patterns 4.10 (2023).
[36] Aapo Hyv¨arinen, Juha Karhunen, and Erkki Oja. Independent Component Analysis. Wiley Interscience, 2001.
[37] Aapo Hyv¨arinen and Erkki Oja. “Independent component analysis: algorithms and applications”. In: Neural
networks 13.4-5 (2000), pp. 411–430.
[38] AapoHyvarinen.“Fastandrobustfixed-pointalgorithmsforindependentcomponentanalysis”.In:IEEETrans-
actions on Neural Networks 10.3 (1999), pp. 626–634.
[39] Miles Cranmer, Alvaro Sanchez Gonzalez, Peter Battaglia, Rui Xu, Kyle Cranmer, David Spergel, and Shirley
Ho.“Discoveringsymbolicmodelsfromdeeplearningwithinductivebiases”.In:AdvancesinNeuralInformation
Processing Systems 33 (2020), pp. 17429–17442.
[40] Pierre-AlexandreKamienny,St´ephaned’Ascoli,GuillaumeLample,andFran¸coisCharton.“End-to-endsymbolic
regression with transformers”. In: Advances in Neural Information Processing Systems 35 (2022), pp. 10269–
10281.
[41] George E. Karniadakis, Ioannis G. Kevrekidis, Lu Lu, Paris Perdikaris, Sifan Wang, and Liu Yang. “Physics-
informed machine learning”. In: Nature Reviews Physics 3.6 (2021), pp. 422–440.
[42] KyleCranmer,JohannBrehmer,andGillesLouppe.“Thefrontierofsimulation-basedinference”.In:Proceedings
of the National Academy of Sciences 117.48 (2020), pp. 30055–30062.
[43] Naoya Takeishi and Alexandros Kalousis. “Physics-integrated variational autoencoders for robust and inter-
pretable generative modeling”. In: Advances in Neural Information Processing Systems 34 (2021), pp. 14809–
14821.
[44] Antoine Wehenkel, Jens Behrmann, Hsiang Hsu, Guillermo Sapiro, Gilles Louppe, and Joern-Henrik Jacobsen.
“Robust Hybrid Learning With Expert Augmentation”. In: Transaction on Machine Learning Research. 2023.
[45] Yuan Yin, Vincent Le Guen, J´er´emie Dona, Emmanuel de B´ezenac, Ibrahim Ayed, Nicolas Thome, and Patrick
Gallinari. “Augmenting physical models with deep networks for complex dynamics forecasting”. In: Journal of
Statistical Mechanics: Theory and Experiment 2021.12 (2021), p. 124012.
12[46] Y.Lecun,L.Bottou,Y.Bengio,andP.Haffner.“Gradient-basedlearningappliedtodocumentrecognition”.In:
Proceedings of the IEEE 86.11 (1998), pp. 2278–2324.
[47] Yasuki Nakayama. Introduction to fluid mechanics. Butterworth-Heinemann, 2018.
[48] Philip Leckner. “Ludwig’s Applied Process Design for Chemical and Petrochemical Plants Volume 1, By A.
Kayode Coker”. In: Chemical Engineering 115.7 (2008), pp. 8–9.
[49] JohannTang.Fan Basics: Air Flow, Static Pressure, and Impedance.https://blog.orientalmotor.com/fan-
basics-air-flow-static-pressure-impedance. Accessed: 2024-01-28.
[50] Edward Collett. Field guide to polarization. International society for optics and photonics, 2005.
[51] Jose Lages, Remo Giust, and Jean-Marie Vigoureux. “Composition law for polarizers”. In: Physical Review A
78.3 (2008), p. 033810.
[52] Nickolay Smirnov. “Table for estimating the goodness of fit of empirical distributions”. In: The Annals of
Mathematical Statistics 19.2 (1948), pp. 279–281.
[53] Henry B Mann and Donald R Whitney. “On a test of whether one of two random variables is stochastically
larger than the other”. In: The Annals of Mathematical Statistics (1947), pp. 50–60.
13Appendix I
Methods
In this appendix, we provide a brief description of the experimental setup for each case study in Sec. 4, together with
a link to the corresponding datasets at causalchamber.org, and to the corresponding code in the paper repository
at github.com/juangamella/causal-chamber-paper.
Case Study: Causal Discovery
Allthemethodsweevaluateinthiscasestudyreturnadirectedacyclicgraph(DAG)(orasetofthem)asanestimate.
Given a single DAG estimate Gˆ := (V,Eˆ) and a ground-truth graph G⋆ := (V,E⋆), we compute the precision P and
recall R in terms of directed edge recovery as
Eˆ E⋆ Eˆ E⋆
P := ∩ and R:= ∩ , (1)
Eˆ E⋆
| | | |
where Eˆ and E⋆ are the sets of directed edges in Gˆ and G⋆, respectively. If a method outputs several DAGs, we
compute P and R for each element in this set.
Task a1: Observational Data
Dataset lt_interventions_standard_v1
Code case_studies/causal_discovery_iid.ipynb
AsinputforGES,wetake10000observationsfromasubsetofthevariables(seeFig.5)intheuniform_reference
experiment of the lt_interventions_standard_v1 dataset. As score for the algorithm, we use the BIC score with a
Gaussian likelihood. GES returns the Markov equivalence class of the estimated data-generating graph, and for each
graph we compute the corresponding precision and recall in the recovery of the edges in the ground-truth graph.
Task a2: Interventional Data
Dataset lt_interventions_standard_v1
Code case_studies/causal_discovery_iid.ipynb
We consider the same subset of variables as for task a1, taking data from several experiments in the lt_
interventions_standard_v1 dataset as input for UT-IGSP [25]. As “observational data”, we take the 10000 ob-
servations from the uniform_reference experiment; as “interventional data” we take 1000 observations from each
experiment where the considered variables receive an intervention—see the accompanying code for the experiment
names. For the conditional independence and invariance tests, we use the default Gaussian tests implemented in the
Python package of UT-IGSP, and run the algorithm at different significance levels (α,β) [10−4,10−2]2. We show
∈
the result for α=0.008,β =0.009, which performs best in terms of both precision and recall (1).
Task a3: Time-series Data
Dataset wt_walks_v1
Code case_studies/causal_discovery_time_series.ipynb
As input to PCMCI+ [26], we take 10000 observations from a subset of the variables in the actuators_random_
walk_1experimentofthewt_walks_v1dataset. Werunthemethodwithpartialcorrelationtestsatsignificancelevel
α=1e 2 and a maximum of 10 lags. From the resulting estimate, we drop edges from a variable to itself and edges
−
forwhichorientationconflictsarise. Wecomputetheprecisionandrecall(1)foreachofthetwographsintheresulting
equivalence class.
Case Study: Out-of-distribution generalization
Task b1: Regression from sensor measurements
Dataset lt_interventions_standard_v1
Code case_studies/ood_sensors.ipynb
14We use the data from several experiments in the lt_interventions_standard_v1 dataset. We begin by splitting
the observations from the uniform_reference experiment into a training set (100 observations) and a validation set
(1000 observations, shown with in the spider plot of Fig. 5b1). As additional validation sets (1000 observations
∅
each), we select experiments where the variables R,G,B,TV,TV,TV,TI and θ receive an intervention—see the
1 2 3 2 1
accompanying code for the experiment names. These validation sets correspond to the additional axes in the spider
plot of Fig. 5b1. On the training set, we fit linear models with intercept using ordinary least squares, with response
I˜ and different sets of predictors: R , R,G , R,G,B , R,G,B,V˜ and I˜,I˜,V˜ ,V˜ ,V˜ . As a baseline, we
1 1 2 3 1 2 3
considerthemodelthatpredicts
the{ ave} ra{
ge
ofI}˜ { inthetr} ain{
ingset.
For} eachr{
esulting model,
w}
ecompute themean
1
absolute error on each of the validation sets. The additional scatter plot in Fig. 5b1 corresponds to the pooled data
across all validation sets.
Task b2: Regression from images
Dataset lt_color_regression_v1
Code case_studies/ood_images.ipynb
We use the images from the lt_color_regression_v1 datasets, at a size of 100 100 pixels. We split the data
×
from the reference experiment into a training and validation set (9000 and 500 observations, respectively). As
additionalvalidationsets,wetakethosearisingfromshiftsinthedistributionoftheresponseR,G,B (bright_colors
experiment) and from interventions on the parameters of the camera—see the accompanying code for the experiment
names. We subsample each of the additional validation sets to a size of 500 observations. As a regression model, we
employasmallLeNet-likeconvolutionalneuralnetwork[46]—seethecodeformoredetails. Asalossfunction, weuse
the mean-squared error in predicting the light-source settings R,G,B, which we minimize using stochastic gradient
descent. We fit the model a total of 16 times, each with a different random initialization of the network weights. For
each resulting model, we compute the mean absolute error on each validation set, and plot the results in Fig. 5b2. As
baseline, we consider the model that predicts the average of R,G,B in the training set.
Task b3: Regression from impulse-response curves
Dataset wt_intake_impulse_v1
Code case_studies/ood_impulses.ipynb
Weusethedatafromseveralexperimentsinthewt_intake_impulse_v1dataset,correspondingtodifferentsettings
of the exhaust load L and oversampling rates O of the downwind barometer—see the accompanying code for
out dw
the experiment names. We split the data from the load_out_0.5_osr_downwind_4 experiment into a training and
validation set (4000 and 900 observations, respectively). As a regression model, we employ a multi-layer perceptron
with an input layer of size 50 (the impulse length), an output layer of size 1, and two additional hidden layers with
200 neurons and ReLu activations. As a loss function, we use the mean-squared error in predicting the hatch position
H, and train the model using stochastic gradient descent. We fit the model a total of 16 times, each with a different
random initialization of the network weights. For each resulting model, we compute the mean absolute error on
validation sets from the training distribution and the additional experiments. Each corresponds to the different axes
in the spider plot of Fig. 5b3. As baseline, we consider the model that predicts the average of H in the training set.
Case Study: Change point detection
Dataset wt_changepoints_v1
Code case_studies/changepoints.ipynb
Wetakethedatafromtheload_in_seed_9experimentinthewt_changepoints_v1dataset,andapplythechange-
forest algorithm [34] to each of the time-series L , ω˜ , P˜ P˜ , C˜ , and M˜. For the algorithm, we use the
in in dw amb in
−
“random forest” method and default hyperparameters—see the accompanying code for details. As ground truth for
the changepoints (vertical gray lines in Fig. 5c), we take the time points where L is set to a new level. In all
in
datasets collected from the chambers, the column intervention takes a value of 1 for the first measurement after an
intervention on any of the chamber variables.
15Case Study: Independent Component Analysis
Task d1: Recovering light-source color
Dataset lt_walks_v1
Code case_studies/ica.ipynb
We use the color_mix experiment from the lt_walks_v1 dataset. As input to the FastICA algorithm [38] we take
the light-intensity measurements I˜,I˜,I˜, V˜ ,V˜ and V˜ , to which we first apply a whitening transformation. We run
1 2 3 1 2 3
the algorithm with 6 components (sources). For each ground-truth source (R,G,B), we show the recovered signal
with the highest Pearson correlation coefficient (in absolute value).
Task d2: Recovering fan loads and hatch position
Dataset wt_walks_v1
Code case_studies/ica.ipynb
We use the loads_hatch_mix_slow experiment from the wt_walks_v1 dataset. As input to the FastICA algorithm
[38] we take the barometric pressure measurements P˜ ,P˜ ,P˜ and P˜ , to which we first apply a whitening
dw up amb int
transformation. We run the algorithm with 4 components (sources). For each ground-truth source (L ,L ,H), we
in out
show the recovered signal with the highest Pearson correlation coefficient (in absolute value).
Task d3: Recovering actuators from images
Dataset lt_camera_walks_v1
Code case_studies/ica.ipynb
As input to the FastICA algorithm [38], we use the images from the actuator_mix experiment in the lt_camera_
walks_v1 dataset, at a size of 50 50 pixels. We first flatten the images, so that each pixel becomes an input
×
variable, applying a whitening transformation as an additional pre-processing step. We run the algorithm with 5
components (sources). For each ground-truth source (R,G,B,θ ,θ ), we show the recovered signal with the highest
1 2
Pearson correlation coefficient (in absolute value).
Case Study: Symbolic Regression
Datasets wt_bernoulli_v1,lt_malus_v1
Code case_studies/symbolic_regression.ipynb
We use a pre-trained version of the model described in [40]—see the code for more details. For both tasks, we
employ the same hyperparameters as in the demonstration provided by the authors2 and run the algorithm with 5
different random initializations. As input for the first task, we randomly sample 1000 observations from the random_
loads_intake experiment in the wt_bernoulli_v1 dataset; for the second task we use the 1000 observations from
the white_255 experiment in the lt_malus_v1 dataset. We show the estimated expressions in Fig. 6d, rounding the
constants to one decimal place.
Case Study: Mechanistic Models
Datasets wt_test_v1, lt_camera_test_v1
Code case_studies/mechanistic_models.ipynb
We compare the output of some of the models defined in App. IV to actual measurements collected from the
chamber. For the wind-tunnel models, we use the steps experiment from the wt_test_v1, setting their parameters
to the values suggested in App. IV.1. For the models of the image-capture process of the light tunnel, we take the
images from the palette experiment in the lt_camera_test_v1 dataset and use the parameters suggested in App.
IV.2.2. AllmodelsareimplementedinthecausalchamberPythonpackage—seetheaccompanyingcodeforexamples.
2Seethedemonstrationathttps://github.com/facebookresearch/symbolicregression/blob/main/Example.ipynb
16Appendix II
Chamber Variables
This appendix documents the variables in each chamber, i.e., the actuators, sensor parameters, and sensor measure-
ments. A description of the physical effects between them can be found in App. III.
Wind Tunnel
Variables Value range Type Component Description
L ,L [0,1] A fan Theloadofthefans,correspondingtothedutycycleofthe
in out
pulse-width-modulation (PWM) signal that controls their
(32-bit float)
speed. See the related datasheet in App. VI for more de-
tails.
C˜ ,C˜ [0,1023] S current sensor The uncalibrated measurements of the electric current
in out
drawn by the fans. The calibrated measurements (in am-
(32-bit float)
peres) are given by
vref(R ) vref(R )
C˜ in 2.5 and C˜ out 2.5,
in out
× 1023 5 × × 1023 5 ×
× ×
wherevref(R ),vref(R )arethereferencevoltagesofthe
in out
corresponding sensors (see Table 3).
ω˜ ,ω˜ 0 (32-bit float) S fan The speed of the fans in revolutions per minute.
in out
≥
T ,T 0,1 P fan The resolution of the tachometer timer that measures the
in out
{ }
elapsed time between successive revolutions of the fan,
where1correspondstomicrosecondsand0tomilliseconds.
Choosingmicrosecondsyieldsahigherresolutioninthefan-
speed measurement.
P˜ ,P˜ 0 S barometer The barometric pressure, in pascals, as measured by the
up dw
P˜ ,P˜ ≥ (32-bit float) different barometers of the chamber. P˜ int corresponds to
amb int the barometer placed at the tunnel intake. P˜ is the
amb
ambient pressure measured by the outer barometer. P˜
up
and P˜ correspond to the barometers inside the tunnel,
dw
which are placed facing into (P˜ ) and away (P˜ ) from
up dw
the airflow. Even at the same height and under the same
conditions, the readings of the barometers have an offset
resulting from the manufacturing process.
A ,A 0:255 A potentiometer The wiper position of the digital potentiometers in the
1 2
speaker amplification circuit (Fig. 2c).
S˜ ,S˜ [0,1023] S arduino The amplitude of the signal after the first potentiometer
1 2
(S˜ )andafterthesecondpotentiometer(S˜ )inthespeaker
(32-bit float) 1 2
amplification circuit (Fig. 2c). The calibrated amplitudes,
in volts, are given by
vref(R ) vref(R )
S˜ 1 and S˜ 2 ,
1 2
× 1023 × 1023
where vref(R ),vref(R ) are the reference voltages of the
1 2
corresponding sensors (see Table 3).
H 0:45:0.1 A motor Theposition,indegrees,ofthemotorcontrollingthehatch
that covers an additional opening of the wind tunnel. The
position can be set in increments of 0.1◦ degrees, with the
hatch being closed at 0◦ and fully open at 45◦.
Table1: Descriptionofthewindtunnelvariables,includingtheirsymbol,valuerange,type,andtherelatedcomponent
for the datasheets in App. VI. Variables are categorized into different types: actuators (A) or sensor parameters (P),
which can be directly manipulated, and sensor measurements (S), which cannot be directly manipulated. For the
17
value range, n:m corresponds to the range n,n+1,...,m and n:m:k to n,n+k,n+2k,...,m .
{ } { }Variables Value range Type Component Description
M˜ [0,1023] S microphone The uncalibrated measurement of the sound level captured
by the microphone. The calibrated signal amplitude, in
(32-bit float)
volts, is given by
vref(R )
M˜ M ,
× 1023
where vref(R ) is the reference voltage of the correspond-
M
ing sensor (see Table 3).
R ,R 1.1,2.56,5 P arduino Thereferencevoltages,involts,ofthesensorsusedtomea-
in out
{ } sure the current (C˜ ,C˜ ), amplifier (S˜ ,S˜ ) and micro-
R ,R in out 1 2
1 2 phone signals (M˜), respectively. The values differ slightly
R M from the actual reference voltages seen by the sensors,
which can be found in Table 3.
O ,O 1,2,4,8 P arduino The oversampling rates when taking measurements of the
in out
{ } current (C˜ ,C˜ ), amplifier (S˜ ,S˜ ) and microphone sig-
O ,O ,O in out 1 2
1 2 M nals (M˜), and of air pressure at the different barometers
O up,O dw (P˜ up,P˜ dw,P˜ amb,P˜ int). To avoid affecting the overall mea-
O ,O surement time, the chambers always take the maximum
amb int
number of readings (8) and discard excess readings accord-
ingly.
Table1: Descriptionofthewindtunnelvariables,includingtheirsymbol,valuerange,type,andtherelatedcomponent
for the datasheets in App. VI. Variables are categorized into different types: actuators (A) or sensor parameters (P),
which can be directly manipulated, and sensor measurements (S), which cannot be directly manipulated. For the
value range, n:m corresponds to the range n,n+1,...,m and n:m:k to n,n+k,n+2k,...,m .
{ } { }
Light Tunnel
Variables Value range Type Component Description
R,G,B 0:255 A light source The brightness setting of the red, green, and blue LEDs on
the main light source. Higher values correspond to higher
brightness.
C˜ [0,1023] S current sensor The uncalibrated measurement of the electric current drawn
bythelightsource. Thecalibratedmeasurement(inamperes)
(32-bit float)
is given by
vref(R )
C˜ C 2.5,
× 1023 5 ×
×
where vref(R ) is the reference voltage of the corresponding
C
sensor (see Table 3).
I˜,I˜,I˜ 0:216 1 S light sensor The uncalibrated infrared measurement of the light-intensity
1 2 3
− sensors, placed before (I˜), between (I˜), and after (I˜) the
1 2 3
polarizers, in reference to the light source.
V˜ ,V˜ ,V˜ 0:216 1 S light sensor The uncalibrated visible-light measurement of the light-
1 2 3
− intensity sensors, placed before (V˜ ), between (V˜ ), and after
1 2
(V˜ ) the polarizers, in reference to the light source.
3
DI,DI,DI 0,1,2 P light sensor The photodiodes used by the light sensors to take infrared
1 2 3 { }
measurements,correspondingtothesmall(DI =0),medium
j
(DI =1) and large (DI =2) infrared photodiodes onboard.
j j
Table2: Descriptionofthelighttunnelvariables,includingtheirsymbol,valuerange,type,andtherelatedcomponent
for the datasheets in App. VI. Variables are categorized into different types: actuators (A) or sensor parameters (P),
which can be directly manipulated, and sensor measurements (S), which cannot be directly manipulated. For the
value range, n:m corresponds to the range n,n+1,...,m .
{ }
18Variables Value range Type Component Description
DV,DV,DV 0,1 P light sensor The photodiodes used by the light sensors to take visible-
1 2 3 { }
light measurements, corresponding to the small (DV = 0)
j
and large (DV =1) photodiodes onboard.
j
TI,TI,TI 0,1,2,3 P light sensor The exposure time of the photodiode during a light-intensity
1 2 3 { }
measurement. Higher values correspond to longer exposure
TV,TV,TV
1 2 3 times and increased sensitivity.
L ,L , 0:255 A led ThebrightnessofLEDsplacedbyeachlight-intensitysensor,
11 12
where L ,L correspond to the two LEDs placed by the ith
L ,L , i1 i2
21 22 sensor (I˜,V˜). The value corresponds to the wiper position
i i
L 31,L 32 ofadigitalrheostat,whichcontrolsthecurrentflowingtothe
LED. Higher values correspond to increased brightness.
θ ,θ -180:180:0.1 A motor The setting of the stepper motors that control the angle of
1 2
the polarizer frames, which can be set in increments of 0.1
degrees. Becausethemechanismfunctionswithoutfeedback,
the actual angle of the polarizers may slightly deviate from
this setting due to the imperfect coupling of the mechanical
pieces.
θ˜ ,θ˜ [0,1023] S angle sensor Thepositionofthepolarizersisencodedintoavoltageusinga
1 2
rotary potentiometer, which is then read by the control com-
(32-bit float)
puter to produce the measurements θ˜ and θ˜. Given these
1 2
measurements, the calibrated angle measurement is given as
720 vref(R )
(θ˜ Z ) j degrees,
j j
− × 1023 × 5
where vref(R ) is the reference voltage of the corresponding
j
sensor(seeTable3),andZ =507,Z =512arethereadings
1 2
at angles θ =θ =0 and reference voltages R =R =5.
1 2 1 2
R ,R ,R 1.1,2.56,5 P arduino The reference voltage, in volts, of the sensors used to mea-
C 1 2
{ } surethecurrent(C˜)andpolarizerangles(θ˜ ,θ˜ ),respectively.
1 2
The values differ slightly from the actual reference voltages
used by the sensors, which can be found in Table 3.
O ,O ,O 1,2,4,8 P arduino The oversampling rate of the sensors used to measure the
C 1 2
{ } current (C˜) and polarizer angles (θ˜ ,θ˜ ), respectively. To
1 2
avoid affecting the overall measurement time, the chambers
alwaystakethemaximumnumberofreadings(8)anddiscard
excess readings accordingly.
˜Im 24-bit RGB S camera Thecolorimageproducedbythecamera,withasizeof2000
×
2000 pixels and 8 bits per color channel.
image
Ap cf. Table 4 P camera The f-number describing the aperture of the camera lens,
with higher values corresponding to smaller openings.
ISO cf. Table 4 P camera The gain of the camera sensor, where higher values corre-
spond to higher sensitivity.
T cf. Table 4 P camera The shutter speed of the camera, i.e., how many seconds the
Im
camera sensor is exposed when taking an image.
Table2: Descriptionofthelighttunnelvariables,includingtheirsymbol,valuerange,type,andtherelatedcomponent
for the datasheets in App. VI. Variables are categorized into different types: actuators (A) or sensor parameters (P),
which can be directly manipulated, and sensor measurements (S), which cannot be directly manipulated. For the
value range, n:m corresponds to the range n,n+1,...,m .
{ }
19Wind Tunnel Light Tunnel
R vref(R) vref(R)
1.1 1.16 1.09
2.56 2.65 2.55
5 5 5
Table 3: Calibrated reference voltages for the wind tunnel (R = R ,R ,R ,R ,R ) and the light tunnel (R =
in out 1 2 M
R ,R ,R ,). They are estimated using the analog_calibration experiments in the wt_test_v1 and lt_test_v1
C 1 2
datasets.
Variable Values
Ap 1.8, 2.0, 2.2, 2.5, 2.8, 3.2, 3.5, 4.0, 4.5, 5.0, 5.6, 6.3, 6.4, 7.1, 8.0,
9.0, 10, 11, 13, 14, 16, 18, 20, 22
ISO 100, 125, 160, 200, 250, 320, 400, 500, 640, 800, 1000, 1250, 1600,
2000, 2500, 3200, 4000, 5000, 6400, 8000, 10000, 12800, 16000,
20000, 25600, 32000, 40000, 51200
T 1/200, 1/250, 1/320, 1/400, 1/500, 1/640, 1/800, 1/1000, 1/1250,
Im
1/1600, 1/2000, 1/2500, 1/3200, 1/4000
Table 4: Possible values for the camera parameters controlling the aperture of the lens (Ap), the sensor gain (ISO),
and the shutter speed (T ).
Im
20Appendix III
Description of Physical Effects
We describe the effects that the chamber actuators and sensor parameters have on the measurements of each sensor.
The effects correspond to the edges in the ground-truth graphs of the standard configurations in Fig. 3, where an
edge A B denotes that the actuator or sensor parameter A has an effect on the sensor measurement B. We justify
→
each effect in terms of the chamber design and the underlying physical principles, further characterizing each effect
through additional experiments (Fig. 7 to Fig. 17). As discussed in Sec. 3.1, these effects can be understood as causal
effects—seeApp.Vforanin-depthdiscussionandadditionalvalidationthroughrandomizedexperiments. Throughout
this appendix, we use a short-hand notation for denoting multiple effects e.g., A ,A B ,B refers to the four
1 2 1 2
{ }→{ }
edges A B ,A B ,A B and A B .
1 1 1 2 2 1 2 2
→ → → →
The code to generate the plots in this section can be found in the Jupyter notebook case_studies/plots_
appendices.ipynb in the paper repository github.com/juangamella/causal-chamber-paper.
III.1 Wind Tunnel
1 1 1
1 5 1 0.0 1 5 1 0.0 1 1 0.0
4 ← 0 4 ← 0 ←
← ← ← ← ← ←
Lin H
← Lout
H
←
Lin Lin H
← Lout
H
←
Lin Lin
Lout
Lin
3
5 C˜
in
963.6
2
C˜
out
4
963.4
1
963.2 P˜ up P˜ dw ω˜in ω˜out 3
L in L in L in
L L
out out
H H L
out
0 100 200 300 0 100 200 300 0 100 200 300
Time index t Time index t Time index t
Figure 7: Time-series data from different sensor measurements under varying inputs to the fan loads (L ,L ) and
in out
hatch position (H), shown on the bottom row. (left) The measurements P˜ ,P˜ of the inner barometers are affected
up dw
by both loads and the hatch position. (center) The fan speeds are affected by their corresponding load. Because the
fans are placed in tandem, their speed is also affected by the load of the other fan, with the strength of the effect
dependingonthehatchposition(e.g., t=100). (right)Becausetheysharethesamepowersupply,theloadofonefan
has a slight effect on the current drawn by the other (e.g., t=250). The data and corresponding experiment protocol
can be found under the steps experiment in the wt_test_v1 dataset.
L C˜ ,ω˜ ,L C˜ ,ω˜ The fan loads (L ,L ) define the duty cycle of the control signal sent to
in in in out out out in out
the f→ ans{ , affectin} g their→ sp{ eed (ω˜ ,ω˜} ) and the current they consume (C˜ ,C˜ ). We provide mechanistic models
in out in out
describingtheseeffectsinApp. IV.1.1,comparingtheiroutputstorealmeasurementsinFig.16. Whentheloadisset
to zero, the fan is completely powered off and no longer produces a tachometer signal (no corresponding observation
shown in Fig. 16); the resulting speed measurement corresponds to the last measured speed (see Fig. 11).
L ,L ,H ω˜ ,ω˜ Each fan drives the flow of air through the wind tunnel, in turn making it easier or
in out in out
{ } → { }
harderfortheotherfantorotate. Thus,thespeedsofthefansarecoupled,andthestrengthofthecouplingisaffected
by the hatch position (see Fig. 7, center).
L C˜ ,L C˜ Because they share the same power supply, the load of one fan has a small effect on the
in out out in
→ →
current drawn by the other (see Fig. 7, right).
T ω˜ ,T ω˜ Changing the resolution (T ,T ) of the timers used in the fan tachometers also changes
in in out out in out
→ →
theresolutionoftheresultingspeedmeasurement(ω˜ ,ω˜ ). Usingaresolutionofmicroseconds(e.g., T =1)allows
in out in
21
aPh
301
mpr
×
201
tnerruc
.bilacnU
×3
Timer Resolution O 1 O 8 ∗← ∗←
T in =0 P˜ up
2
T in =1 P˜ dw
1
P˜
amb
P˜
int
L 1 0 20 40 60 80 100 120 0 50 100 150 200
in
Time index t
0
0 20 40 60 80 100 120
Time index t
Figure 8: (left) Measurements of the fan speed ω˜ under a progressive increase in the fan load L for different
in in
resolutionsofthetachometertimer,with(T =0)correspondingtomillisecondsand(T =1)tomicroseconds. (right)
in in
Effect of the barometer oversampling rate (O ,O ,O ,O ) on the resulting measurement (P˜ ,P˜ ,P˜ ,P˜ ).
up dw amb int up dw amb int
For all barometers, the oversampling rate is increased from 1 to 8 at t = 100, while keeping all other chamber
actuators and sensor parameters constant. The data and experimental setup for both plots can be found under the
tach_resolution and osr_barometers experiments in the wt_test_v1 dataset.
measuring smaller changes in the fan speed, with the difference being more noticeable at higher speeds (see Fig. 8,
left).
L ,L ,H P˜ ,P˜ By controlling the speed of the fans, the loads (L ,L ) affect the air pressure inside
in out up dw in out
{ }→{ }
the wind tunnel, and thus the measurements of the two inner barometers (P˜ ,P˜ ). By controlling the size of the
up dw
additional opening to the outside, the hatch position (H) also affects the pressure inside the tunnel (Fig. 7). We
provide mechanistic models describing these effects in App. IV.1.
L ,L ,H P˜ The fan loads and hatch position also affect the airflow and air pressure at the intake of the
in out int
{ } →
tunnel.
O P˜ ,O P˜ ,O P˜ ,O P˜ Theoversamplingratedetermineshowmanybarometricreadings
up up dw dw amb amb int int
→ → → →
are averaged to produce a single measurement of the air pressure. A higher oversampling rate increases the precision
of the barometers, reducing the noise in their measurements (see Fig. 8, right).
R ,O C˜ , R ,O C˜ The current sensors encode their reading of the current as a voltage between
out out out in in in
{ }→ { }→
0 and 5 volts. This voltage is then read by the onboard computer, linearly mapping the range of [0,R ] ([0,R ])
in out
voltsto[0,1023]. Thus, reducingthereferencevoltagesR ,R increasestheresolutionofthecurrentmeasurements
in out
(see Fig. 12, right), but can also cause the measurements to saturate if the voltage surpasses the reference voltage. As
forthebarometers, theoversamplingrate(O ,O )determines thenumberof readings thatareaveragedtoproduce
in out
a single measurement, thus affecting the precision of the measurements (see Fig. 12, left).
A S˜ ,S˜ ,A S˜ The signal fed to the speaker amplification circuit (Fig. 2c) is binary white noise with a
1 1 2 2 2
→ { } →
periodof40µs: aftereveryperiodthevoltageissetto0or5voltswithequalprobabilityandisstatisticallyindependent
ofpreviousvoltages. Thetwopotentiometersactascontrollablevoltagedividers, affectingtheamplitudeofthesignal
at different points of the circuit. Thus, the first potentiometer (A ) affects the measurements S˜ ,S˜ , whereas the
1 1 2
second potentiometer (A ) only has an effect on the measurement S˜ (Fig. 9).
2 2
R ,O S˜ , R ,O S˜ As for the current measurements, the reference voltages R ,R and oversampling
1 1 1 2 2 2 1 2
{ rates O} ,O→ hav{ e an effe} ct→ on the resulting measurements S˜ ,S˜ .
1 2 1 2
A M˜ The setting of the first potentiometer (A ) controls the amplitude of the signal that is sent to the speaker,
1 1
affe→ cting the sound-level measurement M˜ taken by the microphone (Fig. 9, left).
L ,L ,H M˜ M˜ The speed of the fans, controlled by the loads L ,L , have an effect on the sound level
in out in out
{ M˜ measuredb→ ythe} m→ icrophone(seeFig.10,left). Thepositionofthehatchaffectstheamountofairflowingthrough
the exhaust and over the microphone, also affecting its reading (Fig. 10, center).
22
301
)mpr(
ω˜
ni
×R ,O M˜ As for the other sensors, the reference voltage affects the resolution of the microphone signal
M M
{ } →
measurementandcaninducesaturationifthesignalvoltagerisesaboveit. TheoversamplingrateO determinesthe
M
Nyquist frequency of the system and can introduce aliasing in the resulting signal (Fig. 10, right).
Max. S˜ amplitude Max. S˜ 2 amplitude
∗
A
29 S˜
1
S˜
2
M˜ S˜
1
01
S˜
2 170
28 198
226
255
0
28
A
0 128 255 0 128 255
Actuator 2 A A
A 1 2
input 1
0
0 200 400 600 800 1000
Time index t
Figure 9: (left) Time-series data of S˜ ,S˜ and the microphone output M˜, collected under the inputs A ,A to the
1 2 1 2
amplification circuit potentiometers (bottom left), while all other actuators and sensor parameters are kept constant.
The setting of the first potentiometer A determines the maximum amplitude of the signals S˜ ,S˜ (center) and of the
1 1 2
signal sent to the speaker, affecting the microphone output M˜ (left, gold). The setting of the second potentiometer
A only affects the maximum amplitude of S˜ (left), and the effect is linear for a fixed value of A (right). The
2 2 1
data and experimental setup for the plots can be found under the potis_coarse and potis_fine experiments in the
wt_test_v1 dataset.
P˜ L ,L In the pressure-control configuration of the wind tunnel, the fan loads L ,L are set following
dw in out in out
a con→ tro{ l mechani} sm to keep the pressure measured at the downwind barometer (P˜ ) constant. In particular, the
dw
loads of the fans are set as
(cid:40) (cid:40)
min(1,u(t)) if u(t)>0 min(1, u(t)) if u(t)<0
L and L −
in out
← 0 otherwise ← 0 otherwise
where u(t) is the controller output of the PID controller given by
t
(cid:88)
u(t):=K e(t)+K e(t)+K (e(t) e(t 1)),
p i d
− −
τ=0
wheree(t):=T P˜t isthecontrolerror,i.e.,thedifferenceinthepressuretargetT andthemeasurementP˜t ofthe
− dw dw
downwindbarometerattimepointt. Forthewt_pressure_control_v1dataset,weset(K ,K ,K ):=(0.5,0.1,10−3)
p i d
andsetaspressuretargetT thefirstmeasurementP˜0 takenbythedownwindbarometerafterthechamberpowersup.
dw
The control mechanism is executed internally by the chamber computer, producing a new output u(t) at every time
(cid:80)t
step. The related variables, i.e., target T, control constants K ,K ,K , output u(t) and error terms e(t), e(t)
p i d τ=0
and (e(t) e(t 1)), are returned with each measurement as additional columns in datasets collected from the
− −
pressure-control configuration.
23
tnemerusaem
waR800 L =1
in
O =8
M
600 H=45
M˜
O =4
400 H=0 M
200 m Lic =1
out O =2
M
H=0
L
in O =1
L M
out H=45
H
0 1000 2000 3000 4000 0 512 1023 0 50 100
Time index t M˜ Time index t
Figure10: (left)Time-seriesdataofthemicrophoneoutputM˜ collectedundervaryinginputstothefanloadsL ,L
in out
andthehatchpositionH (bottomleft). Allthreeactuatorshaveaneffectonthemicrophoneoutput. (center)Marginal
distributionofthemicrophoneoutputM˜ forL =1,L =0(top)andL =0,L =1(bottom),correspondingto
in out in out
theregionsmarkedinthetime-seriesplotontheleft. Thehatchaffectstheamountofairthatflowsthroughtheexhaust
of the tunnel and over the microphone, affecting its readings. The effect of opening the hatch (H =45) is dependent
on the loads of the fans, decreasing the airflow when L = 1,L = 0 and increasing it when L = 0,L = 1.
in out in out
(right)TheoversamplingratedeterminestheNyquistfrequencyofthemicrophonesystem, introducingaliasinginthe
resulting signal. The data and experimental setup for the plots can be found in the mic_effects experiment in the
wt_test_v1 dataset.
Lin
Lo=
ut0. =01 0.01
Lin
←
L1
out L←
i0
n
←0.01
Lout
←0.01
3K
ω˜
2K in
1K
ω˜
out
0
1 0 50 100 150 200 250 300
Fan L
in
load L
out
0
0 50 100 150 200 250 300
Time index t
Figure11: Bysettingafanloadtozero(e.g.,L 0att=125),thefaniscompletelypoweredoffandwilldecelerate
out
←
until it stops rotating; however, at zero load, the fan no longer produces a tachometer signal, and the resulting speed
measurement ω˜ corresponds to the last measured speed (e.g., t [125,200]). When powered up again (t=200) the
out
∈
fanalwaysdrawsfullpowerforaninstant,quicklyacceleratingbeforereturningtothelevelspecifiedbytheload. The
data and experimental setup for the plot can be found under the zero_load experiment in the wt_test_v1 dataset.
24
)mpr(
deeps
naFIII.2 Light Tunnel
1.0 400
Oversampling Reference voltage
0.8 O =1 R =1.10
C C
300
O =2 R =2.56
C C
0.6 O =8 R =5.00 C C
200
0.4
100
0.2
0.0 0
110 115 120 125 130 100 200 300 72.5 75.0 77.5
Raw measurement C˜ Raw measurement C˜ Calibrated measurement (mA)
Figure 12: Effect of the reference voltage R and oversampling rate O on the measurements C˜ of the current drawn
C C
by light source, when its brightness (R,G,B) is kept constant. The oversampling rate determines the amount of
readingsthatareaveragedtoproduceasinglemeasurement,affectingtheprecisionofthesensor(left). Foraconstant
oversampling rate (O = 1), changing the reference voltage results in a shift of the sensor output (middle) and an
C
increase in the resolution of the calibrated measurement (right). While the plots show the current measurement
C˜ in the light-tunnel, the same principles apply for the other sensors which encode their measurement as voltage
(θ˜ ,θ˜ ,M˜,S˜ ,S˜ )andforthewind-tunnelbarometers(P˜ ,P˜ ,P˜ ,P˜ ),whichalsoallowforvaryingoversampling
1 2 1 2 dw up amb int
rates(O ,O ,O ,O ). Thedatacorrespondstothecurrent_sensorexperimentfromthelt_test_v1dataset.
dw up amb int
50K
Photodiode Exposure
40K DI =0 TI =0
1 1
DI =1 TI =1
1 1
30K
I˜
1
D 1I =2 T 1I =2
TI =3
20K 1
10K
0
0 128 256 0 128 256 0 128 256
R R R
Figure 13: Effect of the photodiode size (DI) and exposure time (TI) on the infrared measurements (I˜) of the light
1 1 1
sensor nearest the light source. We display the output I˜ of the sensor for varying brightness of the red LEDs on
1
the light source (R), while keeping G = B = 0 and all other actuators constant. Increasing the photodiode size
(left) or exposure time (center) both increase the sensitivity of the sensor. Due to an interplay between the exposure
time and the pulse-width-modulation frequency of the light source, changes in the exposure time also affect the
conditionaldistributionofthemeasurementsgiventhelight-sourceintensity(R,G,B). Forexample, whencomparing
the measurements for TI = 2 and TI = 3 in the rightmost panel (same data as in the center panel, but vertically
1 1
scaled for comparison), we can see a difference in the variance as a function of R. The effects on the visible-light
measurements V˜ follow the same principles and are not shown. The data corresponds to the ir_sensors experiment
1
from the lt_test_v1 dataset.
R,G,B I˜,I˜,I˜,V˜ ,V˜ ,V˜ The brightness settings of the light-source colors (R,G,B) affect the readings
1 2 3 1 2 3
{ } → { }
of all light-intensity sensors. The effect of each color is approximately linear with heteroscedastic noise (Fig. 4d),
with the slope determined by its typical wavelength and the spectral sensitivity of the sensor (see light_source and
light_sensor components in App. VI).
R,G,B C˜ The brightness settings also affect the electric current drawn by the light source. The effect is again
{ }→
approximately linear with roughly the same slope for each channel (see Fig. 4d).
25
ytisneD tnuoCR ,O C˜ As for the wind-tunnel, the sensor measuring the current drawn by the light source encodes its
C C
{ } →
reading into a voltage between 0 and 5 volts. This voltage is then read by the onboard computer, linearly mapping
the range of [0,R ] volts to [0,1023]. Thus, reducing the reference voltage R increases the resolution of the current
C C
measurements (see Fig. 12, right). The oversampling rate (O ) determines the number of readings that are averaged
C
to produce a single measurement, affecting its precision (Fig. 12, left).
DI,TI I˜, DV,TV V˜ The measurements of each light sensor are affected by the choice of photodiode
{ j j} → j { j j } → j
(DI,DV) and gain (TI,TV) used to perform the infrared (I˜) and visible-light (V˜ ) readings. Larger photodiodes
j j j j j j
collect light over a larger area, increasing the sensitivity of the sensor (Fig. 13, left). Higher exposure times achieve
a similar effect by increasing the reading duration, which also has an effect on the conditional distribution of the
measurements given the light source brightness (Fig. 13, right). A timing mechanism ensures that changes in the
exposure time do not affect the overall measurement time.
θ ,R ,O θ˜ The motor settings θ ,θ determine the positions of the polarizer frames. The positions are
j j j j 1 2
{ } →
encoded into a voltage by means of rotary potentiometers, resulting in the measurements θ˜ ,θ˜ . Changes in the
1 2
reference voltages R ,R affect the resolution of the measurements, but can also cause the sensor to saturate (see
1 2
Fig.14,left). Theoversamplingrates(O ,O )determinethenumberofreadingsthatareaveragedtoproduceasingle
1 2
measurement, affecting its precision (Fig. 14, right).
θ ,θ I˜,V˜ ,˜Im The position of the polarizers affects the intensity and spectral composition (i.e., color) of
1 2 3 3
t{ he lig} ht→ pa{ ssing throu} gh them, affecting the readings (I˜,V˜ ) of the third light sensor (see Fig. 4c and Fig. 17) and
3 3
the images (˜Im) captured by the camera (see Fig. 4e). The effect is described by Malus’ law—see App. IV.2.1 for
more details.
Ap,ISO,T ˜Im The camera parameters affect the brightness of the captured images while introducing a variety
{ }→
of side effects (Fig. 4e). For example, a higher gain (ISO) increases the noise, while the aperture (Ap) changes the
depth of field, introducing blur.
L ,L I˜,V˜ Besides the light source, two additional LEDs by each sensor (see Fig. 2d) have an effect on
j1 j1 j j
{ } →
its reading. The LEDs only turn on when the sensor is taking a measurement, and their brightness is controlled
by means of digital rheostats that control the current flowing to each LED. The settings L ,L correspond to
j1 j2
the wiper position of each rheostat. The relationship between the setting and the intensity readings follows an
exponential function (Fig. 4b), resulting from the LED’s voltage-current characteristic, luminosity response and
typical wavelength, and the spectral sensitivity of the sensor. The brightness of the LEDs is much lower than that of
the light source (Fig. 15). See the led and light_sensor components in App. VI for the corresponding datasheets.
200
Ref. voltage Oversampling
6
R =1.10 O =O =1
1 1 2
100
R =2.56 O =O =2
1 1 2
R =5.00 O =O =8 4
1 1 2 0
2
100
−
200 0
−
200 100 0 100 200 506.0 506.5 507.0
− −
θ
1
θ˜
1
Figure 14: Effect of the reference voltage (R ) and oversampling rate (O ) on the angle measurements of the first
1 1
polarizer (θ˜ ). (left) We show the calibrated measurements of the angle sensor (see Table 2 for details) for different
1
values of the motor setting θ and reference voltages R , while keeping the oversampling rate constant at O = 1.
1 1 1
Lowering the reference voltage R results in a saturation of the sensor, being completely saturated (i.e., returning a
1
constantreading)atR =1.1. (right)Uncalibratedmeasurementsθ˜ foraconstantmotorsettingθ =0andreference
1 1 1
voltageR =5. Thestochasticityofthemeasurementisduetoelectricalnoiseinthevoltagemeasurement—increasing
1
the oversampling rate O increases the precision of the sensor. The same principles apply to the measurements θ˜ of
1 2
the second angle sensor. The data corresponds to the angle_sensors experiment from the lt_test_v1 dataset.
26
elgna
detarbilaC
)seerged(
tnemerusaem
ytisneDAll observations Observations where θ θ [85,95]
1 2
| − |∈
3
200
2
150
100
1
50
0 0
0 128 255 0 128 255
L31 L31
Figure 15: Effect of the LED brightness settings (L ,L ) on the reading I˜ of the third light sensor, which is
31 32 3
separatedfromthelightsourcebybothpolarizers. ThelightsourcecolorsR,G,B andbrightnesssettingsL ,...L
11 32
are sampled independently and uniformly at random from the range 0,...,255 , and the polarizer angles θ ,θ from
1 2
{ }
[ 15,105]. In both plots, the color corresponds to R,G,B, and the size to L . Because the brightness of the LEDs
32
i− s very small when compared to that of the light source, their effect on the intensity reading I˜ is barely noticeable
3
whenlookingatallobservations(left),butbecomesapparent,forexample,whenthepolarizersareclosetoorthogonal
(right) and block most of the light emanating from the light source. The data corresponds to the actuators_white
experiment from the lt_walks_v1 dataset.
27
301
×
3˜I
3˜IAppendix IV
Mechanistic Models of The Chambers
This appendix provides mechanistic models describing several of effects and processes in the causal chambers. Each
modelislabeledwithaletterandanumber(e.g.,B1,C2); differentletterscorrespondtodifferentmodeledquantities,
and higher numbers mean increased fidelity. A Python implementation of each model can be found in github.com/
juangamella/causal-chamber, and is accessible through the causalchamber package; examples and the code to
generate the plots in this section can be found in the Jupyter notebook case_studies/mechanistic_models.ipynb
in the paper repository github.com/juangamella/causal-chamber-paper.
ExcludingmodelsD1andF1–F3,themodelsinthissectionareagnostictophenomenaarisingfromthesensorsthat
measure the modeled physical quantities, such as measurement and quantization noise, saturation, or non-linearities
in their response. For this reason, we denote the modeled quantities without a tilde (e.g., ω ,P ,I ) to differentiate
in dw 3
them from the corresponding sensor measurements (e.g., ω˜ ,P˜ ,I˜).
in dw 3
IV.1 Wind Tunnel
Weprovidemodelsdescribingtheeffectofthefanloadonthespeedofthefansandthedrawncurrent(Sec.IV.1.1);the
effect of the fan loads and hatch position on the reading of the downwind barometer (Sec. IV.1.2); and the difference
between the readings of the up- and downwind barometers, as described by Bernoulli’s principle (Sec. IV.1.3).
Measurements ModelB1 ModelA1 ModelA2
3 Drawn 2.5
current
L =0.1
2.5 min L min =0.1 2.0 (A) ×10−1
2
3 Fan
2 speed
2.0 1 1 (rad / s) 102
×
1
Fan load L
in
0 0
0.0 0.5 1.0 0.0 0.5 1.0 0 50 100
Fan load L Fan load L Time index t
in in
Figure 16: Comparing model predictions with real measurements. (left and center): models B1 and A1 of the drawn
currentandspeedofthefans,respectively,asafunctionoftheloadL ,comparedtosteady-statemeasurementsfrom
in
thewt_bernoulli_v1dataset. Whentheloadissettozero, thefaniscompletelypoweredoffandnolongerproduces
a tachometer signal (not shown)—see also Fig. 11. (right) Output of the models B1, A1 and A2 for time-series data
from the wt_test_v1 dataset. The parameters of all models are set as in Sec. IV.1.1.
The fans used in the wind-tunnel are high-speed fans for industrial cooling applications. Their speed is controlled
viapulse-width-modulation(PWM),wherethepulse-width,ordutycycle,correspondstothefanloadsL andL of
in out
the wind tunnel. Additional details and technical specifications of the fans can be found in the datasheets of App. VI,
under the fan component. As we derive the different models of this section, we will refer to these datasheets for the
values of certain model parameters.
IV.1.1 Effect of the fan load on fan speed and drawn current
Two important aspects of the fans’ design are used throughout the models of the fan speed (A1, A2) and drawn
current(B1): first, thefansaredesignedsotheirsteady-statespeedscalesbroadlylinearlywiththeload. Atfullload,
thefansturnatamaximumspeedω , whichisspecifiedbythemanufactureras314.16 rad/s(3000RPM).Second,
max
due to their intended application, unless completely powered off (i.e., L ,L = 0) the fans never operate below a
in out
certain speed, corresponding to a minimum effective load which we denote by L . This value is specified by the
min
manufacturer to be around 0.2, but our experiments show it to be closer to 0.1 (see Fig. 16, center).
28
1 −01
)A(
tnerruc
nwarD
×
201
)s
/
dar(
deeps
naF
×Model A1
We model the steady-state speed ω of the fan under a load L as
(cid:40)
max(L,L )ω if L>0
min max
ω = (2)
0 if L=0
where Θ := (ω ,L ) are the parameters of the model. The first two correspond to the maximum speed of
max min
the fan and the minimum effective load. From the datasheets and our experiments, we can set L = 0.1 and
min
ω =314.16 rad/s (see Fig. 16, left).
max
Model B1
Wemodelthe effectof fan loadonits drawncurrentthroughthe affinitylaws [e.g., 47, section 9.3.5], whichstatethat
thepowerW consumedbyafanisproportionaltothecubeofitsspeedω,thatis,W =W (ω/ω )3,whereW
max max max
isthepowerconsumedbythefanatitsmaximumspeedω . Becausethefansoperateataconstantvoltage, wecan
max
rewritetheaboveexpressionintermsofthedrawncurrentC asC =C (ω/ω )3,whereC isthecurrentdrawn
max max max
at maximum speed. Accounting for the no-load current C of the motor, and combining the above with model A1
min
of the fan speed, we arrive at the model
(cid:40)
C +max(L ,L)3(C C ) if L>0
min min max min
C = − (3)
C if L=0
min
where Θ:=(L ,C ,C ) are the parameters of the model. As before, we can set L =0.1; from the datasheet
min min max min
we can set the nominal current of the fan to C = 0.26 A, and empirically determine the no-load current to be
max
approximately C =0.166 A.
min
Model A2
To model the dynamics of the fan speed beyond the steady state, we express the change in the speed through the
torque-balance equation
1
dω = (τ(L) Kω2)dt, (4)
I −
where I is the fan’s moment of inertia, τ(L) is the torque applied by the fan motor for a given load L, and Kω2 is
the opposing torque due to the drag experienced by the fan. Here, K is a constant that depends on the geometry of
the blades and the density of the air [e.g., 47, section 9.3.5]. These constitute the parameters Θ:=(I,τ(L),K) of our
model, which we approximate as follows:
• We model the fan as a solid cylinder, resulting in a moment of inertia I = 1mr2, where m,r are the mass and
2
radius of the disc, respectively. The fan has a radius of r = 0.059m, and we estimate its mass as m = 0.02kg,
resulting in I =3.48 10−5kg/m2.
×
• We approximate the load-to-torque function as
(cid:40)
T(max(L ,L)3(C C )) if L>0
min max min
τ(L):= −
0 if L=0
whereT isthetorqueconstantofthemotorandtheremainingtermscorrespondtothedrawncurrentasdescribed
by model B1 (after substracting the no-load current C ). In Fig. 16 and Fig. 6f, we set T =0.05Nm/A.
min
• ToobtainavaluefortheconstantK inourmodel, wesolvethesteady-stateequationdω = 1(τ(1) Kω2 )=0
I − max
with I and τ(L) as above, resulting in K =5.26 10−8.
×
In Fig. 16 we compare the output of the models A1 and A2 to real measurements collected from the chamber. An
importantsourceofmisspecificationisthatwemodeltheintakeandexhaustfansindependently,whereasinthetunnel
their speeds affect each other (see Fig. 6f).
29IV.1.2 Effect of the fan loads and hatch position on the downwind barometer
In this section, we provide models describing the effect of the fan loads and hatch position on the static pressure
inside the wind tunnel, corresponding to the measurement P˜ of the downwind barometer. Models C1–C3 relate the
dw
pressure to the fan speeds ω and hatch position H. We can combine them with models A1 or A2 of the fan speeds
in
to simulate the barometer reading as a function of the fan loads (L ,L ), as we do in Fig. 6f.
in out
To model the complex dynamics of the airflow through the wind tunnel, models C1–C3 make some simplifying
assumptions. In first place, we assume that the change in static pressure can be simply computed as the difference
of the static pressure produced by each fan. Furthermore, we model each fan independently, ignoring mutual effects
between them.
Model C1
As a first approach, we model the static pressure P inside the tunnel as
dw
(cid:18) (cid:19)2 (cid:18) (cid:19)2
ω ω
in out
P =P +S S , (5)
dw amb max max
ω − ω
max max
where P is the static pressure outside the wind tunnel (corresponding to the barometer reading P˜ ). The other
amb amb
two terms on the RHS correspond to the static pressures produced by the intake and exhaust fans, resulting from the
the affinity laws [e.g., 48, chapter 5.14]. The parameters of our model are Θ := (S ,ω ), corresponding to the
max max
maximum static pressure and maximum speed of the fan. From the technical specifications, we can set these values
to 74.82 Pa and 314.16 rad/s, respectively.
Model C2
(cid:16) (cid:17)2
Model C1 assumes that the fans always produce their maximum static pressure S ω at a given speed ω.
max ωmax
In reality, there is a trade-off between the airflow and static pressure produced by the fan, dictated by the system’s
resistance to the flow of air, which is called impedance. As an illustration, a fan blowing into an enclosure with no
other openings produces no airflow but maximum static pressure, whereas a fan at the boundary of two completely
open enclosures produces its maximum airflow but no static pressure [49]. To account for this effect, we model the
pressure P as
P =P +S (ω ) S (ω ),
dw amb Z in Z out
−
whereS (ω)isthestaticpressureproducedbythefanatspeedω inasystemwithimpedanceZ. WecomputeS (ω)
Z Z
as the intersection of the impedance curve S =ZQ2 with the pressure-airflow characteristic (PQ-curve) of the fan at
speed ω [see, e.g., 49]. Because the PQ-curve of our fans is not available, we approximate them as the linear relation
(cid:18) (cid:19)2 (cid:18) (cid:19)
ω ω S
in in max
S = S Q,
max
ω − ω Q
max max max
where Q is the maximum airflow of the fan. The impedance Z [0, ] is a result of the complex dynamics of
max
∈ ∞
the air as it flows through the wind tunnel, and we cannot directly calculate it. For a more intuitive interpretation,
we can express it in terms of the ratio r of the maximum airflow that the fans produce when turning at full speed,
yielding Z := Smax (cid:0)1−r(cid:1) for r [0,1]. Under this parametrization, our model becomes
Q2 max r2 ∈
P =P +S (ω ) S (ω ), (6)
dw amb r in r out
−
withparametersΘ:=(S ,ω ,Q ,r). Followingthefan’sspecifications,wesetthemaximumairflowtoQ =
max max max max
0.052m3/s. For the simulation results in Fig. 6f, we set r =0.7.
Model C3
So far. we have not considered the effect of the hatch position (H) on the pressure inside the tunnel. Building on
Model C2, we model the effect of the hatch as a change in the impedance of the system. Opening the hatch lowers
the system impedance and, thus, the static pressure produced by the fans. As in (6), we model the pressure as
P =P +S (ω ) S (ω ), (7)
dw amb r(H) in r(H) out
−
except now the maximum airflow ratio is given by the function r(H)=min(1,r +βH), where H [0,45], r [0,1]
0 45 ∈ 0 ∈
istheratiowhenthehatchisclosed(H =0),andβ >0istheeffectofthehatch,whichwemodelaslinear. Thus,the
parameters of the model become Θ:=(S ,ω ,Q ,r ,β). For the simulation results in Fig. 6f, we set r =0.7,
max max max 0 0
β =0.15, and all other parameters as for the previous models.
30IV.1.3 Relationship between the up- and downwind barometers
Due to their positioning, the pair of barometers inside the wind tunnel function as a pitot tube, where the upwind
barometer (P˜ ) measures the stagnation or total pressure, and the downwind barometer (P˜ ) measures the static
up dw
pressure. Ignoring measurement noise, the readings of both barometers can be related by Bernoulli’s principle:
1
P˜ =P˜ + ρv2+∆. (8)
up dw
2
Above,ρisthedensityoftheair,visthespeedoftheairflowand∆istheoffsetbetweenthereadingsofthebarometers
due to manufacturing differences, which we empirically determine to be around ∆ = 7.1 Pa. By solving for v, we
can use (8) to estimate the speed of the airflow through the tunnel. Model D1 relates the difference in the barometer
readings to the speed of the intake fan.
Model D1
To express the speed v of the airflow as a function of the intake fan speed, we again rely on the affinity laws, which
state that the airflow Q produced by the fan is proportional to its speed ω , i.e.
in
(cid:18) (cid:19)
ω
in
Q= Q ,
max
ω
max
whereω ,Q arethemaximumspeedandairflowofthefan. DividingbytheareaAofthefanopening,weobtain
max max
the following expression for air speed
(cid:18) (cid:19)
1 ω
in
v = Q .
max
A ω
max
Combining this with (8), we arrive at
(cid:18) (cid:19)2
ρ Q
P˜ P˜ = max ω2 +∆, (9)
up − dw 2A2 ω in
max
where Θ := (ρ,A,ω ,Q ,∆) are the parameters of our model. Given the specifications of the fan, we have
max max
A = π0.062 m2 and ω = 314.16 rad/s. We can set ρ = 1.2 and we empirically determine ∆ = 7.1 Pa. The same
max
difficultiesapplytoestimatingQ asforS inmodelC1. Furthermore,inthismodelweignoretheadditionaleffect
max max
that the exhaust fan has on the total airflow through the tunnel. For the symbolic regression task in Fig. 6e, we turn
offtheexhaustfanandtakesteady-statemeasurementsfordifferentloadsoftheintakefan(seethewt_bernoulli_v1
dataset for more details).
IV.2 Light Tunnel
In Sec. IV.2.1, we provide some background on Malus’ law and provide a model of the effect of the polarizer angles
(θ ,θ ) on the light intensity reaching the third light sensor (I˜,V˜ ). In Sec. IV.2.2 we provide models of the image-
1 2 3 3
capture process with increasing degrees of fidelity.
IV.2.1 Polarizer Effects
Depending on their angle, the linear polarizers dim the light passing through them. Malus’ law describes their effect
onlightintensity[50]: givenabeamoftotallypolarizedlightandaperfectpolarizer,theintensityI afterthepolarizer
is given by I =I cos2(θ), where I is the intensity before the polarizer and θ is the angle between the polarizer axis
0 0
and the polarization of the incident light. For unpolarized light passing through two polarizers at angles θ and θ ,
1 2
the intensity after the polarizers becomes
1
I = I cos2(θ θ ).
0 1 2
2 −
In practice, polarizers are imperfect: they are not fully transparent to light polarized parallel to their polarization
axis, and they do not block all light with polarization orthogonal to it. Furthermore, their effect depends on the
frequency of light. For an unpolarized light beam with a given spectral composition, a pair of polarizers will scale
its intensity by Tp < 1/2; when orthogonal, they will still allow some light to pass through, scaling the intensity by
Tc >0.
313000 Model E1
Measurements
2000 R=G=B=64
R=G=B=128
1000 R=G=B=255
0
150 100 50 0 50 100 150
− − −
θ θ
1 2
−
Figure17: ComparingthepredictionofmodelE1(Malus’law)withrealmeasurementsgatheredfromthelighttunnel.
ModelE1isfittodatagatheredunderdifferentbrightnesssettingsofthelightsource(i.e.,R=G=B =64,128,255),
obtaining a coefficient of determination of R2 =0.93,0.97,0.99, respectively. The data for R =G=B =255 is used
in the symbolic regression task of Fig. 6e. The signal-to-noise decreases with the light-source brightness, allowing for
more challenging scenarios. The data can be found in the lt_malus_v1 dataset.
Model E1
Tomodeltheeffectofthepolarizeranglesθ ,θ ontheintensityI oflightreachingthethirdsensor,wecanreformulate
1 2 3
thegeneralizationofMalus’lawforimperfectpolarizers[51]intermsofthetransmissionratesTp,Tc, resultinginthe
model
I =I [(Tp Tc)cos2(θ θ )+Tc],
3 0 1 2
− −
where Θ := (I ,Tp,Tc) are the parameters of the model. The radiant intensity before the polarizers (I ) is given in
0 0
watts per steradian (W/sr), and depends e.g., on the brightness of the tunnel light source. For the polarizing film
usedinthelighttunnel,valuesforthetransmissionratesTp,Tc [0,1]canbefoundinApp.VIunderthepolarizer
∈
component. We can rewrite the above model as
I =β cos2(θ θ )+β ,
3 1 1 2 0
−
becoming our ground truth for the symbolic regression task in Fig. 6e. We compare, in Fig. 17 the output of model
E1 to measurements gathered from the chamber, with the parameters β ,β fit to the data.
0 1
IV.2.2 Image Capture
As models of the image-capture process in the light tunnel, we provide simple simulators that produce a synthetic
image given the light-source setting R,G,B and polarizer angles θ ,θ . The resulting image simulates the image (˜Im)
1 2
produced by the light tunnel and consists of a hexagon over a black background, whose color is given by the RGB
vector (R˜,G˜,B˜) [0,1]3 and models the response of the camera sensor. The models F1–F3 differ in how the vector
(R˜,G˜,B˜) is comp∈ uted. In Fig. 6f, we compare their output to real images produced by the light tunnel.
Model F1
The first model assumes the linear polarizers to be perfect and that their effect is uniform across all wavelengths.
Furthermore, it assumes that the camera sensor is perfectly calibrated to the light source. The resulting color vector
is given by
   
R˜ R
  1  
G˜=cos2(θ
1
θ 2) G, (10)
  − 255 
B˜ B
where cos2(θ θ ) models the dimming effect of the polarizers according to Malus’ law (see Sec. IV.2.1 above).
1 2
−
32
˜I 3Model F2
Thesecondmodelexplicitlymodelstheoutputofthecamerasensorasaresultofitsspectralsensitivityandthewhite
balance correction applied by the processor in the camera. Our complete model is
   
R˜ R
  1  
G˜=min 1,eWScos2(θ 1 θ 2) G , (11)
  { − 255 }
B˜ B
where
• S R3×3 models the response of the sensor to the light of each color,
∈ +
• W := diag(w ,w ,w ) with w ,w ,w R : w +w +w = 1 is the white-balance correction applied by
R B C R B C + R B C
∈
the camera, and
• e > 0 is an additional parameter to model the exposure of the sensor as affected by the camera parameters
aperture (Ap), shutter speed (T ), and sensor gain (ISO).
Im
The term min 1,x :=(min 1,x ) truncates the resulting color vector to the interval [0,1]3, modeling overex-
i i=1,2,3
{ } { }
posure of the camera sensor.
Model F3
We separately model the effect of the polarizers on each of the frequencies produced by the light source. Our model
becomes
   
R˜ R
 G˜ =min 1,eWSdiag(cid:0) (Tp Tc)cos2(θ 1 θ 2)+Tc(cid:1) 1  G  , (12)
  { − − 255 }
B˜ B
where Tp := (Tp,Tp,Tp) [0,1]3 are the transmission rates for each color when the polarizers are aligned, and
R G B ∈
Tc [0,1]3 when their polarization axes are perpendicular. From the technical specifications of the light source and
∈
polarizers, appropriate values are Tp =(0.29,0.35,0.33) and Tc =(0.02,0.08,0.18); for the corresponding datasheets,
see the light_source and polarizer components in Table 9.
33Appendix V
Causal Ground Truth
In this appendix, we formalize a causal interpretation of the ground-truth graphs in Fig. 3. Equipped with this
interpretation, which we give in Definition 1, the graphs describe constraints on the underlying causal system. We
also provide a procedure to empirically validate these constraints using data collected from the chambers.
In Sec. 2, we categorized the variables in each ground-truth graph G as non-manipulable variables, corresponding
to sensor measurements, and manipulable variables, that is, actuators and sensor parameters. Here, we further split
thelatterintomanipulablevariableswithnoincomingedgesinG,whichwecallexogenous,andmanipulablevariables
withincomingedges,whichwecallendogenous andaresetbythecontrolcomputerasafunctionoftheothervariables
in the system. We refer to such functions as assignment functions.
Let X = (X ,...,X ) denote a vector of chamber variables and let us assume that there is a true causal model
V 1 k
describing the system; more formally, we denote by P(Xt do(Xt0 = x)) the distribution of variable X at
j | V\{j} j
time t, after performing an intervention on all other chamber variables X at some earlier time t < t. We
V\{j} 0
can sample from this distribution by taking a measurement from the chamber, where the intervention corresponds
to the following manipulations of its variables: if X is a non-manipulable variable, i.e., a sensor measurement, the
i
intervention consists of overwriting its value with x . If X X is an exogenous manipulable variable, then the
i k V\{j}
∈
intervention corresponds to setting it to x . If it is an endogenous manipulable variable, the intervention also sets its
k
value to x , overriding the value set by its assignment function.
k
Definition 1 (Ground-truth causal model). Let G be a directed graph over X . We call G a ground-truth graph if
V
an edge X X in G implies that
i j
→
t,T >0,xA,xB with xA =xB and xA =xB for all k =i,
∃ i ̸ i k k ̸
such that P(Xt+T do(Xt =xA))=P(Xt+T do(Xt =xB)). (13)
j | V\{j} ̸ j | V\{j}
Although it is impossible to directly evaluate (13)—we would need to perform two different interventions
simultaneously—Definition1allowsus,underadditionalassumptions,tomakestatementsaboutwhataground-truth
graph G implies for the observations collected from the chambers. For example, if we assume that the distribution
resulting from an intervention depends on the time lag (but not the absolute time t) at which the intervention is
performed (the assumption is formalized in Proposition 1 below), then we can use two-sample tests for testing (13).
This assumption is suitable for the controlled environment of the light tunnel and for many of the effects in the wind
tunnel. For the effects on the barometric measurements (P˜ ,P˜ ,P˜ ,P˜ ), whose distribution changes with time
up dw amb int
due to shifts in atmospheric pressure, the assumption is still reasonable for measurements taken closely in time.
V.1 Empirical validation
According to Definition 1, to validate an effect X X , we would need to reject the null hypothesis
i j
→
H : t,T >0,xA,xB with xA =xB and xA =xB for k =i,
0 ∀ i ̸ i k k ̸
such that P(Xt+T do(Xt =xA))=P(Xt+T do(Xt =xB)). (14)
j | V\{j} j | V\{j}
However, as discussed after Definition 1, additional assumptions are needed to test H , since we cannot perform the
0
two different interventions do(Xt = xA) and do(Xt = xB) at the same time t. We first state our validation
V\{j} V\{j}
procedure and then provide sufficient conditions for it to have the appropriate level for testing H .
0
Validation procedure Pick predefined x ,x ,T,N,α.
A B
1. sample U1,...,UN i.i.d. from a Bernoulli distribution with p=0.5
2. sample ∆t ,...,∆t i.i.d. Unif[10−3,1]
1 N
∼
3. let t +T be the current time
0
4. for n=1,...,N
(a) wait ∆t seconds
n
(b) (at time t :=t +T +∆t ) set X xA if Un =0, or X xB otherwise
n n−1 n V\{j} V\{j}
← ←
(c) wait T seconds
34(d) (at time t n+T) collect the measurement xtn+T from the chamber
(e) add the measurement of X to the sample XA XA xtn+T if Un = 0, and XB XB xtn+T
j ← ∪{ j } ← ∪{ j }
otherwise
5. perform a two-sample test ψ that is level α (in practice, we use a Kolmogorov-Smirnov [52] test), comparing the
samples XA and XB, resulting in a p-value p
6. reject H if p α
0
≤
Theaboveprocedureamountstoarandomizedcontrolledtrial,wherethetreatmentunitsaretheN measurements,and
both the intervention allocations and intervention times are randomized. Proposition 1 provides sufficient conditions
for the procedure to achieve the correct level in testing H (14).
0
Proposition 1. Let x ,x ,T,N,α be the values used in the validation procedure and assume that the following two
A B
assumptions hold.
A1. For all t ,...,t such that t +T < t for all i 1,...,N 1 , and for all x1,...,xN x ,x , it holds
1 N i i+1 A B
∈ { − } ∈ { }
that for all n 1,...,N
∈{ }
P(Xtn+T do(Xtn =xn),...,do(Xt1 =x1),Xtn−1+T ,...,Xt1+T)=P(Xtn+T do(Xtn =xn)).
j | V\{j} V\{j} j j j | V\{j}
A2. τ,t
∀
P(Xt+T do(Xt =x ))=P(Xt+T+τ do(Xt+τ =x )),
j | V\{j} A j | V\{j} A
and
P(Xt+T do(Xt =x ))=P(Xt+T+τ do(Xt+τ =x )).
j | V\{j} B j | V\{j} B
Then, the validation procedure is level α for testing H .
0
Proof. AssumptionsA1andA2implythatthereisPAandPB suchthat,conditionedontherealizationsofU ,...,U ,
1 N
XA i.i.d. PA, and XB i.i.d. PB. Additionally, under H , PA =PB. Thus, P(ψ(XA,XB)=1) α.
0
∼ ∼ ≤
Inessence,assumptionsA1 andA2 ensurethatthetestinstep5oftheprocedurereceivestwosamplescomposedof
independent and identically distributed observations. Alternative tests requiring weaker conditions may be possible.
In any case, the assumptions are not unreasonable for the causal chambers. Both assumptions hold when X is an
j
endogenousmanipulablevariable,andtheyarereasonableforallsensormeasurementsinthelighttunnel,andmostin
the wind tunnel. An exception comes from the barometric measurements P˜ ,P˜ ,P˜ and P˜ , which are affected
dw up amb int
bytheatmosphericpressureoutsidethechamber. Inthiscase,assumptionA2 maynotholdforlargeτ. However,the
issue is largely reduced for measurements taken very closely in time. Furthermore, the randomization of time points
and intervention assignments provides some robustness against violations of A1 and A2.
The results of the procedure, in the form of the p-values computed in step 5 (using the Kolmogorov-Smirnov two-
sample test), are shown for each edge and ground-truth graph in Table 5-Table 8. The corresponding datasets are
listed in the caption of each table, and the code to compute the p-values can be found in the Jupyter notebook
causal_validation.ipynbinthepaperrepositoryatgithub.com/juangamella/causal-chamber-paper. Thedata
fromsomeexperimentswasusedtocomputethep-valuesfordifferentedgesandsomeexperimentshavebeenrepeated
a few times; in Table 5-Table 8 we show the raw p-values produced by the test without additional corrections for
multiple testing.
35Edge p-value Edge p-value Edge p-value Edge p-value
R I˜ 2.3 10−14 G I˜ 1.6 10−14 B I˜ 1.8 10−14 R I˜ 2.3 10−14
1 1 1 2
→ × → × → × → ×
G I˜ 1.6 10−14 B I˜ 1.8 10−14 R I˜ 2.3 10−14 G I˜ 1.6 10−14
2 2 3 3
→ × → × → × → ×
B I˜ 1.8 10−14 R V˜ 2.3 10−14 G V˜ 1.6 10−14 B V˜ 1.8 10−14
3 1 1 1
→ × → × → × → ×
R V˜ 2.3 10−14 G V˜ 1.6 10−14 B V˜ 1.8 10−14 R V˜ 2.3 10−14
2 2 2 3
→ × → × → × → ×
G V˜ 1.6 10−14 B V˜ 1.8 10−14 R C˜ 2.3 10−14 G C˜ 1.6 10−14
3 3
→ × → × → × → ×
B C˜ 1.8 10−14 θ I˜ 2.9 10−14 θ I˜ 6.6 10−14 θ V˜ 2.9 10−14
1 3 2 3 1 3
→ × → × → × → ×
θ V˜ 6.6 10−14 θ θ˜ 2.9 10−14 θ θ˜ 6.6 10−14 R θ˜ 1.6 10−14
2 3 1 1 2 2 1 1
→ × → × → × → ×
O θ˜ 3.6 10−104 R θ˜ 2.3 10−14 O θ˜ 4.4 10−16 R C˜ 1.8 10−14
1 1 2 2 2 2 C
→ × → × → × → ×
O C˜ 4.1 10−24 L I˜ 1.6 10−14 L I˜ 2.3 10−14 L V˜ 1.6 10−14
C 11 1 12 1 11 1
→ × → × → × → ×
L V˜ 2.3 10−14 TI I˜ 1.8 10−14 DI I˜ 2.9 10−14 TV V˜ 1.8 10−14
12 → 1 × 1 → 1 × 1 → 1 × 1 → 1 ×
DV V˜ 1.8 10−14 L I˜ 4.2 10−14 L I˜ 6.6 10−14 L V˜ 4.2 10−14
1 → 1 × 21 → 2 × 22 → 2 × 21 → 2 ×
L V˜ 1.3 10−12 TI I˜ 1.8 10−14 DI I˜ 1.6 10−14 TV V˜ 1.6 10−14
22 → 2 × 2 → 2 × 2 → 2 × 2 → 2 ×
DV V˜ 8.9 10−13 L I˜ 2.3 10−14 L I˜ 4.2 10−14 L V˜ 6.8 10−12
2 → 2 × 31 → 3 × 32 → 3 × 31 → 3 ×
L V˜ 4.2 10−14 TI I˜ 2.3 10−14 DI I˜ 4.2 10−14 TV V˜ 1.8 10−14
32 → 3 × 3 → 3 × 3 → 3 × 3 → 3 ×
DV V˜ 2.3 10−14
3 → 3 ×
Table 5: Results of the validation procedure for the edges of the standard-configuration graph of the light tunnel
(Fig. 3a). For each edge, we show the p-value resulting from the Kolmogorov-Smirnov [52] test computed in step 5 of
the procedure. All p-values are below 10−11. The experimental data, together with the interventions xA,xB, waiting
time T and sample size N for each edge can be found in the lt_validate_v1 dataset at causalchamber.org.
Edge p-value Edge p-value Edge p-value
L ω˜ 1.6 10−14 T ω˜ 3.3 10−16 L ω˜ 1.6 10−14
in in in in in out
→ × → × → ×
L C˜ 1.6 10−14 L C˜ 1.9 10−27 L ω˜ 3.4 10−14
in in in out out in
→ × → × → ×
L ω˜ 3.4 10−14 T ω˜ 1.3 10−127 L C˜ 3.4 10−14
out out out out out out
→ × → × → ×
L C˜ 1.1 10−8 H ω˜ 1.1 10−16 H ω˜ 1.1 10−16
out in in out
→ × → × → ×
L P˜ 2.5 10−7 H P˜ 8.8 10−11 L P˜ 0.082
in int int out int
→ × → × →
O P˜ 8.1 10−25 L P˜ 1.6 10−14 H P˜ 2.9 10−14
int int in up up
→ × → × → ×
L P˜ 3.4 10−14 O P˜ 8 10−7 L P˜ 1.6 10−14
out up up up in dw
→ × → × → ×
H P˜ 2.9 10−14 L P˜ 3.4 10−14 O P˜ 1.7 10−5
dw out dw dw dw
→ × → × → ×
O P˜ 2.1 10−287 O C˜ 7.3 10−22 R C˜ 0
amb amb in in in in
→ × → × →
O C˜ 7.8 10−16 R C˜ 3.3 10−16 A S˜ 4.4 10−16
out out out out 1 1
→ × → × → ×
O S˜ 5.6 10−16 R S˜ 0 A S˜ 4.4 10−16
1 1 1 1 1 2
→ × → → ×
A S˜ 2.2 10−59 O S˜ 1.8 10−35 R S˜ 0
2 2 2 2 2 2
→ × → × →
A M˜ 4.5 10−9 L M˜ 1.8 10−9 L M˜ 2.7 10−7
1 in out
→ × → × → ×
H M˜ 3.4 10−15 O M˜ 1.1 10−16 R M˜ 0
M M
→ × → × →
Table 6: Results of the validation procedure for the edges of the standard-configuration graph of the wind tunnel
(Fig. 3c). For each edge, we show the p-value resulting from the Kolmogorov-Smirnov [52] test computed in step
5 of the procedure. The computed p-values are all below 1.8 10−5, except for the one corresponding to the edge
L P˜ (0.082). The data to validate this edge was collect× ed during a windy day (16.4.2024 in Zurich), and the
out int
→
effectontheintakebarometer(afewpascals)wassmallcomparedtothelargefluctuations(100pascals)intheambient
atmosphericpressure. Whenusingamorepowerfulrank-sumtest[53]),weobtainedap-valueof0.029. Wewillrepeat
theexperimentwithalongerrunningtime(largerN)oronadaywithfewerfluctuationsintheatmosphericpressure.
The experimental data, together with the interventions xA,xB, waiting time T and sample size N for each edge can
be found in the wt_validate_v1 dataset at causalchamber.org.
36Edge p-value Edge p-value Edge p-value Edge p-value
θ ˜Im 2 10−13 θ ˜Im 1.6 10−14 R ˜Im 2.3 10−14 G ˜Im 1.6 10−14
1 2
→ × → × → × → ×
B ˜Im 1.8 10−14 T ˜Im 2.9 10−14 Ap ˜Im 2.3 10−14 ISO ˜Im 4.2 10−14
Im
→ × → × → × → ×
Table 7: Results of the validation procedure for the additional edges in the “camera” graph of the light tunnel
(Fig. 3b). For each edge, we show the p-value resulting from the Kolmogorov-Smirnov [52] test computed in step 5 of
the procedure. All p-values are below 10−12. For the image variable˜Im, the test is performed on the average of pixel
values. The experimental data, together with the interventions xA,xB, waiting time T and sample size N for each
edge can be found in the lt_camera_validate_v1 dataset at causalchamber.org.
Edge p-value
P˜ L 2.3 10−14
dw in
→ ×
P˜ L 2.3 10−14
dw out
→ ×
Table8: Resultsofthevalidationprocedurefortheadditionaledgesofthe“pressure-control”graphofthewindtunnel
(Fig. 3d). For each edge, we show the p-value resulting from the Kolmogorov-Smirnov [52] test computed in step 5 of
the procedure. The experimental data, together with the interventions xA,xB, waiting time T and sample size N for
each edge can be found in the wt_pc_validate_v1 dataset at causalchamber.org.
37Appendix VI
Component Datasheets
Component Chamber Description and datasheets
light source wt/lt The light source of the light tunnel.
- LED array: datasheets/light_source.pdf
- Individual LED (e.g. for wavelengths): datasheets/light_source_led.pdf
current sensor wt/lt Current sensor for the light source and fans. datasheets/current_sensor.pdf
motor wt/lt The stepper motors to control the polarizers and the hatch.
- Motor: Model 17HS8401 in datasheet datasheets/motor.pdf
- A4988 motor driver: datasheets/motor_driver.pdf
angle sensor lt The rotary potentiometer used to measure the polarizer angle. Model 3590S-6-502L in
datasheet datasheets/angle_sensor.pdf
light sensor lt The light-intensity sensor of the light tunnel. Model Si1151-AB00-GMR in datasheet
datasheets/light_sensor.pdf
led lt The LEDs placed by each light sensor in the light tunnel.
- LEDs: datasheets/led.pdf
- Digital rheostats: model MCP4151 in datasheets/potentiometer.pdf
camera lt The light-tunnel camera, a Sony α6100: datasheets/camera.pdf
arduino wt/lt The control computer used in the chambers, i.e., an Arduino Mega Rev3: datasheets/
arduino_mega.pdf
fan wt The wind tunnel fans:
- Fan specifications: datasheets/fan.pdf
- Speed control white paper: datasheets/fan_pwm.pdf
- Specifications of a similar motor: datasheets/fan_motor.pdf
barometer wt The high precision barometers used in the wind tunnel: datasheets/barometer.pdf
potentiometer wt Digital potentiometer used to regulate amplitude in the amplification circuit of the wind
tunnel. It is the same component as the rheostats of the light tunnel, i.e., model MCP4151
in datasheets/potentiometer.pdf
microphone wt The wind tunnel microphone consists of an electret microphone with the LM385-DIP8 am-
plifier in datasheets/microphone_amplifier.pdf
speaker wt The wind-tunnel speaker.
- Amplifier: model LM386-D08-T in datasheets/speaker_amplifier.pdf
- Speaker: datasheets/speaker.pdf
Table 9: Physical components of the chambers and their related datasheets. The datasheets can be found at github.
com/juangamella/causal-chamber/.
38