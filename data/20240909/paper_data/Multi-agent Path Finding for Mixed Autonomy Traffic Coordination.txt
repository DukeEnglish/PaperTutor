Multi-agent Path Finding for Mixed Autonomy Traffic Coordination
Han Zheng, Zhongxia Yan, Cathy Wu
Abstract—In the evolving landscape of urban mobility, the must interact with uncertain human drivers, reveals signifi-
prospective integration of Connected and Automated Vehicles cant limitations.
(CAVs) with Human-Driven Vehicles (HDVs) presents a com-
The core challenge addressed in this article lies in the
plex array of challenges and opportunities for autonomous
assumptionsofcompletecontroloveragentbehaviors,which
driving systems. While recent advancements in robotics have
yielded Multi-Agent Path Finding (MAPF) algorithms tai- does not hold in road traffic scenarios involving HDVs. We
lored for agent coordination task characterized by simplified thereby introduce a novel algorithm called Behavior Predic-
kinematics and complete control over agent behaviors, these tion Kinematic Priority Based Search (BK-PBS) with two
solutions are inapplicable in mixed-traffic environments where
purposes:1)predictthefuturebehaviorofHDVsandenable
uncontrollable HDVs must coexist and interact with CAVs.
CAVs to avoid collisions with HDVs, 2) indirectly control
Addressing this gap, we propose the Behavior Prediction
Kinematic Priority Based Search (BK-PBS), which leverages and coordinate the behavior of HDVs through proactive
anoffline-trainedconditionalpredictionmodeltoforecastHDV interactions between CAVs and HDVs. The original Priority
responses to CAV maneuvers, integrating these insights into a BasedSearch(PBS)algorithm[1]plansindependentshortest
PriorityBasedSearch(PBS)wheretheA*searchproceedsover
paths for all agents, then resolves conflicts by searching
motion primitives to accommodate kinematic constraints. We
overassignmentsofagentprioritiesandreplanningagentsto
compare BK-PBS with CAV planning algorithms derived by
rule-based car-following models, and reinforcement learning. avoid conflicts with higher-priority agents. In BK-PBS, we
Through comprehensive simulation on a highway merging enhance this approach by first training an offline conditional
scenario across diverse scenarios of CAV penetration rate and prediction model that forecasts HDV reactions to CAV ma-
trafficdensity,BK-PBSoutperformsthesebaselinesinreducing
neuvers.ThismodelistheninvokedwhenaCAVisassigned
collision rates and enhancing system-level travel delay. Our
ahigherprioritythananHDV,allowingPBStoreasonabout
work is directly applicable to many scenarios of multi-human
multi-robot coordination. forecasted HDV trajectories conditioned on nearby CAVs’
trajectories. This method fosters a proactive coordination
I. INTRODUCTION
strategy between CAVs and HDVs, moving beyond the
The rapid advancements in the field of autonomous vehi- reactive coordination of treating HDVs as obstacles.
cles and intelligent transportation systems herald a future
To replan CAVs within BK-PBS, our low-level A* search
where Connected and Automated Vehicles (CAVs) could
utilizes motion primitives to accommodate kinematic con-
become an integral part of our urban landscapes. This in-
straints characterizing the realistic motion of CAVs. We
tegration promises to significantly enhance traffic efficiency,
demonstrate the effectiveness of BK-PBS in a simulated
reducecongestion,andimproveoverallroadsafety.However,
mixed-traffic scenario where CAVs and HDVs drive along
the transition towards fully automated traffic systems is
a highway with merging lanes. Experimental result shows
fraught with challenges, particularly due to the necessity
that BK-PBS outperforms baselines in reducing collision
for CAVs to coexist and interact seamlessly with Human-
rates and system-level travel delay under different CAVs
Driven Vehicles (HDVs) in mixed-traffic environments. The
penetration rate and traffic density.
unpredictable nature of human driving behavior introduces a
levelofcomplexitythatcurrentautonomousdrivingsystems II. RELATEDWORK
must adeptly navigate to ensure harmonious and safe traffic
flow. A. Mixed-traffic Coordination
Recent works in robotics, planning, and artificial intel- While numerous works have proposed coordination meth-
ligence have made significant strides in Multi-Agent Path odsforCAVsinvarioustrafficsettings[2],fewerworkshave
Finding (MAPF) algorithms, which are designed to opti- studied mixed autonomy settings where CAVs must coexist
mize multi-agent coordination. These algorithms have been withHDVsinthesametrafficsystem.Previousmodel-based
instrumental in solving the coordination problems in various optimal control methods for mixed autonomy typically de-
domains, including warehouse automation, drone swarms, sign algorithms for smoother car-following, platooning, and
andfull-autonomytrafficcoordination.However,theirappli- other relatively simple behaviors [3], [4]. Other works have
cationinmixed-trafficscenarios,whereautonomoussystems leveraged model-free reinforcement learning (RL) [5], [6]
to automatically discover high-performing control policies
This work was supported by the National Science Foundation (NSF)
CAREERaward2239566andtheMITAmazonScienceHub. for a variety of traffic scenarios, though without explicit
Han Zheng, Zhongxia Yan and Cathy Wu are with the Laboratory collisionprevention.Nevertheless, wearethefirstto studya
for Information & Decision Systems (LIDS), Massachusetts Institute of
search-based planning method for mixed autonomy, and we
Technology,Cambridge,MA02139,USA.Email:{hanzheng,zxyan,
cathywu}@mit.edu additionally incorporate behavior prediction of surrounding
4202
peS
5
]OR.sc[
1v18830.9042:viXra𝒋𝒉 𝒎𝒄
𝒊𝒄 Conflict 𝒎𝒄
𝒊𝒄 𝒏𝒄 Conflict
𝒋𝒉 𝒏𝒄
→𝝉(𝒏𝒄) 𝝉(𝒎𝒄)←
→𝝉(𝒊𝒄) 𝝉(𝒋𝒉)←
M-A*
𝒋𝒉≺𝒊𝒄 𝒊𝒄≺𝒋𝒉
M-A*
𝒎𝒄≺𝒏𝒄𝒏𝒄≺𝒎𝒄
M-A*
𝒃𝜽(.)
A* search with
motion
Learned prediction primitives
Current state of surrounding
vehicles of𝒋𝒉 model 𝒃𝜽(.)
Predicted HDV
GCN trajectory
+ Fully Lane Motion
Connected Change Primitives Goal
GCN Layers Decision positions
Planned trajectories of CAVs that have
higher priority than 𝒋𝒉 in the BK-PBS node
Fig.1:Mixedtrafficcoordination:1)TheleftportiondescribesacollisionbetweenaCAVic andaHDVjh.Toresolvethis
CAV-HDV collision, BK-PBS introduces priority between these two vehicles, and replan the CAV trajectory using M-A*
while re-predict the HDV trajectory using the conditional prediction model b . 2) The right portion describes a collision
θ
between a CAV mc and a CAV nc. To resolve this CAV-CAV collision, BK-PBS introduces priority between these two
vehicles, and replan each of the CAV trajectory using M-A*.
HDVs rather than assume their behavior is fully character- backtracking tree-search to resolve pairwise agent collisions
ized. by adding local constraints. Priority-based Search (PBS)
[1] is a scalable extension of CBS, albeit suboptimal and
B. Behavior Prediction
incomplete, which searches over global priorities between
Behavior and trajectory prediction constitutes a corner- conflicting agents rather than local constraints.
stone of research in the domain of autonomous driving, In continuous space, several works in multi-robot motion
offering substantial contributions to the understanding and planning [16], [17] have applied sampling based methods
anticipation of the movements of pedestrians and human- like probabilistic roadmaps [18] in conjunction with CBS or
operatedvehicles inthevicinity ofautonomous vehicles[7]. other discrete MAPF algorithms. to plan over settings with
This field has traditionally favored deep learning approaches continuous2Dspaceandtime.Alternatively,continuousset-
for forecasting future positions and actions [8]–[10]. tingsmaybediscretizedforapplicationofMAPFalgorithms
However, the scope of this paper diverges from the task [19].[20]proposesaMAPF-basedapproachforcoordination
of designing a deep learning model for behavior and tra- of CAVs in a full autonomy system, but no MAPF-based
jectory prediction based on extensive real-world datasets. approachhaseverbeendesignedformixedautonomytoour
Instead,ourresearchcentersontheintegrationofanexisting knowledge.
prediction model into the strategic planning processes of a
III. PROBLEMFORMULATION
fleet of autonomous vehicles operating within mixed traffic
A. MAPF Formulation of Highway Coordination
environments. Our primary interest lies in exploring the
synthesis of predictive insights with the dynamic decision- We formulate the highway coordination problem in the
making required for effective navigation and safety in sce- Multi-AgentPathFinding(MAPF)framework.Theclassical
narios where CAVs and HDVs coexist. MAPFprobleminvolvesk agentsandisdefinedbythetuple
⟨G,s,g⟩, where G=(V,E) represents an undirected graph.
C. Multi-agent Path Finding
In this context, s : [1,...,k] → V assigns each agent to
The classical multi-agent path finding (MAPF) problem a source position, while g : [1,...,k] → V assigns each
[11]isaNP-hard[12]problemwhichseekstofindtheshort- agent to a goal position. We focus on discrete time domain,
est collision-avoiding paths for a set of agents in a discrete with each agent occupying a position on the graph at any
graph.Sincethespaceofjointagenttrajectoriesisintractably given timestep and capable of performing one action that
large to consider [13], nearly all MAPF algorithms rely determines the next position node to transit to, per timestep.
on repeatedly calling a single-agent path planner such as Applying this framework to a mixed-traffic highway sce-
A* search [14] or SIPP [15], while holding paths of some nario, we represent each CAV agent in the scene as ic ∈C,
set of other agents as constraints. In particular, Conflict- and each HDV agent as ih ∈ H. In coordinating highway
based Search (CBS) [13] is a seminal algorithm which first traffic, our primary objective is to determine the control
plans independent shortest paths for all agents then relies on inputs for the CAVs; therefore, we only set goals for CAVagents.Weoperatewithinadiscrete-timeapproximationofa B. Kinematic Bicycle Model
continuous control task, and we solve the planning problem
We adopt the bicycle model [21] for the vehicle kinemat-
using motion primitives in a rolling horizon fashion.
ics,andthemotionprimitivestranslateintolow-levelbicycle
Let the position of a CAV agent at time t be x t(ic) ∈ kinematics. The bicycle model allows for a more accurate
R2, representing the source position. As CAVs are generally representation of real-world vehicle motion compared to
expected to drive forward or merge based on the control point-massmodelswhileremainingcomputationallyefficient
inputs, their goals are not restricted to a single position but for trajectory planning and control. Here, the pairs of front
rather to a set of positions. We then define the goal set at and rear wheels are each aggregated into a singular wheel
time t for a CAV agent as G t(ic). If the CAV is traveling along the midline of the vehicle. The control inputs are
on the main road, its goal set G t(ic) comprises positions accelerationaandfrontwheelsteeringangleδ.Thedistance
on its current and adjacent lanes that lie ahead at or farther from the center of gravity to front and rear wheels is half of
than distance d. Conversely, for a CAV on a merging lane, vehicle length ℓ . ψ denotes the heading. β denotes the slip
k
the goal set G t(ic) includes positions on any adjacent lane angle.
before the merging zone ends.
In the classical MAPF context, actions are determined
by a function u : V → V, where u(v) = v′ indicates x˙ x =vcos(ψ+β) x˙ y =vsin(ψ+β) v˙ =a
(cid:18) (cid:19)
that an agent at position v will move to position v′ in the ψ˙ = vcos(β) tan(δ) β =tan−1 tanδ
following timestep. In our highway coordination task, we ℓ 2
k
introduce motion primitives as actions to address the contin- (2)
uous control challenge. These motion primitives encompass
predefined high-level maneuvers such as acceleration and
IV. METHOD
lanechanging.Foranactionuc ∈Ucdrawnfromthemotion For coordinating mixed-traffic, we take insight from a
primitive library, a CAV agent progresses to the subsequent MAPF algorithm called Priority Based Search (PBS) and
position in accordance with a transition model fc. The incorporateanofflinelearnedpredictionmodeltopredictand
transitionbetweenCAVpositionsisexpressedasx (ic)= revise the future behavior of HDVs in the PBS planning of
t+1
fc(x (ic),uc). The movement of a HDV is not controlled CAV trajectories. To accommodate the constraints imposed
t
by our planning algorithm but in react to its surrounding by the vehicle kinematic model, a multi-phase A* search
vehicles. It follows x (jh) = fh(x (jh),S (jh)), where searches on a discrete state graph where the edges are
t+1 t t
fh is the HDV transition model and S (jh) is the collection represented by motion primitives. We name our proposed
t
of vehicles states (position, velocity and acceleration) of method as Behavior Prediction Kinematic Priority Based
vehicles in the vicinity of HDV jh. Search (BK-PBS), which is sketched in Algorithm 1.
WedenotethesequenceofCAVactionshc =[uc,...,uc]
i 0 T A. Multi-phase A* with Motion Primitives
within a control horizon T pertaining to CAV agent ic as a
In the context of classical MAPF, system dynamics are
plan, and we define the trajectory sequence associated with
often reduced to simplified point-mass agents, with low-
thisplanasτ(ic)=[x (ic),...,x (ic)].Asolutiontothe
1 T+1
level path-finding such as A* search conducted in a grid-
problem is thus defined as a collection of |C| single-agent
basedworlddevoidofkinematicconstraints.Forthehighway
CAV plans, one for each CAV, ensuring that all CAVs reach
coordination problem, we aim to construct a continuous
their respective goals from their sources without colliding
trajectory for each CAV from its starting point to its des-
with any other vehicles on road.
tination,incompliantwiththevehiclekinematicsdetailedin
The collision free constraints can be represent as ∀t ∈
the referenced bicycle model, while avoiding collisions with
{1,...,T + 1},∀j ∈ H ∪ {C/ic},B (ic) ∩ B (j) = ∅,
t t other vehicles.
where B (·) denotes the bounding box of a vehicle at time
t To address this, we present a method that combines
t. The center of a bounding box is the vehicle position.
kinematicconstraintswithA*search—Multi-phaseA*with
Beside the collision-free constraint, we also aim to facili- MotionPrimitives(M-A*).LeticbetheCAVunderplanning
tate smooth merging and enhance the highway’s throughput. associated with a BK-PBS node N. This method performs
This objective can be represented as minimizing the total
the A* search on a graph where each node represents the
travel delay cost positionofic,andeachedgerepresentsamotionprimitive—
aviablemaneuverthatconformstothekinematicconstraints
(cid:88)
J = [tf −t∗] (1) outlined by the bicycle model. Trajectories of vehicles other
i i
i∈H∪C than the CAV under planning are integrated into the graph
as dynamic obstacles constraints.
where t∗ is the minimal time that vehicle i arrives at the Each motion primitive delineates a possible segment of
i
end of the highway section, and tf is the actual arrival time τ(ic), distinguished by particular steering and velocity pro-
i
afterplanning.Thefree-flowtraveltimet∗ canbecomputed files.Givenatargetpositionofic,theA*algorithmsearches
under the assumption that the vehicle accelerates and travels for the sequence of primitives that leads to the lowest
at maximum speed ignoring other on-road vehicles. cost, collision-free trajectory from the current state to thetarget. The motion primitive library includes the following a depth-first traversal of a Priority Tree (PT). Let i ≺ j
maneuvers: 1) accelerate, 2) decelerate, 3) idle, 4) lane denotes that vehicle i has priority over vehicle j. Each node
change left, 5) lane change right, and 6) emergency braking. N encompassesapriorityorderingamongvehiclepairs(i,j)
For the feasibility of low-level planning, we enhance the throughthepriorityorder≺ associatedwithnodeN,along
N
A* search with a tiered planning approach. In the initial withasetofminimum-costtrajectoriesthatcomplywiththis
planning phase, A* search endeavors to locate the lowest- priority ordering, ensuring no collision between any vehicle
cost, collision-free path from the current location of ic trajectoryunderthegivenpriorityconstraints.Givenanagent
to its goal location within a specified search budget. The i,wedenotethesetofagentsthathashigherorlowerpriority
searchbiasestowardsforwardmovement,withalargershare than i in node N as {≺ i} or {≻ i}, respectively. The
N N
of the budget dedicated to acceleration and lane-changing objectiveofminimizingtotaltraveldelaycostJ isequivalent
primitives. If the initial search does not yield a valid path, to maximize the overall travel speed.
a secondary search is conducted that biases towards safe The root node of the PT contains no predefined priorities
deceleration. We restrict the primitive library to exclude the (line2)andthesetofindependentminimum-costtrajectories
acceleration and idle maneuvers. For CAVs driving on the forallvehicles(line3-7).ForaCAV,therootnodetrajectory
mainroad,wereviseitsgoaltocloserpositionsonitscurrent is found using M-A* without considering the trajectory
and adjacent lanes that lie ahead at distance d′, which is of other vehicles as dynamic obstacle constraints; while a
smaller than the original goal distance d. We also adjust the HDVs, the root node trajectory is predicted by b without
θ
budget’s distribution, favoring deceleration and emergency considering any CAV actions.
braking.Subsequently,asecondphaseofsearchcommences
When the search arrives at a node N in the PT, if
to determine a more conservative, collision-free trajectory.
no collision are detected among vehicles, N is identified
B. Conditional Prediction Model as a goal node in the high-level search (differing from
the goal locations described in III). We assume that two
In this study, we address the challenge of coordinating a
HDVs are capable of avoiding collisions with one another
mixed traffic system comprising both HDVs, which exhibit
through natural coordination, thus eliminating the need for
uncertainanduncontrollablebehavior,andCAVs.Theuncer-
branching in conflicts involving solely HDVs. If a collision
taintyofHDVscomplicatestheapplicationofPBSfortraffic
arises between a CAV i and any vehicle j (line 14), BK-
planning. Specifically, if a CAV cannot anticipate an HDV’s
PBS branches N into two new child nodes, respectively
future movements, planning a collision-free trajectory for
introducing new priority constraints i ≺ j and j ≺ i to the
the CAV becomes infeasible. A potential solution involves
child nodes (line 17). The left section of Fig.1 illustrates the
predictingthetrajectoriesofHDVsinadvance,treatingthem
branching of a CAV-HDV collision, while the right section
as dynamic obstacles in the CAVs’ path, and utilizing PBS
shows the branching of a CAV-CAV collision. Within each
to navigate CAVs around HDVs. This approach, which we
of the newly generated child nodes, a replanning process
refertoasreactivecoordination,inherentlyprioritizesHDVs
is invoked to resolve collisions according to the priority
withinthePBSframework,compellingCAVstoadjustbased
ordering (line 18). Within the replanning, BK-PBS first
on HDV actions. However, our objective is to establish a
conducts a topological sort to arrange the vehicle indices
proactive coordination strategy, wherein HDV behavior is
in accordance with the priority ordering (line 24). It then
also influenced by CAV movements. This is achieved by
plans a conflict-free minimum-cost trajectory for each agent
branching over the priority order between CAVs and HDVs
subject to the trajectories of all agents with higher priority.
in conflict situations within PBS. Nonetheless, the challenge
arisesinsituationswhereanHDVisassignedalowerpriority For a CAV-HDV collision, assigning a higher priority to
than a CAV, as the HDV’s trajectory cannot be directly an HDV results in adding the predicted HDV trajectory as
controlled or replanned. a constraint in the CAV’s low-level planning via the M-
A* (line 28). Conversely, if a lower priority is assigned to
Toaddressthisissue,weintroduceaconditionalprediction
model, denoted as b , designed to predict the future actions an HDV, b θ is invoked to re-predict the HDV’s trajectory,
θ
conditioned on the CAV’s planned trajectory (line 31). It is
of HDVs based on potential CAV maneuvers. This model
important to note that within the BK-PBS update plan, the
enables us to plan for CAV movements in such a way
inputforb includesthetrajectoriesofallCAVswithhigher
that avoids collisions with HDVs, taking into account the θ
priority, ensuring the preservation of established priority
predicted responses of HDVs to CAV actions. Essentially,
orders. For a CAV-CAV collision, we use M-A* (line 28) to
this model allows for the adjustment of HDV priorities and
findthethetrajectoryforeachCAVsubjecttotheconstraints
the subsequent reevaluation of their trajectories in light of
induced by the new priority order.
CAV movements, facilitating proactive coordination.
WeillustratePBS’sbranchingbetweenaCAVandaHDV Achildnodeisprunedifforsomeagent,notrajectorycan
in the left part of Fig.1. befoundtoavoidconflictwithallhigher-priorityagents(line
32). If no viable child node emerges from an expanded N,
C. Mixed-traffic Priority Based Planning
BK-PBS backtracks to the parent node. If two child nodes
BK-PBS is a centralized planning algorithm that deter- emergefromanexpandedN,thechildnodewithlowersum
mines actions for all CAVs at once. Like PBS, BK-PBS is of cost will be searched first.Algorithm1:BK-PBSformixedtrafficcoordination velocitiesoftheleadingandfollowingvehiclesonitscurrent
andadjacentlane,denotedaso(jh).Thisgraphfeedsdirectly
1 Function BK-PBS(C,H,≺ 0, b θ):
into a GCN block. For the second input, we select CAVs
2 ≺ root←≺ 0; Root.plan←∅;
that have higher priority than jh at current planning step,
3 for i∈C∪H do
and encode their planned trajectories to a graph sequence
4 success←UpdatePlan(Root,i,b θ);
denoted as {τ(p)|p≺ jh, p∈C} (line 31). Each graphs
5 if not success then N
within this sequence has the future positions and velocities
6 return “No Solution”;
(cid:80) of CAVs that have higher priority than jh as node features.
7 Root.cost←− vehicle speeds in Root.plan;
A second GCN block processes each graph in the sequence,
8 STACK ←{Root};
employingsharedweightsandaveragingtheoutcomesacross
9 while STACK ̸=∅ do
the sequence’s temporal dimension. We assume that each
10 N ← top node in STACK;
graph is fully connected.
11 STACK ←STACK\{N};
Previous research suggests that the longitudinal behavior
12 if N.plan has no collision then
of highway drivers is relatively straightforward to predict
13 return N.plan;
[23]. Consequently, we posit that an HDV will sustain
14 C ← first pair of CAV-involved collision
its current speed for a foreseeable interval, focusing our
(i,j) in N.plan;
predictive efforts on the vehicle’s lateral movements. The
15 for i in C do
16 N′ ←N ; combined GCN outputs are then channeled through two
fully-connected layers, culminating in a sigmoid layer that
17 ≺ N′←≺ N ∪ {j ≺i};
18 success←UpdatePlan(N′,i,b θ); computes the probability of the lane change decision of jh
at next timestep. The outcome is a sequence of future lane
19 if success then
20 Add N′ into STACK in change decision for jh, which is combined with the library
non-increasing order of N′.cost; ofmotionprimitivestogeneratethecorrespondingtrajectory
prediction τ(jh).
21 return “No Solution”;
22
23 Function UpdatePlan(N,i,b θ):
24 L← topological ordering set {i}∪{≻ N i};
25 for q ∈L do Fig. 2: Highway Simulator: CAVs are colored in green and
26 if q =i or ∃k ∈{≺ N i} that q collide with k HDVs are colored in blue
in N.plan then
27 if q ∈C then
28 τ(q)←M-A*({τ(p)|p≺ N q}); V. EXPERIMENTALSETUP
29 else A. Simulation Environment
30 o(q)← surrounding vehicle states;
We modify HighwayEnv [24] to simulate the system with
31 predict the trajectory τ(q)←
discretization dt = 0.2s for H = 400 timesteps. Fig. 2
b (o(q),{τ(p)|p≺ q, p∈C})
θ N
32 if no τ(q) is returned by M-A* or illustratesthelayoutofthehighwaysection.Thepenetration
predicted τ(q) still lead to collision then
rateofCAVsisdenotedasα.Thehighwaysectionhaslength
l = 460, with each lane has width w = 4.5m and the
33 return false; lane
34 update τ(q) in N.plan; merging zone length l m =180m.
35 return true; We set arrival rate λ veh/hr with initial speed sampled
from a uniform distribution v ∼ U(25,35) m/s. The CAV
0
penetration rate α is defined as the ratio of populated CAVs
to the total number of populated vehicles. Each vehicle has
D. Neural Network-based Conditional Prediction Model
length ℓ = 5m and width 2m. Vehicles collide when their
k
We parameterize b using neural networks. The architec- boundingboxesoverlap.Crashedvehiclesareremovedfrom
θ
ture of this model is illustrated in the lower-left portion of the scene after a collision happens. The speed limit on the
Fig.1. Our approach utilizes Graph Convolutional Networks highway is set as v = 35m/s. The longitudinal behavior
max
(GCNs) [22] to represent the inter-vehicle dependencies. of HDVs is governed by the IDM [25] while the lateral
Let jh be the HDV under prediction associated with a behavior is governed by MOBIL model [26]. We use the
BK-PBS node N. The model’s input is bifurcated: the first default parameters from [24] for the HDV driver models,
input comprises the current observation of the leading and except the target speed of IDM is sampled uniformly from
trailingvehiclesinagentjh’slaneandtheadjacentones.The 25 m/s to 35 m/s.
subsequent input includes the planned trajectories of CAVs For a HDV driving on the ramp, its lateral behavior
with higher priority than jh, within a preview horizon pc. is governed by the stochastic merging model from [27],
These inputs are structured as graphs; specifically, the first which shapes the probability of taking the merge action in
input forms a graph whose nodes featurize the positions and proportional to the distance to the end of the merging zone.BK-M-A* IDM+MOBIL RL-PPO BK-PBS
0.250
0.8 0.184 0.166 0.8 0.087 0.111 0.8 0.229 0.256 0.8 0.089 0.137
0.225
0.7 0.158 0.199 0.7 0.126 0.144 0.7 0.188 0.215 0.7 0.066 0.141 0.200
0.175
0.6 0.115 0.177 0.6 0.119 0.142 0.6 0.166 0.221 0.6 0.057 0.116 0.150
0.125
0.5 0.105 0.156 0.5 0.097 0.143 0.5 0.170 0.224 0.5 0.073 0.144
0.100
0.075
0.4 0.082 0.145 0.4 0.116 0.165 0.4 0.132 0.185 0.4 0.052 0.115
2500 3000 2500 3000 2500 3000 2500 3000
Arrival Rate (veh/hr) Arrival Rate (veh/hr) Arrival Rate (veh/hr) Arrival Rate (veh/hr)
Fig. 3: Controllable collision rate under different vehicle arrival rates and CAV penetration rates
B. Prediction Model between vehicles. For M-A* used in both BK-PBS and BK-
M-A*,accordingtoIII-AandIV-A,forCAVsdrivingonthe
WetrainthepredictionmodelusedinBK-PBSandBK-M-
main road, we set the goal distance in the first phase of A*
A* using supervised learning. For data collection, we run a
planning as d=70 m, while the revised goal distance in the
rolloutpolicyforCAVcontrolandrecordthestatesofevery
second phase of A* planning as d′ =30 m.
CAV and HDV at every simulation step. We post-process
IDM+MOBILutilizestherule-basedcar-followingmodels
the data to match the input-output pairs for the prediction
[25],[26]forCAVplanning.Wechooseitsparameterssame
network described in IV-D, resulting a dataset which has
as the parameters of the HDV driver model, expect that the
30K training samples in total.
The output from all hidden layers in the GCN and fully target speed of IDM for CAV is set as 35 m/s.
connected layers has size 64, expect for the last fully Reinforcement learning is a commonly used approach to
connected layers which outputs a single value to the sigmod coordinate CAV in a highway driving scenario. RL-PPO
functiontodeterminetheprobabilityforlanechangedecision uses Proximal Policy Optimization [29] to offline train a
of a HDV. For the prediction network used in BK-M-A*, control policy for a CAV to select the motion primitives.
we do not include the planned trajectories of CAVs as TheRLagentistrainedinasingleCAVenvironmentwitha
conditional input, since there is no priority order among reward function of maintaining a target speed and avoiding
vehicleswhenplanningunderBK-M-A*.Wetrainthemodel collision with up to 14 surrounding HDVs. The policy and
for 1000 epochs using Adam Optimizer [28] with learning value function networks both have two layers and hidden
ratelr =0.001andbatchsizeas64.Thetrainingisperform dimensions of 256. We run training with a learning rate of
on a desktop with a single RTX 3090 Ti GPU, and the total 0.001, discount factor of 0.95, batch size of 512, and 10
training time is around 4 hours. epochs per gradient update for 1e8 total environment steps
Note that the model is trained using data collected from (around1dayon48CPUcores).Aftertraining,weinference
environmentsettingwithcertainvehiclearrivalrateandCAV the policy in a multi-agent environment described in V-A.
penetration rate, while deployed in different environment The trained policy is applied to each CAV independently
settings. with weights sharing.
We run all the planning algorithms in a rolling-horizon
C. Planning Algorithms fashion, where the planning frequency is 5 Hz. After each
We compare BK-PBS with three baselines: BK-A*, planning round, we take the first n primitives from the each
IDM+MOBIL and RL-PPO. planned primitive sequence of a CAV. In all experiments, n
BK-M-A* is a decentralized planning algorithm that de- is set to 1.
terminesthetrajectoryofeachCAVindependentlyusingM- For robustness study we sweep α from 0.4 to 0.8 in
A*. In BK-M-A*, a CAV under planning sees its surround- both low density (λ = 2500 veh/hr) and high density (λ =
ing vehicles as dynamics obstacles, whose trajectories are 3000 veh/hr) traffic. We test each planning algorithm on 5
predicted using a learned prediction model and encoded as environment seeds in all settings and average the results.
dynamic obstacle constraints into the M-A* planning of that We track the number of crashed vehicles and travel delay
CAV.ComparedtoBK-PBS,BK-M-A*doesnothaveahigh- of every vehicle that successfully arrives at the end of the
level planning procedure to resolve the collision conflicts highway section without collision.
etaR
noitarteneP
etaR
noitarteneP
etaR
noitarteneP
etaR
noitartenePVI. EXPERIMENTALRESULTS escalate with increasing vehicle arrival rates, suggesting
that RL-PPO struggles to maintain safety in denser traffic
A. Evaluation of Prediction Model
conditions. IDM+MOBIL appears to fare better, with its
We conduct an offline evaluation of the trained prediction
heat map exhibiting consistently lighter shades. It exhibits
model b , using a dataset procured in a same manner to the
θ a lesser dependency on arrival rate changes, which implies
training dataset. As detailed in IV-D, this model predicts the
the robustness of these rule-based driver models in diverse
lane-changing decisions of HDV with binary outcomes: 1
traffic densities. We found collision rates with BK-PBS tend
signifies executing a lane change, while 0 indicates main-
to rise alongside arrival rates, and such trend can also be
taining the current lane. Due to the different lateral driver
found with BK-M-A*.
model for HDV on ramps versus main roads, we partition
BK-M-A* shows intermediate performance but demon-
the evaluation dataset into two subsets. One subset contains
strates elevated collision rates under all settings compared
samples exclusively from ramps while the other contains
to BK-PBS, which is due to the fact that BK-M-A* does
samples solely from main roads, allowing us to assess the
not resolve conflicts between vehicles while a CAV-CAV
model’s performance in predicting lane-changing decisions
conflict can be effectively solved by BK-PBS, resulting in
governed by different lateral driver models.
less collisions between two CAVs. This explanation can be
Each subset comprises 4000 samples, and we present the
validatedbyobservingthatthecollisionratewithBK-M-A*
evaluationoutcomesinTable.IforrampdataandTable.IIfor
grows quickly as penetration rate increases.
main road data.
One interesting observation is that at high traffic densities
(λ=3000veh/hr),IDM+MOBILoccasionallyrecordsfewer
TABLE I: Lane-change prediction on the ramp
collisions compared to BK-PBS. This could be because,
accuracy=92.6% PredictedNo PredictedYes in heavy traffic, the MOBIL model restricts frequent lane
changes due to the presence of vehicles in adjacent lanes
ActualNo 2469 88
ActualYes 205 1238 mostofthetime.Incontrast,BK-PBSconsistentlyseeksthe
shortest path to the destination, resulting in more frequent
lane shifts and side collisions.
TABLE II: Lane-change prediction on the main road
C. Travel Delay
accuracy=94.1% PredictedNo PredictedYes Wecomputetheaveragedelayofvehiclesthatsuccessfully
arrives at the end of the highway section without collision
ActualNo 3237 57
ActualYes 181 525 according to Eq.1 and report it in Table.III and Table.IV.
TABLE III: Average delay (sec) at λ=2500 veh/hr
We find the trained model b attains high accuracy in
θ
overall lane change prediction. However, a marked disparity
α 0.4 0.5 0.6 0.7 0.8
isevidentbetweentheratiooftruenegativestotruepositives
BK-M-A* 6.24 5.79 5.63 5.50 5.67
in predictions of lane-changing on main roads compared IDM+MOBIL 5.82 6.05 5.72 5.83 5.59
to ramps. This discrepancy suggests that the model’s pro- RL-PPO 7.19 7.54 7.43 7.30 7.09
BK-PBS 6.51 6.31 5.61 5.45 5.51
ficiency in predicting HDV lane changes on main roads is
somewhat limited, a focal point that may necessitate further
model refinement to enhance predictive accuracy.
TABLE IV: Average delay (sec) at λ=3000 veh/hr
B. Controllable Collision Rate
α 0.4 0.5 0.6 0.7 0.8
After each simulation episode, we compute the collision
BK-M-A* 6.81 6.60 5.78 6.03 6.01
rate as the ratio between the crashed vehicles and total
IDM+MOBIL 7.46 7.72 7.19 7.16 7.98
number of vehicles that inserted to the scene. Note that a RL-PPO 8.11 8.13 8.09 7.74 7.56
HDV can crashed into another HDV during simulation (this BK-PBS 7.02 6.50 6.06 5.77 5.80
happens naturally within our simulator), which is out of the
algorithm’s control; thus we only focus on collisions that While an satisfying outcome would be for BK-PBS to
have a CAV involved, and we named the resulting collision facilitate smoother traffic flow and yield the lowest travel
rate as the controllable collision rate. delay relative to the three benchmark algorithms, it appears
We report the controllable collision rate in Fig.3. A that under certain conditions, BK-M-A* and IDM+MOBIL
visual inspection reveals that the proposed method BK-PBS exhibit the lowest travel delays.
achieves relatively low collision rate overall, as indicated by This result may seem misleading, as in scenarios where
the predominance of lighter shades. As mentioned in V-C, a baseline surpasses BK-PBS in travel delay, it concur-
thevaluesshownareaveragedover5randomseedsforeach rentlyincursasubstantiallyhighercollisionrate,asdepicted
scenario setting. in Fig.3. During simulation, crashed vehicles are removed
RL-PPO exhibits the highest collision rates across all from the scene after a collision happens. This leads to
penetration and arrival rates. Notably, its collision rates less congested traffic conditions and, consequently, enablingremaining vehicles to accelerate, which artificially reduces [7] S.Mozaffari,O.Y.Al-Jarrah,M.Dianati,P.Jennings,andA.Mouza-
travel delay. kitis, “Deep learning-based vehicle behavior prediction for au-
tonomous driving applications: A review,” IEEE Transactions on
A more equitable method of comparison would consider
IntelligentTransportationSystems,vol.23,no.1,pp.33–47,2022.
traveldelaysatcomparablecollisionrates.Whenspecifically [8] H. Zhao, J. Gao, T. Lan, C. Sun, B. Sapp, B. Varadarajan, Y. Shen,
comparing IDM+MOBIL and BK-PBS at an arrival rate Y. Shen, Y. Chai, C. Schmid, C. Li, and D. Anguelov, “Tnt: Target-
driven trajectory prediction,” in Proceedings of the 2020 Conference
of λ = 3000 veh/hr and accounting for similar collision
onRobotLearning(J.Kober,F.Ramos,andC.Tomlin,eds.),vol.155
rates,itbecomesevidentthatBK-PBSexcelsindensetraffic ofProceedingsofMachineLearningResearch,pp.895–904,PMLR,
conditions. We observe that BK-PBS significantly reduces 16–18Nov2021.
[9] B. Ivanovic and M. Pavone, “The trajectron: Probabilistic multi-
total travel delay by 15%-20% compared to IDM+MOBIL
agenttrajectorymodelingwithdynamicspatiotemporalgraphs,”2019
in dense traffic, reaffirming its effectiveness in smoothing IEEE/CVF International Conference on Computer Vision (ICCV),
traffic flow. pp.2375–2384,2018.
[10] A. Gupta, J. Johnson, L. Fei-Fei, S. Savarese, and A. Alahi, “Social
gan: Socially acceptable trajectories with generative adversarial net-
VII. CONCLUSIONSANDFUTUREWORK
works,” in Proceedings of the IEEE Conference on Computer Vision
andPatternRecognition(CVPR),June2018.
This paper presents the Behavior Prediction Kinematic
[11] R. Stern, N. R. Sturtevant, A. Felner, S. Koenig, H. Ma, T. T.
Priority Based Search (BK-PBS), a novel framework that Walker, J. Li, D. Atzmon, L. Cohen, T. S. Kumar, et al., “Multi-
utilizes an offline-trained conditional prediction model for agent pathfinding: Definitions, variants, and benchmarks,” in Twelfth
AnnualSymposiumonCombinatorialSearch,2019.
forecasting the reactions of HDVs to CAV actions. This
[12] J. Yu and S. LaValle, “Structure and intractability of optimal multi-
prediction model is adeptly integrated into Priority Based robotpathplanningongraphs,”inProceedingsoftheAAAIConference
Search (PBS), which employing a low-level multi-phase A* onArtificialIntelligence,vol.27,pp.1443–1449,2013.
[13] G.Sharon,R.Stern,A.Felner,andN.R.Sturtevant,“Conflict-based
search with motion primitives that respect kinematic con-
search for optimal multi-agent pathfinding,” Artificial Intelligence,
straints.Insimulatedhighwaymergingscenarioswithvaried vol.219,pp.40–66,2015.
traffic densities and AV penetrations, BK-PBS outperformed [14] P. E. Hart, N. J. Nilsson, and B. Raphael, “A formal basis for the
heuristicdeterminationofminimumcostpaths,”IEEEtransactionson
existing rule-based and RL algorithms, reducing collisions
SystemsScienceandCybernetics,vol.4,no.2,pp.100–107,1968.
and travel delays. This method holds promise for improving [15] M.PhillipsandM.Likhachev,“Sipp:Safeintervalpathplanningfor
thecoordinationbetweenhumansandrobotsinmixed-traffic dynamic environments,” in 2011 IEEE International Conference on
RoboticsandAutomation,pp.5628–5635,IEEE,2011.
environments,forexample,cooperativenavigationofmobile
[16] J.Kottinger,S.Almagor,andM.Lahijanian,“Conflict-basedsearchfor
robots among crowds. multi-robot motion planning with kinodynamic constraints,” in 2022
We aim to evolve the BK-PBS framework further by IEEE/RSJInternationalConferenceonIntelligentRobotsandSystems
(IROS),pp.13494–13499,IEEE,2022.
integrating more sophisticated behavior prediction method-
[17] K.OkumuraandX.De´fago,“Quickmulti-robotmotionplanningby
ologies, enhancing safety measures with the implementation combining sampling and search,” International Joint Conference on
ofsafetyenvelopeslikecontrolbarrierfunctions,andextend- ArtificialIntelligence(IJCAI),2023.
[18] L.E.Kavraki,P.Svestka,J.-C.Latombe,andM.H.Overmars,“Prob-
ing its applicability to larger and more general networks.
abilisticroadmapsforpathplanninginhigh-dimensionalconfiguration
Additionally, since crashed vehicles are removed from the spaces,”IEEEtransactionsonRoboticsandAutomation,vol.12,no.4,
scene in our simulation, validating BK-PBS in physical pp.566–580,1996.
[19] W.Ho¨nig,J.A.Preiss,T.S.Kumar,G.S.Sukhatme,andN.Ayanian,
testbeds that account for replanning in response to chain
“Trajectory planning for quadrotor swarms,” IEEE Transactions on
reactions caused by crashes is a crucial next step. This will Robotics,vol.34,no.4,pp.856–869,2018.
bringusclosertorealizingitspotentialinreal-worldsystems. [20] Z.Yan,H.Zheng,andC.Wu,“Multi-agentpathfindingforcooper-
ativeautonomousdriving,”InternationalConferenceofRoboticsand
Automation,2024.
REFERENCES
[21] R. Rajamani, Vehicle dynamics and control. Springer Science &
BusinessMedia,2011.
[1] H.Ma,D.Harabor,P.J.Stuckey,J.Li,andS.Koenig,“Searchingwith
[22] T.N.KipfandM.Welling,“Semi-supervisedclassificationwithgraph
consistentprioritizationformulti-agentpathfinding,”inProceedings
convolutionalnetworks,”CoRR,vol.abs/1609.02907,2016.
oftheAAAIConferenceonArtificialIntelligence,vol.33,pp.7643–
[23] C. R. Munigety and T. V. Mathew, “Towards behavioral modeling
7650,2019.
of drivers in mixed traffic conditions,” Transportation in Developing
[2] J.Rios-TorresandA.A.Malikopoulos,“Asurveyonthecoordination
Economies,vol.2,no.6,2016.
of connected and automated vehicles at intersections and merging at
[24] E. Leurent, “An environment for autonomous driving decision-
highwayon-ramps,”IEEETransactionsonIntelligentTransportation
making.” https://github.com/eleurent/highway-env,
Systems,vol.18,no.5,pp.1066–1077,2016.
2018.
[3] K.Li,J.Wang,andY.Zheng,“Cooperativeformationofautonomous
[25] M.Treiber,A.Hennecke,andD.Helbing,“Congestedtrafficstatesin
vehiclesinmixedtrafficflow:Beyondplatooning,”IEEETransactions
empiricalobservationsandmicroscopicsimulations,”PhysicalReview
onIntelligentTransportationSystems,vol.23,no.9,pp.15951–15966,
E,vol.62,p.1805–1824,Aug.2000.
2022.
[26] A.Kesting,M.Treiber,andD.Helbing,“Generallane-changingmodel
[4] J. Wang, Y. Zheng, Q. Xu, J. Wang, and K. Li, “Controllability
mobil for car-following models,” Transportation Research Record,
analysis and optimal control of mixed traffic flow with human-
vol.1999,no.1,pp.86–94,2007.
driven and autonomous vehicles,” IEEE Transactions on Intelligent
[27] B.T.Lin,“Developmentofmachine-learningmodelsforautonomous
TransportationSystems,vol.22,no.12,pp.7445–7459,2021.
vehicledecisionsonweavingsectionsoffreewayramps,”finalreport,
[5] C.Wu,A.Kreidieh,K.Parvate,E.Vinitsky,andA.M.Bayen,“Flow:
2024.
A modular learning framework for mixed autonomy traffic,” IEEE
[28] D. P. Kingma and J. Ba, “Adam: A method for stochastic optimiza-
TransactionsonRobotics,2021.
tion,”CoRR,vol.abs/1412.6980,2014.
[6] Z.Yan,A.R.Kreidieh,E.Vinitsky,A.M.Bayen,andC.Wu,“Unified [29] J. Schulman, F. Wolski, P. Dhariwal, A. Radford, and O. Klimov,
automatic control of vehicular systems with reinforcement learning,” “Proximal policy optimization algorithms,” arXiv preprint
IEEETransactionsonAutomationScienceandEngineering,vol.20, arXiv:1707.06347,2017.
no.2,pp.789–804,2022.