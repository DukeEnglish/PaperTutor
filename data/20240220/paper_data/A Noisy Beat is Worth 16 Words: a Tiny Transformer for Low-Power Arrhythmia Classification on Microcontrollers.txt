1
A Noisy Beat is Worth 16 Words: a Tiny
Transformer for Low-Power Arrhythmia
Classification on Microcontrollers
Paola Busia, Matteo Antonio Scrugli, Victor Jean-Baptiste Jung, Luca Benini, Paolo Meloni
Abstract—Wearable systems for the long-term monitoring of Neural network-based classification has been successfully
cardiovascular diseases are becoming widespread and valuable exploited for arrhythmia recognition, reaching very high
assets in diagnosis and therapy. A promising approach for real-
accuracy levels exploiting Convolutional Neural Networks
time analysis of the electrocardiographic (ECG) signal and the
(CNNs) [3]. Even better results have been obtained recently
detectionofheartconditions,suchasarrhythmia,isrepresented
by the transformer machine learning model. Transformers are with the use of large-size transformers [4], [5], involving a
powerful models for the classification of time series, although computationalworkloadnotsuitableforefficientexecutionon
efficientimplementationinthewearabledomainraisessignificant wearable monitoring devices.
design challenges, to combine adequate accuracy and a suitable
In this work, we plan to combine the advantages deriving
complexity.
from the attention mechanism exploited in transformers with
In this work, we present a tiny transformer model for the
analysis of the ECG signal, requiring only 6k parameters and actual execution on wearable devices for long-term monitor-
reaching 98.97% accuracy in the recognition of the 5 most ing. To this aim, we have designed a lightweight transformer
common arrhythmia classes from the MIT-BIH Arrhythmia architecture that can be executed on microcontrollers, focus-
database,assessedconsidering8-bitintegerinferenceasrequired
ing on limited footprint and complexity. Moreover, we have
for efficient execution on low-power microcontroller-based de-
consideredmotionartifactnoiseresilienceasamainobjective
vices.Weexploredanaugmentation-basedtrainingapproachfor
improvingtherobustnessagainstelectrodemotionartifactsnoise, within the overall design process, using signals with artifacts
resulting in a worst-case post-deployment performance assess- to augment the dataset during training.
ment of 98.36% accuracy. Suitability for wearable monitoring
We start with a review of the state of the art of classifi-
solutionsisfinallydemonstratedthroughefficientdeploymenton
cation approaches in Section II. In Section III, we provide a
the parallel ultra-low-power GAP9 processor, where inference
execution requires 4.28ms and 0.09mJ. general overview of the considered ECG monitoring system
and describe its components, focusing on the architecture
IndexTerms—Arrhythmia,Transformer,Wearablemonitoring
of the proposed transformer-based classifier. Section III-C
summarizes the specifications of the datasets targeted for this
study, whereas Section III-D provides the definition of the
I. INTRODUCTION evaluationmetricsconsideredfortheassessmentoftheresults,
AccordingtotheWorldHealthOrganization,cardiovascular namely sensitivity and precision. The assessment of the clas-
diseases are the first cause of death worldwide [1]. The sification performance is presented in Section IV, including
electrocardiographic (ECG) signal represents the commonly inSectionIV-Capost-deploymentevaluation,consideringthe
accepted non-invasive diagnostic and monitoring tool for the impact of noise resulting from electrode movement artifacts
detection and recognition of anomalies in the functioning and accuracy drop due to data quantization. Finally, we report
of the heart, whose early detection can help reduce their in Section V the evaluation of the on-hardware performance
consequences and provide adequate treatment. of the proposed model deployed on the GAP9 low-power
It is established that wearable solutions are of great im- multicore microcontroller unit (MCU).
portance for allowing continuous monitoring of chronic con- The main contributions of this work can be summarized in
ditions while reducing the burden on clinicians and hospital the following points:
structures [2]. In this context, where the privacy of the data is
• we present a tiny transformer model for arrhythmia
a relevant concern, near-sensor edge processing represents an
recognition, reaching accuracy aligned with the state of
increasingly attractive option. Particular benefits would result
the art of transformer-based classifiers, with 60× fewer
from continuous monitoring for the detection of arrhythmia,
parameters and 300× fewer required operations;
which represents an anomaly of the heartbeat, showing an
• weevaluatetherobustnessofourproposedclassifiercon-
irregular or abnormal rhythm.
sidering common issues of real-time execution, resulting
from the presence of artifacts and noise in the signal
Paola Busia, Matteo A. Scrugli, and Paolo Meloni are with the DIEE,
University of Cagliari, Cagliari, Italy (e-mail: paola.busia@unica.it , mat- acquisition;
teoa.scrugli@unica.it,paolo.meloni@unica.it). • we provide an efficient implementation on a low-power
Victor J. B. Jung and Luca Benini are with the Integrated Systems
commercialMCU,resultinginlessthan0.09mJperinfer-
Laboratory,ETHZu¨rich,Zu¨rich,Switzerland.
LucaBeniniiswiththeDEI,UniversityofBologna,BolognaItaly. ence obtained with quantization up to 8-bitprecision and
4202
beF
61
]PS.ssee[
1v84701.2042:viXra2
parallel execution on 8 cores, thus showing the proposed useofanadaptivelearningengine,itprovidesthepossibilityto
model is suitable for long-term wearable monitoring. refine a CNN-based global classification model considering a
smallsubsetofpatient-specificdata,registeringupto7.5%ac-
II. RELATEDWORK curacy improvement on tests following the leave-one-patient-
Table I summarizes the recent works presenting neural out approach, reaching up to 99.16% classification accuracy.
network-basedmodelsforarrhythmiarecognitionontheMIT- The state of the art for transformer-based classification is
BIH dataset [11], [12]. For each of the listed works, we establishedbytheworkof[5].TheauthorspresentedaVision
reportinsubsequentcolumnsthepublicationyear,thenumber Transformer (ViT) consisting of 3 encoding blocks and 4
of arrhythmia classes considered, the specific task addressed, parallel heads in the attention layer. They obtained 99.62%
the classification model, and the test accuracy obtained. The accuracy, exploiting a denoising and baseline-wandering re-
”Footprint”, ”Inference Time”, and ”Energy consumption” moval step, and concatenating the information about the RR
columns summarize the performance evaluated on the target intervals within the last classification layer. An interesting
platform, reported in the ”Hardware Target” column. Finally, approach is presented in the work of [4]. The proposed
for each work, we indicate whether the degradation of the model is applied on 3s-long windows of signal and provides
classification accuracy in the presence of growing levels of the positioning and classification of the heartbeats occurring
noise has been explored. during that period, reaching 99.86% heartbeat positioning
As can be noted, classification based on CNNs reaches accuracy, and 99.49% classification accuracy. The best model
remarkable results. In [3] the authors present a CNN adapted exploits5Mparameters,butcompetitiveresultswereobtained
from the EfficientNet family, focusing on the 8-class arrhyth- with a similar architecture based on 0.75MB of parameters,
mia recognition task and reaching 99.54% accuracy with reaching 99.05% accuracy.
around 5.3M parameters. A 1D-CNN exploiting 2M param- Otherrelevantexamplesarerepresentedbytheworkof[6],
eters is presented in [8], reporting 99% accuracy in the 4- reaching 99.3% accuracy on the MIT-BIH dataset, and the
class recognition problem. As an alternative, the work of [7] transformer architectures presented in [16]–[18], which were
presents arrhythmia classification based on a Multi-Layer- designedandtestedondifferentdatasets,consideringmultiple-
Perceptron (MLP) model, scoring a classification accuracy lead acquisition.
higher than 99.47% for each of the 5 classes considered. To the best of our knowledge, the transformer-based clas-
Tiny CNN models have also been exploited for real-time sifiers in the literature have storage and computational re-
arrhythmiadetectiononresource-constraineddevices.Ref.[9] quirements non-compatible with efficient deployment on low-
presentstwoalternativeCNNsforarrhythmiarecognitionona power MCUs. To better motivate this statement, we consider
commerciallow-powermicrocontroller,reachingupto98.69% as a reference for wearable deployment a typical storage size
and 98.89% accuracy in the 5-class recognition problem, of 512kB, which is the available space in the L2 memory
with 18K and 93K parameters. The efficiency of inference of microcontroller-based platforms such as GAP8 [19] and
execution was evaluated on the ST Sensortile microcontroller, BioWolf [20]. The more recent GAP9, which is further de-
where it requires 215ms and 0.66mJ. Hybrid models resulting scribed in Section V, embeds a larger storage space, up to
from the combination of the CNN topology with the MLP, 1.5MB in the L2 memory level, which is still not enough
such as in [13], or the Long-Short-Term-Memory (LSTM) for the allocation of the model in [5]. Finally, the authors
network, such as in [14], were also considered for binary of [6] describe an FPGA implementation, but the size and
classification, to distinguish between normal and ventricular, complexity of the model, as well as the inference time and
orgenerallyabnormal,heartbeats.Theproposedmodelsreach energy consumption, are not reported.
up to 98.5% and 97% accuracy. Inthis work,we thuspresent anefficient transformerarchi-
We also include as a reference the work of [10], address- tecture, targeting accurate arrhythmia detection on low-power
ing the more challenging inter-patient classification problem, wearable devices, and extending the performance assessment
wheretheclassifieristrainedandtestedonthedatafromsep- to the typical challenges of real-time wearable operating con-
arate sets of patients. The author presents a CNN working on ditions. As most of the referenced works, with the exception
the first derivative of the ECG signal and exploiting matched of [10], we refer to the intra-patient classification problem,
filters reproducing the different arrhythmia classes within the where each heartbeat in the dataset is considered indepen-
convolutionallayers.Themodelalsoexploitstheprocessingof dently, and randomly assigned to the training, validation, or
the RR intervals (the distance between consecutive heartbeat test set.
peaks in the signal) through a stack of fully connected layers,
obtaining 98.18% accuracy with a 15kB memory footprint.
III. ECGCLASSIFIERDESIGN
Edge deployment on a Raspberry Pi equipped with a Cortex-
ARMv8 64-bit System on Chip results in less than 1ms A typical ECG signal is shown in Figure 1, referring to
inference time. This work explores the robustness against acquisition from a single electrode. Each heartbeat is defined
increasing levels of noise, considering white noise addition by a complex wave around a peak (R) in the amplitude,
up to 3db Signal to Noise Ratio (SNR). commonly known as the QRS complex. The shape of the
Another relevant contribution to the issue of inter-patient wavearoundtheR-peak,andtheintervalsbetweenconsecutive
variability is presented in [15], introducing BioAIP, a special- peaks (pre-RR and post-RR intervals), highlighted in the
ized processor for biological signal processing. Through the figure, are both meaningful diagnostic elements.3
Inference Energy Noise
Work Year Classes Task Model Accuracy Footprint HardwareTarget
Time Consumption Addition
[5] 2019 4 intra-patient ViT 99.62% 3MB* 365MOPs*1 - - ✗
[6] 2022 4 intra-patient ViT 99.3% - - - XilinxAlveo ✗
U50FPGA
[4] 2022 4 intra-patient Transformer 99.49% 20MB 70.53MOPs1 - - ✗
[7] 2022 5 intra-patient MLP >99% - 30.41MOPs1 - - ✗
[3] 2022 8 intra-patient CNN 99.54% 16MB - - - ✗
[8] 2023 4 intra-patient CNN 99% 2.2MB - - - ✗
[9] 2022 5 intra-patient CNN 98.89% 96kB 215ms 0.66mJ ARMCortex-M4 ✗
[10] 2023 3 inter-patient CNN 98.18% 15kB 1ms - Cortex-ARMv8 ✓
ViT32-bit 99.05% ✗
thiswork 2024 5 intra-patient ViT8-bit 98.97% ✗
ViT8-bit 98.36% 49kB 4.28ms 0.09mJ GAP9 ✓
*Estimatedfrompaper.
1Thepaperreportsthemodelcomplexityintermsofnumberofrequiredoperations.Ourproposedmodelrequirestheexecutionof0.97MOPs/inference.
TABLE I: State of the art on the MIT-BIH Arrhythmia database.
R
R PEAK PREPARATION CLASSIFICATION
R
1
Peak RR RR
Denoising Transformer
Detection
preRRinterval postRRinterval
0.5
Fig. 2: Overview of the ECG monitoring system.
0
includes two main filtering steps. The baseline wandering
component is identified thanks to two median filters with
respectively 200ms and 600ms window length, and subtracted
0 0.5 1 1.5 2
Time[s] from the signal. At this point, a low-pass filter with a cut-off
frequency of 35Hz is exploited for powerline noise removal.
Fig. 1: Typical ECG signal. Highlighted is the considered
The clean signal is then processed for the identification of
window around a single heartbeat, the R peak position and
thewindowofinterestaroundtheRpeak.Amongthecommon
the definition considered in the following for pre- and post-
QRSdetectionalgorithmsintheliterature,herewerefertothe
RR intervals.
well-known Pan-Tompkins detection algorithm, which allows
the detection of 99.67% of the heartbeats in the considered
dataset [21].
Figure2describesageneraloverviewofthereal-timemon-
itoring system that would be executed on a wearable device.
TheinputtothesystemisrepresentedbythecontinuousECG B. Transformer for Arrhythmia recognition
signal. As reported in the plot, our proposed classification
The proposed classifier is a Vision Transformer [22], [23],
system exploits two main information elements: a window of
adapted for the processing of 1D medical signals, similarly
the acquired signal selected around a single heartbeat, and a
to the approaches of [24], [25]. The model proposed in this
pair of values representing the pre-RR and post-RR intervals.
work was developed starting from the architecture presented
The identification and processing of these two elements is
in [25], and further optimized for the arrhythmia recognition
the result of the peak preparation block, which involves a
task. In alignment with the choice in [9], the input size is
denoising step and a peak detection step. The ECG window
selected equal to 198 samples, equally distributed on the left
and the pre-RR and post-RR intervals are thus provided to
and on the right of the considered R peak position within the
the transformer-based classifier, for the recognition of the
heartbeat, and corresponding to roughly 0.5s of data based on
considered classes of arrhythmia.
the sampling frequency of the considered dataset.
In the following, we describe in Section III-A the details
The structure of the model is represented in Figure 3,
of the data preparation block. The architectural description of
and the values of the architectural parameters are reported in
our proposed transformer model for heartbeat classification is
Table II. A typical ViT model consists of three main stages,
reported in Section III-B. Finally, Section III-C presents the
an embedding stage, an encoder stage, and a classification
main characteristics of the reference datasets considered for
stage. The embedding stage performs a data preparation task,
the design optimization and assessment.
producingasoutputasequenceofpatches,inspiredbytheto-
kensofaninputtext,andincludingthepositionalinformation.
A. Peak preparation
In our model, this processing is obtained with a convolution
The raw ECG signal goes through a denoising block per- stage, as proposed in [24]. The size k of the filtering kernels,
forming baseline-wandering and noise removal. This block applied considering no overlap with stride s = k, defines the
wasstructuredaccordingtotheschemesuggestedin[5],which length S of the resulting sequence, whereas the size of each
edutilpmAGCE4
EMBEDDING STAGE ENCODERSTAGE CLASSIFICATION STAGE
(pre-RR, post-RR)
2
x 2
C ADO DNV
1x2x1 LAYER NORM
E wCG in din op wut
1 x
3 x 61
1 x 61
x 66
821
x 61
61
x 821
TA
C N O
C
5 x
81 ( N, S, V, F, Q)
M
8 1 2
D G
6 h q
E
EH
ee ,k
N
LmaA
,vd
USb:
s se, Eizd eding size,
1x198x1 REDUCE MEAN
positional
embedding
Fig. 3: Architecture of the proposed transformer model for arrhythmia classification.
Stage Layer Output Parameters
patch, the embedding size E, results from the selection of the
k:3×1
Convolution 16×66×1
number of output channels. s:3
Embedding
AddPos.Embedding 16×66×1
This sequence represents the input to the encoder stage,
Dense 1×2
where most of the data processing is performed. The encoder LayerNorm 16×66×1
E:16
is constituted by a stack of blocks including a Multi-Head-
S:66
Multi-Head-Attention 16×66×1
Attention (MHA) layer and a Feed Forward network, exploit- d:2
H:8
ing residual connections. Encoder
LayerNorm 16×66×1
TheMHArepresentsthemostimportantmechanismwithin Dense 128×66×1
Gelu 128×66×1
the transformer, allowing the evaluation of the mutual rele-
Dense 16×66×1
vance between two points within the observed time series. As Gelu 16×66×1
LayerNorm 16×66×1
a first step for the attention evaluation, the input sequence
Classification ReduceMean 1×16
of patches is projected into three different spaces, known as Dense 1×5
queries Q, keys K, and values V. The first two projections
TABLE II: Parameters of the proposed transformer model for
are used for the evaluation of the attention matrix, whose
arrhythmia classification.
items allow to give weight to the elements within the third V
projection, according to the Equation in 1, where d represents
the size of the Q, K, and V projections. between the current R peak and the previous and following
QKT one. This second input is first linearly projected within the
Attention(Q,K,V)=Softmax( √ )V (1) embedding stage and then concatenated to the output of
d
the encoder which processes the ECG window around the
The attention mechanism is usually replicated considering heartbeat.
multiple parallel executions, called heads, where independent ThetupleofvaluesrepresentingtheRRintervalsisnormal-
projections of the input are evaluated. In MHA, a final linear ized into the range [-2,2], to resemble the distribution of the
projectionisperformedinordertorestoretheembeddingdata encoderoutputattheconcatenationlevel,thussimplifyingthe
size. In Table II, the number of heads is indicated with H. quantization process.
The most relevant parameters impacting the computational
load of the MHA layer were selected based on an exploration
C. Reference Datasets
processaimingtomaximizetheaccuracyonthetargetdataset,
under a defined storage constraint. We considered as a first As a main reference for this study, we considered the
target a maximum of 512kB memory footprint, but we finally MIT-BIH Arrhythmia Database [11], [12], which collects the
aimed at a more efficient topology that could fit the 128kB of ECG recordings of 47 subjects into 48 records, lasting 30
the L1 memory of the targeted GAP9 processor. The explo- minutes. The data included in the dataset is a composition
ration involved the selection of the embedding dimension E, of randomly selected ambulatory recordings from Boston’s
the number of heads H, and the sequence length S evaluated Beth Israel Hospital, and recordings selected to include the
within the attention layer, deriving from the choice of the clinically relevant arrhythmia examples. Each record reports
kernel size k and stride s within the embedding convolution the signal acquired by two channels, usually modified limb
layer. We also evaluated the dimension of the hidden layer of lead II (MLII) and V1, with a 360Hz sampling frequency.
the encoder feed-forward network. We refer in the following to processing based on the signal
The final classification stage is usually implemented as an acquired by the MLII.
MLP or a Dense layer. Based on the results reported in the In alignment with most of the works in the literature [4],
literature [4], [5], [10], [26], we considered the benefits of [5], [10], [26], we excluded from the training and test sets the
including the information about the RR intervals to differ- records containing paced beats, namely ”102”, ”104”, ”107”,
entiate the considered arrhythmia classes. We thus followed ”217”. Furthermore, we referred to the AAMI standard [27]
the example of [5] and introduced an additional input to to identify the 5 most relevant classification groups for the
the traditional transformer topology, representing the distance arrhythmia recognition problem: N (non-ectopic beats), S5
ArrhytmiaClass #Samples Train Valid Test
(supra-ventricularectopicbeats),V(ventricularectopicbeats),
N 90098 63022 9057 18019
F (fusion beat), Q (unclassifiable beat). S 2781 1967 273 541
V 7007 4919 664 1424
Real-time heartbeat classification on wearable monitoring
F 802 573 75 154
devices can be affected by different sources of noise. The Q 15 12 1 2
MIT-BIH Noise Stress Test Database [12], [28] collects noise
TABLE III: Composition of the MIT-BIH dataset and typical
samplesoriginatingfromthreemainsources,baselinewander,
training - validation - test split considered.
muscle artifacts, and electrode motion artifacts. In the follow-
ing,welimittheanalysistothenoiseresultingfromelectrode
motion artifacts, as it can modify significantly the appearance IV. EXPERIMENTALRESULTS
of the heartbeat and is not easily filtered out [28].
In the following, we summarize the outcome of the tests
Here we describe the process leading to the creation of
performed to evaluate the performance of our proposed ar-
the noise-corrupted datasets referenced in the Experimental
rhythmia classifier.
Section IV-C. The corruption of the signal is indicated as
different Signal-to-Noise ratio (SNR) levels, expressed in dB.
For brevity, we indicate as noiseless the original signal, with A. Intra-patient arrhythmia recognition
no additional noise deriving from electrode motion artifacts. We assessed the performance of our proposed model in
Given a noiseless signal S from the MIT-BIH Arrhythmia the intra-patient classification task, based on 5-fold cross-
Database and a noise component N from the MIT-BIH Noise validation. The ECG records in the dataset were segmented
StressTestDatabase,thenoisewasscaledbyascalingfactorα around each heartbeat corresponding to one of the NSVFQ
calculatedbasedonthedesiredSNR,accordingtoEquation2. arrhythmia classes, considering the dataset annotations for the
heartbeat positioning. All collected segments were shuffled
(cid:115)
mean(|S|2) and randomly split into a training set, a validation set, and
α= (2)
mean(|N|2)×10desir 1ed 0SNR a test set, with a 7:1:2 ratio, to enable a direct comparison
with the literature [5]. The composition of the dataset and a
The resulting noisy signal Y is generated in Equation 3,
typical train-valid-test split is reported in Table III.
where the scaling factor α results from Equation 2.
ThetrainingoftheclassifierwasperformedononeNVIDIA
T4TensorCoreGPU,usingtheTensorFlowframeworkinside
Y =S+α×N (3) the Google Colab environment. We exploited 200 epochs
training, with Adam optimizer, adaptive reduce-on-plateau
Each noisy ECG signal is annotated with the original
learning rate with starting value 2e−3, and batch size 128.
arrhythmia labels from the MIT-BIH Arrhythmia Database.
The classification performance for full-precision inference
is reported in Table IV, in terms of mean value and standard
D. Evaluation Metrics deviation across the 5 tests considered. The performance of
the model is only slightly impacted by the extremely low
As will be further detailed, Table III reports the typical
sensitivity and precision registered for the Q class, which is
composition of the training and test sets from the MIT-BIH
veryunder-representedinthedataset,andexcludedfrommost
dataset. As can be noticed, the dataset is highly unbalanced,
studies [4], [5]. Our proposed model reaches an average of
presenting a majority of normal heartbeats and a different
99.05% accuracy on the 5 splits considered. Table V reports
number of instances for each of the represented classes. Due
thesummaryconfusionmatrixreferringtothecross-validation
to this reason, for the performance assessment, we not only
test. As can be derived from Table IV, the main weakness is
considered the overall classification accuracy but also the
represented by a reduced sensitivity in the recognition of the
sensitivity and precision on each of the targeted arrhythmia
F class.
classes. The definition we referenced for these metrics is
reported in equations 4 and 5, where we apply them to class
N: B. Ablation Study
Wereportinthefollowingtheablationstudyofthedifferent
Sens = TN N (4) datapre-processingchoicesexplored,summarizedinTableVI,
N TN +FS +FV +FF +FQ limiting the analysis to a single train-test split.
N N N N N
ThefirstlineintheTablereportstheaccuracyoftheselected
model, depicted in Figure 3 of Section III-B. We started
TN
Prec = N (5) from the removal of the concatenation of the second input,
N TN +FN +FN +FN +FN
N S V F Q representing the RR interval information, which helps in the
where the notation TN indicates a normal sample, cor- arrhythmiaclassdiscrimination,asreportedinseveralprevious
N
rectly classified as normal, FS indicates a normal sample studies [4], [5], [10], [26]. The result was a 0.36% accuracy
N
which is classified as a supra-ventricular ectopic beat, and fi- drop, reported in the second line.
nallyFN indicatesasupra-ventricularectopicbeatclassified Weassessedatthispointtherelevanceofthedenoisingstep.
S
as normal. A similar logic can be applied to the interpretation We report in the third line the performance obtained when
of the other symbols in the equations. considering the RR information, but the selected topology6
Class Sensitivity Precision
non-augmenteddatasetsamplesandbalancedmixcorresponds
N 99.74%(0.08) 99.38%(0.04)
S 88.79%(2.02) 94.14%(1.72) to an equally partitioned test set, with different noise levels
V 96.91%(0.58) 97.59%(0.24)
applied to each subset, to emulate real-life conditions where
F 76.92%(5.48) 88.99%(1.93)
Q 10%(20) 10%(20) the noise level is expected to vary over an evaluation.
Accuracytot 99.05%(0.08) The solid grey line shows the results obtained when per-
TABLE IV: Test classification performance, when no addi- forming classification on different test conditions with the
tional noise is applied to the signal. We report mean values modeltrainedonthenon-corruptedsignal.Ascanbeobserved,
and standard deviation in 5-fold cross-validation with full- inthiscase,theaccuracyisdramaticallyaffectedbythenoise,
precision inference. with up to almost 8% points drop registered with high noise
N 89867 119 79 31 2 levels and test SNR equal to 3dB.
S 289 2468 23 1 0
In order to improve robustness during real-time inference,
V 139 31 6783 45 0
F 120 4 62 616 0 we considered the effect of including examples of corrupted
Q 10 0 4 0 1
signals during the training process, represented by the other
N S V F Q
PredictedLabels lines in the plot. As can be observed, augmenting with a
TABLE V: Confusion matrix summarizing performance on specific level of noise improves the resilience of the classi-
the considered splits for the full-precision model, when no fication algorithm when a similar noise level is considered in
additional noise is applied to the signal. thetest,althoughingeneral,itdeterminesaslightdegradation
forlowernoiselevels.Thebalancedmixstrategy,ontheother
Model TestAccuracy hand, performs better than specific levels in most evaluation
SelectedModel 99.17% pointsandespeciallyintheleftmostone,representingreal-life
noRR 98.81%
conditions.Itreducestheaccuracydroponthemostcorrupted
nodenoising 98.66%
noRRandnodenoising 98.69% signal (SNR = 3dB) to less than 1.2% points. This gain in
the robustness to high noise levels does not compromise the
TABLEVI:Comparisonoftestperformanceonasingle7:1:2
classification accuracy on the noiseless signal, which is only
split, based on different input processing choices. Accuracy
0.02% lower than the highest one reported in Table VI. The
numbers refer to tests performed with no additional noise
results thus confirmed the advantages of a training approach
applied to the signal.
considering a variable noise level for augmentation.
Basedonthesefindings,werepeated5-foldcross-validation
using training data augmentation and reported the results in
was trained, validated, and tested on unfiltered data, not pre-
Table VII. The first two columns summarize the performance
processed with the denoising step in Figure 2. The resulting
for the classification of the noiseless signal. The average
accuracy is lower than the best obtained by 0.51% points. To
accuracyis99.07%,thusnodegradationisobservedcompared
confirm this result, we finally removed both the RR concate-
to the un-augmented training approach. The confusion matrix
nation and the denoising step, thus obtaining the performance
is also included for completeness and reported in Table VIII.
reported in the fourth line. As can be observed, there is no
On the other hand, a significant advantage was obtained on
furtheraccuracydegradationcomparedtothenumberreported
the balanced mix test. In this scenario, 98.65% was achieved
in the third line, showing how the RR information only
on average on the 5 train-test splits considered. The corre-
providesarelevantadvantagewhencombinedwithaneffective
spondingcumulativeconfusionmatrixisreportedinTableIX.
denoising approach.
As can be observed, each test sample was replicated in order
to represent a different noise condition in real-time inference.
C. Post-deployment evaluation
The resulting evaluation metrics are summarized in the right
This work targets wearable devices for real-time heartbeat columns of Table VII. The comparison with the performance
classification, we thus present in this section the assessment onthenoiselesstestshowsagenerallyreducedsensitivityand
of the performance degradation deriving from two main chal- precision, especially in the recognition of the S and F classes.
lenges of wearable deployment, namely increasing levels of 2) Quantization: Finally, in order to optimize the storage
noisecorruptingtheECGsignalandaccuracylossduetodata requirementsofourmodelandexploitatbestthebyteprocess-
quantization. ing resources on edge-processing platforms, we made use of
1) Noisedegradation: Asafirststepforthenoisedegrada- the Quantlab framework [29] to obtain 8-bit quantization. To
tion analysis, we used as a baseline the accuracy reported in thisaim,weconsideredthemodelstrainedwithnoiseaugmen-
TableVI,derivingfromtheevaluationonthenoiselesssignal, tation and whose full-precision performance is summarized
andthecorrespondingspecifictrain-testsplit.Werepeatedthe in Table VII. We exploited 15 epochs of quantization-aware
same test using noise-augmented versions of the dataset sam- fine-tuning, obtaining an average test accuracy of 98.97% on
ples in training and in test, to create Figure 4. Different lines the clean noiseless signal, with a limited 0.1% drop from
correspond to different levels of noise used for augmenting the accuracy of the full-precision models. The performance
the training set, while different evaluation points in each line metrics are summarized in the first two columns of Table X,
correspond to a different level of noise in the test. Considered whereas the confusion matrix is reported in Table XI. The
levels are noiseless, 24dB SNR, 10dB SNR, 3dB SNR, and accuracy drop resulted from restricting all computations to
balanced mix, where noiseless corresponds to the original integertype,anditmostlyaffectsthesensitivityoftheSclass,
slebaLeurT7
NoiselessTest BalancedMixTest NoiselessTest BalancedMixTest
Class Sensitivity Precision Sensitivity Precision Class Sensitivity Precision Sensitivity Precision
N 99.73%(0.08) 99.42%(0.08) 99.59%(0.12) 99.15%(0.08) N 99.74%(0.05) 99.3%(0.08) 99.41%(0.14) 99.01%(0.1)
S 89.13%(1.1) 93.64%(1.34) 84.08%(1.2) 91.34%(1.62) S 84.73%(1.1) 94.65%(0.87) 78.3%(1.55) 92.12%(0.8)
V 97%(0.42) 98.01%(0.33) 95.7%(0.42) 96.59%(0.47) V 97.52%(0.42) 97.24%(0.45) 96.34%(0.53) 94.11%(1.26)
F 78.73%(4.97) 88.63%(3.42) 71.05%(4.34) 84.62%(5.15) F 76.58%(3.52) 89.56%(2.57) 68.94%(2.62) 81.33%(4.45)
Q 4%(8) 10%(20) 2%(4) 2.5%(5) Q 9%(11.14) 40%(48.99) 5.75%(7.57) 4.48%(6.84)
Accuracy 99.07%(0.06) 98.65%(0.07) Accuracy 98.97%(0.04) 98.36%(0.08)
TABLE VII: Test classification performance, reporting mean TABLE X: Test classification performance, reporting mean
values and standard deviation in 5-fold cross-validation with values and standard deviation in 5-fold cross-validation with
full-precisioninference,whentrainingdataaugmentationwith 8-bit inference, when training data augmentation with varying
varying noise levels is exploited. noise levels is exploited.
N 89858 136 50 37 17 N 89860 115 88 32 3
S 278 2479 22 2 0 S 388 2356 37 0 0
V 130 33 6789 44 2 V 115 17 6825 40 1
F 104 1 64 631 2 F 121 1 66 614 0
Q 11 0 3 0 1 Q 10 0 3 0 2
N S V F Q N S V F Q
PredictedLabels PredictedLabels
TABLE VIII: Confusion matrix summarizing noiseless test TABLE XI: Confusion matrix summarizing noiseless test
performance on the considered splits for the full-precision performance on the considered splits for the 8-bit model,
model, when training data augmentation with varying noise when training data augmentation with varying noise levels is
levels is exploited. exploited.
N 358901 710 483 232 66 N 358267 647 1061 344 73
S 1630 9355 130 8 1 S 2126 8708 282 7 1
V 807 182 26802 192 9 V 743 93 26971 169 16
F 596 4 325 2278 5 F 645 3 345 2211 4
Q 47 0 11 0 2 Q 46 0 9 0 5
N S V F Q N S V F Q
PredictedLabels PredictedLabels
TABLE IX: Confusion matrix summarizing balanced mix test TABLE XII: Confusion matrix summarizing balanced mix
performance on the considered splits for the full-precision test performance on the considered splits for the 8-bit model,
model, when training data augmentation with varying noise when training data augmentation with varying noise levels is
levels is exploited. exploited.
D. Comparison with the state of the art
We discuss at this point how our proposed solution com-
pares to the state-of-the-art context, considering as a main
reference the work of [5], which represents the most accurate
alternative. Table XIII summarizes the most relevant perfor-
95
mance figures for the comparison. The first line refers to full-
precisioninferenceperformedonnoiselessdata,asweindicate
trainingwithnoiselesssignal the data not corrupted with electrode motion noise. A limited
trainingwith24dBSNR
accuracydropisobservedwhenevaluatingtheperformanceof
trainingwith10dBSNR
the 8-bit model, in the second line. Our result presents only a
90 trainingwith3dBSNR
slightdegradationwithrespecttotheperformanceofthestate-
trainingwithbalancedmix
of-the-art transformer model, corresponding to only a 0.65%
noiseless 24dBSNR 10dBSNR 3dBSNR balancedmix accuracy drop, despite the reduced complexity in terms of the
Testcondition number of parameters and memory footprint, reported in the
fifth and sixth lines.
Fig. 4: Test classification performance considering increasing
Finally, although a direct comparison with the reference
levels of noise deriving from electrode motion artifacts.
model is not possible, we provide an assessment of worst-
caseperformanceconsideringadeploymentscenariocorrupted
by different levels of noise. The training data augmentation
allowed us to limit the accuracy drop to 0.4% points for
as can be observed from the table.
full-precision inference, whereas post-deployment assessment
We finally tested the performance on the classification of the quantized model results in 98.36% average accuracy,
of noise-corrupted signal, with the balanced mix test. The which we report in Table I as the worst-case expected real-
outcomeisreportedinthethirdandfourthcolumnsofTableX, time deployment performance.
andasummaryconfusionmatrixisreportedinTableXII.The
assessment resulted in an average 98.36% accuracy, which V. DEPLOYMENT
we can consider as a worst-case post-deployment real-time In this section, we assess the efficiency of the proposed
performance prediction. transformer classifier, considering its deployment on the par-
%ycaruccA
slebaLeurT
slebaLeurT
slebaLeurT
slebaLeurT8
Metric ThisWork [5] GAP9
32-bitAccuracyNoiseless 99.05% 99.62% Frequency 370MHz 240MHz
8-bitAccuracyNoiseless 98.97% - Time/Inf 2.85ms 4.28ms
Power 42.60mW 20.33mW
32-bitAccuracyNoisy 98.65% -
Energy/Inf 0.12mJ 0.09mJ
8-bitAccuracyNoisy 98.36% -
Parameters 6649 4057111 TABLE XIV: On-hardware performance on the GAP9 pro-
Footprint 49kB 3MB1
cessor for parallel execution on the 8 cores of the computing
1Estimatedfromthepaper.
cluster.
TABLEXIII:Comparisonwiththestate-of-the-arttransformer
model for arrhythmia recognition.
VI. CONCLUSIONS
In this work, we presented an efficient transformer model
for arrhythmia classification, reaching 99.05% accuracy in
the classification of the 5 most common arrhythmia classes
Conv1.41% from the MIT-BIH Arrhythmia database. The classification
Add1.13% performance was assessed considering different inference
LayerNorm12.90% conditions, resembling real-time disturbance, by introducing
MHA67.90% different levels of noise corruption deriving from electrode
Dense11.63% motion artifacts, based on the noise samples from the MIT-
Gelu4.40% BIH Noise Stress Test database.
ReduceMean0.62% Integer 8-bit inference resulted in 98.97% accuracy on the
noiseless signal, which is only 0.65% lower than the state-
of-the-art transformer model, although reducing by 60× the
Fig. 5: Composition of the computational workload of the numberofparameters,andby300×thenumberofoperations.
different operators in the proposed model, expressed as per- The lean topology of the proposed model can be efficiently
centage of the total inference time. deployed on low-power devices for wearable monitoring, as it
is demonstrated by the performance evaluated on the GAP9
parallelprocessor,whereinferenceisexecutedin4.28ms,with
allel ultra-low power (PULP) GAP9 processor [19]. This 0.09mJ energy consumption.
commercialplatformembedsacomputingclusterof8parallel
processors, accessing a shared 128kB L1 memory to enable
REFERENCES
efficientparallelexecution.Theoffloadofcomputationstothe
cluster is handled by an additional core, working as a Fabric [1] W. H. Organization, “Cardiovascular diseases,” June 2023. [Online].
Available: https://www.who.int/health-topics/cardiovascular-diseases#
Controller. The memory system includes also a 1.5MB L2
tab=tab 1
memory and supports voltage and frequency tuning for power [2] S. M. A. Iqbal, I. Mahgoub, E. Du, M. A. Leavitt, and W. Asghar,
management. Based on the recent assessment on the tiny-ML “Advances in healthcare wearable devices,” npj Flexible Electronics,
vol. 5, no. 9, 2021. [Online]. Available: https://doi.org/10.1038/
benchmarks [30], GAP9 shows exceptional energy efficiency,
s41528-021-00107-x
withaslowas0.33mW/GOP,thusrepresentingaperfectfitfor [3] C.-F. Zhao, W.-Y. Yao, M.-J. Yi, C. Wan, and Y.-l. Tian, “Arrhythmia
long-term wearable monitoring tasks. Furthermore, the com- classificationalgorithmbasedonatwo-dimensionalimageandmodified
efficientnet,”ComputationalIntelligenceNeuroscience,2022.
putational workload of the transformer model is intrinsically
[4] R.Hu,J.Chen,andL.Zhou,“Atransformer-baseddeepneuralnetwork
parallel,thusthecomputingclustercanbeefficientlyexploited for arrhythmia detection using continuous ecg signals,” Computers in
to reduce inference time during real-time execution. Biology and Medicine, vol. 144, p. 105325, 2022. [Online]. Available:
https://www.sciencedirect.com/science/article/pii/S0010482522001172
For efficient deployment, we considered the 8-bit model
[5] G. Yan, S. Liang, Y. Zhang, and F. Liu, “Fusing transformer model
reportedinTableXIII.WeexploitedtheDorycodegeneration with temporal features for ecg heartbeat classification,” in 2019 IEEE
tool [31] for assisted implementation on the target platform. International Conference on Bioinformatics and Biomedicine (BIBM),
2019,pp.898–905.
As depicted in Figure 5, over 67% of the computing time is
[6] P. K. Singh, N. Shukla, A. Pandey, A. P. Shukla, and S. C. Neupane,
occupied by the MHA layer, whose implementation exploits “Ecg-vit: A transformer-based ecg classifier for energy-constraint
theparallelresourcesontheplatformbybalancingthecompu- wearable devices,” Journal of Sensors, p. 2449956, 2022. [Online].
Available:https://doi.org/10.1155/2022/2449956
tation among the cores of the computing cluster: each head is
[7] W. Wang, J. Guan, X. Che, and W. Wang, “Ms-mlp: Multi-scale
mapped into one of the eight cores, according to the strategy sampling mlp for ecg classification,” in 2022 30th European Signal
described in [32]. Measured on-hardware performance results ProcessingConference(EUSIPCO),2022,pp.1288–1292.
[8] A. A. Ahmed, W. Ali, T. A. A. Abdullah, and S. J. Malebary,
inaslowas4.28ms/inferenceand0.09mJenergyconsumption,
“Classifying cardiac arrhythmia from ecg signal using 1d cnn deep
for parallel execution exploiting 8 cores at 240MHz working learningmodel,”Mathematics,vol.11,no.3,2023.[Online].Available:
frequency. As can be noticed from the measurements reported https://www.mdpi.com/2227-7390/11/3/562
[9] M.A.Scrugli,D.Loi,L.Raffo,andP.Meloni,“Anadaptivecognitive
in Table XIV, this operating configuration was selected as
sensornodeforecgmonitoringintheinternetofmedicalthings,”IEEE
the most energy-efficient one. The power measurements were Access,vol.10,pp.1688–1705,2022.
performed with a Power Profiler Kit II (PPK2) connected [10] M. M. Farag, “A tiny matched filter-based cnn for inter-patient ecg
classification and arrhythmia detection at the edge,” Sensors, vol. 23,
to the GAP9 Evaluation Kit, resulting in an average power
no.3,2023.[Online].Available:https://www.mdpi.com/1424-8220/23/
consumption of 20.33mW. 3/13659
[11] G. Moody and R. Mark, “The impact of the mit-bih arrhythmia [31] A. Burrello, A. Garofalo, N. Bruschi, G. Tagliavini, D. Rossi, and
database,” IEEE Engineering in Medicine and Biology Magazine, F. Conti, “Dory: Automatic end-to-end deployment of real-world dnns
vol.20,no.3,pp.45–50,2001. onlow-costiotmcus,”IEEETransactionsonComputers,pp.1–1,2021.
[12] A.Goldberger,L.Amaral,L.Glass,J.Hausdorff,P.C.Ivanov,R.Mark [32] A. Burrello, M. Scherer, M. Zanghieri, F. Conti, and L. Benini, “A
etal.,“Physiobank,physiotoolkit,andphysionet:Componentsofanew microcontrollerisallyouneed:Enablingtransformerexecutiononlow-
research resource for complex physiologic signals.” Circulation, vol. power iot endnodes,” 2021 IEEE International Conference on Omni-
101,p.e215–e220,2000. LayerIntelligentSystems(COINS),pp.1–6,2021.
[13] D. L. T. Wong, Y. Li, D. John, W. K. Ho, and C.-H. Heng, “Low
complexity binarized 2d-cnn classifier for wearable edge ai devices,”
IEEETransactionsonBiomedicalCircuitsandSystems,vol.16,no.5,
pp.822–831,2022.
[14] G.Sivapalan,K.K.Nundy,S.Dev,B.Cardiff,andD.John,“Annet:A
lightweight neural network for ecg anomaly detection in iot edge sen-
sors,”IEEETransactionsonBiomedicalCircuitsandSystems,vol.16,
no.1,pp.24–35,2022.
[15] J. Liu, J. Fan, Z. Zhong, H. Qiu, J. Xiao, Y. Zhou, Z. Zhu, G. Dai,
N.Wang,Q.Liu,Y.Xie,H.Liu,L.Chang,andJ.Zhou,“Anultra-low
powerreconfigurablebiomedicalaiprocessorwithadaptivelearningfor
versatilewearableintelligenthealthmonitoring,”IEEETransactionson
BiomedicalCircuitsandSystems,vol.17,no.5,pp.952–967,2023.
[16] C.Che,P.Zhang,M.Zhu,Y.Qu,andB.Jin,“Constrainedtransformer
networkforecgsignalprocessingandarrhythmiaclassification,”BMC
Medical Informatics and Decision Making, p. 184, 2021. [Online].
Available:https://doi.org/10.1186/s12911-021-01546-2
[17] A.Natarajan,Y.Chang,S.Mariani,A.Rahman,G.Boverman,S.Vij,
andJ.Rubin,“Awideanddeeptransformerneuralnetworkfor12-lead
ecgclassification,”in2020ComputinginCardiology,2020,pp.1–4.
[18] L.Meng,W.Tan,J.Ma,R.Wang,X.Yin,andY.Zhang,“Enhancing
dynamic ecg heartbeat classification with lightweight transformer
model,” Artificial Intelligence in Medicine, vol. 124, p. 102236, 2022.
[Online]. Available: https://www.sciencedirect.com/science/article/pii/
S093336572200001X
[19] Greenwaves,“Ultralowpowergapprocessors,”August2023.[Online].
Available:https://greenwaves-technologies.com/low-power-processor/
[20] V. Kartsch, G. Tagliavini, M. Guermandi, S. Benatti, D. Rossi, and
L.Benini,“Biowolf:Asub-10-mw8-channeladvancedbrain–computer
interfaceplatformwithanine-coreprocessorandbleconnectivity,”IEEE
Transactions on Biomedical Circuits and Systems, vol. 13, no. 5, pp.
893–906,2019.
[21] J.PanandW.J.Tompkins,“Areal-timeqrsdetectionalgorithm,”IEEE
TransactionsonBiomedicalEngineering,vol.BME-32,no.3,pp.230–
236,1985.
[22] D. Alexey, B. Lucas, K. Alexander, W. Dirk, Z. Xiaohua, U. Thomas,
D.Mostafa,M.Matthias,H.Georg,G.Sylvain,U.Jakob,andH.Neil,
“An image is worth 16x16 words: Transformers for image recognition
atscale,”InternationalConferenceonLearningRepresentations,2021.
[23] A. Vaswani et al., “Attention is all you need,” Advances in Neural
InformationProcessingSystems,vol.2017-December,p.5999–6009,
2017.
[24] A.Burrello,F.B.Morghet,M.Scherer,S.Benatti,L.Benini,E.Macii,
M. Poncino, and D. J. Pagliari, “Bioformers: Embedding transformers
forultra-lowpowersemg-basedgesturerecognition,”IEEE2022DATE,
2022.
[25] P. Busia, A. Cossettini, T. M. Ingolfsson, S. Benatti, A. Burrello,
M. Scherer, M. A. Scrugli, P. Meloni, and L. Benini, “Eegformer:
Transformer-basedepilepsydetectiononraweegtracesforlow-channel-
countwearablecontinuousmonitoringdevices,”in2022IEEEBiomed-
icalCircuitsandSystemsConference(BioCAS),2022,pp.640–644.
[26] T. Wang, C. Lu, Y. Sun, M. Yang, C. Liu, and C. Ou, “Automatic
ecgclassificationusingcontinuouswavelettransformandconvolutional
neural network,” Entropy, vol. 23, no. 1, 2021. [Online]. Available:
https://www.mdpi.com/1099-4300/23/1/119
[27] A. for the Advancement of Medical Instrumentation American
National Standards Institute, Testing and Reporting Performance
Results of Cardiac Rhythm and ST-segment Measurement Algorithms,
ser. ANSI/AAMI. The Association, 1999. [Online]. Available:
https://books.google.it/books?id=gzPdtgAACAAJ
[28] M.R.MoodyG.B.,MuldrowW.E.,“Anoisestresstestforarrhythmia
detectors.”ComputersinCardiology,vol.11,pp.381–384,1984.
[29] M.Spallanzani,G.Rutishauser,M.Scherer,A.Burrello,F.Conti,and
L.Benini,“QuantLab:aModularFrameworkforTrainingandDeploy-
ing Mixed-Precision NNs,” https://cms.tinyml.org/wp-content/uploads/
talks2022/Spallanzani-Matteo-Hardware.pdf,March2022.
[30] MLCommons,“Inference:tiny.v1.0Results,”2023,Accessed:01-08-
2023.[Online].Available:https://mlcommons.org/en/inference-tiny-10/