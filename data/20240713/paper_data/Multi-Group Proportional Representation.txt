MULTI-GROUP PROPORTIONAL REPRESENTATION
APREPRINT
AlexOesterling∗ ClaudioMayrinkVerdun∗ CarolXuanLong AlexGlynn
HarvardUniversity HarvardUniversity HarvardUniversity HarvardUniversity
LucasMonteiroPaes SajaniVithana MartinaCardone FlavioP.Calmon
HarvardUniversity HarvardUniversity UniversityofMinnesota HarvardUniversity
ABSTRACT
Imagesearchandretrievaltaskscanperpetuateharmfulstereotypes,eraseculturalidentities,and
amplifysocialdisparities. Currentapproachestomitigatetheserepresentationalharmsbalancethe
number of retrieved items across population groups defined by a small number of (often binary)
attributes. However,mostexistingmethodsoverlookintersectionalgroupsdeterminedbycombina-
tionsofgroupattributes,suchasgender,race,andethnicity. WeintroduceMulti-GroupProportional
Representation (MPR), a novel metric that measures representation across intersectional groups.
We develop practical methods for estimating MPR, provide theoretical guarantees, and propose
optimizationalgorithmstoensureMPRinretrieval. Wedemonstratethatexistingmethodsoptimizing
for equal and proportional representation metrics may fail to promote MPR. Crucially, our work
showsthatoptimizingMPRyieldsmoreproportionalrepresentationacrossmultipleintersectional
groupsspecifiedbyarichfunctionclass,oftenwithminimalcompromiseinretrievalaccuracy.
1 Introduction
Arecognizedobjectiveinfairmachinelearning(ML)isdiscovering,reporting,andmitigatingrepresentationalharms
[1–3]. Representationalharmsarisewhensystemsreinforceandperpetuatethemarginalizationofpopulationgroups
basedoncharacteristicssuchasrace,socioeconomicstatus,culturalbackground,andgender[1,4–6]. Theseharms
oftenmanifestthroughthebiasedportrayalormisrepresentationofthesegroups,stereotypereinforcement,anderasure
of cultural identities [7, 8]. Representational harms have been widely documented in ML systems. For instance,
many freely available datasets used in ML are not geo-diverse [9], and generative models can output images that
under-representdemographicminoritiesacrossgenderandracialidentities[10–12].
Wefocusonrepresentationinretrievaltasks. Representationalharmsinretrievalandrankingtasksarisewhenretrieved
itemsdonotaccuratelyreflectthetruediversityandproportionspresentinreality,perpetuatingharmfulstereotypes
andbiases[13]. Forinstance,Kayetal.[2]demonstratedthat,in2015,only10%ofthetop100resultsforCEOin
GoogleImageSearchwerewomen,despite28%ofCEOsintheUSbeingwomen,andrecentstudies[14,15]have
demonstratedthatthisbiasisstillpresentinmodernimagesearchengines. Later,Otterbacheretal.[16]showedthatthe
searchengineBingusuallyproducedtwiceasmanymenascomparedtowomenwhenqueriedwiththeword“person”.
Finally,[17]systematicallystudiedgenderbiasesinimagerepresentationsbyauditingthefourmostimportantimage
searchengines: Google,Bing,Baidu,andYandex. Inparticular,amongotherfindings,thisstudyshowedthatwhena
qualifiersuchas“intelligent”isaddedtothequery“person”,theenginesstillexhibitahugegenderdiscrepancy;see
also[1,Chapter7]. Whenretrievalisbasedonasearchovervectorembeddingsofimagesandtext,biasesinembedding
modelscanpropagatetoretrievedresults,leadingtodisparaterepresentationofpeoplebydemographicgroupssuchas
genderorrace[18–20],aswellaspropagatingspuriouscorrelationsfromthedatasetmorebroadly[21]ordistorting
resultsduetostereotypespresentintherepresentation[22]. Thoughcorrelationsbetweenunrelatedsemanticconcepts
donotnecessarilyconstituterepresentationalharms,awealthofresearchchartsundesirablebiasinembeddingmodels,
includingpubliclyavailablejointvision-languagefoundationalembeddingmodelssuchasCLIP[23]usedforretrieval.
∗:Equalcontribution.Correspondencetoaoesterling@g.harvard.edu.
4202
luJ
11
]IA.sc[
1v17580.7042:viXraMulti-GroupProportionalRepresentation APREPRINT
Biasinembeddingscanleadtobiasinretrieval[24–26]. Infact,recentworkbySrinivasanetal.[27]arguesthatmany
imageretrievalsystemslack“socialdiversity”asperceivedbyhumans.
Several interventions aim to control gross statistical deviations in group representations in retrieval. A common
approachisensuringequalrepresentationofpre-definedpopulationgroupsinretrieveditems[28,29]. Analternative
goalisproportionalrepresentation(PR)[20,30],wheretherepresentationofdifferentgroupsisapproximatelyequalto
referencepopulationstatistics.Variousinterventionshavebeenproposedtoachieveequalorproportionalrepresentation,
includingoptimizingfordiversityinadditiontothesimilarityinretrieval[27,31],directlyselectingtheobjectsretrieved
based on balancing known or predicted sensitive attributes [29] and, for vector databases, modifying embeddings
directlytoremoveinformationaboutgroup-definingattributes[18,20].
Achievingproportionalrepresentationacrossmultipleintersectionalgroupsischallenging,asexistingfairnessinterven-
tionstypicallyconsideronlyasmallnumberofpre-definedgroups. Ensuringrepresentationacrossindividualgroups
(e.g.,givenbygenderorrace)doesnotguaranteerepresentationacrossintersectionalgroups(e.g.,givenbygenderand
race),asdemonstratedinTables1and3.Thestudyofintersectionalityanditsconsequencesisrootedinworkinlawand
thesocialsciences[32–34]andhasbeenawell-discussedproblemforseveraldecades. Inmachinelearningsystems,
lackofintersectionalrepresentationcancontributetotheinvisibilityofhistoricallymarginalizedgroupsdeterminedby
multipleaxesofidentity[35],ortheirmistreatmentthrough“fairnessgerrymandering,”whereinterventionsonfairness
forspecificgroupsmayharmfairnessonintersectionalsubgroups[36]. However,asthenumberofgroup-denoting
attributesincreases,thenumberofintersectionalgroupsgrowsexponentially,quicklysurpassingthenumberofretrieved
itemsandlimitingtheachievableproportionalrepresentation.
WeproposeametriccalledMulti-groupProportionalRepresentation(MPR)toquantifytherepresentationofintersec-
tionalgroupsinretrievaltasks. MPRmeasurestheworst-casedeviationbetweentheaveragevaluesofacollectionof
representationstatisticscomputedoverretrieveditemsrelativetoareferencepopulationwhoserepresentationweaim
tomatch. ThesetofrepresentationstatisticsisgivenbyafunctionclassC,whereeachfunctionc∈C mapsaretrieved
itemxtoaRealnumber. Forinstance,c(x) ∈ {−1,1}maydenotebinarygroupmembership. Intheory,C canbe
givenbyboundedcomplexityfunctionclasses,suchaslinearfunctionsorshallowdecisiontrees. Inpractice,C are
functionsdefinedoveritemattributes,suchasvectorembeddingsorgroup-denotinglabels,enablingMPRtomeasure
proportionalrepresentationacrosscomplex,intersectionalsubgroups. Comparedtonaivelycountingthenumberof
retrieveditemsacrossa(potentiallyexponential)numberofpre-definedgroups,MPRoffersamoreflexible,scalable,
andtheoreticallygroundedmetricformulti-grouprepresentationinretrieval.
InadditiontointroducingandcarefullymotivatingtheMPRmetric(Section2),wemakethreecontributions. First,
weshowhowtocomputeMPRforseveralfunctionclassesinSection3. ComputingMPRreliesonacurateddataset
thatrepresentsthedesiredpopulationwhoseproportionalrepresentationweaimtoreflectinretrieveditems. Wederive
samplecomplexityboundsforthesizeofthiscurateddatasetbasedonthecomplexityofthefunctionclassC. Wealso
demonstratethatMPRcanbecomputedinclosedformforcertainfunctionclassesorwitharegressionoracle. Second,
weproposeMAPR,analgorithmthatretrievesitemsfromavectordatabasetomaximizetheiraveragesimilaritytoa
queryembeddingwhilesatisfyinganMPRconstraintrelativetothecurateddataset(Section4). MAPRachievesthisby
iterativelycallinganoraclethatcomputesMPRviolations,yieldingbothrelevantandrepresentativeretrieveditems.
Third,weevaluateMAPRonretrievaltasksusingdatasetssuchasCelebA[37],theOccupationsdataset[31],Fairface
[38],andUTKFace[39]. Ourresults(Section5)showthatMAPRPareto-dominatescompetingapproachesinbalancing
retrievalsimilarityandMPR.
RelatedWork. Broadlyspeaking,existingworkonfairanddiverseretrievalwithpretrainedembeddingseither: 1)
modifiestheembeddingspacetoprioritizedownstreamfairness,or2)providesretrievalalgorithmsoptimizingfor
diversityorfairness.
MitigatingBiasinEmbeddingSpace. Variousapproacheshavebeenproposedtoproducevectorembeddingsoftextand
imagesthattargetdiversityormitigatebias. Theseincludemodifyinglossfunctionstoencouragegroupfairness[40],
adversarialtraining[41,42],disentanglingrepresentations[43],andin-processingfairsamplingmethodsforgender
imbalance [18]. Many foundational embeddings models are not trained with such approaches, so post-processing
methodsforfairnesshavealsobeendevelopedformultimodalmodelslikeCLIP[23],suchasCLIP-clip[18],CLIP-
debias [20], and FairCLIP [19]. The recent work PATHS [27], built upon the pretrained image-text model CoCa,
leveragestext-guidedprojectionstoextractanembeddingthatcapturescomplexnotionsofdiversityinpeople,enabling
effectivediverseretrievalmethods. Inourexperiments,wereporttheMPRachievedbyCLIP-clipandCLIP-debias
inretrievaltasks. PATHS[27]istherecentworkmostsimilartooursinthatitalsoaimstopromoteintersectional
representationinretrieval. Codeforimplementingandreproducing[27]wasnotavailableatthetimeofsubmission.
WeapproximateitsretrievalalgorithmwithvanillaCLIPembeddings. Unliketheaforementionedmethods,MAPRisnot
basedonmodifyingembeddings.
2Multi-GroupProportionalRepresentation APREPRINT
RetrievalAlgorithmswithDiversityorFairness. Insteadofmodifyingembeddings,severalmethodsaimtopromote
diversity,givenpossiblybiasedembeddings. Forafixedquery,thebaselinemethodforretrievalisk-Nearest-Neighbors
(k-NN),wherethekmostsimilaritemsareretrieved[44]. Givenanadditionaldiversityconstraint,apopularapproach
is Maximal Marginal Relevance (MMR) [45], where items are greedily retrieved in order to maximize a linear
combinationofsimilarityanddiversitymetrics. Celisetal.[30],CelisandKeswani[31]focusondiversityandfairness
inimageretrieval,usingareweighingmethodthatcombinessimilarityandMMRtoselectdiverseyetrelevantimages.
Alternatively,thePost-HocBiasMitigation[29]methodaimstoachieveequalrepresentationoverapre-definedattribute
(suchasgender)throughcallstoanoracleclassifierandselectingabalancedgroupofimages. Weextendthisprior
workintwokeyways: (i)weaimtoachieveproportionalrepresentationacrossintersectionalgroups,goingbeyond
therepresentationoftwogroupsdefinedbybinaryattributes;(ii)MAPRexplicitlybalancesMPRandretrievalsimilarity
viaanoptimizationthatcontrolsforboth,offeringaprincipledalternativetogreedyMMR-basedmethods.
DiversityMetrics. Atraditionalmeasureofdiversityforasetisthepairwisesimilarityoftheretrieveditems[46].
However,thegeneralvisual(dis)similaritymetricisinsufficientinoptimizingforpeople-relateddiversitysuchasskin
toneorgender[30]. Whentheattribute(e.g.,race)alongwhichdiversityisoptimizedisknown,fairnessdefinition-
derivedmetricssuchasproportionalrepresentationareused([47],seealsonextsection). Formorecomplexnotions
ofdiversitythataimtocaptureintersectionalorsubtlesocioculturalidentities(e.g.,culturalbackgrounds,lifestyles,
nationalities, religions), humanannotatorsareemployedtodetermineiftheselectedsetofimagesismorediverse
thanthebaseline(retrievalbasedonsimilaritytoqueryonly)[27]. MPRcomplementsexistingmetricsbyprovidinga
rigorousapproachtomeasuringrepresentationacrosscomplex,intersectionalgroupsdefinedbyarichclassoffunctions.
However, as with any fairness metric, MPR has limitations (see Section 6) and may not always align with human
perceptionsofrepresentation. Weunderscoretheimportanceofinvolvingstakeholdersindefiningrepresentationgoals
andauditingretrievalsystems.
Multi-GroupFairness. Ourworkisdirectlyinformedbytheburgeoningliteratureonmulti-groupfairnessinclassi-
fication,particularlytheworkofHébert-Johnsonetal.[48],Kimetal.[49,50]whoproposedrigorousframeworks
ofmulti-groupfairnessauditingandpost-processingtoensurefairpredictionsacrossidentifiablesubgroups. Recent
effortsinthisfieldinclude[51–53],whichanalyzesamplecomplexityaspectsofmeasuringandreportingmulti-group
representation, and[54,55]whodevelopstrongervariantsofmulti-groupfairnessnotions. Unlikepriorwork, we
focusonmulti-grouprepresentationinretrievalratherthanmulti-groupfairnessinclassificationandregression. Lastly,
proportionalrepresentationstrategiesaroseinthepoliticalsciencesliterature[56–60]–weaddressthisbodyofworkin
AppendixC.
2 AMulti-GroupProportionalRepresentationMetric
Preliminaries. Consider a retrieval dataset of items from which we aim to retrieve relevant entries, denoted by
D ={xr,...,xr}. Weassumethatxr ∈Rd×G,whereG isasetofadditionallabelsforeachitem. Forexample,
R 1 n i
itemsxr canbed-dimensionalembeddingsofimages,videos,ortextualcontent,inwhichcaseG =∅. Alternatively,
i
xr =(e ,g ),wheree ∈Rdisanembeddingandg isavectoroflabelsindicatinggroupmembership(e.g.,gender,
i i i i i
race,ethnicity).
Givenaqueryembeddingq ∈ Rd,thegoalofretrievalistosearchandreturnthetop-k mostsimilaritemstoqin
D . ThesimilaritybetweenanembeddingofqanditemsinD ismeasuredaccordingtoametricκ:Rd×Rd →R.
R R
Throughoutthepaper,weassumethatD isavectordatabaseandκiscosinesimilaritybetweenembeddings,though
R
thisformulationcanbegeneralized. ToretrieveitemsfromD ,userspromptaqueryq(e.g.,"Fortune500CEOs")
R
which is then embedded Rd. Ideally, the user receives k retrieved items R(q) = {xr,...,xr} ⊂ D such that
1 k R
κ(q,xr)≥κ(q,x)forallx∈/ R(q)andi∈[k].
i
Thesimplestsettingformeasuringrepresentationistoconsideronlytwopopulationgroupsdenotedbyabinaryvariable
–asettingcommonlyfoundinthefairretrievalandgenerationliterature[18,19]. Inthiscase,groupmembershipis
determinedbyagroup-denotingfunctionc:Rd×G →{−1,1}. Foranitemxr,c(xr)indicatesmembershiptogroup
i i
−1or1(e.g.,male/female)basedonitsembeddinge andassociatedlabelsg . IftheretrievaldatasetD contains
i i R
annotationsforgroupmembership,c(xr)cansimplyreturntherelevantfeaturefromg . However,whengrouplabels
i i
arenotpresent(i.e.,G = ∅),c(xr)canbeimplementedasaclassifierthatpredictsgroupmembershipbasedonthe
i
item’sembeddinge .
i
Withagroup-denotingfunctionc(xr)inhand,wecanmeasuretherepresentationofeachgroupinasetofretrieved
items R(q). One popular constraint for representation is equal representation [2, 28], which aims to ensure that
thenumberofretrieveditemsineachgroupisapproximatelythesame,i.e., 1 (cid:80) c(xr)≈0. Analternative
k xr∈R(q)
metricisproportionalrepresentation[20,61],whichquantifiesthedeviationofgroupmembershipfromareference
distributionQ. Methodsthatpromoteproportionalrepresentationaimtoensure 1 (cid:80) c(xr)≈E [c(X)].
k xr∈R(q) Q
3Multi-GroupProportionalRepresentation APREPRINT
Here,themeasureQcapturesthedistributionofareferencepopulationwhoserepresentationstatisticsweaimtomatch.
Forexample,ifQwerethedistributionofindividualsintheUnitedStates,E [c(X)]couldmeasuretheproportionof
Q
menvs. womenintheUSandbeapproximatedusingCensusdata.
Proportionalrepresentationgeneralizesequalrepresentationsincedifferentgroupsarerarelyuniformlydistributedover
agivenpopulation. Naturally,thechoiceofdistributionQisapplicationandcontext-dependent–werevisitthechoice
ofQbelow. Importantly,ifQisbiased,thenbiaseswillbepropagatedtotheretrieveditems.
Multi-GroupProportionalRepresentation. Weaimtoensurethatretrieveditemsrepresentindividualsfromdiverse
andintersectionalpopulationgroups. Insteadofmeasuringproportionalrepresentationintermsoftheaverageofa
singlegroup-denotingfunctionc(xr),weconsideraclassofQ-measurablefunctions,therepresentationstatisticsclass,
C ⊂(cid:8) c:Rd×G →R(cid:9) . ThissetC mayrepresentmultiple,potentiallyuncountableoverlappinggroups. Weformally
definemulti-groupproportionalrepresentationnext.
Definition1. ForareferencerepresentationdistributionQ,asetofQ-measurablesetofrepresentationstatisticsC,
andasetofkretrieveditemsR,wedefinethemulti-groupProportionalRepresentation(MPR)metricas
(cid:12) (cid:12)
(cid:12)1 (cid:88) (cid:12)
MPR(C,R,Q)≜sup(cid:12) c(xr)−E [c(X)](cid:12). (1)
(cid:12)k Q (cid:12)
c∈C(cid:12) (cid:12)
xr∈R
AsetofitemsRis(C,ρ)-multi-groupproportionalrepresentativeofQifMPR(C,R,Q)≤ρ.
TheMPRmetricquantifiesthe“representativeness”ofarichclassofstatistics,denotedbyfunctionsinC,withinaset
ofretrieveditemsR. Thisgeneralizationiscrucialforcapturingintersectionalgroups. Forexample,C couldcontain
functionsthatmapitemstodemographicgroupsbasedonrace,gender,age,orcombinationsthereof. Alternatively,
whenlabelsinG containsuchgroup-denotingattributes,C canrepresentdecisiontreesofagivendepthoverfeatures
(e.g.,allcombinationsofpairsofrace,gender,andage). TheMPRmetriccomparestheempiricalaverageofeach
c∈CovertheretrievedsetRtoitsexpectationunderthereferencedistributionQ. BydefiningQappropriately,wecan
flexiblyspecifydifferentstatisticalrepresentationgoals,suchasequalrepresentation(E [c(X)]=1/2forbinaryc)or
Q
proportionalrepresentationw.r.t. atargetpopulation. However,asC growsincomplexity,pre-specifyingE [c(X)]for
Q
allc∈C becomesinfeasible. Instead,MPRcanbeestimatedusingacarefullycurateddataset,whichwedefineinthe
nextsubsection.
Remark1. MPRisequivalenttothemaximummeandiscrepancy(MMD)ofrepresentationstatisticsinC between
theempiricaldistributionoverretrieveditemsRandthereferencedistributionQ. MMD-basedmetricshavealong
history[62,63]andareusedinhypothesistestingforcomparingdistributions. MMDisaparticularcaseoftheIntegral
ProbabilityMetric(IPM)[64,65],allowingustoborrowfromtherichliteratureonIPMstomeasureandensureMPR
inpractice.
Remark2. MPRcanbeviewedasthe“representationinretrieval”counterpartofmulti-groupfairnessmetricsfound
inclassification,suchasmultiaccuracy[49]andmulticalibration[48]. Whereasmultiaccuracyandmulticalibration
measure if classification error residuals are correlated with any group represented within a class C, MPR captures
proportionalrepresentationofgroupsinC withinasetofretrieveditems–afundamentallydifferentproblem. The
ideaofrepresentinggroupsintermsofa“computationallyidentifiable”classoffunctionsC isdirectlyinspiredbythe
multi-groupfairnessinclassificationliterature,andweadoptsimilarnotation(i.e.,candC).
CuratedDatasetsforProportionalRepresentation. AkeychallengeincomputingMPRisselectingthereference
representationdistributionQandmeasuringtheexpectationoffunctionsinC againstthisdistribution. Inthesimple
casewhereC consistsofasmallnumberoffunctionsindicatingmembershipinindividualgroups,wecouldpotentially
settheproportionalrepresentationtargetsE [c(X)]foreachgroupc∈C manually,e.g.,bydefiningatargetfraction
Q
ofmen/womenorindividualsfromdifferentethnicbackgrounds. Thisquicklybecomesinfeasiblewhentherearemany
intersectionalgroups–andimpossibleifC isuncountable. Moreover,inmostpracticalsettings,Qwillverylikelynot
haveasimpleclosed-formanalyticalexpression.
Inpractice,i.i.d. samplesdrawnforQmaybeavailable. Forinstance,theretrievaldatasetD itselfmaybedrawnfrom
R
thetargetpopulationforwhichweaimtopreserveproportionalrepresentationinretrieveditems. Alternatively,wemay
haveaccesstoadatasetthatwascarefullycuratedtoberepresentativeofadiversepopulation. Examplesincludethe
FairFacedataset[38],whichwasdesignedtobebalancedacrossrace,gender,andagegroups,andtheAVFSdataset
[66]. Moregenerally,werefertodatasetswithsamplesdrawnfromthetargetpopulationQasacurateddataset.
Definition 2 (Curated Dataset). Let Q be a probability distribution over Rd ×G tailored to account for diversity
andrepresentationofstakeholderswhoquerytheretrievaldataset. Thecurateddatasetwithmsamplesdrawnthe
distributionQisdenotedasD ≜ {xc,...,xc }. WedenotetheMPRofasetofretrieveditemsRrelativetothe
C 1 m
empiricaldistributionoverD asMPR(C,R,D ).
C C
4Multi-GroupProportionalRepresentation APREPRINT
TheexactnatureofthecurateddatasetD iscontext-dependentandmayvarybasedonthespecificapplicationand
C
desiredrepresentationgoals. Wecanalsoconditionthecurateddatasetonagivenquery. Specifically,foraqueryq,we
canretrieverelevantsamplesfromboththecurateddatasetD andtheretrievaldatasetD . Thesamplesretrieved
C R
fromD canthenserveasa“conditional”curateddataset,denotedasD ,whichcapturesthedesiredrepresentation
C C|q
targetspecifictothequeryq. Thisapproachallowsforamoregranularandcontext-awareproportionalrepresentation.
Inthenexttwosections,weintroducetheoreticalguaranteesandalgorithmsthatareagnostictothespecificchoice
ofD . Inotherwords,ourproposedmethodsformeasuringandpromotingMPRinretrievalaregeneralandcanbe
C
appliedregardlessofhowthecurateddatasetisconstructed. Inournumericalexperiments(Section5),weuseFairFace
[38]asthecurateddataset.
3 ComputingMulti-GroupProportionalRepresentation
Computing MPR in Defnition 1 requires approximating two quantities: the representation distribution Q and the
supremumsup . WefirstestablishgeneralizationboundsforapproximatingQusingi.i.d. samples. Wethenshow
c∈C
howtocomputesup forseveralclassesofrepresentationstatisticsC.
c∈C
Error in approximation Q via a curated dataset. Proposition 1, proved in Appendix A, bounds the deviation
betweentheempiricalMPRcomputedoverthecurateddatasetD drawni.i.d. fromreferencedistributionQandthe
C
trueMPRmeasuredoverQ.
Proposition1(GeneralizationGapofMPR). LetR(q) = {xr}k beasetofkretrievedsamples,D = {xc}m
i i=1 C i i=1
be a curated dataset comprised of m i.i.d. samples from a target representation distribution Q, and δ > 0. If
C ={c:Rd×G →{−1,1}}withRademachercomplexityR (C)then,withprobabilityatleast1−δ,
m
(cid:114)
log(2/δ)
|MPR(C,R,D )−MPR(C,R,Q)|≤R (C)+ . (2)
C m 8m
WecanextendProposition1toanysetofboundedfunctionsC (see,e.g.,boundsonempiricalMMDestimatesin[63]).
Notethattheguaranteein(2)onlyholdsforasinglesetofretrieveditemsRinresponsetoaquery. Proposition2
providesaboundonthesizemofani.i.d. curateddatasetD thatensuresanϵ-accurateestimateofMPRforasetof
C
M queries.
Proposition2(QueryBudgetGuarantee). ConsideranysetofM queriesQ={q ,...,q }whereM ∈N. LetVC(C)
1 M
denotetheVC-dimensionoftheclassC withrangein{−1,1}. Forϵ > 0,ifD consistsofmi.i.d. samplesdrawn
C
fromQwheremsatisfies
32VC(C)
2log(cid:0)2M(cid:1)
m≥ + δ , (3)
ϵ2 2ϵ2
then,withprobabilityatleast1−δ,|MPR(C,R,D )−MPR(C,R,Q)|≤ϵ.
C
TheaboveresultsprovideguidelinesonthesizeofthecurateddatasetrequiredtoaccuratelyestimateMPRrelativetoa
truetargetrepresentationdistributionQ. IftheclassofrepresentationstatisticsC isverycomplex(intheVC-dimension
sense),thenthesizemofthecurateddatasetD mustbeproportionallylargetorepresentQaccurately. Hence,the
C
curationdatasetshouldbedesignedhavinginmind(i)thenumberofdiversequeriesbeingaskedand(ii)thecomplexity
ofthefunctionclassC. WhileProposition2providesaconservativebound,asgeneralizationboundsareoftennottight
[67],theseresultsneverthelessofferinsightintotherelationshipbetweenthecomplexityofC andtheaccuracyofMPR
estimation.
Intheremainderofthepaper,weassumethatMPRiscomputedagainstafixedcurateddatasetD ofsizem. We
C
considerfourspecificinstantiationsofthesetofrepresentationstatisticsC: (i)C isclosedunderscalarmultiplication,
i.e.,ifc∈C,thenλc∈C foranyλ∈R,(ii)C isasetoffunctionstakingvaluesin{−1,1};(iii)C consistsoflinear
functions;and(iv)CconsistsoffunctionsinaReproducingKernelHilbertSpace(RKHS).Next,weshowthatforcases
(i)and(ii)MPRcanbecomputedusingcallstoanoraclethatperformsregressionoverC and,forlinearfunctions(iii),
MPRhasasimpleclosed-formexpression. Duetoitstechnicalnature,wedeferthecalculationofMPRforfunctionsin
anRKHStoAppendixB.2.
ComputingMPRviaMeanSquareError(MSE)Minimization. WhenC isclosedundermultiplicationorconsists
ofbinaryfunctionswithvalues−1,1,MPRcanbeexpressedasanMSEminimization. Thisenablesustocompute
MPRbyleveragingexistingblack-boxoraclesthatperformregressionunderquadraticloss,suchasregressors/classifiers
implementedinMLlibrarieslikescikit-learn[68].
5Multi-GroupProportionalRepresentation APREPRINT
The key observation for expressing MPR as an MSE minimization is that MPR can be formulated as a maximum
correlationproblem. Considerthe(row-wise)concatenationoftheretrievaldatasetD andthecurateddatasetD ,
R C
givenbyX≜[xr,...,xr,xc,...,xc ],wherex isthei-thentryofX. Fortheremainderofthissection,weconsider
1 n 1 m i
afixedsetofretrieveditemsR. Leta∈{0,1}n beavectorindicatingitemsthatareretrievedfromD foragiven
R
query,i.e.,a =1⇔xr ∈R. Underthisnotation,whereretrieveditemsareindicatedbythevectora,MPRcanbe
i i
reformulatedas
(cid:12) (cid:12) (cid:12) (cid:12)
(cid:12)1 (cid:88)n 1 (cid:88)m (cid:12) (cid:12)n (cid:88)+m (cid:12)
MPR(C,R,D )=sup(cid:12) a c(xr)− c(xc)(cid:12)=sup(cid:12) c(x )a (cid:12), (4)
C (cid:12)k i i m i (cid:12) (cid:12) i (cid:101)i(cid:12)
c∈C(cid:12) (cid:12) c∈C(cid:12) (cid:12)
i=1 i=1 i=1
where a (cid:101) ∈ Rn+m has i-th entry given by (cid:101)a i ≜ 1 i≤na ki −1 i>nm1. This reformulation will be useful for explicitly
castingMPR-constrainedretrievalasanoptimizationproblem.
WhenC consistsofbinaryfunctionsinrange{−1,1},MPRisequivalenttoregressionoverC ofaunderquadraticloss,
(cid:101)
since
n+m n+m
inf (cid:88) (c(x )−a )2 =n+m+a⊺ a+2sup (cid:88) c(x )a . (5)
i (cid:101)i (cid:101) (cid:101) i (cid:101)i
c∈C c∈C
i=1 i=1
Theabsolutevaluein(4)canberecoveredbyregressing−ainsteadofa.
(cid:101) (cid:101)
Most classes of regression functions in R are closed under scalar multiplication (e.g., multiplying the output of a
decisiontreeregressorbyaconstantstillyieldsadecisiontreeregressor). However,inthiscase,itfollowsfrom(4)
thatMPRisunbounded. EvenforboundedC,withoutpropernormalizationMPRcanscalewithdatasetsize,whichis
undesirableforarepresentationalmeasure. WeconstrainC toasetofnormalizedfunctionsforMPRtobeboundedand
independentofdatasetsize. ThisconstraintalsoallowsustocastMPRasanMSEminimizationoverC. Weformally
state this result next, proven in Appendix A, which will be applied in Section 4 to develop a cutting-plane-based
algorithmforensuringMPRinretrievalcalledMAPR.
Proposition 3. Let C′ ≜ {c ∈ C | (cid:80)m+nc(x )2 = mk } where C is closed under scalar multiplication. Let
i=1 i m+k
c(X)=[c(x ),...,c(x )]. Then
1 n+m
0≤MPR(C′,R,D )≤1, (6)
C
andforany
n+m
(cid:88)
c∗ ∈arginf (c(x )−a )2, (7)
i (cid:101)i
c∈C
i=1
√
letcˆ:X →Rbedefinedascˆ(x)= C c∗(x). Then,wehavethat
∥c∗(X)∥2
(cid:12) (cid:12)
(cid:12)n (cid:88)+m (cid:12)
cˆ∈argsup(cid:12) c(x )a (cid:12). (8)
(cid:12) i (cid:101)i(cid:12)
c∈C′ (cid:12) (cid:12)
i=1
ComputingMPRforBounded-NormLinearRegression. Recallthateachitemintheretrievalorcurateddatasetsis
oftheformx =(e ,g ),wheree isanembeddingandg−iarelabels. Whenx ∈Rl (i.e.,thelabelshavenumerical
i i i i i
values),wecanconsiderC asalinearsetoffunctionsoverretrieveditems. Inthiscase,MPRenjoysaclosed-form
expression,asstatedinthenextproposition.
Proposition 4. Let items in the retrieval and curated datasets be vectors in Rl for l < m + n and C =
(cid:8) x(cid:55)→w⊺x|w ∈Rk(cid:9) .Moreover,letX∈R(m+n)×l bethematrixformedbyconcatenatingitemsintheretrievaland
curateddatasetD andD ,respectively. ForC′inProposition3,wehave
R C
(cid:114)
mk
MPR(C′,R,D )= ∥U⊺ a∥ , (9)
C m+k l(cid:101) 2
whereX=UΣV⊺istheSVDofXandU ∈R(m+n)×l aretheleftsingularvectorsinUcorrespondingtothetop-l
l
largestsingularvalues.1
Theabovepropositioncanbedirectlyadaptedtolinearfunctionsdefinedonlyoverembeddingsorasubsetoffeatures
ofretrieveditems. Theclosed-formexpressionforMPRin(9)alsoallowsMPR-constrainedretrievaltobecomputed
byaquadraticprogram,asdiscussedinAppendixB.1.
1ForanalysisoffunctionsinanRKHS,seeAppendixB.2
6Multi-GroupProportionalRepresentation APREPRINT
Algorithm1MAPR(Multi-groupAwareProportionalRetrieval)
Input:D ,queryq,numberofiterationsT,numberofitemstoretrievek,MPRconstraintρ,Oracle(a)thatcomputessolves
R
(4)andreturnsc∈Cthatapproximatesthesup.
1: C(cid:101)←∅,s
i
=κ(xr i,q)
2: foriter∈{1,2,...,T}do
3: a←argmax a∈[0,1]ma⊺ssubjectto(cid:12) (cid:12) k1(cid:80)n i=1a ic(xr i)− m1 (cid:80)m i=1c(xc i)(cid:12) (cid:12)≤ρforc∈C(cid:101)
4: (mpr_violation,c)←Oracle(a) ▷Solve(4)
5: ifmpr_violation≤ρoriter=T then
6: returnR←{xr ∈D correspondingtoklargestentriesofa }
i R i
7: else
8: C(cid:101)←C(cid:101)∪{c}
9: endif
10: endfor
4 PromotingMulti-GroupProportionalRepresentationinRetrievalTasks
Next,wedevelopanoptimizationframeworkforretrievingthekmostsimilaritemsinavectordatabasetoagivenquery
qwhilesatisfyingatargetMPRthresholdofρ. Weformulatetheretrievalgoalasmaximizingtheaveragesimilarity
betweenaqueryandretrieveditems,givenbys =κ(xr,q)(recallSection2fornotation),whereκ(xr,q)isgivenby
i i i
cosinesimilarityinourexperiments. TheproblemofmaximizingutilityinretrievalwhilesatisfyinganMPRconstraint
(expressedasEq. (4))canbeformulatedastheintegerprogram:
(cid:12) (cid:12)
max a⊺ s subjectto
sup(cid:12) (cid:12)1 (cid:88)n
a c(xr)−
1 (cid:88)m c(xc)(cid:12)
(cid:12)≤ρ,
(cid:88)k
a =k. (10)
a∈{0,1}n c∈C(cid:12) (cid:12)k i i m i (cid:12) (cid:12) i
i=1 i=1 i=1
WhenC isgivenbynormalizedlinearfunctionsasinProposition4,theintegerconstraintscanberelaxedtoa∈[0,1]n
andtheoptimizationcanbeapproximatedviastandardquadraticsolvers;seeAppendixB.1.
Multi-GroupAwareRetrieval. Weapproximate(10)viatheMulti-GroupAwareProportionalRetrievalAlgorithm
(MAPR),describedinAlgorithm1. MAPRisessentiallyacutting-planemethodthataimstofindasetofk itemsthat
maximizeutilitywhileapproximatelysatisfyinganMPRconstraintofρ. Thealgorithmiteratesbetween(i)acall
toanoraclethatcomputesMPRandreturnsafunctionc ∈ C thatachievesthesupremumin(4)and(ii)acalltoa
linearprogram(LP)solverthatapproximatesthetop-kmostsimilaritemstoaquerysubjecttolinearconstraintsonthe
violationmeasuredbyc. EachoraclecalladdsanadditionalconstrainttotheLPsolverwhich,inturn,approximatesthe
top-kitemsunderanincreasingsetofconstraints. ThesolutionoftheLPisroundedtosatisfytheintegerconstraint
a ∈ {0,1}n. Inourimplementation,weassumethatMPRcanbecomputedviaMSEminimization(cf. Section3)
–inwhichcaseweconsiderthenormalizedclassC′. Theoraclecallconsistsofrunningablack-boxquadraticloss
minimizationoverC.
Interestingly,weobservethat,despiterelaxingtheintegerconstraintsineachLPcall,thesolutiontotherelaxedproblem
isverysparseand(afterrounding)approximateswellthesolutionoftheidealintegerprogram(10)formoderatevalues
ofρ. However, themethodcanfailtoaccuratelyapproximatetheIPsolutionwhenρissmall. Wepresentamore
detailedanalysisofMAPRinAppendixB,whichdiscussespotentialconvergenceissueswiththecuttingplanemethod
aswellasstoppingconditions.
5 NumericalExperiments
Inthissection,weshowthatMAPRiseffectiveinpromotingmoreproportionalrepresentationacrossintersectionalgroups
whilepreservingsimilaritybetweenretrieveditemsandagivenquery. Notably,MAPRPareto-dominatescompeting
benchmarksintermsofachievedMPRgapandutility.
Datasets. Weconductretrievaloverthreeimagedatasetsoffaces: CelebA[37],whichincludeslabelsforgender,
age,andvariousotherattributes,UTKFace[39],whichcontainsgender,age,andraceattributes,andOccupations
[2],whichcontainsgenderattributes. WecomputeMPRusingFairFace[38]asthecurateddatasetD ,sinceitisa
C
carefullydesigneddatasetoffaceswithsubgroupattributesforrace,gender,andage. Inallcases,eachdatasetentry
consistsofanimage(CLIP)embeddinge andasetoflabelsg .
i i
Benchmarks. Wecompareourmethodwithfourbaselines. DebiasClip[20]modifiestextquerieswithaprepended
learnedembeddingfordebiasedretrievalbutdoesnotallowfortunablecontroloftherepresentation-similaritytrade-off,
7Multi-GroupProportionalRepresentation APREPRINT
Table1:Retrievalaveragedover10querieswith50retrievalsonUTKFacedataset[39]forMAPR,k-NN,andMMR[27].Entries
indicateaveragepercentagerepresentationinretrieveditems.MAPRisabletobalancerepresentationacrossclasses,whereask-NN
andMMRmissintersectionalgroups(highlightedinred).
White Black Asian Indian Others Sum
Male 21.2±11.84 13.2±7.70 10.8±7.54 21.2±20.70 1.4±1.56 67.8±23.72
Top-K Female 17.2±21.04 6.6±6.14 4.0±2.82 2.8±2.56 1.6±1.50 32.2±23.72
Sum 38.4±17.18 19.8±12.56 14.8±7.38 24±19.38 3.0±2.04
Male 28.8±8.96 11.0±4.58 10.2±4.04 10.8±2.40 3.8±1.06 64.6±7.74
MMR Female 16.2±9.06 7.6±3.66 5.0±3.00 4.0±1.26 2.6±1.56 35.4±7.74
Sum 45.0±7.76 18.6±5.38 15.2±5.82 14.8±3.12 6.4±1.96
Male 7.8±3.74 10.2±2.90 13.0±2.56 11.8±2.44 7.2±3.70 50±0
MAPR (Ours) Female 12.2±3.74 9.8±2.90 7.0±2.56 8.2±2.44 12.8±3.70 50±0
Sum 20±0 20±0 20±0 20±0 20±0
soitonlyresultsinasingleretrievalsetoverwhichwecomputesimilarityandMPR.ClipClip[18]trimsfeatures
fromCLIPembeddingsthathavehigh“mutualinformation”withgender,allowingforcontrolofhowmanyfeatures
areclippedfromtheembedding. PBM[29]post-processesCLIPembeddingstomitigatebiasbypredictinggender
attributesandsubsamplingfromeachgenderequally. PBMalsoallowstuningtherepresentation-similaritytradeoff
bycontrollingthelikelihoodofsamplingatrandomorinabalancedmannerfromtheretrievaldataset. Finally,the
state-of-the-artforfairretrievalisthePATHSalgorithm[27],whichusesasetofadjective-nounkeywordstocapture
abroadsetofidentityvectorsinvision-languagemodels,andthengreedilysamplesusingtheMMR[45]algorithm
tonavigatetherepresentation-similaritytradeoff. However,theauthors’methodofcomputingPATHSembeddingsis
notpublic,soweusedCLIPembeddingstoreplicatetheiralgorithm. WerefertothismethodasMMR.Foradetailed
discussionofthesealgorithmsandtheirapproachestorepresentation,seeAppendixC.
ExperimentalSetup. WeconsidertwoclassesofrepresentationstatisticsC: linearregressionanddecisiontrees.
Inbothcases,wecomputeMPRoverC′,i.e.,C normalizedovertheretrievalandcurateddatasets(seeProp. 3). To
accelerateretrieval,wequeryeachofourretrievaldatasetsforthetop10kitemsaccordingtotheprompt“A photo of
a {query}"intermsofrawsimilarityusingFAISS[69]. Wesimilarlyretrievethetop10kitemsfromFairFaceasthe
query-conditionedcurateddatasetD . Onereasonwefirstfilterforthetop10kitemsistheruntimeofMMR,whichis
C
agreedyalgorithmthattraversesthefulldatasetforeachretrievalk(evenfor10kentriesandk =50retrieveditems,
MMRtakeshourstorunfor10queries). Weaggregateresultsover10queriesforoccupationssuggestedbyChatGPT
3.5(AppendixE).
Inordertoevaluaterepresentationoverinterpretablepopulationgroups,weconsiderthatrepresentationstatisticsC are
computedonlyoverlabelsg giveninFairFace. Theselabelsarenotpresentinallretrievaldatasets. Thus,forCelebA
i
andOccupations,wetrainlinearprobesonFairFace’sCLIPembeddingstopredicttheirraceandageattributes,and
whenusingUTKFace,wemapfromFairFace’sracelabelstoUTKFace’sracelabelsbymappingSoutheast Asian
andEast AsiantoAsianandMiddle EasternandLatino_HispanictoOther. WhilethefairMLcommunity
shouldengageinbroaderdiscussionsaddressingtheethicsofpredictingsensitiveattributesfromCLIPembeddings
andtheissuessurroundingthegroupingandre-groupingofdiverseracialidentities,weacknowledgethattheseare
larger-scaleissuesthatourworkdoesnotpresumetoaddress.Instead,ourexperimentsaimtodemonstratetheflexibility
andscalabilityoftheMPRmetricinhandlingcomplexintersectionalgroupsasdatasetsbecomemorerepresentative.
Weretrievek =50itemsforeachoftheabovequeries. Foragivenfunctionclassandquery,wecomputethebaseline
MPRandaveragecosinesimilarityforthetop50mostsimilaritems. Then,weconductaparametersweepoverρ
startingfromthismax-MPRvalue,inputtingeachvaluetoMAPRinAlgorithm1.
Results. WeincludeplotsforthreedatasetsforlinearregressionmodelsinFig.1withadditionalresultsfordecision
treesandMLPsinAppendixD.WeobservethatMAPRPareto-dominatesbenchmarkmethods,andisabletopreserve
similaritywhilereachinglowerlevelsofMPR.Interestingly, methodsbasedondirectlymodifyingembeddingsor
queriesforasinglegroupattributesuchasClipClipandDebiasCliponlypartiallyreduceMPRatahighutilitycost.
ThemostcompetitivemethodtooursisMMR,whichisourattempttoreplicatePATHS.ThoughMMRiscompetitive
tooursforlargeMPR,itfailstoachievesmallvaluesofMPRrelativetoMAPR.ItisalsonotablethatMAPRcandrive
MPRtonearzeroforUTKFace,yetgapsremaininCelebAandOccupations,indicatingbiasesinthesedatasetsrelative
toFairFace.
InFig. 2,weevaluatethequalityofMAPRintermsoftheprecisionoftheretrievedimagesontheOccupationsdataset,
whichhasgroundtruthoccupationlabelswecanqueryfor. WeobservethatMAPR retainssimilarprecisionvalues
8Multi-GroupProportionalRepresentation APREPRINT
Ours MMR PBM ClipCLIP DebiasClip
Ours Fit MMR Fit PBM Fit ClipCLIP Fit
1.0 1.0 1.0
0.9 1.0 0.9 0.9
0.8
0.8
0.8 0.9 0.7
0.7
0.6 0.7
0.8 0.6 0.5
0.6 0.5 0.4
0.7
0.4 0.3
0.7 0.8 0.9 1.0 1.1 1.2 1.3 0.0 0.2 0.4 0.6 0.8 1.0 1.2 1.4 0.7 0.8 0.9 1.0 1.1
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
0.6
Figure1:FractionofTop-kcosinesimilarityvsFractionofTop-kMPRaveragedover10queriesfork=50imagesretrieved.From
Left-to-Right:CelebA,UTKFac0es.5,Occupations.Valuesarenormalizedsok-NNachievespoint(1,1)ineachcase.MAPRPareto-
dominatesbaselinesandsignificantlyclosestheMPRgap.
0.4
0.0 0.5 1.0
Query: chief_executive_officer
Query: lawyer
0.40 MAPR (Ours) Fraction of Top-k MPR
1.00 MAPR (Ours)
MMR
MAPR Top-k
0.35 ClipCLIP
0.99 QP Top-k
PBM
QP
0.30 DebiasClip 0.98
0.25 0.97
0.20 0.96
0.15 0.95
0.10 0.94
0.05 0.93
0.92
0.2 0.4 0.6 0.8 1.0
0.0 0.2 0.4 0.6 0.8 1.0
Fraction of Top-k MPR
Fraction of Top-k MPR
Figure2:PrecisionofMAPRontheOccupationsdatasetfor
Figure3:ComparisonofMAPR(iterativelinearprogram)to
occupation“ChiefExecutiveOfficer". Ourmethodmaintains
quadraticprogramoptimizationofclosedformMPRforlinear
similarprecision-representationperformancewhencompared
regression.Formostvaluesofρ,MAPRisnear-optimaltothe
withbaselines.
QP.Inaddition,selectingthetop-kentriestoconductretrieval
fromtheLPdoesnotincursignificantcostintermsofsimilarity.
acrosslevelsofrepresentationwithexistingmethodsandmorefullyexplorestheprecision-representationtrade-off
curve. InFig. 2,weshowresultsforthequery“Aphotoofachiefexecutiveofficer”withresultsforadditionalqueries
inAppendixD.
InthecasewhereC consistsoflinearmodels,Proposition3providesaclosed-formsolutiontoMPR.Weevaluate
MAPRagainstaquadraticprogramdirectlyoptimizingforProp3asdemonstratedinAppendixB.1andalsocompare
results when rounding the relaxed problem to actually retrieve k items (Top-k). Fig 3 demonstrates that with fifty
iterations,MAPRisnear-optimalatalllevelsofrepresentationtoadirectoptimizationoftheclosedformofMPR.
InTable1,weconstructasyntheticcurationsetofperfectlybalancedgroupattributes. Thisrepresentsastylizedworld
whereproportionalrepresentationisequalrepresentationacrossallgroups. OurresultsdemonstratethatMAPRcan
exactlyachieveourequalrepresentationgoalswhenprovidedwithanidealizedcurationdataset,whereaspriorbaselines
–seeDebiasCLIP,ClipCLIP,andPBMinAppendixTable3)–underrepresentseveralintersectionalgroups.
6 ConcludingRemarksandLimitations
In this work, we introduced a novel retrieval metric called Multi-group Proportional Representation (MPR) and
developedalgorithmstoensureMPRinretrievaltasks. Bymeasuringdeviationsinasetofrepresentationstatistics,
MPRprovidesascalableapproachtoquantifyingandenforcingproportionalrepresentationforcomplex,intersectional
groups. WeanalyzedthegeneralizationpropertiesandrealizableregimesofMPRand,throughexperimentsinimage
retrieval,demonstrateditsfavorableutility-fairnesstrade-offcomparedtoexistingfairretrievalalgorithms.
9
ytiralimiS
k-poT
fo
noitcarF
noisicerP
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarFMulti-GroupProportionalRepresentation APREPRINT
Ourworkhaslimitationsthatofferopportunitiesforfutureresearch. First,whileMPRisdesignedtohandlealarge
number of groups, the computational complexity of the proposed cutting-plane algorithm in the case of a general
function class C can be a concern for high-dimensional feature spaces. Developing more efficient algorithms or
approximationtechniquescouldhelpaddressthisissue. Second,whilewefocusedonretrievaltasks,adaptingMPR
to other domains, such as ranking, recommendation systems, and image generation, could broaden its impact and
applicability. Futureresearchcouldalsoinvestigatethelong-termsocietalimpactofenforcingMPRinreal-world
retrievalsystemstounderstanditspotentialbenefitsandrisks. Finally,MPRisinherentlylimitedbythecurateddataset.
If this dataset is biased against a given group, this bias will be propagated by MAPR. The creation and selection of
curateddatasetsmustcarefullyaccountforstakeholderinterestandtargetrepresentationstatistics.
7 Acknowledgements
TheauthorswouldliketothankthediscussionswithFilipeGoulartCabral. Thismaterialisbaseduponworksupported
bytheNationalScienceFoundationunderawardsCAREER-1845852,CIF-1900750,CIF-2231707,andCIF-2312667,
FAI-2040880,andalsobytheNationalScienceFoundationGraduateResearchFellowshipunderGrantNo. DGE-
2140743. Theviewsexpressedherearethoseoftheauthorsanddonotreflecttheofficialpolicyorpositionofthe
fundingagencies.
References
[1] SolonBarocas,MoritzHardt,andArvindNarayanan. Fairnessandmachinelearning: Limitationsandopportuni-
ties. MITPress,2023.
[2] MatthewKay,CynthiaMatuszek,andSeanAMunson. Unequalrepresentationandgenderstereotypesinimage
searchresultsforoccupations. InProceedingsofthe33rdannualacmconferenceonhumanfactorsincomputing
systems,pages3819–3828,2015.
[3] KateCrawford. Thetroublewithbias,2017. AccessedMay1,2024.https://www.youtube.com/watch?v=
fMym_BKWQzk.
[4] SarahMyersWest,MeredithWhittaker,andKateCrawford. Discriminatingsystems. AINow,pages1–33,2019.
[5] SolonBarocas,KateCrawford,AaronShapiro,andHannaWallach. Theproblemwithbias: Allocativeversus
representationalharmsinmachinelearning. In9thAnnualconferenceofthespecialinterestgroupforcomputing,
informationandsociety,page1.Philadelphia,PA,USA,2017.
[6] Sanjana Gautam, Pranav Narayanan Venkit, and Sourojit Ghosh. From melting pots to misrepresentations:
Exploringharmsingenerativeai. arXivpreprintarXiv:2403.10776,2024.
[7] HariniSureshandJohnGuttag. Aframeworkforunderstandingsourcesofharmthroughoutthemachinelearning
lifecycle. InProceedingsofthe1stACMConferenceonEquityandAccessinAlgorithms,Mechanisms,and
Optimization,pages1–9,2021.
[8] JaredKatzman,AngelinaWang,MorganScheuerman,SuLinBlodgett,KristenLaird,HannaWallach,andSolon
Barocas. Taxonomizingandmeasuringrepresentationalharms: Alookatimagetagging. InProceedingsofthe
AAAIConferenceonArtificialIntelligence,volume37,pages14277–14285,2023.
[9] Shreya Shankar, Yoni Halpern, Eric Breck, James Atwood, Jimbo Wilson, and D Sculley. No classification
withoutrepresentation: Assessinggeodiversityissuesinopendatasetsforthedevelopingworld. arXivpreprint
arXiv:1711.08536,2017.
[10] Sasha Luccioni, Christopher Akiki, Margaret Mitchell, and Yacine Jernite. Stable bias: Evaluating societal
representationsindiffusionmodels. AdvancesinNeuralInformationProcessingSystems,36,2024.
[11] Federico Bianchi, Pratyusha Kalluri, Esin Durmus, Faisal Ladhak, Myra Cheng, Debora Nozza, Tatsunori
Hashimoto,DanJurafsky,JamesZou,andAylinCaliskan. Easilyaccessibletext-to-imagegenerationamplifies
demographicstereotypesatlargescale. InProceedingsofthe2023ACMConferenceonFairness,Accountability,
andTransparency,pages1493–1504,2023.
[12] AlexanderLin,LucasMonteiroPaes,SreeHarshaTanneru,SurajSrinivas,andHimabinduLakkaraju. Word-level
explanationsforanalyzingbiasintext-to-imagemodels. arXivpreprintarXiv:2306.05500,2023.
[13] LatanyaSweeney. Discriminationinonlineaddelivery. CommunicationsoftheACM,56(5):44–54,2013.
[14] DanaëMetaxa, MichelleAGan, SuGoh, JeffHancock, andJamesALanday. Animageofsociety: Gender
and racial representation and impact in image search results for occupations. Proceedings of the ACM on
Human-ComputerInteraction,5(CSCW1):1–23,2021.
10Multi-GroupProportionalRepresentation APREPRINT
[15] YunheFengandChiragShah. HasCEOGenderBiasReallyBeenFixed? AdversarialAttackingandImproving
GenderFairnessinImageSearch. InProceedingsoftheAAAIConferenceonArtificialIntelligence,volume36,
pages11882–11890,2022.
[16] Jahna Otterbacher, Jo Bates, and Paul Clough. Competent men and warm women: Gender stereotypes and
backlash in image search results. In Proceedings of the 2017 chi conference on human factors in computing
systems,pages6620–6631,2017.
[17] RobertoUlloa,AnaCarolinaRichter,MykolaMakhortykh,AleksandraUrman,andCelinaSylwiaKacperski.
Representativenessandface-ism: Genderbiasinimagesearch. newmedia&society,26(6):3541–3567,2024.
[18] JialuWang,YangLiu,andXinWang. Aregender-neutralqueriesreallygender-neutral? mitigatinggenderbiasin
imagesearch. InProceedingsofthe2021ConferenceonEmpiricalMethodsinNaturalLanguageProcessing,
pages1995–2008,2021.
[19] JunyangWang,YiZhang,andJitaoSang. Fairclip: Socialbiaseliminationbasedonattributeprototypelearning
andrepresentationneutralization. arXivpreprintarXiv:2210.14562,2022.
[20] HugoBerg,SiobhanHall,YashBhalgat,HannahKirk,AleksandarShtedritski,andMaxBain. Apromptarray
keepsthebiasaway: Debiasingvision-languagemodelswithadversariallearning. InProceedingsofthe2nd
ConferenceoftheAsia-PacificChapteroftheAssociationforComputationalLinguisticsandthe12thInternational
JointConferenceonNaturalLanguageProcessing(Volume1: LongPapers),pages806–822,2022.
[21] JaeMyungKim,A.SophiaKoepke,CordeliaSchmid,andZeynepAkata. Exposingandmitigatingspurious
correlationsforcross-modalretrieval. 2023IEEE/CVFConferenceonComputerVisionandPatternRecognition
Workshops(CVPRW),pages2585–2595,2023.
[22] Mohsen Abbasi, Sorelle A Friedler, Carlos Scheidegger, and Suresh Venkatasubramanian. Fairness in repre-
sentation: quantifyingstereotypingasarepresentationalharm. InProceedingsofthe2019SIAMInternational
ConferenceonDataMining,pages801–809.SIAM,2019.
[23] AlecRadford,JongWookKim,ChrisHallacy,AdityaRamesh,GabrielGoh,SandhiniAgarwal,GirishSastry,
AmandaAskell,PamelaMishkin,JackClark,etal. Learningtransferablevisualmodelsfromnaturallanguage
supervision. InInternationalconferenceonmachinelearning,pages8748–8763.PMLR,2021.
[24] SiobhanMackenzieHall,FernandaGonçalvesAbrantes,HanwenZhu,GraceSodunke,AleksandarShtedritski,
andHannahRoseKirk. Visogender: Adatasetforbenchmarkinggenderbiasinimage-textpronounresolution.
AdvancesinNeuralInformationProcessingSystems,36,2024.
[25] RobertWolfeandAylinCaliskan. Markednessinvisualsemanticai. InProceedingsofthe2022ACMConference
onFairness,Accountability,andTransparency,pages1269–1279,2022.
[26] TolgaBolukbasi,Kai-WeiChang,JamesYZou,VenkateshSaligrama,andAdamTKalai. Manistocomputer
programmeraswomanistohomemaker? debiasingwordembeddings. Advancesinneuralinformationprocessing
systems,29,2016.
[27] Hansa Srinivasan, Candice Schumann, Aradhana Sinha, David Madras, Gbolahan Oluwafemi Olanubi, Alex
Beutel, Susanna Ricco, and Jilin Chen. Generalized people diversity: Learning a human perception-aligned
diversityrepresentationforpeopleimages. arXivpreprintarXiv:2401.14322,2024.
[28] AnayMehrotraandElisaCelis. Mitigatingbiasinsetselectionwithnoisyprotectedattributes. Proceedingsofthe
2021ACMConferenceonFairness,Accountability,andTransparency,2020.
[29] FanjieKong,ShuaiYuan,WeituoHao,andRicardoHenao. Mitigatingtest-timebiasforfairimageretrieval.
AdvancesinNeuralInformationProcessingSystems,36,2024.
[30] ElisaCelis,VijayKeswani,DamianStraszak,AmitDeshpande,TarunKathuria,andNisheethVishnoi. Fairand
diversedpp-baseddatasummarization. InInternationalconferenceonmachinelearning,pages716–725.PMLR,
2018.
[31] L Elisa Celis and Vijay Keswani. Implicit diversity in image summarization. Proceedings of the ACM on
Human-ComputerInteraction,4(CSCW2):1–28,2020.
[32] KimberleCrenshaw. Demarginalizingtheintersectionofraceandsex: Ablackfeministcritiqueofantidiscrimina-
tiondoctrine,feministtheoryandantiracistpolitics. InUniversityofChicagoLegalForum,volume1989,page8,
1989.
[33] KimberléWilliamsCrenshaw. Mappingthemargins: Intersectionality,identitypolitics,andviolenceagainst
womenofcolor. InThepublicnatureofprivateviolence,pages93–118.Routledge,2013.
[34] SumiCho,KimberléWilliamsCrenshaw,andLeslieMcCall. Towardafieldofintersectionalitystudies: Theory,
applications,andpraxis. Signs: Journalofwomenincultureandsociety,38(4):785–810,2013.
11Multi-GroupProportionalRepresentation APREPRINT
[35] JoyBuolamwiniandTimnitGebru. Gendershades: Intersectionalaccuracydisparitiesincommercialgender
classification. InConferenceonfairness,accountabilityandtransparency,pages77–91.PMLR,2018.
[36] MichaelKearns,SethNeel,AaronRoth,andZhiweiStevenWu. Preventingfairnessgerrymandering: Auditing
andlearningforsubgroupfairness. InInternationalconferenceonmachinelearning,pages2564–2572.PMLR,
2018.
[37] ZiweiLiu,PingLuo,XiaogangWang,andXiaoouTang. Deeplearningfaceattributesinthewild. InProceedings
ofInternationalConferenceonComputerVision(ICCV),December2015.
[38] KimmoKarkkainenandJungseockJoo. Fairface: Faceattributedatasetforbalancedrace,gender,andageforbias
measurementandmitigation. InProceedingsoftheIEEE/CVFwinterconferenceonapplicationsofcomputer
vision,pages1548–1558,2021.
[39] ZhifeiZhang,YangSong,andHairongQi. Ageprogression/regressionbyconditionaladversarialautoencoder. In
IEEEConferenceonComputerVisionandPatternRecognition(CVPR).IEEE,2017.
[40] RichZemel,YuWu,KevinSwersky,ToniPitassi,andCynthiaDwork. Learningfairrepresentations. InSanjoy
DasguptaandDavidMcAllester,editors,Proceedingsofthe30thInternationalConferenceonMachineLearning,
volume28ofProceedingsofMachineLearningResearch,pages325–333,Atlanta,Georgia,USA,17–19Jun
2013.PMLR.
[41] HarrisonEdwardsandAmosStorkey.Censoringrepresentationswithanadversary.In4thInternationalConference
onLearningRepresentations,pages1–14,2016.
[42] DavidMadras,ElliotCreager,ToniannPitassi,andRichardZemel. Learningadversariallyfairandtransferable
representations. InJenniferDyandAndreasKrause,editors,Proceedingsofthe35thInternationalConferenceon
MachineLearning,volume80ofProceedingsofMachineLearningResearch,pages3384–3393.PMLR,10–15
Jul2018.
[43] ElliotCreager,DavidMadras,Jörn-HenrikJacobsen,MarissaWeis,KevinSwersky,ToniannPitassi,andRichard
Zemel. Flexiblyfairrepresentationlearningbydisentanglement. InInternationalconferenceonmachinelearning,
pages1436–1445.PMLR,2019.
[44] XiuboGeng,Tie-YanLiu,TaoQin,AndrewArnold,HangLi,andHeung-YeungShum. Querydependentranking
usingk-nearestneighbor. InProceedingsofthe31stannualinternationalACMSIGIRconferenceonResearch
anddevelopmentininformationretrieval,pages115–122,2008.
[45] JaimeCarbonellandJadeGoldstein. Theuseofmmr,diversity-basedrerankingforreorderingdocumentsand
producingsummaries. InProceedingsofthe21stannualinternationalACMSIGIRconferenceonResearchand
developmentininformationretrieval,pages335–336,1998.
[46] BarrySmythandPaulMcClave. Similarityvs.diversity. InInternationalconferenceoncase-basedreasoning,
pages347–361.Springer,2001.
[47] Evaggelia Pitoura, Kostas Stefanidis, and Georgia Koutrika. Fairness in rankings and recommendations: an
overview. TheVLDBJournal,pages1–28,2022.
[48] UrsulaHébert-Johnson,MichaelKim,OmerReingold,andGuyRothblum. Multicalibration: Calibrationfor
the(computationally-identifiable)masses. InInternationalConferenceonMachineLearning,pages1939–1948.
PMLR,2018.
[49] MichaelPKim,AmirataGhorbani,andJamesZou. Multiaccuracy: Black-boxpost-processingforfairnessin
classification. InProceedingsofthe2019AAAI/ACMConferenceonAI,Ethics,andSociety,pages247–254,
2019.
[50] MichaelPKim,ChristophKern,ShafiGoldwasser,FraukeKreuter,andOmerReingold. Universaladaptability:
Target-independentinferencethatcompeteswithpropensityscoring. ProceedingsoftheNationalAcademyof
Sciences,119(4):e2108097119,2022.
[51] EliranShabat,LeeCohen,andYishayMansour. Samplecomplexityofuniformconvergenceformulticalibration.
AdvancesinNeuralInformationProcessingSystems,33:13331–13340,2020.
[52] LucasMonteiroPaes,AnandaTheerthaSuresh,AlexBeutel,FlavioCalmon,andAhmadBeirami. Multi-group
fairnessevaluationviaconditionalvalue-at-risktesting. arXivpreprintarXiv:2312.03867,2023.
[53] ParikshitGopalan,LunjiaHu,andGuyNRothblum. Oncomputationallyefficientmulti-classcalibration. arXiv
preprintarXiv:2402.07821,2024.
[54] Parikshit Gopalan, Michael P Kim, Mihir A Singhal, and Shengjia Zhao. Low-degree multicalibration. In
ConferenceonLearningTheory,pages3193–3234.PMLR,2022.
12Multi-GroupProportionalRepresentation APREPRINT
[55] ZhunDeng,CynthiaDwork,andLinjunZhang. Happymap: Ageneralizedmulticalibrationmethod. In14th
InnovationsinTheoreticalComputerScienceConference,ITCS2023,page41.SchlossDagstuhl-Leibniz-Zentrum
furInformatikGmbH,DagstuhlPublishing,2023.
[56] DuncanBlack. TheoryCommitteesandElections. CambridgeUniversityPress,1958.
[57] JohnRChamberlinandPaulNCourant. Representativedeliberationsandrepresentativedecisions: Proportional
representationandthebordarule. AmericanPoliticalScienceReview,77(3):718–733,1983.
[58] BurtLMonroe. Fullyproportionalrepresentation. AmericanPoliticalScienceReview,89(4):925–940,1995.
[59] FriedrichPukelsheim. Proportionalrepresentation. Springer,2017.
[60] Jonathan K Hodge and Richard E Klima. The mathematics of voting and elections: a hands-on approach,
volume30. AmericanMathematicalSoc.,2018.
[61] AjilJalal,SushrutKarmalkar,JessicaHoffmann,AlexDimakis,andEricPrice. Fairnessforimagegeneration
withuncertainsensitiveattributes. InInternationalConferenceonMachineLearning,pages4721–4732.PMLR,
2021.
[62] KarstenMBorgwardt,ArthurGretton,MalteJRasch,Hans-PeterKriegel,BernhardSchölkopf,andAlexJSmola.
Integratingstructuredbiologicaldatabykernelmaximummeandiscrepancy. Bioinformatics,22(14):e49–e57,
2006.
[63] ArthurGretton, KarstenMBorgwardt, MalteJRasch, BernhardSchölkopf, andAlexanderSmola. Akernel
two-sampletest. TheJournalofMachineLearningResearch,13(1):723–773,2012.
[64] Alfred Müller. Integral probability metrics and their generating classes of functions. Advances in applied
probability,29(2):429–443,1997.
[65] BharathKSriperumbudur,KenjiFukumizu,ArthurGretton,BernhardSchölkopf,andGertRGLanckriet. Onthe
empiricalestimationofintegralprobabilitymetrics. ElectronicJournalofStatistics,6:1550–1599,2012.
[66] JeroneTheodoreAlexanderAndrews,PrzemyslawJoniak,andAliceXiang. Aviewfromsomewhere: Human-
centricfacerepresentations. InTheEleventhInternationalConferenceonLearningRepresentations,2022.
[67] YidingJiang,BehnamNeyshabur,HosseinMobahi,DilipKrishnan,andSamyBengio. Fantasticgeneralization
measuresandwheretofindthem. InInternationalConferenceonLearningRepresentations,2019.
[68] F.Pedregosa,G.Varoquaux,A.Gramfort,V.Michel,B.Thirion,O.Grisel,M.Blondel,P.Prettenhofer,R.Weiss,
V.Dubourg,J.Vanderplas,A.Passos,D.Cournapeau,M.Brucher,M.Perrot,andE.Duchesnay. Scikit-learn:
MachinelearninginPython. JournalofMachineLearningResearch,12:2825–2830,2011.
[69] JeffJohnson,MatthijsDouze,andHervéJégou. Billion-scalesimilaritysearchwithGPUs. IEEETransactionson
BigData,7(3):535–547,2019.
[70] PeterL.BartlettandShaharMendelson. Rademacherandgaussiancomplexities: Riskboundsandstructural
results. JournalofMachineLearningResearch,(1),2002.
[71] MartinJWainwright. High-dimensionalstatistics: Anon-asymptoticviewpoint,volume48. Cambridgeuniversity
press,2019.
[72] JunYang,ShengyangSun,andDanielMRoy. Fast-ratepac-bayesgeneralizationboundsviashiftedrademacher
processes. AdvancesinNeuralInformationProcessingSystems,32,2019.
[73] Yuheng Bu, Shaofeng Zou, and Venugopal V Veeravalli. Tightening mutual information-based bounds on
generalizationerror. IEEEJournalonSelectedAreasinInformationTheory,1(1):121–130,2020.
[74] AmirAsadi,EmmanuelAbbe,andSergioVerdú. Chainingmutualinformationandtighteninggeneralization
bounds. AdvancesinNeuralInformationProcessingSystems,31,2018.
[75] RonAmit,BaruchEpstein,ShayMoran,andRonMeir. Integralprobabilitymetricspac-bayesbounds. Advances
inNeuralInformationProcessingSystems,35:3123–3136,2022.
[76] JamesEKelley,Jr. Thecutting-planemethodforsolvingconvexprograms. JournalofthesocietyforIndustrial
andAppliedMathematics,8(4):703–712,1960.
[77] ElliotWardCheneyandAllenAGoldstein. Newton’smethodforconvexprogrammingandtchebycheffapproxi-
mation. NumerischeMathematik,1(1):253–268,1959.
[78] BCurtisEavesandWIZangwill. Generalizedcuttingplanealgorithms. SIAMJournalonControl,9(4):529–542,
1971.
[79] DimitriBertsekas. Convexoptimizationalgorithms. AthenaScientific,2015.
13Multi-GroupProportionalRepresentation APREPRINT
[80] DonaldMTopkis. Cutting-planemethodswithoutnestedconstraintsets. OperationsResearch,18(3):404–413,
1970.
[81] Jean-Louis Goffin and Jean-Philippe Vial. Convex nondifferentiable optimization: A survey focused on the
analyticcentercuttingplanemethod. Optimizationmethodsandsoftware,17(5):805–867,2002.
[82] LaurenceAWolseyandGeorgeLNemhauser. Integerandcombinatorialoptimization. JohnWiley&Sons,2014.
[83] BernhardSchölkopfandAlexanderJSmola. Learningwithkernels: supportvectormachines,regularization,
optimization,andbeyond. MITpress,2002.
[84] THofmann,BSchölkopf,andAJSmola. Kernelmethodsinmachinelearning. TheAnnalsofStatistics,36(3):
1171–1220,2008.
[85] WeihaoGao,SreeramKannan,SewoongOh,andPramodViswanath. Estimatingmutualinformationfordiscrete-
continuousmixtures,2018.
[86] ThomasHare. ATreatiseontheElectionofRepresentatives,ParliamentaryandMunicipal. Longman,Green,
Longman,&Roberts,1861.
[87] MichelBalinski.Fairmajorityvoting(orhowtoeliminategerrymandering).TheAmericanMathematicalMonthly,
115(2):97–113,2008.
[88] Ariel D Procaccia, Jeffrey S Rosenschein, and Aviv Zohar. On the complexity of achieving proportional
representation. SocialChoiceandWelfare,30(3):353–362,2008.
[89] NadjaBetzler,ArkadiiSlinko,andJohannesUhlmann. Onthecomputationoffullyproportionalrepresentation.
JournalofArtificialIntelligenceResearch,47:475–519,2013.
[90] GurobiOptimization,LLC. GurobiOptimizerReferenceManual,2024. URLhttps://www.gurobi.com.
[91] StevenDiamondandStephenBoyd. CVXPY:APython-embeddedmodelinglanguageforconvexoptimization.
JournalofMachineLearningResearch,17(83):1–5,2016.
[92] Akshay Agrawal, Robin Verschueren, Steven Diamond, and Stephen Boyd. A rewriting system for convex
optimizationproblems. JournalofControlandDecision,5(1):42–60,2018.
14Multi-GroupProportionalRepresentation APREPRINT
SupplementarymaterialtothepaperMulti-GroupProportionalRepresentation
Inthissupplementtothepaper,wepresenttheproofsinAppendixA.Inparticular,weproveProposition1,Proposition
2, andProposition4. InAppendixB,wediscusstheMPR-awareretrievalalgorithm, itsconvergenceaspects, and
theMPR-awareretrievalforlinearfunctionsandfunctionsbelongingtoanRKHS.InAppendixC,wedescribethe
algorithms,providefurtherretrievalstatistics,andabriefdiscussionaboutproportionalRepresentationinpolitical
sciences. Inparticular,afterdescribingthealgorithmsCLIP-clipWangetal.[18],CLIP-debiasBergetal.[20],Post-
HocBiasMitigation([29]andPATHS(Srinivasanetal.[27]),weincludeadditionalplotsforthreedatasetsfordecision
treemodelsinFig.10formultilayerperceptroninFig.11. InAppendixE,weprovideexperimentSettinganddetails.
Finally,inAppendixD,discussadditionalexperimentalresultsandcompareMAPR againstk-NN,MMR,ClipClip,
PBM,andDebaisCLIP.Inparticular,weincludefulltablesofintersectionalretrievalperformanceonUTKFace.
A ProofsfromSection3
WestartbyprovingProposition1fromSection3whichboundstheerrorinMPRestimateswhenQisapproximated
viaacurateddatasetD . WedosobyusingtoolsfromstandardRademachercomplexityresultsinstatisticallearning
C
theory,e.g.,[70]. Seealso[71,Chapter4]. Werestatethetheoremsheretofacilitatereadability. Westartwithalemma
aboutthedifferenceofsuprema.
Lemma1. LetP andP′betwodistributionsoverX andC ={c:X →[0,1]}. Then
supE [c(X)]−supE [c(X)]≤sup{E [c(X)]−E [c(X)]}. (11)
P P′ P P′
c∈C c∈C c∈C
Proof.
supE [c(X)]−supE [c(X)]
P P′
c∈C c∈C
=sup{E [c(X)]−E [c(X)]+E [c(X)]}−supE [c(X)]
P P′ P′ P′
c∈C c∈C
≤sup{E [c(X)]−E [c(X)]}+supE [c(X)]−supE [c(X)]
P P′ P′ P′
c∈C c∈C c∈C
≤sup{E [c(X)]−E [c(X)]}.
P P′
c∈C
Proposition 5 (Generalization Gap of MPR). Let {xr}k be retrieved samples R and {xc}m be i.i.d. samples
i i=1 i i=1
fromacurateddistributionQusedtogenerateacurationdatasetD . IfC ={c:X →{−1,1}}andR (C)isthe
C m
RademachercomplexityofC then,forallδ >0
(cid:115)
log(cid:0)2(cid:1)
|MPR(C,R,D )−MPR(C,R,Q)|≤R (C)+ δ (12)
C m 8m
withprobabilityatleast1−δ.
Proof. First,notethat
MPR(C,R,D )−MPR(C,R,Q) (13)
C
(cid:12) (cid:12) (cid:12) (cid:12)
(cid:12)1 (cid:88)k 1 (cid:88)m (cid:12) (cid:12)1 (cid:88)k (cid:12)
=sup(cid:12) c(xr)− c(xc)(cid:12)−sup(cid:12) c(x )−E [c(X)](cid:12) (14)
(cid:12)k i m i (cid:12) (cid:12)k i Q (cid:12)
c∈C(cid:12) (cid:12) c∈C(cid:12) (cid:12)
i=1 i=1 i=1
(cid:40)(cid:12) (cid:12)1 (cid:88)k 1 (cid:88)m (cid:12) (cid:12) (cid:12) (cid:12)1 (cid:88)k (cid:12) (cid:12)(cid:41)
≤sup (cid:12) c(xr)− c(xc)(cid:12)−(cid:12) c(x )−E [c(X)](cid:12) (15)
(cid:12)k i m i (cid:12) (cid:12)k i Q (cid:12)
c∈C (cid:12) (cid:12) (cid:12) (cid:12)
i=1 i=1 i=1
(cid:12)(cid:12) (cid:12) (cid:12) (cid:12)(cid:12)
(cid:12)(cid:12)1 (cid:88)k 1 (cid:88)m (cid:12) (cid:12)1 (cid:88)k (cid:12)(cid:12)
≤sup(cid:12)(cid:12) c(xr)− c(xc)(cid:12)−(cid:12) c(x )−E [c(X)](cid:12)(cid:12) (16)
(cid:12)(cid:12)k i m i (cid:12) (cid:12)k i Q (cid:12)(cid:12)
c∈C(cid:12)(cid:12) (cid:12) (cid:12) (cid:12)(cid:12)
i=1 i=1 i=1
15Multi-GroupProportionalRepresentation APREPRINT
(cid:12) (cid:12)
(cid:12) 1 (cid:88)m (cid:12)
≤sup(cid:12) c(xc)−E [c(X)](cid:12) (17)
(cid:12)m i Q (cid:12)
c∈C(cid:12) (cid:12)
i=1
Where(15)comesfromLemma1and(17)comesfromthetriangularinequality.
(cid:12) (cid:12)
Additionally,byswitchingMPR(C,R,Q)bysup (cid:12)1 (cid:80)k c(x )−E [c(X)](cid:12)in(13)andrepeatingtheprevious
c∈C(cid:12)k i=1 i Q (cid:12)
argument,weconcludethat:
(cid:12) (cid:12) (cid:12)(cid:12) (cid:12) (cid:12)
(cid:12) (cid:12)1 (cid:88)k (cid:12)(cid:12) (cid:12) 1 (cid:88)m (cid:12)
(cid:12)MPR(C,R,D )−sup(cid:12) c(x )−E [c(X)](cid:12)(cid:12)≤sup(cid:12) c(xc)−E [c(X)](cid:12). (18)
(cid:12) C (cid:12)k i Q (cid:12)(cid:12) (cid:12)m i Q (cid:12)
(cid:12) c∈C(cid:12) (cid:12)(cid:12) c∈C(cid:12) (cid:12)
i=1 i=1
Therefore,from(18)weshow
(cid:12)
(cid:12)
(cid:12)
(cid:12)1 (cid:88)k
(cid:12) (cid:12)(cid:12)
(cid:12)
(cid:115) log(cid:0)2(cid:1)
Pr(cid:12) (cid:12)MPR(C,R,D C)−sup(cid:12) (cid:12)k c(x i)−E Q[c(X)](cid:12) (cid:12)(cid:12) (cid:12)≥2R m(C)+ 2mδ  (19)
(cid:12) c∈C(cid:12) (cid:12)(cid:12)
i=1
 (cid:12)
(cid:12) 1 (cid:88)m
(cid:12)
(cid:12)
(cid:115) log(cid:0)2(cid:1)
≤Prsup(cid:12) (cid:12)m c(xc i)−E Q[c(X)](cid:12) (cid:12)≥2R m(C)+ 2mδ  (20)
c∈C(cid:12) (cid:12)
i=1
 (cid:12)
(cid:12) 1 (cid:88)m c(xc) (cid:20)
c(X)(cid:21)(cid:12)
(cid:12)
(cid:115) log(cid:0)2(cid:1)
≤Prsup(cid:12)
(cid:12)m
2i −E
Q 2
(cid:12) (cid:12)≥R m(C)+ 8mδ ≤δ, (21)
c∈C(cid:12) (cid:12)
i=1
here(21)comesfromthegeneralizationboundusingRademachercomplexityfrom[70]andthefactthat c(x) ∈[−1,1]
2 2 2
hencetheimageof c isinanintervalofsize1.
2
WenowproveProposition2,whichprovidesaboundonthesizemofani.i.d. curateddatasetD thatensuresan
C
ϵ-accurateestimateofMPRforasetofM queries.
Proposition6(QueryBudgetGuarantee). DenotequeriestoretrievesamplesbyQ={q ,...,q }whereM ∈Nis
1 M
thenumberofqueries. LetVC(C)denotetheVC-dimensionoftheclassC withimagein{−1,1}. Then,forϵ>0ifthe
curationdatasetcontainsm∈NsamplesfromthecurateddatadistributionQsuchthat
128VC(C)
2log(cid:0)2M(cid:1)
m≥ + δ (22)
ϵ2 ϵ2
thenwehavewithprobabilityatleast1−δthat
(cid:12) (cid:12)
(cid:12)1 (cid:88)k (cid:12)
sup(cid:12) c(x )−E [c(X)](cid:12)≤MPR(C,R,D )+ϵ (23)
(cid:12)k i Q (cid:12) C
c∈C(cid:12) (cid:12)
i=1
Proof. First,recallthattheRademachercomplexityR (C)isupperboundedbytheVC-dimensionofCbytherelation
m
(cid:118)
(cid:117) (cid:16) (cid:17)
(cid:117)2VC(C)log em
(cid:116) VC(C)
R (C)≤ , (24)
m m
whereeisEuler’snumber.
DenotethesamplesretrievedforagivenqueryqbyR(q)={xr(q)}k . FromProposition1wehavethatforallδ∗
i i=1
 (cid:115) 
log(cid:0) 2 (cid:1)
Pr|MPR(C,R,D C)−MPR(C,R,Q)|≥R m(C)+ 8mδ∗ ≤δ∗.
Therefore,usingthepreviousequationifwetakeδ∗ = δ anddenoteR(q)=Rwehavethat
M
16Multi-GroupProportionalRepresentation APREPRINT
 (cid:115) 
log(cid:0) 2 (cid:1)
Prsup|MPR(C,R,D C)−MPR(C,R,Q)|≥R m(C)+ 8mδ∗ 
q∈Q
 (cid:115) 
(cid:88)
log(cid:0) 2 (cid:1)
≤ Pr|MPR(C,R,D C)−MPR(C,R,Q)|≥R m(C)+ 8mδ∗ 
q∈Q
(cid:88) δM
≤ δ∗ = =δ. (25)
M
q∈Q
Hence,wehavethat,withprobabilityatleast1−δforallq ∈Q
(cid:12) (cid:12)1 (cid:88)k (cid:12) (cid:12) (cid:115) log(cid:0)2M(cid:1)
sup(cid:12) c(xr(q))−E [c(X)](cid:12)≤MPR(C,R(q),D )+R (C)+ δ (26)
(cid:12)k i Q (cid:12) C m 8m
c∈C(cid:12) (cid:12)
i=1
(cid:118)
(cid:117) (cid:16) (cid:17) (cid:115)
≤MPR(C,R(q),D
)+(cid:117) (cid:116)2VC(C)log VCem
(C) +
log(cid:0)2M
δ
(cid:1)
. (27)
C m 8m
Wheretheinequalityin(27)comesfromtheupperboundin(24).
(cid:115)
(cid:18) (cid:19)
Moreover,ifm ≥
32VC(C)
then
2VC(C)log Ve Cm
(C) ≤ ϵ andifm ≥
log(2M
δ
) then(cid:113) log(2M
δ
)
≤ ϵ. Therefore,we
ϵ2 m 2 2ϵ2 8m 2
concludethatifmissuchthat
32VC(C)
log(cid:0)2M(cid:1)
m≥ + δ (28)
ϵ2 2ϵ2
then
(cid:12) (cid:12)
(cid:12)1 (cid:88)k (cid:12)
sup(cid:12) c(xr(q))−E [c(X)](cid:12)≤MPR(C,R(q),D )+ϵ (29)
(cid:12)k i Q (cid:12) C
c∈C(cid:12) (cid:12)
i=1
AsdescribedinSection3,suchboundstendtobeconservativeandtheseboundscanbeimprovedbydoingasharper
analysiswithPAC-Bayesian[72]ormutualinformationbounds[73]. Seealso[74]and[75].
WenowproveProposition3. Thispropositionstatesthatforspecificfunctionclasses,computingMPRisequivalentto
solvinganMSEregressionproblem. ThispropositionallowsustoefficientlyestimateMPRwithstandardregression
modelsfrompackagessuchasscikit-learn[68].
Proposition 7. Let C′ ≜ {c ∈ C | (cid:80)m+nc(x )2 = mk } where C is closed under scalar multiplication. Let
i=1 i m+k
c(X)=[c(x ),...,c(x )]. Then
1 n+m
0≤MPR(C′,R,D )≤1, (30)
C
andforany
n+m
(cid:88)
c∗ ∈arginf (c(x )−a )2, (31)
i (cid:101)i
c∈C
i=1
√
letcˆ:X →Rbedefinedascˆ(x)= C c∗(x). Then,wehavethat
∥c∗(X)∥2
(cid:12) (cid:12)
(cid:12)n (cid:88)+m (cid:12)
cˆ∈argsup(cid:12) c(x )a (cid:12). (32)
(cid:12) i (cid:101)i(cid:12)
c∈C′ (cid:12) (cid:12)
i=1
Proof. Webeginprovingthefirststatement. Asashorthand,letc(X)=[c(x ),...,c(x )]. TheCauchy-Schwarz
1 n+m
inequalitygives,
(cid:12) (cid:12)
(cid:12)n (cid:88)+m (cid:12)
(cid:12) c(x )a (cid:12)≤∥c(X)∥ ∥a∥ , (33)
(cid:12) i (cid:101)i(cid:12) 2 (cid:101) 2
(cid:12) (cid:12)
i=1
17Multi-GroupProportionalRepresentation APREPRINT
where X ∈ R(m+n)×l is the matrix formed by the row-wise concatenation of D and D and a is the vector
R C (cid:101)
[a ,...,a ]. C′givesusaconstraintonthenormofc(X),andwecancomputeagiventherearektermswithvalue
(cid:101)0 (cid:101)m+n (cid:101)
1/k,mtermswithvalue1/m,andn−ktermswithvalue0. Alsonotethat mk =(1 + 1)−1
m+k k m
(cid:12) (cid:12)
(cid:12)
(cid:12)
(cid:12)n (cid:88)+m
c(x i) (cid:101)a
i(cid:12)
(cid:12) (cid:12)≤(
k1
+
m1
)−1 2(
k1
+
m1
)1 2 =1. (34)
(cid:12) (cid:12)
i=1
Next,weprovethesecondstatement. ConsidertheminimizeroftheMSEproblem,
n+m
(cid:88)
arginf (c(x )−a )2, (35)
i (cid:101)i
c∈C
i=1
AsC isclosedunderscalarmultiplication,wecanequivalentlywritethisatwo-partoptimizationproblem
(cid:32) n+m (cid:33)
(cid:88)
arginf inf (λc(x )−a )2 , (36)
i (cid:101)i
c∈C λ
i=1
wheretheinneroptimizationisquadraticandyieldsasolution
(cid:80)n+mc(x
)a
λ∗ = i=1 i (cid:101)i, (37)
∥c(X)∥2
2
assuming∥c(X)∥ <∞. PluggingthisbackintoEquation(36),theMSEproblembecomes
2
arginfn (cid:88)+m ((cid:80)n i=+ 1mc(x i) (cid:101)a
ic(x )−a )2 (38)
∥c(X)∥2 i (cid:101)i
c∈C i=1 2
=arginfn (cid:88)+m(cid:18) ⟨c(X),a (cid:101)⟩2
c(x
)2−2⟨c(X),a (cid:101)⟩
c(x )a
+a2(cid:19)
(39)
∥c(X)∥4 i ∥c(X)∥2 i (cid:101)i (cid:101)i
c∈C i=1 2 2
=arginf(cid:32) ⟨c(X),a (cid:101)⟩2 ∥c(X)∥2−2⟨c(X),a (cid:101)⟩ ⟨c(X),a⟩+n (cid:88)+m a2(cid:33)
(40)
∥c(X)∥4 2 ∥c(X)∥2 (cid:101) (cid:101)i
c∈C 2 2 i=1
=arginf−⟨c(X),a (cid:101)⟩2 +n (cid:88)+m
a2 (41)
∥c(X)∥2 (cid:101)i
c∈C 2 i=1
Asa doesnotdependonc,thisoptimizationisequivalentto
(cid:101)i
⟨c(X),a⟩2 |⟨c(X),a⟩|2
argsup (cid:101) =argsup (cid:101) (42)
∥c(X)∥2 ∥c(X)∥2
c∈C 2 c∈C 2
Notethatthesupremumcanbemultipliedbyaconstant. Thenwecanmultiplybysome∆>0andget
∆|⟨c(X),a⟩|2
argsup (cid:101) = argsup |⟨c(X),a⟩|2. (43)
∥c(X)∥2 (cid:101)
c∈C 2 c∈C √
∥c(X)∥2= ∆
Inotherwords,for∆>0and
|⟨c(X),a⟩|2
c∗ ∈argsup (cid:101) , (44)
∥c(X)∥2
c∈C 2
√
andlettingcˆ:X →Rbedefinedascˆ(x)= ∆ c∗(x),wehavethat
∥c∗(X)∥2
(cid:12) (cid:12)n (cid:88)+m (cid:12) (cid:12)2 (cid:12) (cid:12)n (cid:88)+m (cid:12) (cid:12)
cˆ∈ argsup |⟨c(X),a⟩|2= argsup (cid:12) c(x )a (cid:12) = argsup (cid:12) c(x )a (cid:12). (45)
(cid:101) (cid:12) i (cid:101)i(cid:12) (cid:12) i (cid:101)i(cid:12)
c∈C, c∈C, (cid:12) (cid:12) c∈C, (cid:12) (cid:12)
√ √ i=1 √ i=1
∥c(X)∥2= ∆ ∥c(X)∥2= ∆ ∥c(X)∥2= ∆
Letting∆= mk ,wecanconcludethatsolvinganMSEregressionproblemisequivalenttofindingtherepresentation
m+k
statisticforMPR.
18Multi-GroupProportionalRepresentation APREPRINT
Now,weestablishProposition4,restatedbelowforconvenience. ItsaysthatMPRenjoysaclosed-formexpression
whenevertheclassC isgivenbylinearfunctions. ThispropositionallowsustosimplifyMAPR since,inthiscase,the
optimizationproblemcanbecastasaquadraticprogram.
Proposition 8. Let items in the retrieval and curated datasets be vectors in Rl for l < m + n and C =
(cid:8) x(cid:55)→w⊺x|w ∈Rk(cid:9) .Moreover,letX∈R(m+n)×l bethematrixformedbyconcatenatingitemsintheretrievaland
curateddatasetD andD ,respectively. ForC′inProposition3,wehave
R C
(cid:114)
mk
MPR(C′,R,D )= ∥U⊺ a∥ , (46)
C m+k l(cid:101) 2
whereX=UΣV⊺istheSVDofXandU ∈R(m+n)×l aretheleftsingularvectorsinUcorrespondingtothetop-l
l
largestsingularvalues.
The closed-form expression for MPR in (9) allows MPR-constrained retrieval to be approximated by a quadratic
program,whoseproofcanbefoundinAppendixB.Moreover,theabovepropositioncanbedirectlyadaptedtolinear
functionsdefinedonlyforembeddingsorasubsetoffeaturesofretrieveditems.
Proof. SinceweareconsideringtheclassC′ ≜{c∈C |(cid:80)m+nc(x )2 = mk },whereC =(cid:8) x(cid:55)→w⊺x|w ∈Rd(cid:9) ,
i=1 i m+k
thecomputationoftheMulti-GroupProportionalRepresentationmetric
(cid:12) (cid:12)
(cid:12)n (cid:88)+m (cid:12)
MPR(C′,R,D )=argsup(cid:12) c(x )a (cid:12) (47)
C (cid:12) i (cid:101)i(cid:12)
c∈C (cid:12) (cid:12)
i=1
boilsdowntothefollowingoptimizationproblem
n+m
(cid:88) ⊺
max (w x)a (48)
(cid:101)i
c∈C
i=1
m+n
subjectto (cid:88) [w⊺ x]2 = mk , (49)
m+k
i=1
whichcanbewrittenas
max aTXw (50)
(cid:101)
w∈Rn+m
mk
subjectto ∥Xw∥2= , (51)
2 m+k
whereX ∈ R(n+m)×l isthematrixformedbyconcatenatingitemsintheretrievalandcurateddatasetD andD ,
R C
respectively. LetX=UΣV⊺betheSVDofXandU ∈R(m+n)×l aretheleftsingularvectorsinUcorresponding
l
tothetop-llargestsingularvalues. Then,theproblembecomes
max
aTUΣV⊺
w (52)
(cid:101)
w∈Rm+n
mk
subjectto ∥ΣV⊺ w∥2= . (53)
2 m+k
Now,byachangeofvariablesΣV⊺w=wandU⊺a=z
(cid:101) (cid:101)
max zTw (54)
(cid:101)
w(cid:101),w∈Rm+n
mk
subjectto ∥w∥2= , (55)
(cid:101) 2 m+k
⊺
ΣV w=w. (56)
(cid:101)
wecanusethemethodofLagrangemultipliers. LetusdefinetheLagrangianfunction:
(cid:18) (cid:19)
λ mk
L(w,w,λ,µ)=zTw− ∥w∥2− −µT(ΣV⊺ w−w). (57)
(cid:101) (cid:101) 2 (cid:101) 2 m+k (cid:101)
Tofindtheoptimalsolution,wesetthepartialderivativesoftheLagrangianwithrespecttow,w,λ,andµtozero:
(cid:101)
∂L ∂L
=z−λw+µ=0, =−VΣµ=0, (58)
(cid:101)
∂w ∂w
(cid:101)
19Multi-GroupProportionalRepresentation APREPRINT
(cid:18) (cid:19)
∂L 1 mk ∂L
= ∥w∥2− =0, =ΣV⊺ w−w=0. (59)
∂λ 2 (cid:101) 2 m+k ∂µ (cid:101)
Fromthesecondequation,wehaveVΣµ=0. AssumingVandΣarefullrank,thisimpliesµ=0. Substitutingthis
intothefirstequation,weget:
1
z−λw=0 =⇒ w= z. (60)
(cid:101) (cid:101)
λ
Usingthethirdequationandtheconstraint∥w∥2= mk ,wecansolveforλ:
(cid:101) 2 m+k
(cid:114)
1 mk m+k
∥w∥2= ∥z∥2= =⇒ λ=±∥z∥ (61)
(cid:101) 2 λ2 2 m+k 2 mk
SincewearemaximizingzTw,wechoosethepositivevalueofλ. Thus,theoptimalwis:
(cid:101) (cid:101)
(cid:113)
mk
w∗ = m+k z. (62)
(cid:101)
∥z∥
2
Finally,usingthefourthequation,wecanfindtheoptimalw:
(cid:113) (cid:113)
mk mk
ΣV⊺ w∗ =w∗ =⇒ w∗ =(ΣV⊺ )−1w∗ = m+k (ΣV⊺ )−1z= m+k (ΣV⊺ )−1U⊺ a. (63)
(cid:101) (cid:101) ∥z∥ ∥z∥ (cid:101)
2 2
TheoptimalwisthenobtainedbysolvingthelinearsystemΣV⊺w∗ =w∗.
(cid:101)
B TheMPR-awareretrievalalgorithm
Inthissection, wediscusstheconvergenceofMAPR,theMulti-groupAwareProportionalRetrievalalgorithm. As
describedinSection4,theMPR-awaremethodisessentiallyacuttingplanemethod(alsoknownastheKelley-Cheney-
Goldsteinmethod[76,77])appliedtothelinearfunctionaTs;seealso[78].
Thealgorithmbeginsbyidentifyingthek-mostsimilaritemstoagivenqueryinDR. Then,anMSE-minimizingoracle
iscalledandreturnsthestatistic(orgroup-denotingfunction)c∈Cwiththemostdisproportionaterepresentationforthe
setofretrieveditems. Thefunctioncisthenaddedasaconstrainttoalinearprogramthatoutputsavectora∈[0,1]n
maximizingaveragesimilarityasin(10)subjecttoasingleconstraint(cid:12) (cid:12) k1 (cid:80) i=1na ic(xr i)− m1 (cid:80)m i=1c(xc i)(cid:12) (cid:12) ≤ ρ,
where integer constraints are relaxed. The optimal a is rounded so only the largest k entries are marked as 1,
correspondingtoanewsetofretrieveditems. Theprocessrepeatswithanincreasingnumberofconstraintstothelinear
programandhaltswhentheoracledoesnotreturnafunctionthatviolatesthetargetMPRconstraintρ. Inmathematical
terms,westartbysolvingtheproblem
⊺
max a s (64)
a∈{0,1}n
k
(cid:88)
subjectto a =k. (65)
i
i=1
Notethatthesolutiontothisproblemisgivenbythevectorathatfindsthekthlargestentriesofs,i.e.,itidentifies
thek-mostsimilaritemstoagivenqueryinD . Then,Proposition3providesawaytogeneratecutsgiventhevector
R
a ∈ Rn found as a solution of the previous iteration. These cuts are given by the function c ∈ C with the most
k
disproportionaterepresentationforthesetofretrieveditems.
Ateachiteration,wetestiftheMPRconstraint,lessorequaltoρ,issatisfied. Ifnot,thisgivesusanewinequalityto
beincorporatedintothelinearproblem(B)thatoutputsavectora∈[0,1]nmaximizingaveragesimilarityasin(10)
subjecttoasingleconstraint(cid:12) (cid:12) k1 (cid:80)n i=1a ic(xr i)− m1 (cid:80)m i=1c(xc i)(cid:12) (cid:12)≤ρ,whereintegerconstraintsarerelaxed. Therefore,
thealgorithmconsistsofiterativelyaddinganewconstraint(cut)oftheform
(cid:12) (cid:12)
(cid:12)1 (cid:88)n 1 (cid:88)m (cid:12)
G(a)=:sup(cid:12) a c(xr)− c(xc)(cid:12) (66)
(cid:12)k i i m i (cid:12)
c∈C(cid:12) (cid:12)
i=1 i=1
20Multi-GroupProportionalRepresentation APREPRINT
andsolvingtheproblemagainuntilalltheinequalitiesarefulfilled,i.e.,untiltheoracledoesnotreturnafunctionthat
violatesthetargetMPRconstraintρ. Atthispoint,thealgorithmhalts. Itremainstobeshownthatthedescription
aboveindeedcorrespondstoatraditionalcuttingplanemethodforconvexfunctions. Forthesubsequentdiscussion,we
willdenotetheterminsidethesupremumin(66)byg(a,c),i.e.,
n m
1 (cid:88) 1 (cid:88)
g(a,c)=
k
a ic(xr i)−
m
c(xc i), forc∈C(cid:101). (67)
i=1 i=1
ThenextpropositionlinkstheoracleviaMSE,describedinProposition3,withthesubdifferentialofthefunctionG(a).
Proposition9. LetC beininfinitesetandletG(a) = sup |g(a,c)|betheconvexrestrictionoftheoptimization
c∈C
problem(10)givenbythesupremum,i.e.,G(a)≤ρ,∀a∈Rn. Ifc∗ ∈argsup |g(a∗,c)|andcdenotethefunction
c∈C
c∗evaluatedatthepointsx ,...,x ,i.e.,c=[c (x ),...,c (x )],theng∗ :=sign(g(a∗,c∗))·c∈∂G(a∗),i.e.,g∗
1 n ∗ 1 ∗ m
isasubgradientofGatapointa∗.
Proof. WestartbynotingthatG(a)isaconvexfunctionsinceitisasupremumofacompositionofanaffinefunction
withtheabsolutevalue. Also,notethatG(a)canbewrittenasG(a) = sup |g(a,c)|= sup |c⊺a+b |,where
c∈C c∈C c
b:C →R. Weneedtoprovethat
G(a∗)+g∗⊺ (a−a∗)≤G(a),∀a∈Rn (68)
Infact,startingfromtheleft-handsideleadsto
|g(a∗,c∗)|+sign(g(a∗,c∗))c⊺ (a−a∗) (69)
c⊺a+b
=|c⊺ a+b |+ c c⊺ (a−a∗) (70)
c |c⊺a+b |
c
c⊺a+b
=|c⊺ a+b |+ c −c⊺ a∗−b +c⊺ a+b (71)
c |c⊺a+b | c∗ c∗
c
|c⊺a+b |2
=|c⊺ a+b |− c +sign(g(a∗,c∗))(c⊺ a+b ) (72)
c |c⊺a+b | c∗
c
≤|c⊺ a+b |≤G(a),∀a∈Rn (73)
c∗
Thisshowsthatc=[c (x ),...,c (x )]isasubgradientofG(a).
∗ 1 ∗ m
ThecuttingplanestrategydescribedinAlgorithm1addressestheconstraintsoftheformG(a)≤ρthatarenotfulfilled.
Since(68)holds,thealgorithmaddslinearapproximations(orcuttingplanes)oftheform
G(a∗)+g∗⊺ (a−a∗)≤ρ (74)
totheproblemateachiterationuntilthesolutionsatisfiesalltheinequalities. Thisreformulationdemonstratesthatthe
MPR-awarealgorithmcanbeviewedasatraditionalcuttingplanemethodforminimizingalinearfunctionoverthe
polyhedronP ={a
∈[0,1]∩(cid:80)n
a =k}. If,atacertainiteration,thealgorithmfindsaniteratethatsatisfiesall
i i=1 i
theinequalities,itterminatessincethelowerboundprovidedbythecuttingplanemethodmatchestheupperbound.
Inthecasewherethealgorithmcontinuesaddingconstraints,theaccumulationpoint(guaranteedtoexistduetothe
compactnessofthesetP)willconvergetoanoptimalsolution,asprovenin[79,Proposition4.1.2]orthemaintheorem
in[76,Section2].
However,itisimportanttonotethatevenwhenthealgorithmterminatesinafinitenumberofsteps,thecuttingplane
methodoftenrequiresasubstantialnumberofiterationstoconvergeandmayexhibitnumericalinstabilities. Addressing
theseinstabilitiesorexploringtechniquestodiscardcertaincutsforimprovedconvergence,suchaspartialcuttingplane
methods,isbeyondthescopeofthispaper. Forfurtherinformationonthesetopics,referto[80,81]andthereferences
therein.
Theintegerprogrammaynotbeasscalableasitsconvexrelaxation. Ifwerelaxittoa ∈[0,1],thisbecomesaconvex
i
optimizationproblemsolvablebystandardmethods(evenforverylargeC)andprovidesanupperboundtotheoriginal
program for reasonable values of the MPR violation (and for which Proposition 9 applies). However, the optimal
solutionoftherelaxedproblemmightnotbefeasiblefortheoriginalproblem,becauseitmighthavefractionalvalues
forsomea ,whiletheoriginalproblemrequiresthesetobebinary. Therearecertainspecialcaseswheretheoptimal
i
solutionoftherelaxedproblemisguaranteedtobeintegral(i.e.,alla are0or1),inwhichcaseitisalsoanoptimal
i
21Multi-GroupProportionalRepresentation APREPRINT
solutionfortheoriginalproblem. Thisisthecase,forexample,whentheconstraintmatrixistotallyunimodularandthe
right-handsidesoftheconstraintsareintegral[82]. Still,weobservefromempiricalexperimentsthatselectingthetop
ka ioftherelaxedproblemisacomputationallyefficientalternativetosolvingtheintegerprogramMPR-RETRIV(k,ρ),
sinceresultsfromroundingproduceanegligibledifferencetotheupperbound(seeFigures8and9).
Now,wedescribehowtheMPRconstraintcanbesimplifiedfortheclassoflinearfunctions.Inthiscase,theMPR-aware
retrievalalgorithmbecomesascalablequadraticprogram.
B.1 MPR-awareRetrievalviaQuadraticProgramming
Proposition 4allowedus tohave asimple closed-formrepresentation of MPRin thecase of bounded-normlinear
regressionfunctions,i.e.,whenC′ ≜{c∈C | 1 (cid:80)m+nc(x )2 =1},andC =(cid:8) x(cid:55)→w⊺x|w ∈Rd(cid:9) . Inthiscase,
m+n i=1 i
MAPR becomes
⊺
max a s (75)
a,y
√
⊺
subjectto m+n∥U a∥ ≤ρ, (76)
l(cid:101) 2
⊺
a 1=k, (77)
a ∈{0,1}, (78)
i
wherea (cid:101)∈Rn+mhasi-thentrygivenby (cid:101)a i ≜1 i≤na ki −1 i>nm1.
Furthermore,theresultfromProposition4allowsustoexploretheefficiencyofourcuttingplanealgorithm. InFigures
4and6,wecomparethequadraticoptimizationproblem(Eqn. 75)toMAPR(alinearprogram,Algorithm1)forlinear
regression and measure the MPR of our solutions with the closed form value from Proposition 4. As we can see,
whilethequadraticprogramtracesasmoothercurve, MAPR’scuttingplaneapproachwell-approximatestheclosed
formsolution. Intheseexperiments,weretrieve50itemsfromCelebA,withoutacurationset. Finally,inFigures
5and7,werunthequadraticprogramandcomparetheMPRasmeasuredwiththeclosedformsolutionandlinear
regressor-approximated measurement of MPR. In other words, where Figures 4 and 6 measure the quality of our
retrievalalgorithmgivenaperfect(closedform)MPRoracle,Figures5and7measurethequalityofourMSEoraclein
comparisontotheperfectoracle. WeobservethattheMSEoracleisaperfectapproximatoroftheclosedformforMPR.
Query: lawyer
1.00 MAPR (Ours)
MAPR Top-k
0.99 QP Top-k
QP
0.98
0.97
0.96
0.95
0.94
0.93
0.92
0.0 0.2 0.4 0.6 0.8 1.0
Fraction of Top-k MPR
Figure4:SimilarityvsMPRforQuadraticProgram(Eqn.75)andMAPR.MAPRwellapproximatesthequadraticprogramalongthe
Paretofrontier.Measuredoverasinglequery“Aphotoofalawyer"for50retrievedsamplesonCelebA.
B.2 ComputingMPRforFunctionsinanRKHS
Kernelmethodsareageneralizedbutpractical,non-linear,andeasytechniquetoimplementalgorithmsforaplethora
ofimportantproblemsinmachinelearning[83,84]. AsMPRiscloselyrelatedtothemaximummeandiscrepancy
22
ytiralimiS
k-poT
fo
noitcarFMulti-GroupProportionalRepresentation APREPRINT
MSE Estimator vs QP, Query: lawyer
1.00 Closed Form MPR
MSE MPR Estimator
0.99
0.98
0.97
0.96
0.95
0.94
0.93
0.92
0.0 0.2 0.4 0.6 0.8 1.0
Fraction of Top-k MPR
Figure5:SimilarityvsMPRforMSEestimated(Prop3andclosedform(Prop4)measuresofMPR.Fortheclassoflinearmodels,
alinearregressionoracleperfectlyachievestheanalyticalsolutionforMPR.Measuredoverasinglequery“Aphotoofalawyer"for
50retrievedsamplesonCelebA.
problem,aclosed-formexpressionofMPRcanbeeasilydeducedbyusingresultsfrom[63,Lemma6]whenC isa
reproducingkernelHilbertspace,whichincludes,forexample,linearregression,logisticregression,Gaussiankernel
ridgeregression,andhard-marginSVMs.
Proposition10(MPRforRKHS[63]). Let{xr}k beretrievedsamplesRand{xc}m thesamplesfromthecuration
i i=1 i i=1
datasetD . LetC beareproducingkernelhilbertspacewithkernelK(.,.),then
C
 1/2
k k,m m
1 (cid:88) 2 (cid:88) 1 (cid:88)
MPR(C,R,Q)=
k2
K(xr i,xr j)−
mk
K(xr i,xc j)+
n2
K(xc i,xc j) . (79)
i,j=1 i,j=1 i,j=1
Therefore,givenakernelK(.,.),wecaneasilycomputeMPR(C,R,Q)byevaluatingthekernelatthepointsxr,xc
i j
andusethisinAlgorithm1.
C DescriptionofFairRetrievalAlgorithmsandRetrievalStatisticsandOtherRelated
Works
Inthissection,wedescribethemethodswebenchmarkagainstthataimtopromotefairnessmultimodalmodelslike
CLIP[23]. Wealsobrieflyoverviewproportionalrepresentationinpoliticalsciences.
• CLIP-clip(Wangetal.[18]): CLIP-clipisapost-processingalgorithmwithtwostages. First, themutual
information between each positional feature of an embedding and some sensitive attributes is estimated
(treating each sensitive attribute as a discrete random variable and each position as a continuous random
variable[85]). Then,inorderofgreatesttolowestmutualinformation,attest-timesomenumberofCLIP
featuresaredroppedfromboththetextandimageembedding,resultinginlessbias(atcosttothefidelityof
theembedding). Byvaryingthenumberoffeaturesdropped,arecall-biastrade-offisinduced.
• CLIP-debias(Bergetal.[20]): Thealgorithmlearnsaseriesoftokensthatarepre-pendedtotextqueriesinto
CLIPviaadversarialtrainingtominimizetheabilitytopredictasensitiveattributeoftheresultingembedding
(inthedefaultcase,gender). Then,retrievalisconductedwiththedebiasedembeddings.
• Post-Hoc Bias Mitigation ([29]): Post-Hoc Bias Mitigation is a post-processing method that relies on an
oracleclassifiertolabelelementsthatmightberetrievedwitheitheroneofseveralsensitiveattributesora
neutrallabel. Then,iteratively,Post-HocBiasMitigationaddseitherasetofelements(oneofeachpredicted
sensitiveattribute)orapredictedneutralelementtotargetequalrepresentation,basedonwhichoptionhas
higheraveragecosinesimilarity. Theoraclemaybeapretrainedclassifier,azero-shotmethodusingCLIP
embeddings,orthetruelabels.
23
ytiralimiS
k-poT
fo
noitcarFMulti-GroupProportionalRepresentation APREPRINT
Query: chef Query: nurse Query: artist
1.00 MAPR (Ours) 1.00 MAPR (Ours) 1.000 MAPR (Ours)
MAPR Top-k MAPR Top-k MAPR Top-k
0.98 Q QP P Top-k 0.98 Q QP P Top-k 0.995 Q QP P Top-k
0.990
0.96
0.96
0.985
0.94
0.94 0.980
0.92
0.92 0.975
0.90 0.970
0.90
0.88 0.965
0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
Query: doctor Query: teacher Query: engineer
1.000 MAPR (Ours) 1.00 MAPR (Ours) 1.00 MAPR (Ours)
MAPR Top-k MAPR Top-k MAPR Top-k
0.995 Q QP P Top-k 0.98 Q QP P Top-k 0.98 Q QP P Top-k
0.990 0.96
0.96
0.985 0.94
0.980 0.94 0.92
0.975 0.92 0.90
0.970 0.90 0.88
0.86
0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
Query: architect Query: scientist Query: programmer
1.00 MAPR (Ours) 1.00 MAPR (Ours) 1.00 MAPR (Ours)
MAPR Top-k MAPR Top-k MAPR Top-k
0.99 Q QP P Top-k 0.99 Q QP P Top-k 0.98 Q QP P Top-k
0.98 0.98 0.96
0.97 0.97 0.94
0.96 0.96 0.92
0.95 0.95 0.90
0.94 0.94 0.88
0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
Figure6: AdditionalcomparisonsofQuadraticProgram(Eqn. 75)andMAPRoverqueries“chef", “nurse", “artist", “doctor",
“teacher",“engineer",“architect",“scientist",and“programmer".
• PATHS(Srinivasanetal.[27]): Itconstructsanewembeddingspacebuiltuponthepretrainedimage-text
modelCoCaandleveragedtext-guidedprojectionstoextractanembeddingthatcapturescomplexnotionsof
diversityinpeople,uponwhichadiverseretrievalmethod(suchastheMMRmethoddetailedabove)canbe
runtoeffectivelyincreasethediversityofthereturnedsamples.
ProportionalRepresentation(PR)inpoliticalsciences. AsdescribedintherelatedworksinSection1,proportional
representation(broadlyconstrued)hasalonghistoryinsocialchoicetheoryandpoliticalsciences[56–60]andhasbeen
aguidingprincipleinthedesignofpoliticalsystems,aimingtoensurerepresentationreflectsunderlyingpopulation
preferencesanddemographics. Itcanbetracedbacktothelate18thcentury,withearlyproponentssuchasHonoré
GabrielRiqueti,ComtedeMirabeau,whodiscussedtheideain1780. The19thcenturysawsignificantcontributions
to the development of proportional representation, including the works of Thomas Wright Hill and Thomas Hare.
Hare’s1859publication,“ATreatiseontheElectionofRepresentatives,ParliamentaryandMunicipal”[86],outlineda
systemofsingletransferablevoteforproportionalrepresentation. Inthelate19thandearly20thcenturies,theworksof
CarlAndrae,VictorD’Hondt,andJohnStuartMillfurtherexploredandcontributedtothediscussionofproportional
representationinthepoliticalscienceliterature. See[56–60].
Similarly,inML,ouraimisproportionalrepresentationindataandoutputs,ensuringequitableperformanceacross
groups, and mirroring representation goals in political systems. PR electoral systems [87], used by countries like
Uruguay,Sweden,SouthAfrica,andNewZealand,allocatelegislativeseatsproportionallytovotesreceivedbyparties.
Challengesincludee.g.,gerrymandering[87]andthecomplexityofapportionmentandseatallocation[88,89].
D AdditionalResults.
In this section we include additional experimental results. First, we include full tables of intersectional retrieval
performanceonUTKFaceforourmethod,k-NN,MMR,ClipClip,PBM,andDebaisCLIP.Weaverageover10queries
24
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarFMulti-GroupProportionalRepresentation APREPRINT
MSE Estimator vs QP, Query: chef MSE Estimator vs QP, Query: nurse MSE Estimator vs QP, Query: artist
1.00 Closed Form MPR 1.00 Closed Form MPR 1.000 Closed Form MPR
MSE MPR Estimator MSE MPR Estimator MSE MPR Estimator
0.99 0.99 0.995
0.98 0.98 0.990
0.97 0.97 0.985
0.96 0.96
0.980 0.95
0.95
0.94 0.975
0.94
0.970
0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
MSE Estimator vs QP, Query: doctor MSE Estimator vs QP, Query: teacher MSE Estimator vs QP, Query: engineer
1.000 Closed Form MPR 1.00 Closed Form MPR 1.00 Closed Form MPR
MSE MPR Estimator MSE MPR Estimator MSE MPR Estimator
0.995 0.99 0.98
0.990
0.98 0.96
0.985
0.97 0.94
0.980
0.92 0.975 0.96
0.970 0.95 0.90
0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
MSE Estimator vs QP, Query: architect MSE Estimator vs QP, Query: scientist
MSE Estimator vs QP, Query: programmer
1.00 Closed Form MPR 1.00 Closed Form MPR
MSE MPR Estimator MSE MPR Estimator 1.00 Closed Form MPR
0.99 0.99 MSE MPR Estimator
0.98
0.98 0.98 0.96
0.97
0.97 0.94
0.96
0.96 0.92
0.95
0.95 0.90
0.94
0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
Figure7:AdditionalcomparisonsofMSEtoclosedformMPRestimatorforqueries“chef",“nurse",“artist",“doctor",“teacher",
“engineer",“architect",“scientist",and“programmer".
Embedding ChangeEmbedding ChangeRetrieval Pre-definedfeatures ApproachtoDiversity
DebiasCLIP Custom ✔ ✗ ✔ Ignore/DecorrelateAttributes
PBM AnyVLM ✗ ✔ ✔ EqualRepresentationoverAttributes
PATHS Custom ✔ ✔ ✔ HighVarianceRepresentationoverAttributes
ClipCLIP AnyVLM ✔ ✗ ✔ Ignore/DecorrelateAttributes
OURS Any ✗ ✔ ✗ MultigroupProportionalRepresentationoverAttributes
Table2:Axisofcomparisonforoursandexistingfairretrievalmethods.Thebluecolorindicatesapositivefeatureofthemethod
whiletheredcolorindicatesanegativeone.
aswhileretrieving50images. InTable3,wecomputeMPRwithalinearregressionoracleandoptimizeourmethod
withthesamelinearregressionoracle. Weareabletoperfectlybalanceacrossintersectionalgroupswhileothermethods
oftenfailtoaccountforthe‘Others’racecategoryandthe‘Female’gendercategory. SomemethodssuchasPBM
whichoptimizeforequalrepresentationareabletoachievebalancedrepresentationacrossthegenderaxisbutfailto
considerdiversityinrace. InTable4,weseeasimilarstoryforMPRmeasuredandoptimizedwithadecisiontree.
Next,weincludeadditionalsimilarity-MPRtradeoffcurveswhenmeasuringandoptimizingMPRwithadecisiontree
(Figure10)andwithanMLPwith1hiddenlayerofdimension64(Figure11). WeobserveasimilarPareto-domination
tothatobservedinthemainpaper,asourmethodisabletolowerMPRthemostwhilepreservingsimilarityevenwith
morenonlinearoracleestimatorsofMPR.Figure11,weplotonalog-scaleforMPRastheMLPisabletofindsuch
violatingfunctionsforbaselinemethodsthattheir“Fractionoftop-kMPR"canreachvaluesof35. IntheMLPsetting,
whilePBMpreserveshighsimilarityonawhole,itisstillunabletodecreaseMPRaslowasMAPRisabletoat≈95%
oftop-ksimilarity.
In Figure 12 we include nine additional precision-representation curves. Similar to the result for the query “chief
executiveofficer"inthemainpaper,MAPRmaintainssimilarprecision-representationperformancetobaselinemethods.
25
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarFMulti-GroupProportionalRepresentation APREPRINT
IP vs LP, Query: doctor
1.00 LP
LP Top-k
IP
0.99
0.98
0.97
0.96
0.8000.8250.8500.8750.9000.9250.9500.9751.000
Fraction of Top-k MPR
Figure8:Comparisonoflinearprogramwithandwithouttakingthetop-ktointegerprogram.Solvingtherelaxedprogramismuch
morecomputationallyefficientandachievessimilarperformanceafterroundingtosolvingtheintegerprogram.
Table3: Retrievalaveragedover10querieswith50retrievalsonUTKFacedataset[39]forMAPR,k-NN,MMR[27],ClipClip
PBM,andDebiasCLIPwithMPRoptimizedandmeasuredwithalinearregressionoracle. Entriesindicateaveragepercentage
representationinretrieveditems.MAPRisabletobalancerepresentationacrossclasses,whereasotherbaselinesmissintersectional
groups(highlightedinred).
White Black Asian Indian Others Sum
Male 7.8±3.74 10.2±2.90 13.0±2.56 11.8±2.44 7.2±3.70 50±0
MAPR (Ours) Female 12.2±3.74 9.8±2.90 7.0±2.56 8.2±2.44 12.8±3.70 50±0
Sum 20±0 20±0 20±0 20±0 20±0
Male 21.2±11.84 13.2±7.70 10.8±7.54 21.2±20.70 1.4±1.56 67.8±23.72
Top-K Female 17.2±21.04 6.6±6.14 4.0±2.82 2.8±2.56 1.6±1.50 32.2±23.72
Sum 38.4±17.18 19.8±12.56 14.8±7.38 24±19.38 3.0±2.04
Male 28.8±8.96 11.0±4.58 10.2±4.04 10.8±2.40 3.8±1.06 64.6±7.74
MMR Female 16.2±9.06 7.6±3.66 5.0±3.00 4.0±1.26 2.6±1.56 35.4±7.74
Sum 45.0±7.76 18.6±5.38 15.2±5.82 14.8±3.12 6.4±1.96
Male 23.2±9.96 11.0±5.16 10.8±5.88 14.2±8.70 1.8±2.08 61.0±17.08
ClipClip Female 15.2±9.44 7.0±4.32 7.4±5.30 6.6±5.52 2.8±1.84 39.0±17.08
Sum 38.4±11.42 18.0±8.20 18.2±5.68 20.8±9.52 4.6±2.2
Male 19.8±7.82 13.0±7.12 9.4±5.66 15.2±8.72 1.2±1.6 58.6±11.62
PBM Female 18.6±12.96 8.4±5.92 5.6±3.88 7.2±5.16 1.6±1.50 41.4±11.62
Sum 38.4±13.50 21.4±11.38 15.0±6.70 22.4±13.44 2.8±2.04
Male 20.4±7.48 8.2±3.94 5.4±2.54 11.0±3.50 3.8±2.6 48.8±5.52
DebiasCLIP Female 19.4±6.98 9.4±5.14 8.4±4.28 10.0±4.64 4.0±1.78 51.2±5.52
Sum 39.8±9.78 17.6±3.66 13.8±5.62 21.0±6.52 7.8±3.16
Finally,weincludeexampleretrievalsfor‘architect’and‘teacher’queriesoverUTKFacewitheachofourbaselines.
Similartothetables,weselecteachalgorithm’ssolutionwiththelowestMPRafterdoingahyperparametersweepfor
eachrespectivealgorithmandplotthecorrespondingimagesbelow.
26
ytiralimiS
k-poT
fo
noitcarFMulti-GroupProportionalRepresentation APREPRINT
IP vs LP, Query: architect IP vs LP, Query: artist IP vs LP, Query: chef
1.000 LP 1.000 LP 1.000 LP
LP Top-k LP Top-k LP Top-k
0.995 IP 0.998 IP 0.995 IP
0.990 0.996 0.990
0.985 0.985
0.994
0.980 0.980
0.975 0.992 0.975
0.970 0.990
0.970
0.965 0.988
0.965
0.960 0.986
0.70 0.75 0.80 0.85 0.90 0.95 1.00 0.8250.8500.8750.9000.9250.9500.9751.000 0.86 0.88 0.90 0.92 0.94 0.96 0.98 1.00
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
IP vs LP, Query: engineer IP vs LP, Query: lawyer IP vs LP, Query: nurse
1.00 LP 1.000 LP 1.00 LP
LP Top-k LP Top-k LP Top-k
0.99 IP 0.995 IP 0.99 IP
0.98 0.990 0.98 0.97
0.97
0.985 0.96
0.96 0.980 0.95
0.95
0.94
0.975
0.94 0.93
0.93 0.970
0.65 0.70 0.75 0.80 0.85 0.90 0.95 1.00 0.80 0.85 0.90 0.95 1.00 0.75 0.80 0.85 0.90 0.95 1.00
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
IP vs LP, Query: programmer IP vs LP, Query: scientist IP vs LP, Query: teacher
1.00 LP 1.000 LP 1.00 LP
LP Top-k LP Top-k LP Top-k
IP 0.998 IP 0.99 IP
0.99
0.996 0.98
0.98 0.994 0.97
0.992
0.96
0.97 0.990
0.95
0.988
0.96 0.94
0.986
0.93
0.70 0.75 0.80 0.85 0.90 0.95 1.00 0.94 0.95 0.96 0.97 0.98 0.99 1.00 0.70 0.75 0.80 0.85 0.90 0.95 1.00
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
Figure9:Additionalcomparisonsofrelaxedproblemandtop-kselectiontointegerprogram.“chef",“nurse",“artist",“lawyer",
“teacher",“engineer",“architect",“scientist",and“programmer".
Ours MMR PBM ClipCLIP DebiasClip
Ours Fit MMR Fit PBM Fit ClipCLIP Fit
1.0 1.0 1.0
1.0 0.9 0.9
0.9
0.8
0.8
0.8 0.9 0.7
0.7
0.6
0.7
0.8 0.6 0.5
0.6 0.5 0.4
0.7
0.4 0.3
0.6 0.7 0.8 0.9 1.0 1.1 1.2 0.0 0.2 0.4 0.6 0.8 1.0 1.2 1.4 0.6 0.7 0.8 0.9 1.0 1.1 1.2 1.3
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
0.6
Figure10:FractionofTop-kcosinesimilarityvsFractionofTop-kMPRforMPRmeasuredbyfunctionclassCgivenbythesetof
decisiontrees.Averagedover10q0u.e5riesfork=50imagesretrieved.FromLeft-to-Right:CelebA,UTKFaces,Occupations.Values
arenormalizedsok-NNachievespoint(1,1)ineachcase.MAPRPareto-dominatesbaselinesandsignificantlyclosestheMPRgap.
0.4
0.0 0.5 1.0
Fraction of Top-k MPR
27
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarFMulti-GroupProportionalRepresentation APREPRINT
Table4:Retrievalaveragedover10querieswith50retrievalsonUTKFacedataset[39]forMAPR,k-NN,MMR[27],PBM,and
DebiasCLIPwithMPRoptimizedandmeasuredwithadecisiontreeoracle.Entriesindicateaveragepercentagerepresentationin
retrieveditems.MAPRisabletobalancerepresentationacrossclasses,whereasotherbaselinesmissintersectionalgroups(highlighted
inred).
White Black Asian Indian Others Sum
Male 11.0±1.34 10.4±0.8 10.0±0 10.2±0.6 8.8±0.98 50.4±1.64
Ours Female 10.6±1.28 9.6±0.80 9.6±1.20 10.2±1.08 9.6±1.2 49.6±1.64
Sum 21.6±1.64 20±1.26 18.6±1.2 20.4±1.2 18.4±1.2
Male 21.2±11.84 13.2±7.70 10.8±7.54 21.2±20.70 1.4±1.56 67.8±23.72
Top-K Female 17.2±21.04 6.6±6.14 4.0±2.82 2.8±2.56 1.6±1.50 32.2±23.72
Sum 38.4±17.18 19.8±12.56 14.8±7.38 24±19.38 3.0±2.04
Male 27.4±9.13 11.8±5.02 10.2±4.33 10.2±3.03 3.2±2.4 62.8±11.77
MMR Female 17±9.13 9±5.67 5.4±3.47 3.6±1.5 2.2±1.08 37.2±11.77
Sum 44.4±6.62 20.8±9.39 15.6±5.64 13.8±3.84 5.4±2.37
Male 19.6±13.11 12.4±6.56 9.4±6 15±8.91 1.2±1.6 57.6±12.74
PBM Female 19.6±13.11 8.4±5.92 5.4±3.69 7.2±5.15 1.8±1.66 42.4±12.74
Sum 39.2±13.45 20.8±11.07 14.8±6.46 22.2±13.61 3±2.05
Male 20.4±6.99 8.2±3.94 5.4±2.54 11±3.49 3.8±2.6 48.8±5.53
DebiasCLIP Female 19.4±6.99 9.4±5.14 8.4±4.27 10±4.65 4±1.79 51.2±5.53
Sum 39.8±9.78 17.6±3.67 13.8±5.62 21±6.53 7.8±3.16
Ours MMR PBM ClipCLIP DebiasClip
Ours Fit MMR Fit PBM Fit ClipCLIP Fit
1.1 1.0 1.0
1.0 1.0 0.9 0.9
0.8
0.9 0.8
0.9 0.7
0.8 0.7
0.6
0.7 0.8 0.6 0.5
0.6 0.5 0.4
0.7
0.4 0.3
103 102 101 100 101 103 102 101 100 101 102 103 102 101 100 101
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
0.6
Figure11:FractionofTop-kcosinesimilarityvsFractionofTop-kMPRforMPRmeasuredbyfunctionclassCgivenbytheset
of2-layerMLPswithhiddendim0e.n5sion64.Averagedover10queriesfork=50imagesretrieved.FromLeft-to-Right:CelebA,
UTKFaces,Occupations.Valuesarenormalizedsok-NNachievespoint(1,1)ineachcase.MAPRPareto-dominatesbaselinesand
significantlyclosestheMPRgap.0.4
0.0 0.5 1.0
Fraction of Top-k MPR
28
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarF
ytiralimiS
k-poT
fo
noitcarFMulti-GroupProportionalRepresentation APREPRINT
Query: bartender Query: bus_driver Query: chemist
1.0 MAPR (Ours) 0.7 MAPR (Ours) 0.5 MAPR (Ours)
MMR MMR MMR
0.8 C P DBl eip M bC iaL sI CP lip 0.6 C P DBl eip M bC iaL sI CP lip 0.4 C P DBl eip M bC iaL sI CP lip
0.5
0.6 0.4 0.3
0.3
0.4 0.2
0.2
0.2 0.1 0.1
0.0
0.0
0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0 0.2 0.4 0.6 0.8 1.0
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
Query: construction_worker Query: customer_service_representative Query: housekeeper
MAPR (Ours) 0.6 MAPR (Ours) 0.8 MAPR (Ours)
0.7 M ClM ipR CLIP 0.5 M ClM ipR CLIP 0.7 M ClM ipR CLIP
0.6 P DB eM biasClip P DB eM biasClip 0.6 P DB eM biasClip
0.4 0.5 0.5
0.4 0.3 0.4
0.3 0.2 0.3
0.2 0.2
0.1
0.1 0.1
0.0 0.0 0.0
0.2 0.4 0.6 0.8 1.0 0.2 0.4 0.6 0.8 1.0 1.2 0.0 0.2 0.4 0.6 0.8 1.0
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
Query: nurse_practitioner Query: receptionist Query: special_ed_teacher
0.35 MAPR (Ours) MAPR (Ours) 0.30 MAPR (Ours)
0.30 M ClM ipR CLIP 0.4 M ClM ipR CLIP M ClM ipR CLIP
PBM PBM 0.25 PBM
0.25 DebiasClip 0.3 DebiasClip 0.20 DebiasClip
0.20
0.2 0.15
0.15
0.10 0.1 0.10
0.05 0.05
0.0
0.2 0.4 0.6 0.8 1.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0 1.2 1.4 1.6
Fraction of Top-k MPR Fraction of Top-k MPR Fraction of Top-k MPR
Figure12: Additionalprecision-representationplotsoverqueries“bartender",“busdriver",“chemist",“constructionworker",
“customerservicerepresentative",“housekeeper",“nursepractitioner",“receptionist",and“sepecialedteacher".
Figure13:RetrievalsforMAPRwithquery“Aphotoofateacher"
29
noisicerP
noisicerP
noisicerP
noisicerP
noisicerP
noisicerP
noisicerP
noisicerP
noisicerPMulti-GroupProportionalRepresentation APREPRINT
Figure14:Retrievalsfork-NNwithquery“Aphotoofateacher"
Figure15:RetrievalsforMMRwithquery“Aphotoofateacher"
30Multi-GroupProportionalRepresentation APREPRINT
Figure16:RetrievalsforClipClipwithquery“Aphotoofateacher"
Figure17:RetrievalsforPBMwithquery“Aphotoofateacher"
31Multi-GroupProportionalRepresentation APREPRINT
Figure18:RetrievalsforDebiasClipwithquery“Aphotoofateacher"
Figure19:RetrievalsforMAPR withquery“Aphotoofanarchitect"
32Multi-GroupProportionalRepresentation APREPRINT
Figure20:Retrievalsfork-NNwithquery“Aphotoofanarchitect"
Figure21:RetrievalsforMMRwithquery“Aphotoofanarchitect"
33Multi-GroupProportionalRepresentation APREPRINT
Figure22:RetrievalsforClipClipwithquery“Aphotoofanarchitect"
Figure23:RetrievalsforPBMwithquery“Aphotoofanarchitect"
34Multi-GroupProportionalRepresentation APREPRINT
Figure24:RetrievalsforDebiasClipwithquery“Aphotoofanarchitect"
35Multi-GroupProportionalRepresentation APREPRINT
E ExperimentNotes
E.1 GPTGeneratedQueries.
The 10 queries used in experiments and generated by GPT are as follows: [programmer, nurse, architect,
scientist, artist, chef, lawyer, teacher, engineer, doctor].
E.2 ExperimentSettingandDetails.
These experiments were conducted mainly on cpu after initially using a single A100 GPU to compute CLIP and
DebiasCLIPembeddingsandrunFAISStocomputethetop10kcandidatesforeach. Then,allembeddingsaresaved
so that retrieval across all methods can be run on cpu. When training linear probes, we conduct cross-validated
hyperparametersearchfrom0.01to100overℓ regularizedlogisticregressionmodeslfromscikit-learn[68]tofindthe
2
optimalprobe.
TorunMAPR,weuseGurobi [90]withanAcademic LicensetosolveEqn. (10)eachiterationofour cuttingplane
method,anduseCVXPY[91,92]tosolveourclosed-form,quadraticprogram.
Totrainouroracleestimators,wecallscikit-learn’simplementationsofLinearRegression,DecisionTreeswithdepth3,
andMLPswithonehiddenlayerofsize64.
Onaverage,theruntimeforMAPRisapproximately1-5minuteswith50queriesand10000elementsineachofour
retrievalandcurationsets. However,withmorefeatures(suchasusingCLIPembeddingsinsteadofgroupattributes)
thisruntimecanincrease. Wenotehowever, thatourmostcompetitivebaseline, MMR,isagreedyalgorithmthat
requires1-2hoursperquerytocompute. Inliveimageretrievalsettings,thisruntimeistooslowtobeofanypractical
use.
36