Extending Stable and Popular Matching Algorithms from
Bipartite to Arbitrary Instances
Gergely Cs´aji1
HUN-RENKRTK KTI
September 26, 2024
Abstract
We consider stable and popular matching problems in arbitrary graphs, which are referred to
as stable roommates instances. We extend the 3/2-approximation algorithm for the maximum
sizeweaklystablematchingproblemtotheroommatescase,whichsolvesamorethan20yearold
open question of Irving and Manlove about the approximability of maximum size weakly stable
matchings in roommates instances with ties [28] and has nice applications for the problem of
matchingresidentstohospitalsinthepresenceofcouples. Wealsoextendthealgorithmthatfinds
a maximum size popular matching in bipartite graphs in the case of strict preferences and the
algorithm to find a popular matchingamong maximum weight matchings.
While previous attempts to extend the idea of promoting the agents or duplicating the edges
from bipartiteinstancestoarbitrary onesfailed, theseresultsshow thatwith thehelp ofasimple
observation, we can indeed bridge thegap and extend these algorithms.
1 Introduction
Preference based matching markets is an extensively studied topic in computer science, mathematics
and economics literature. The extensive study of the area started back in 1962 after the seminal
paperofGaleandShapley[13], whointroducedthe stablemarriageproblemandshowedthata stable
matchingalwaysexists andcanbe foundinlinear time. Since then, countlessapplicationsandrelated
models have been studied, see Manlove[27] for an overview. Applications include Residentallocation,
University admission, Kidney exchange, job markets and much more.
A centralquestionrelatedto stable matchings is about finding a maximumsize stable matching in
agiveninstancewithweakpreferences(meaningtiesareallowed). Forbipartiteinstances,theproblem
is called Max-SMTI, which has been show to admit a 3/2-approximationalgorithm by McDermid in
2009 [29]. However, the question of approximability remained open for arbitrary instances ever since
Irving and Manlove asked it in their seminal paper more than 20 years ago [19]. The approximablity
of maximum size stable matchings in arbitrary (also called roommmates) instances was also posed as
anopenquestionat[1]. Asourmainresult,weresolvethislong-standingopenquestionandshowthat
the problem admits a 3/2-approximation algorithm just as in the bipartite special case. Somewhat
surprisingly,thisresulthasaniceapplicationfortheallocationofresidentstohospitalsinthepresence
of couples, which is also a central problem in the field, with applications in many country’s national
resident matching programs,such as the NRMP in the US [2].
Apartfromstability,anothercentralnotiongettingmoreandmoreattentionrecentlyispopularity,
whichwasintroducedbyGardenfors[14]. Intuitively,apopularmatchingisonethatdoesnotloseina
head-to-headelection against any other matching. The advantages of popularity are that (i) it allows
larger matchings than stable ones, while still preserving a nice global form of stability and (ii) it can
naturally be made compatible with maximum size or maximum weight matchings, by restricting the
candidate matchings.
Usingourcentralobservation,weextendsomepreviousalgorithmsforpopularmatchingstoroom-
mates instances. We give an algorithm to find a maximum size popular fractional-matching and also
an algorithm that finds a popular solution among the maximum weight fractional-matchings.
1
4202
peS
52
]SD.sc[
2v37161.9042:viXra1.1 Related Work
In the stable marriage problem, the goal is to match two classes of agents in a way such that there
are no blocking edges, i.e. pairs of agents who mutually prefer each other to their partners. The
stable marriage problem with ties and incomplete lists (smti) was first studied by Iwama et al. [20],
who showed the NP-hardness of Max-SMTI, which is the problem of finding a maximum size stable
matching in an SMTI instance. Since then, several papers made progress to improve the approx-
imability of the problem, e.g. Iwama et al. [21, 22] and Kira´ly [24]. Currently, the best ratio is 3
2
by a polynomial time algorithm of McDermid [29], where the same ratio is attained by linear-time
algorithms of Pauluch [31, 32] and Kira´ly [25, 26]. This 3-approximation has been extended even
2
to very general cases, including two-sided matroid constraints [9], γ-stability [7], where we are given
γe numbers for each edge e and vertex v such that these numbers describe how much improvement
v
v needs to consider e a blocking edge, and critical relaxed stability [30], which is a generalization of
Max-SMTI, where there is a set of critical agents, among whom we must match as much as possible
and stability is relaxed in an appropriate way.
As for the inapproximability of Max-SMTI, Halldo´rssson et al. [16] showed that it is NP-hard
to approximate it within some constant factor. Later, inapproximability results have been improved,
especially assuming strongercomplexity theoretic conjectures. Yanagisawa[34] and Halldo´rssonet al.
[17]showedthatassumingtheUniqueGamesConjecture,thereisno 4−ε-approximationforanyε>0.
3
By a recent work by Dudycz et al. [12] it follows that assuming the strong Unique Games Conjecture
ortheSmallSetExpansionHypothesisorthestrong-UGC,therecannotevenbea 3−ε-approximation
2
algorithm for Max-SMTI.
The Stable Roommates problem with ties and incomplete preferences was studied by Irving and
Manlove[19]. Theyshowedthatfindingsuperstablematchingscanbedoneinpolynomialtime. They
posedasanopenquestionwhetherthemaximumsizeofaweaklystablematchingcanbeapproximated
better than 2 or not. Of course, as deciding if a stable roommates instance with ties admits a weakly
stable matching is NP-hard, the question makes sense in the following two senses. First of all, by
a result of Tan [33], we know that half-integral weakly stable matchings (also called weakly stable
partitions) always exist and can be found in polynomial time, even in the case of multigraphs [6].
Therefore, the question of whether we can approximate the maximum size of a weakly stable half-
matching (or a weakly stable fractional-matching)better than 2 is still a very relevant open question.
Secondly, as in [1], we can restrict the instances to ones without odd preference cycles (meaning in
everyoddcyclethere isanagentthatprefersits clockwiseneighbourto itsother neighbour,andthere
is another agent that prefers its anti-clockwise neighbour to its other neighbour), which implies that
there always exists a weakly stable matching. Hence, for such instances, it makes sense to try to
find a weakly stable (integral) matching, which approximates the size of the maximum size weakly
stable matching better than 2. Here, a 2-approximation is trivial, as any weakly stable matching is
a 2-approximation (and every weakly stable half-matching gives at least one weakly stable integral
matching of the same size), which has already been observed by Irving and Manlove in their paper
[19]. We show that both these problems admit a 3-approximation algorithm, which is best possible
2
under the strong Unique Games Conjecture, given the inapproximabilty results for the bipartite case.
Popularmatchingshavebeenstudiedbymanypapersrecently. IthasbeenknownsinceGardenfors’
seminal paper in 1975 [14] that stable matchings are popular, and hence popular matchings always
exist in bipartite instances. Kavitha [23] gave algorithms to find a maximum size popular matching,
andamatchingthatispopularamongthe maximumsizematchings. The ideasofheralgorithmswere
similar to Kira´ly’s, that is, they used Gale-Shapley type proposal-rejection algorithms, where agents
could have multiple levels. Finding a popular matching among the maximum weight matchings has
also a similar algorithm as shown in Cs´aji et al. [8].
Sadly, if the preferences of the agents may contain ties, a popular matching may not exist and
finding a popular matching is NP-hard [11]. In the case of arbitrary graphs, i.e. stable roommates
instances,finding apopularmatchingwasshownto beNP-hardevenwithstrictpreferencesbyGupta
et al. [15].
To cope with this hardness, Huang and Kavitha [18] studied popular mixed-matchings in the
marriage and roommmates settings. They showed that a popular mixed-matching always exists and
gaveanalgorithmtofind a maximumweightpopularmixed-matchingin polynomial-timeby using an
LP-formulationforthe problem. This notionofpopularmixed-matchingswerealsostudiedbyBrandt
and Bullinger [5]. We introduce a new version of popularity for fractional-matchings, which we call
2popular fractional-matchings. We show that popular mixed-matchings may not be popular fractional-
matchings, but our algorithm can find a popular fractional-matching that has maximum size among
both the popular fractional- and popular mixed-matchings.
1.2 Our Contributions
In this paper we extend the 3-approximation algorithm for Max-SMTI for roommates instances. A
2
nice application for this result (somewhat surprisingly) arises from the problem of assigning residents
to hospitals in the presence of couples. This is a notoriously difficult problem algorithmically, which
is NP-hard even in extremely restricted cases [4]. However, it was shown very recently by Cs´aji et al.
[10],thatifweposesomenaturalrestrictionsonthecouple’spreferences,thenwecanhavepolynomial
time algorithms that find stable matchings by modifying the capacities by at most 1 in the process
(whichleadstoaso-callednear-feasiblestablematching). The novelidea ofthe algorithmisto reduce
the problemto the stable roommatesproblemwith appropriategadgetsand roundoffa weakly stable
half-matching in the obtained instance. Therefore, given that the hospitals and the residents may
have ties in their rankings, using algorithms that find larger weakly stable half-matchings in stable
roommates instances can be utilized to find near-feasible stable solutions that match more residents,
which is a very desirable feature.
Wealsoextendthealgorithmsforfindingmaximumsizepopularmatchingsandpopularmatchings
among the maximum weight matchings (in the case of strict preferences). Since popular matchings
may not exist in the roommates model, and even deciding their existence is NP-hard, we propose a
natural definition of popularity among fractional-matchings. This is somewhat similar to a previous
notionofpopularmixed-matchings[18],however,weshowthatamixed-matchingmaynotbe popular
with respect to our notion. We show that any stable half-matching is popular and that there always
existsamaximumsizepopularfractional-matchingthatishalf-integral. Wealsogiveanalgorithmthat
finds such a matching. This happens to be also a popular mixed-matching which has maximum size
amongthepopularmixed-matchings. Finally,wegiveanalgorithmthatfinds ahalf-integralmatching
that is popular among the maximum weight fractional-matchings.
Ourresultsarebasedonasimple,butcrucialobservation. IfonetranslatesthealgorithmsofKira´ly
[25] and Kavitha [23] that have multiple possible levels for each agent such that they make parallel
copies of different types of each edge instead that the two sides rank in an (almost) opposite order,
then it seems essential that we can have a partition U ∪W of the vertices such that each edge has
one vertex from both. However, it turns out that we only need that for each edge, its parallel copies
are ranked in an (almost) opposite order by its two vertices, we do not need to have copy types that
are globally rankedin an (almost) opposite way by the two sides. This crucialobservationhelps us to
overcome the difficulties of extending these algorithms for roommates instances.
1.3 Paper Structure
We start by defining the problems we study in more detail in Section 2. Then, we describe the meta-
algorithm in Section 3, which serves as a basis for all three of our algorithms. The approximation
algorithmforMax-SRTIisdescribedinSection3.1,thealgorithmforfindingamaximumsizepopular
fractional-matchinginSection3.2andthealgorithmforfindingapopularhalf-integralmatchingamong
the maximum weight fractional-matchings in Section 3.3. Finally, we conclude in Section 4.
2 Preliminaries
We investigatematchingmarkets,wherethe setofagentswiththe possiblesetofcontractsisgivenby
anarbitrarygraphG=(V;E), where vertices correspondto agents and edges correspondto possible,
mutually acceptable contracts. We allow the graph G to have parallel edges, i.e. multiple contracts
between the same two agents. For each agent v ∈V, let E(v) denote the edges that are incident to v.
WesaythatafunctionM :E →R isafractional-matching, if M(e)≤1foreachv ∈V.
0 Pe E(v)
We say that M is a half-matching, if ≥ additionally M(e) ∈ {0,1,1} for∈ each e ∈ E. We say that v is
2
saturated by M, if it holds that M(e)=1, otherwise v is unsaturated. Similarly, an edge e is
Pe E(v)
∈
saturated by M, if M(e)=1, otherwise it is unsaturated. For a vertex v, let E (v) denote the edges
M
with positive M-value incident to v, that is E (v)={e∈E(v)|M(e)>0}.
M
3For a number x, let x+ =max{0,x}.
2.1 Weakly Stable and γ-stable Matchings
We assume that for each agent v, there is a preference function p : E(v) → R , which defines a
v 0
≥
weakranking(cid:23) overtheincidentedgesofv. We emphasizethatweassumethattheagents(vertices)
v
rank their incident edges instead of the other agents, because we allow parallel edges in our model,
representing multiple types of contracts between two given agents. We also assume that p (∅) ≤ 0,
v
which denotes that an agent always weakly prefers to be matched to any acceptable partners rather
thanbeingunmatched. Suchaninstanceiscalledastable roommatesinstancewithties andincomplete
preferences. Ifthe(cid:23) inducedpreferencesarestrict,thenwerefertoitasastableroommates instance.
v
Foravertexvandafractional-matchingM,wedefinep (M):=min p (e),ifvissaturated,
v e ∈EM(v) v
otherwise p (M):=p (∅).
v v
We saythat anedge e=(u,v) blocks a fractional-matchingM,if M(e)<1 and(i) p (e)>p (M)
u u
and (ii) p (e) > p (M), that is, both are either unsaturated or have a worse partner with positive
v v
weight in M.
A fractional-matching M is called weakly stable or just stable, if there is no blocking edge to
M. The problem of finding a maximum size weakly stable matching in a bipartite graph with weak
preferences,called Max-SMTI is a well studied problem that is NP-hardeven to approximate within
someconstant,butadmitsalineartime 3-approximation[26]. Here,weconsidertheproblemoffinding
2
a maximum-size weakly stable fractional-matching in arbitrary graphs, which we call maximum size
stable roommates problem with ties and incomplete preferences, Max-SRTI for short.
Insteadofweakstability,wedefineamoregeneralnotion,mirroringγ-stabilityforbipartitegraphs
[7]. Suppose that for each edge e = (u,v), there are two numbers γu > 0 and γv > 0 given. We
e e
say that a fractional-matching M is γ-min stable, if there is no blocking edge e = (u,v) such that
p (e)−p (M)≥ γu and p (e)−p (M)≥ γv holds. Similarly, a fractional-matching is γ-max stable,
u u e v v e
if there is no blocking edge e=(u,v) such that p (e)−p (M)≥γu or p (e)−p (M)≥γv holds.
u u e v v e
In order to be able to solve both problems with the same algorithm, we go one step further and
consider a common generalizationof the above two problems. Instead of one γu value, we have values
e
0<γu <δu for each vertex-edge pair. We say that an edge e= (u,v) γ-blocks a fractional-matching
e e
M, if either min{p (e)−p (M)−γu,p (e)−p (M)−δv} ≥ 0 or min{p (e)−p (M)−δu,p (e)−
u u e v v e u u e v
p (M)−γv}≥0 holds. We say that a matching M is γ-stable, if no edge γ-blocks M.
v e
If the γv values are sufficiently small, then this corresponds to γ-max stability, and when the γv
e e
andδv valuesare sufficiently close,then itcorrespondsto γ-minstability. Furthermore,if both the γv
e e
and δv are sufficiently small, then we get back weak stability.
e
Now wedefine the optimizationproblemwe investigate,calledMaximum γ-stable fractional-
matching with ties and incomplete preferences abbreviated as Max-γ-fSRTI for short.
Max-γ-fSRTI
In: A graph G=(V;E), p () preference valuations for each v ∈V, numbers 0<γv <δv for
v e e
each pair (e,v)∈E×V such that v ∈e.
Out: A maximum size γ-stable fractional-matching M
Thespecialcaseoffindingamaximumsizeweaklystablefractional-matchingiscalledMax-SRTI.
2.2 Popular Matchings
For our popular matching related problems, we assume that the p (e) values are different for each
v
vertex v ∈V, so they induce a strict preference order ≻ overits adjacent edges. Also, e≻ ∅ for any
v v
adjacent edge e to v.
Let e,f be two elements of E∪{∅}. An agent v can compare these two elements and cast a vote,
based on which one he prefers more according to ≻ . Hence, we define vote (e,f) = +1, if e ≻ f,
v v v
vote (e,f)=0, if e=f and vote (e,f)=−1, if f ≻ e.
v v v
Forintegralmatchings,popularityisdefinedasfollows. M ispopular,if∆(M,N)= vote (M(v),N(v))≥
Pv V v
0 for any matching N, where M(v) and N(v) denote the edge v receives in M or N res∈pectively, if
4there is any, otherwisethey are defined to be ∅. Hence, a matching M is popular,if itdoes notlose in
a head-to-head comparison to any other matching.
We extend this definition in a natural way to fractional-matchings,which mirrors the definition of
popularity for the case of many-to-many matching instances.
LetM,N betwofractional-matchings. Wedenotethe fractional-matchingdefinedbymax{M(e)−
N(e),0}fore∈E as(M−N)+. Agentv ∈V nowcomparesthedifferences(M−N)+ and(N−M)+
by pairing the edges of E (v) with E (v) with some appropriate weights. This is done
(M N)+ (N M)+
with the help of a function φ− : E(v)∪{∅} ×− E(v)∪{∅} →R , such that
v (cid:0) (cid:1) (cid:0) (cid:1) 0
≥
1. φ (e,f)=(M −N)+(e) for each e∈E(v),
Pf E(v) v
∈ ∪{∅}
2. φ (f,e)=(N −M)+(e) for each e∈E(v),
Pf E(v) v
∈ ∪{∅}
3. φ (f,∅)=( M(e)−N(e))+,
Pf E(v) v Pe E(v)
∈ ∪{∅} ∈
4. φ (∅,f)=( N(e)−M(e))+.
Pf E(v) v Pe E(v)
∈ ∪{∅} ∈
The function φ is called a feasible pairing for v if it satisfies these condition.
v
Itfollowsalsothatφ (e,e)=0foranye∈E(v)∪{∅},aseither(M−N)+(e)=0or(N−M)+(e)=0
v
and also either ( M(e)−N(e))+ =0 or ( N(e)−M(e))+ =0.
Pe E(v) Pe E(v)
∈ ∈
We say that φ={φ |v ∈V} is a feasible pairing, if φ is a feasible pairing for v, for each v ∈V.
v v
Forafeasiblepairingφ,wedefinevote (M,N,φ )= φ (e,f)·vote (e,f). Finally,
v v P(e,f) (E(v) )2 v v
∈ ∪{∅}
welet∆(M,N,φ)= vote (M,N,φ )and∆(M,N)=min ∆(M,N,φ) φ is a feasible pairing .
Pv V v v (cid:8) (cid:12) (cid:9)
We say that an fract∈ional-matching M is popular, if ∆(M,N) ≥ 0 for any(cid:12)fractional-matching N,
i.e. if no other fractional-matchingcanbeat M in a head-to-headelectionwith respect to any feasible
pairing.
Westudythefollowingoptimizationproblemoffindingamaximumsizepopularfractional-matching.
Max-PRI
In: A graph G=(V;E) with strict preference orders ≻ for each v ∈V.
v
Out: A maximum size popular fractional-matching M
2.3 Popular Mixed-Matchings and a Common Generalization
Let M be a fractional-matching. Then, by a result of Balinski [3] about the half-integrality of the
k k
matching polytope, we have that M = λ M , where 0 < λ ≤ 1, λ = 1 and each M is
Pi=1 i i i Pi=1 i i
half-integral.
We say that the fractional-matching M is a popular mixed-matching[18], if it holds that for any
fractional-matching N, we have that
X[ X M(e)N(f)votev(e,f)+ X M(e)(1
−
X N(f))votev(e, ∅)+ X N(f)(1
−
X M(e))votev( ∅,f)] ≥0.
v∈V e,f∈E(v) e∈E(v) f∈E(v) f∈E(v) e∈E(v)
ItisshownbyHuangandKavitha[18]usingthehalf-integralityofthematchingpolytopethatthis
is equivalent to only requiring it for half-integral matchings N, and if the instance is bipartite, only
for integral matchings N.
Example 1. We give an example to show that a popular mixed-matching may not be a popular frac-
tional matching. We have a bipartite instance with agents u ,u ,u on one side and w ,w on the
1 2 3 1 2
other. The preferences are w ≻ w for i=1,2, only w for u , and u ≻ u , u ≻ u ≻ u .
1 ui 2 2 3 1 w1 2 1 w2 2 w2 3
Take the half-matching M with M(u ,w )=M(u ,w )=M(u ,w )=M(u ,w )= 1 and M(e)=0
1 1 1 2 2 1 2 2 2
otherwise. It is straightforward to verify that M is a popular mixed-matching, by comparing it to every
integral matching N.
However, it is not a popular fractional-matching. Take N with N(u ,w ) = 1,N(u ,w ) =
1 1 2 2
N(u ,w )= 1 and N(e)=0 otherwise. Then, the feasible pairings are unique for each agent and we
3 2 2
have that u ,w both have votes −1, u ,w both have votes +1 and u has vote −1 so ∆(M.N)<0.
1 1 2 2 2 2 3 2
5We relax the axioms of feasible pairings to allow comparisons that arise from the definition of
popular mixed-matchings − note that here an edge e with M(e) = N(e) = 1 may be paired with
2
different edges, which is not allowed in a feasible pairing.
Wesaythatφ: E(v)∪{∅} × E(v)∪{∅} →R isasensible-pairing betweenfractional-matchings
(cid:0) (cid:1) (cid:0) (cid:1) 0
≥
M and N, if
1. φ (e,f)=M(e) for each e∈E(v),
Pf E(v) v
∈ ∪{∅}
2. φ (f,e)=N(e) for each e∈E(v),
Pf E(v) v
∈ ∪{∅}
3. φ (∅,f)>0 =⇒ M(e)<1,
Pf E(v) v Pe E(v)
∈ ∪{∅} ∈
4. φ (f,∅)>0 =⇒ N(e)<1,
Pf E(v) v Pe E(v)
∈ ∪{∅} ∈
5. φ (e,e)=φ (e,e) for each e=(u,v)∈E.
u v
Note that by changing the last axiom to φ (e,e,) = φ (e,e) = min{M(e),N(e)}, changing 3
u v
back to the stronger requirement φ (∅,f) = ( N(e)−M(e))+, and changing 4
Pf E(v) v Pe E(v)
to φ (f,∅)= ( M∈ (e)−∪{ N∅} (e))+, we get bac∈ k the definition for a feasible pairing.
Pf E(v) v Pe E(v)
∈ ∪{∅} ∈
Hence, any feasible pairing is sensible. For a pairing φ defined by φ (e,f) = M(e)N(f), φ (e,∅) =
v v v
M(e)(1− N(f)), φ (∅,f) = (1− M(e))N(f) for e = (u,v), which is the pairing in
Pf E(v) v Pe E(v)
the definition∈of popular mixed-matchings, we∈have that all axioms are clearly satisfied.
We say that a fractional-matching M is extra-popular, if ∆(M,N,φ) ≥ 0 for any sensible-pairing
φ.
Remark1. Itimmediatelyfollowsthatanextra-popularfractional-matchingisbothapopularfractional-
matching and a popular mixed-matching.
We say that a fractional-matching M is barely-defendable, if for any other fractional-matching N,
there exists some sensible pairing φ such that ∆(M,N,φ)≥0.
Remark 2. We also have that both popular mixed-matchings and popular fractional-matchings are
barely-defendable.
2.4 Popular Maximum Weight Matchings and Popular Critical Matchings
Letussupposethatwehavesomeweightfunctionω :E →Rontheedges. Byrestrictingthecandidate
fractional-matchings to only the maximum weight fractional-matchings, we can define a new version
of popularity. We say that a maximum weight fractional-matching M is a popular maximum weight
fractional-matching, if we have ∆(M,N,φ)≥0 for any other maximum weight fractional-matching N
and feasible pairing φ. We call the problem of finding such a matching Pop-MaxW-SRI.
Pop-MaxW-SRI
In: AgraphG=(V;E)withstrictpreferenceorders≻ foreachv ∈V andaweightfunction
v
ω :E →R.
Out: A popular maximum weight fractional-matching M.
In our algorithm, we reduce this problem to a slightly easier problem, where we consider critical
fractional-matchings. To define these, let’s suppose we are given a set C ⊆ V of critical vertices. We
say that a fractional-matching is critical, if it saturates every critical vertex, i.e. if M(e)=1
Pe E(v)
for all v ∈C. ∈
Finally, we say that a critical fractional-matching is a popular critical fractional-matching, if
∆(M,N,φ)≥0 for any critical fractional-matching N and feasible pairing φ.
Pop-Crit-SRI
In: A graph G = (V;E) with strict preference orders ≻ for each v ∈ V and a set of critical
v
vertices C ⊆V.
Out: A popular critical fractional-matching M.
63 The Meta-Algorithm
As it turns out, similarly to the bipartite case, all these problems can be solved with very similar
algorithms, that have the same outline. We call this the meta-algorithm, which we describe now.
1. Create a stable roommates instance I = (G,≻) with strict preferences (and parallel edges -
′ ′ ′
note that this is also called Stable Multiple Activities in the literature [6]) by making parallel copies
(e ) of each edge e and creating strict preferences over the created edges.
i i k
∈
2. Run the extension of Tan’s algorithm by Cechl´arov´a et al.[6] to obtain a stable half-matching
M in the new instance I .
′ ′
3. Take the projection M of M to I, which is defined as M(e):= M (e ).
′ Pi ′ i
The second and third steps will be the same for all three algorithms. The only difference between
themisinthefirststep,thatis,howdowecreateparalleledgesandhowdowecreatestrictpreference
orders over them.
3.1 Maximum Size γ-Stable Fractional-Matching
We start with our 3-approximationalgorithm for Max-γ-fSRTI.
2
Let V = {v ,...,v } be an indexing of the vertices. We describe the fine-tuned first step of the
1 n
meta-algorithm for this problem in more detail.
For each edge e = (v ,v ) ∈ E, i < j we create four parallel edges e1,e2,e3,e4. For v , e1 is
i j i
considered the best copy of e, while e2 is second best, e3 is third and e4 is last. For v , e4 is the best
j
copy of e, e3 is second, e2 is third and e1 is last.
We create the strict preferences of a vertex v as follows. For any edges e,f, the worst copy of
f (which may be either f1 or f4) is always ranked worse than any best, second or third copy of e.
Furthermore,thesecondbestcopyoff isbetterthanthebestcopyofeifandonlyifp (f)≥p (e)+γv
v v f
and the third copy of f is better than the best copy of e if and only if p (f) ≥ p (e)+δv. Within
v v f
the best and last copies, the edges are ranked according to a strict extension of v’s original weak
preferences. This can be obtained in the following way. For a vertex v ∈ V and e = (u,v) let a(e)
be the best, b(e) be the second, c(e) be the third and d(e) be the last copy. Set p (a(e)) = p (e),
v v
p (b(e))=p (e)−γv and p (c(e))=p (e)−δv. Then, for each vertex, these new (possibly negative)
v v e v v e
preference numbers define a weak order, in which we break ties in a way such that among edges with
the same value the c copies are best, the b copies are second and the a copies are last. Finally, the
worst copies are ranked strictly last in the order they are in p (), breaking the ties arbitrarily.
v
We start by showing that we can restrict ourselves to only consider half-matchings.
Lemma 1. There always exists a half-integral optimal solution to Max-γ-fSRTI.
Proof. Let M be an arbitrary maximum size γ-stable fractional-matching. Using the fact that the
convex hull of fractional-matchings form a half-integral polyhedron [3], we get that M = λ M ,
Pi i i
where λ =1, λ >0 and M is a half-matching for each i. It follows that there exists at least one
Pi i i i
M such that M (e)≥ M(e). We show that M is γ-stable.
i Pe E i Pe E i
Suppose that∈e = (u,v) γ-blo∈cks M . If u (or v) is unsaturated in M then it is also unsaturated
i i
in M. Also, we have that E (u) ⊆ E (u) and E (v) ⊆ E (v). Therefore, we get that p (M ) ≥
Mi M Mi M v i
p (M) and p (M )≥p (M). This implies that e γ-blocks M, a contradiction.
v u i u
It follows that there exists an optimal half-matching to Max-γ-fSRTI.
Finally, we show that our algorithm outputs a 3-approximation.
2
Theorem 1. Max-γ-fSRTI can be 3-approximated in polynomial time.
2
Proof. Let M be the output of the algorithm and M be the pre-image of M in I .
′ ′
Claim 1. The output half-matching M is γ-stable.
Proof: Suppose for contradiction that there is a γ-blocking edge e = (v ,v ) to M. Suppose by
i j
symmetry that p vi(e)≥ p vi(M)+γ evi and p vj(e) ≥ p vj(M)+δ evj. Take the second best copy of e for
v , which is the third best copy of e for v . This copy of e blocks M by the definition of the rankings,
i j ′
contradiction.
(cid:4)
7Claim 2. For any γ-stable half-matching N it holds that N(e)≤ 3 M(e).
Pe E 2Pe E
∈ ∈
Proof:CreateabipartitegraphG =(V,V ,E ),whereV ={v |v ∈V}is acopyofV andforeach
′′ ′ ′′ ′ i′ i
(v ,v )∈E, we have edges (v ,v )∈E and (v ,v )∈E .
i j i j′ ′′ i′ j ′′
Each half-matching N defines a matching N in G as follows. If N(e) = 1 for e = (v ,v ), then
′′ ′′ i j
we add (v ,v ) and (v ,v ) to N . If we have a cycle of value 1 edges on vertices {v ,...,v }, then
i j′ i′ j ′′ 2 i1 ik
we add (v ,v ),(v ,v ),...,(v ,v ). Finally, if we have a path of of value 1 edges on vertices
i1 i′ 2 i2 i′ 3 ik i′ 1 2
{v ,...,v }, then we add (v ,v ),(v ,v ),...,(v ,v ).
i1 ik i1 i′
2
i2 i′
3
ik−1 i′
k
Let N be a maximum size γ-stable half-matching. Take the matchings N ,M corresponding to
′′ ′′
N and M.
Suppose for the contrary that N(e) > 3 M(e). Then, we have that |N | > 3|M |.
Pe E 2Pe E ′′ 2 ′′
This implies that either there is a com∈ponent in N △M∈ that has a single N -edge or a component
′′ ′′ ′′
with two N -edges and a single M -edge.
′′ ′′
In the first case, we get that there is an edge (v ,v ) such that v and v are both unsaturated in
i j i j
M, contradicting the γ-stability of M. In the second case, let the component be {e =(v ,v ),f =
′′ i1 i′
2
′′
(v ,v ),g = (v ,v )}, where f = (v ,v ) is the edge of M . We have that i ,i ,i are distinct
i′
2
i3 ′′ i3 i′
4
′′ i′
2
i3 ′′ 1 2 3
and so are i ,i ,i , but it may happen that i =i .
2 3 4 1 4
Since v and v are unmatched by M , v and v are unsaturated in M . Since the best copy
i1 i′
4
′′ i1 i4 ′
of e for v does not block M , v is saturated with first, second or third copies. Since the best copy
i2 ′ i2
of g for v does not block M , v is saturated with first, second or third copies. Hence, either the
i3 ′ i3
secondor the third bestcopy off =(v ,v ) forv has positive weightin M . Suppose by symmetry
i pt vii 3s (t eh )e ≥se pc vo i3n (d
v
ib 3,e vst i4c )o +py δ. eviT 3.he Tn h, if sor cot nh
ti e2
ras
dai im3
cte sr te ha
esi o2
γn -, stw ae bim litu yst ofha Nv .e p
vi2(e)≥′
p vi2( (cid:4)v i1,v i2)+γ
evi2
and
3.1.1 Maximum Size Weakly Stable Fractional-Matching
For completeness, we describe an even simpler algorithm for the special case Max-SRTI, i.e. the
case,when there are no γ numbers, eachagentv just has a preference valuationp (), inducing a weak
v
preference order (cid:23) (e ≻ f ⇔ p (e) > p (f) and e (cid:23) f ⇔ p (e) ≥ p (f)) and to goal is to find a
v v v v v v v
maximum size weakly stable half-matching.
Then, in the first step of the algorithm, we do the following. For each e=(v ,v ),i<j, we create
i j
threeparalleledges ei,e0,ej. For v , ei isbest, e0 is middle andej is worst,andforv , ej is best, e0 is
i j
middle andei is worst. Then, the preference ordersfor v ∈V are createdfrom(cid:23) suchthatfor each
i vi
e∈E(v ), ei ≻e0, and f0 ≻ei if and only if f is strictly preferred to e. Within the same copy types,
i
the edgesare rankedaccordingto anarbitrarystrictextensionof (cid:23) . The copies ej, j 6=i are ranked
vi
last in the order (cid:23) , breaking the ties in an arbitrary way. An easy way to create these preferences
v
is to go through (cid:23) , and in each tie [e ,..,e ] just substitute it with ei ≻ ···ei ≻ e0 ≻ ···e0, then
vi 1 k 1 k 1 k
append to worst copies of the edges strictly after them by breaking the ties arbitrarily.
To give an example, let (cid:23) = e ≻ [f,g] ≻ h. Then, we get ei ≻ e0 ≻ fi ≻ gi ≻ f0 ≻ g0 ≻ hi ≻
vi
h0 ≻ej1 ≻fj2 ≻gj3 ≻hj4, where e=(v i,v j1),f =(v i,v j2),g =(v i,v j3),h=(v i,v j4).
Theorem 2. Max-SRTI can be 3-approximated in polynomial time even with the simpler algorithm.
2
Proof. Let M be the output of the simpler algorithm and M be the pre-image of M in I .
′ ′
Claim 3. The output half-matching M is weakly stable.
Proof: Suppose for contradiction that there is a blocking edge e = (v ,v ) to M. Then, the copy e0
i j
blocks M by the definition of the rankings, contradiction.
′
(cid:4)
Claim 4. For any weakly stable half-matching N it holds that N(e)≤ 3 M(e).
Pe E 2Pe E
∈ ∈
Proof: Let N be a maximum size weakly stable half-matching.
Create a bipartite graph G =(V,V ,E ), and matchings N ,M as in Theorem 1.
′′ ′ ′′ ′′ ′′
Suppose for the contrary that N(e) > 3 M(e). Then, we have that |N | > 3|M |.
Pe E 2Pe E ′′ 2 ′′
This implies that either there is a com∈ponent in N △M∈ that has a single N -edge or a component
′′ ′′ ′′
with two N -edges and a single M -edge.
′′ ′′
Inthefirstcase,wegetthatthereisanedge(v ,v )suchthatv andv arebothunsaturatedinM,
i j i j
contradicting the weak stability of M. In the second case, let the component be {e =(v ,v ),f =
′′ i1 i′
2
′′
8(v ,v ),g =(v ,v )},wheref =(v ,v )istheedgeofM ,i.e. M(f)>0. Wehavethati ,i ,i
i′
2
i3 ′′ i3 i′
4
′′ i′
2
i3 ′′ 1 2 3
are distinct and so are i ,i ,i , but it may happen that i =i .
2 3 4 1 4
blocS kin Mce ′,v i o1 nla ynd fiv 2,i′ 4 f0ar ce anun hm ava etc phe od sitb ivy eM va′ l′ u, ev i i1 na Mnd ′.v i S4 ina cr ee gu in 3s da otu er sa nte od
t
bin loM ck′. MS ′,in oc ne lyei f2 i3d ,o fe 0s cn ao nt
have positive value in M ′. Hence, we have that M ′(f0) > 0. Then, since ei2 and gi3 does not block
M , we must have f ≻ e and f ≻ g, contradicting the stability of N. (cid:4)
′ vi2 vi3
Wealsoshowthatiftheinstancehasnooddpreferencecycles,thenthealgorithmoutputsaweakly
stablematchingthatapproximatesthemaximumweaklystablematching. Recallthatthismeansthat
in every odd cycle, there is an agent that prefers its clockwise neighbour to its other neighbour, and
there is another agent that prefers its anti-clockwise neighbour to its other neighbour.
Theorem 3. If the instance does not admit odd preference cycles, then the algorithm outputs an
integral weakly stable matching M, such that |M|≥ 2|N| for any other weakly stable matching N.
3
Proof. Bythe resultofTanonstablepartitions[33],weknowthatifthere isnooddpreferencecycles,
then each weakly stable half-matching consists of disjoint value 1 edges and even cycles of value 1
2
edges. Also, in this case, Tan’s algorithm always outputs an integral weakly stable matching. Hence,
our algorithm also outputs an integral matching.
Finally,wehavealreadyshownthat|M|≥ 2|N|inTheorem2,sothisalsoclearlyholdsforweakly
3
stable integral matchings too.
By Theorems 2 and 3 we have shown that both variants of finding a maximum size weakly stable
fractional-matching mentioned in the introduction has a 3-approximation algorithm.
2
3.2 Maximum Size Popular Fractional-Matching
In this section we solve the maximum size popular fractional-matching problem, Max-PRI for short.
Recallthatforthisproblem,weassumedthatwehavestrictpreferenceorders≻ foreachagentv ∈V.
v
We describe the fine-tuned first step of the meta-algorithm. For each edge e = (v ,v ), i < j, we
i j
create two parallel edges e ,e . Agent v considers e the good copy and e the bad one, while v
a b i a b j
considers e the good and e the bad one. The new strict preferences are created such that for any
b a
vertex v , it first ranks the good copies in their originalorder and strictly after then the bad copies in
i
their original order.
Theorem 4. Max-PRI is solvable in polynomial time. Furthermore, the output of the algorithm
is half-integral, extra-popular and has maximum size even among the barely-defendable fractional-
matchings.
Proof. Take the output half-matching M of the algorithm. Take any fractional-matching N and also
an arbitrary sensible-pairing φ between M and N.
We decompose φ as follows. First, we define φ0 by setting φ0(e,e) = 0 and φ0(e,f) = φ (e,f)
v v v
for e 6= f. We also set M0(e) = M(e)−φ (e,e) = M(e)−φ (e,e) and N0(e) = N(e)−φ (e,e)
v u v
for all e ∈ E. We can do this, as vote (e,e) is always 0, so this does not change ∆(M,N,φ), i.e.
v
∆(M,N,φ)=∆(M0,N0,φ0). Wealsomuststillhavethatforeache=(v ,v ), φ0 (e,f)=
i j P vi
f ∈E(vi)
∪{∅}
φ0 (e,f)=M0(e) and φ0 (f,e)= φ0 (f,e)=N0(e), because of the
P vj P vi P vj
f ∈E(vj)
∪{∅}
f ∈E(vi)
∪{∅}
f ∈E(vj)
∪{∅}
axiom φ (e,e)=φ (e,e) on sensible-pairings.
vi vj
Let k = 0. Create a graph Hk = (Wk,Ek), where each e = (v ,v ) ∈ E with Nk(e) > 0 receives
i j
two vertices ei ,ej and each with Mk(e) > 0 receives vertices ei ,ej . We also add a vertex v
N N M M ∅
corresponding to ∅. Then, we define the edges of Hk such that (ei ,fj ) is an edge if and only
M N
if i = j and φk (e,f) > 0. We also add edges edge (ei ,ej ) and (ei ,ej ) for each e = (v ,v ).
vi M M N N i j
Finally, we add an edge (ei ,v ) if and only if φk (e,∅)>0 and an edge (ei ,v ) if φ (∅,e)>0. Let
M ∅ vi N ∅ vi
Fk ={(ei ,ej )|e∈E, Mk(e)>0}∪{(ei ,ej )|e∈E, Nk(e)>0}.
M M N N
It is clear that either there is an Fk−Ek\Fk alternating cycle in Hk or an almost Fk−Ek\Fk
alternating cycle, which alternates at each vertex except v . This holds because each vertex apart
∅
fromv is adjacentto atleastone edgefrom bothFk andEk\Fk, as we have(and will maintain)for
∅
9each e = (v ,v ) that φk (e,f)= φk (e,f)= Mk(e) and φk (f,e) =
i j P vi P vj P vi
f ∈E(vi)
∪{∅}
f ∈E(vj)
∪{∅}
f ∈E(vi)
∪{∅}
φk (f,e)=Nk(e).
P vj
f ∈E(vj)
∪{∅}
Let this cycle be Ck. Also observe that by the construction of Hk, the edges Ck ∩Fk alternate
between (ei ,ej ) type and (ei ,ej ) type edges. Hence, Ck ∩ Fk gives a walk Pk in G, where
M M N N
Pk =(e ,f ,e ,...,f ,e ), with Mk(e )>0, Nk(f )>0 and φ (e ,f )>0,φ (e ,f )>0 and
it mayh0 app1 en1 that ejk =∅jk , e =∅ ore i =e (notei that anedgevi c− a1 nhi a− v1 eNi k(e)>u 0i ani dMi k(e)>0
0 jk 0 jk
simultaneously). Here, e =(u ,v ) and f =(v ,u ).
i i i i i 1 i
−
Set the weight of P to be
k
– w =min {φk (e ,f ),φk (e ,f )}, if e =e ,
k i ∈[jk] vi−1 i −1 i ui i i 0 jk
– w =min {φk (e ,f ),φk (e ,f ),φ (e ,∅)} if e 6=∅,e =∅,
k i ∈[jk] vi−1 i −1 i ui i i u0 0 0 jk
– w =min {φk (e ,f ),φk (e ,f ),φ (e ,∅)}, if e =∅,e 6=∅ and finally
k i ∈[jk] vi−1 i −1 i ui i i vjk jk 0 jk
– w =min {φk (e ,f ),φk (e ,f ),φ (e ,∅),φ (e ,∅)}, if ∅6=e 6=e 6=∅.
k i ∈[jk] vi−1 i −1 i ui i i u0 0 vjk jk 0 jk
Then, we let k := k+1, φk (e ,f ) = φk 1(e ,f )−w , φk (e ,f ) = φk 1(e ,f )−w
vi−1 i −1 i vi−−1 i −1 i k −1 ui i i u− i i i k −1
and φk(e,f) = φk 1(e,f) otherwise. If v ∈ Ck 1, then we let φk (e,∅) = φk 1(e,∅) − w if
v v− ∅ − vi vi− k −1
(v ,ei) ∈ Ck 1 and e = e ,v = u or e = e ,v = v , and φk(e,∅) = φk 1(e,∅) otherwise.
∅ − 0 i 0 jk i jk v v−
Also, φk(∅,f) = φk 1(∅,f) − w , if e = ∅,f = f ,v = v or e = ∅,f = f ,v = u and
φk(∅,e)v
=φk
1(∅,ev )−
otherwise.
k −1 0 1 0 jk jk jk
v v−
We letMk(e )=Mk 1(e )−w andMk(e)=Mk 1(e)otherwise. We let Nk(f )=Nk 1(f )−
i − i k 1 − i − i
w and Nk(f)=Nk 1(f) otherw− ise. This is feasible, as eachedge appearsat most once in as an e
k 1 − i
edg− e and at most once as an f edge in Pk.
i
Finally, we define Hk from Mk,Nk and φk the same way and iterate this procedure until φk ≡0.
We caniterate it,since eachvertexwekeepinHk apartfromv remainsadjacenttoatleastoneedge
∅
frombothFk andEk\Fk as we maintain φk(e,f)= φk(e,f)=Mk(e) and
Pf E(v) v Pf E(u) u
φk(f,e) = φk(f,e) =∈ Nk∪ ({ e∅ )} (in both cases∈ , eith∪ e{ r∅} all three terms remain
Pf E(v) v Pf E(u) u
∈ ∪{∅} ∈ ∪{∅}
the same, or all three decreases by w and by the choice of w it remains nonnegative). This
k 1 k 1
procedure terminates in finitely many s− teps, as in each step at least− one new φk(e,f) becomes 0.
v
For eachwalk Pl, letPl =(e ,f ,e ,f ,e ...,e ), whereM(e )>0 andN(f )>0 foreachi and
0 1 1 2 2 jl i i
e =e , if Pl is a closed walk and e ,e can be ∅.
0 jl 0 jl
Let e = (u ,v ) and f = (v ,u ). Of course, it may happen that v = v or u = v for some
i i i i i 1 i i j i j
−
i,j,however,this does notmatterfor the proof. Note that depending onthe abovecases,wecanhave
u =∅, v =∅ or u =u ,v =v .
0 jl 0 jl 0 jl
What is important however is that we have that no two adjacent edges are the same in any of the
walksPl bythefactthatφk(e,e)isalways0. Thisalsomeansthatvote (e ,f )+vote (e ,f ))∈
v vj−1 j −1 j uj j j
{−2,0,+2},as the preferences are strict.
k jl
Then, we have that ∆(M,N,φ) = w · (vote (e ,f )+vote (e ,f )+x(Pl)), where
lP
=1
k jP
=1
vj−1 j −1 j uj j j
x(Pl)=vote (e ,∅)+vote (e ,∅) if e 6=e and 0 otherwise. Therefore,it is enough to show that
u0 0 vjl jl 0 jl
jl
for each walk Pl, (vote (e ,f )+vote (e ,f )+x(Pl)) ≥ 0 and it is strictly larger than 0,
jP
=1
vj−1 j −1 j uj j j
whenever we have e =e =∅.
0 jl
Claim 5. 1. If e has a bad copy for v with positive value in M and e has a good copy for v ,
i i ′ i+1 i+1
then vote (e ,f )+vote (e ,f )=+2.
vi i i+1 ui+1 i+1 i+1
2. If e has a bad copy for v with positive value in M or e has a good copy for v , then
i i ′ i+1 i+1
vote (e ,f )+vote (e ,f )≥0.
vi i i+1 ui+1 i+1 i+1
3. If e has a good copy for v with positive value in M and e has a bad copy for v , then
i i ′ i+1 i+1
vote (e ,f )+vote (e ,f )≥−2.
vi i i+1 ui+1 i+1 i+1
4. If e =∅, then e has only a bad copy for v with positive weight in M and vote (e ,f )=+1.
0 1 1 ′ u1 1 1
105. Ife =∅,thene hasonlyagoodcopyforv withpositiveweightinM andvote (e ,f )=
jl jl−1 jl−1 ′ vjl−1 jl−1 jl
+1.
Proof:1. Supposeforthecontrarythatv oru prefersf toe ore respectively. Notethatboth
i i+1 i+1 i i+1
copies of f are unsaturated in M , because we have M(e )>0, M(e )>0 and f ∈/ {e ,e }.
i+1 ′ i i+1 i+1 i i+1
By the assumption, both are matched with a bad copy with positive weight in M . If u prefers
′ i+1
f , then the (unsaturated) bad copy of f for u (which is a good copy for v ) blocks M ,
i+1 i+1 i+1 i ′
otherwise the other copy blocks M by the definition of the extended rankings, contradiction.
′
2. In this case, at least one of u ,v is matched with a bad copy with positive weight in M ,
i+1 i ′
say it is v (other case is analogous). Hence, if both prefers f , then the bad copy of f for v
i i+1 i+1 i
(unsaturated in M for the same reasons) blocks M , contradiction.
′ ′
3. Trivial.
4. If e = ∅, then we must have by the 3-rd axiom of sensible pairings that v is unsaturated in
0 0
M , as φ (∅,f ) > 0. Hence, by the fact that the bad copy of f for v does not block M , we get
′ v0 1 1 0 ′
that u is saturated with good copies in M , so e must have a bad copy with positive weight in M
1 ′ 1 ′
for v . Also, u has to prefer each edge of M with positive weight even to the good copy of f , so
1 1 ′ 1
vote (e ,f )=+1.
u1 1 1
5. This case is very similar to 3. We have that u is unsaturated, so v can only have good
copies with positive weight in M and it must prefer
ejl
to f , so vote
j (l e−1
,f )=+1. (cid:4)
′ jl−1 jl vjl−1 jl−1 jl
Using vote (e ,f )+vote (e ,f ) ≥ −2, we get by the above observations that for each Pl,
vi i i ui+1 i i+1
case1. happens atleastasmanytimes ascase3.,exceptmaybe inthe case,where e 6=∅, e 6=∅ and
0 jl
e 6=e , in which case it can happen once more. However, in that case, the two endpoints u and v
0 jl 0 jl
jl
vote with +1, i.e. x(Pl)=+2, so (vote (e ,f )+vote (e ,f )+x(Pl))≥0.
jP
=1
vj−1 j −1 j uj j j
Finally, if e = e = ∅, then case 1. happens one more time than case 3., so by cases 4. and 5.
0 jl
jl
we havethat (vote (e ,f )+vote (e ,f )+x(Pl))>0. This provesthat M is extra-popular
jP
=1
vj−1 j −1 j uj j j
and that it has a maximum size even among the barely-defendable fractional-matchings.
Remark 3. Observe that we did not use the 4-th axiom of sensible pairings anywhere in the proof
of Theorem 4. Hence, the half-matching we get is extra-popular even in a slightly stronger sense we
get by eliminating axiom 4 from the definition of sensible pairings. Also, it is largest among barely-
defendable fractional-matchings even with the weaker definition which does not require axiom 4 from
sensible pairings.
The reason for axiom 4 is that it is quite natural and symmetric to axiom 3, and that we utilize it
in the next section for the Pop-Crit-SRI algorithm.
3.3 Popular Maximum Weight Fractional-Matching
In this section, we consider the problem of finding a fractional-matching that is popular among the
maximum weight fractional-matchings.
Consider the LP for the maximum weight fractional-matching problem.
maximize Xω ex
e
e E
∈
subject to X x e≤1, v ∈V
e E(v)
∈
x ≥0 e∈E
e
The Dual LP is
minimize Xy
v
v V
subject to y ∈+y ≥ω e∈E
u v e
y ≥0 v ∈V
v
Let y =(y ) be an optimal dual solution. By duality, we know that a fractional-matching M
∗ v∗ v V
∈
givenby x=(x ) is optimal, if and only if we have (i) y +y =ω(e) for each e=uv with x >0
e e E u∗ v∗ e
∈
and (ii) for each v with y >0 we have x(e)=1.
v∗ Pe E(v)
∈
11Let E :={e∈E |y +y =ω(e)} and C :={v ∈V |y >0}. Then, we have that the maximum
′ u∗ v∗ v∗
weight fractional-matchings (so each possible candidate) are exactly the ones that have positive value
only on edges from E andsaturate every v ∈C. Hence, we can restrictthe set of edges of G to E , so
′ ′
from now on let E :=E .
′
Thisway,wereducedthe problemtofinding apopular critical fractional-matching ,whichtorecall
is a fractional-matching M that saturates every v ∈ C and ∆(M,N) ≥ 0 for any fractional-matching
N that saturates each v ∈C.
Therefore, now it is enough to solve Pop-Crit-SRI.
We describe the fine-tuned first step of the meta-algorithm. Let |C|=s. We keep each edge of E.
These will be called the middle copies. If e=(v ,v ) such that v ,v ∈/ C, we do not create additional
i j i j
parallel edges. If v ∈ C,v ∈/ C, we add copies e1,...,es. These are considered worst copies for v in
i j i
the opposite order (i.e. es is the absolute worst and e1 is best among them) and best copies for v in
j
the opposite order (i.e. es is the absolute best and e1 is the worst among them). If v ∈/ C,v ∈C, we
i j
add copies e 1,...,e s. These are consideredworstcopies for v in the opposite order (i.e. e s is the
− − j −
absolute worstand e 1 is best amongthem) andbest copies for v in the opposite order(i.e. es is the
− j
absolute best and e1 is the worst among them). If v ,v ∈C, then we do both of the above.
i j
Then, the preferences are created such that the best copies are best, then the middle copies and
then the worst copies are worst. With respect to that, each vertex ranks the edges of the same type
according to their original order. For a vertex v, we use the notation Bv(e) to denote the j-th best
j
copy of e among the best copies, and Wv(e) to denote the j-th worst copy of e among the worst
j
copies (both can be either ej or e j). We also use the notation lev (Bv(e)) = j, lev (e) = 0 and
− v j v
lev (Wv(e))=−j, which is called the level of the given copy of e for v.
v j
Theorem 5. Pop-Crit-SRI is solvable in polynomial time. Furthermore, the algorithm outputs an
extra-popular matching among the critical matchings.
Proof. Take the output M of the algorithm.
Claim 6. M saturates every vertex in C.
Proof: Suppose for the contrary that M does not saturate some vertex v ∈ C. Take a half-matching
N that does.
Construct a bipartite graph G = (V,V ,E ) as in the proof of Theorem 1 and add the edges
′′ ′ ′′
according to the half-matchings N and M the same way, which leads to matchings N and M . By
′′ ′′
theassumptiononN,weknowthattheremustbeanM −N alternatingpaththatstartsfromsome
′′ ′′
vertex v or v with v ∈C and contains more copies of vertices from C. Suppose by symmetry it is
i1 i′
1
i1
v . Take the edge e =(v ,v )∈N (corresponding to the edge e ∈E). Since not even the worst
coi′ 1
py for v of e
bl′1 o′
cks
Mi′ 1
,
i w2
e get
′ t′
hat v is saturated in M
wi1
th only
Bvi2-type
edges. Hence,
we have
soi m1
e
ed1
ge f =
(v′
,v ) ∈ M
suci h2
that v ∈ C, as
B′ vi2(f
) exist.
1
By our assumption on
the component,
there1′′
is
somi2
e
edi′ 3
ge e
=′′
(v ,v ) ∈
Ni3
. For v
,1
we
h1
ave that M
(Wvi3(f
)) > 0, so
even
Wvi3(e
) can only be
dominate′2 d′
at
vi′ 3 ini4
M .
H′′
ence,
vi3
is saturated in
M′ w1
ith
B1 vi4
copies
2 2 i4 ′ i4 ′ j
with j ≤ 2. Hence, we have an edge f = (v ,v ) ∈ M and that v ∈ C. By the assumption on
2′′ i4 i′
5
′′ i5
the component, there exists an edge e = (v ,v ) ∈ N . By iterating this argument, we get edges
′3′ i′
5
i6 ′′
f ,e ,...,e ,f , such that each of them contains a vertex in V that corresponds to a critical vertex
3′′ ′4′ ′s′ s′′ ′
inC. However,thereares+1suchverticesin(e ∪f ∪···∪e ∪f )∩V ,acontradictionto|C|=s. (cid:4)
1 1 s s ′
Claim 7. M is an extra-popular critical fractional-matching.
Proof: Let N be an arbitrary critical fractional-matching and let φ be a sensible pairing between M
and N.
WedecomposeφtogetwalksP1,...,PkthesamewayasinTheorem4. LetPl =(e ,f ,e ,f ,e ...,e ),
0 1 1 2 2 jl
where M(e ) > 0, N(f ) > 0 and φ (e ,f ) > 0,φ (e ,f ) > 0 for each i and e = e , if Pl is a
i i vi−1 i −1 i ui i i 0 jl
closed alternating walk (i.e. if it is a union of alternating cycles), and otherwise e = ∅ or e = ∅ is
0 jl
possible. Here, e =(u ,v ) and f =(v ,u ).
i i i i i 1 i
k− jl
Then,wehavethat∆(M,N,φ)= w · (vote (e ,f )+vote (e ,f )+x(Pl)). Therefore,
lP
=1
k jP
=1
vj−1 j −1 j uj j j
jl
it is enough to show that for each walk Pl, (vote (e ,f )+vote (e ,f )+x(Pl))≥0.
jP
=1
vj−1 j −1 j uj j j
12It may happen that v = v or u = v for some i,j, however, this does not matter for the proof.
i j i j
Similarly as in Theorem 4, we have that for any i, f ∈/ {e ,e }.
i i 1 i
−
Claim 8. 1. If e has a level p copy for v in M with positive value, then if e has a level q copy
i i ′ i+1
for v with positive value in M , then q ≤p+1.
i+1 ′
2. If e has a level p copy for v in M with positive value and e has a level q copy for v with
i i ′ i+1 i+1
positive value in M such that q =p+1, then vote (e ,f )+vote (e ,f )=+2.
′ vi i i+1 ui+1 i+1 i+1
3. If e has a level p copy for v in M with positive value and e has a level q copy for v with
i i ′ i+1 i+1
positive value in M such that p=q, then vote (e ,f )+vote (e ,f )≥0.
′ vi i i+1 ui+1 i+1 i+1
4. If e = ∅, then each copy of e with positive value in M has level at most 0 for v and if there
0 1 ′ 1
is one with level exactly 0, then vote (e ,f )=+1.
u1 1 1
5. If e 6=∅ and e 6=e , then each copy of e with positive value in M has level at least 0 for v .
0 0 jl 0 ′ 0
6. If e = ∅, then each copy of e with positive value in M has level at least 0 for v and if
jl jl−1 ′ jl−1
there is one with level exactly 0, then vote (e ,f )=+1.
vjl−1 jl−1 jl
7. If e 6=∅ and e 6=e , then each copy of e with positive value in M has level at least 0 for v .
jl jl 0 jl ′ jl
Proof: First of all, observe that for any edge f , it is not saturated in M, because at least one of its
i
endpointshaveadifferentincidentedgewithpositivevalue(anditcannothappenthatP =(e ,f ,e )
l 0 1 1
with e =e =∅ by the stability of M ). Hence, none of f ’s copies are saturated in M .
0 1 ′ i ′
1. Suppose that q > p+1. Then, the copy of f that has level p+1 for v blocks M , because
i+1 i ′
this copy is level −(p+1) > −q for u , so both of them strictly prefer it to some copies of e and
i+1 i
e with positive value in M , contradiction.
i+1 ′
2. In this case, u has a level −(p+1) copy of f with positive value in M . Hence, if either
i+1 i+1 ′
v or u prefer f to e or e respectively, then either the level p or the level p+1 copy of f
i i+1 i+1 i i+1 i+1
for v blocks M , contradiction.
i ′
3. Suppose both v and u prefer f to e and e respectively. Then, by the assumption of
i i+1 i+1 i i+1
case 3, the level p copy of f for v blocks M , contradiction.
i+1 i ′
4. Suppose e = ∅. Then, φ(f ,∅)> 0, so v is unsaturated in M by the third axiom on sensible
0 1 0 ′
pairings. By the fact that the level 0 copy (which must exist) of f for v does not block M , we get
1 0 ′
that u is saturated in M with copies that have level at least 0. Hence, e has level at most 0 for v
1 ′ 1 1
inanycopythathas positivevalue inM . Also, ifthe level0copy ofe has positivevalue inM , then
′ 1 ′
we must have that e ≻ f , so vote (e ,f )=+1.
1 u1 1 u1 1 1
5. Suppose e 6=∅ and e 6=e . This implies that φ (e ,∅)>0. By the fourth axiom on sensible
0 0 jl u0 0
pairings, this implies that N(e)<1, so u ∈/ C, as both M and N saturate critical vertices.
Pe ∈E(u0) 0
Hence, u has only copies with level at least 0 in G, so e has only copies with level at most 0 for v
0 ′ 0 0
in G and thus also in M .
′ ′
6. Suppose that e = ∅. Then, u is unsaturated by M by the third axiom on feasible pairings.
jl jl ′
By the fact that the level0 copy (whichmust exist)off for u does notblock M , we getthatv
jl jl ′ jl−1
is saturated in M with copies that have level at least 0. Hence, e has level at least 0 for v in
′ jl−1 jl−1
anycopythathaspositivevalueinM . Also,ifthelevel0copyofe haspositivevalueinM ,then
′ jl−1 ′
we must have that e ≻ f , so vote (e ,f )=+1.
jl−1 vjl−1 jl vjl−1 jl−1 jl
7. Similarly as in case 5, we get that v ∈/ C. Therefore, any copy of e in G have level at least 0
jl jl ′
for v , thus this is also true for the ones with positive value in M . (cid:4)
jl ′
From Claim 8 it follows that the occurrences of case 2 with q = p+1 are at least as many as
the occurrences with q < p. Furthermore, we also have that vote (e ,f )+vote (e ,f ) ≥ 0 and
v0 0 1 u1 1 1
vote (e ,f )+vote (e ,f ) ≥ 0, if e = ∅ or e = ∅ by cases 4 and 6, so we can conclude
ujl jl jl vjl−1 jl−1 jl 0 jl
that
jl
(vote (e ,f )+vote (e ,f )+x(Pl))≥0. (cid:4)
jP
=1
vj−1 j −1 j uj j j
Therefore, we conclude that M is a popular maximum weight fractional-matching.
As we observed before, we get the following corollary from Theorem 5
Corollary 1. Pop-MaxW-SRI is solvable in polynomial time.
134 Conclusions
In this paper we have shownthat many algorithms that rely onleveling the agents,or duplicating the
edges can be extended even to roommates instances. This opens possibilities to utilize this technique
even further, so it would be interesting to see other frameworks, where it helps to provide desirable
solutions.
5 Acknowledgements
The author thanks Tama´s Kira´ly, Kavitha Telikepalli and Yu Yokoi for fruitful discussions about
popular fractional-matchings. The project was supported by the Hungarian Scientific Research Fund,
OTKA, Grant No. K143858, by the Momentum Grant of the Hungarian Academy of Sciences, grant
number 2021-2/2021 and by the Ministry of Culture and Innovation of Hungary from the National
Research, Development and Innovation fund, financed under the KDP-2023 funding scheme (grant
number C2258525).
References
[1] http://lemon.cs.elte.hu/egres/open/Maximum_weakly_stable_matchings_in_graphs_without_odd_preferen
[2] https://www.nrmp.org/.
[3] M. L. Balinski. Integer programming: methods, uses, computations. Management science,
12(3):253–313,1965.
[4] P.Bir´o,D.F.Manlove,andI.McBride.Thehospitals/residentsproblemwithcouples: Complexity
and integer programming models. In Experimental Algorithms: 13th International Symposium,
SEA 2014, Copenhagen, Denmark, June 29–July 1, 2014. Proceedings 13, pages 10–21.Springer,
2014.
[5] F. Brandt and M. Bullinger. Finding and recognizing popular coalition structures. Journal of
Artificial Intelligence Research, 74:569–626,2022.
[6] K. Cechl´arov´a and V. Val’ov´a. The stable multiple activities problem. IM Preprint, series A,
(1):2005, 2005.
[7] G. Cs´aji. A simple 1.5-approximation algorithm for a wide range of max-smti problems. arXiv
e-prints, pages arXiv–2304,2023.
[8] G.Cs´aji,T.Kira´ly,K.Takazawa,andY.Yokoi.Popularmaximum-utilitymatchingswithmatroid
constraints. arXiv preprint arXiv:2407.09798, 2024.
[9] G. Cs´aji, T. Kira´ly, and Y. Yokoi. Approximationalgorithms for matroidaland cardinalgeneral-
izations of stable matching. In Symposium on Simplicity in Algorithms (SOSA), pages 103–113.
SIAM, 2023.
[10] G. Cs´aji, D. Manlove, I. McBride, and J. Trimble. Couples can be tractable: New algo-
rithms and hardness results for the hospitals/residents problem with couples. arXiv preprint
arXiv:2311.00405, 2023.
[11] A´. Cseh, C.-C. Huang, and T. Kavitha. Popular matchings with two-sided preferences and one-
sided ties. SIAM Journal on Discrete Mathematics, 31(4):2348–2377,2017.
[12] S. Dudycz, P. Manurangsi, and J. Marcinkowski. Tight inapproximability of minimum maximal
matching on bipartite graphs and related problems. In Approximation and Online Algorithms:
19th International Workshop, WAOA 2021, Lisbon, Portugal, September 6–10, 2021, Revised
Selected Papers, pages 48–64. Springer, 2022.
[13] D. Gale and L. S. Shapley. College admissions and the stability of marriage. The American
Mathematical Monthly, 69(1):9–15,1962.
14[14] P. G¨ardenfors. Match making: assignments based on bilateral preferences. Behavioral Science,
20(3):166–173,1975.
[15] S.Gupta,P.Misra,S.Saurabh,andM.Zehavi.Popularmatchinginroommatessettingisnp-hard.
ACM Transactions on Computation Theory (TOCT), 13(2):1–20,2021.
[16] M. Halldo´rsson, K. Iwama, S. Miyazaki, and Y. Morita. Inapproximability results on stable
marriage problems. In LATIN 2002: Theoretical Informatics: 5th Latin American Symposium
Cancun, Mexico, April 3–6, 2002 Proceedings 5, pages 554–568.Springer, 2002.
[17] M. M. Halldo´rsson, K. Iwama, S. Miyazaki, and H. Yanagisawa. Improved approximation of the
stablemarriageproblem. InAlgorithms-ESA 2003: 11th AnnualEuropean Symposium, Budapest,
Hungary, September 16-19, 2003. Proceedings 11, pages 266–277.Springer, 2003.
[18] C.-C.HuangandT.Kavitha. Popularity,mixedmatchings,andself-duality. InProceedings of the
Twenty-Eighth Annual ACM-SIAM Symposium on Discrete Algorithms, pages2294–2310.SIAM,
2017.
[19] R.W.IrvingandD.F.Manlove. Thestableroommatesproblemwithties. Journalof Algorithms,
43(1):85–105,2002.
[20] K. Iwama, D. Manlove, S. Miyazaki, and Y. Morita. Stable marriage with incomplete lists and
ties. InProc. 26th International Colloquium on Automata, Languages, and Programming (ICALP
1999), pages 443–452.Springer, 1999.
[21] K. Iwama, S. Miyazaki, and N. Yamauchi. A 1.875-approximationalgorithm for the stable mar-
riageproblem. InProc. EighteenthannualACM-SIAMsymposium on Discretealgorithms (SODA
2007), pages 288–297.SIAM, Philadelphia, 2007.
[22] K. Iwama, S. Miyazaki, and N. Yamauchi. A (2−c 1 )-approximation algorithm for the stable
√n
marriage problem. Algorithmica, 51(3):342–356,2008.
[23] T. Kavitha. A size-popularity tradeoff in the stable marriage problem. SIAM Journal on Com-
puting, 43(1):52–71,2014.
[24] Z. Kira´ly. Better and simpler approximation algorithms for the stable marriage problem. Algo-
rithmica, 60(1):3–20,2011.
[25] Z. Kira´ly. Linear time local approximation algorithm for maximum stable marriage. In Proc.
Second International Workshop on Matching Under Preferences (MATCH-UP 2012), page 99,
2012.
[26] Z. Kira´ly. Linear time local approximation algorithm for maximum stable marriage. Algorithms,
6(3):471–484,2013.
[27] D. Manlove. Algorithmics of matching under preferences, volume 2. World Scientific, 2013.
[28] D. F. Manlove, R. W. Irving, K. Iwama, S. Miyazaki, and Y. Morita. Hard variants of stable
marriage. Theoretical Computer Science, 276(1-2):261–279,2002.
[29] E. McDermid. A 3/2-approximation algorithm for general stable marriage. In Proc. 36th Inter-
national Colloquium on Automata, Languages, and Programming (ICALP 2009), pages 689–700.
Springer, 2009.
[30] M. Nasre, P. Nimbhorkar, and K. Ranjan. Critical relaxed stable matchings with two-sided ties.
arXiv preprint arXiv:2303.12325, 2023.
[31] K. Paluch. Faster and simpler approximation of stable matchings. In Proc. 9th International
Workshop on Approximation and Online Algorithms (WAOA 2011), pages 176–187,2011.
[32] K.Paluch. Fasterandsimplerapproximationofstablematchings. Algorithms,7(2):189–202,2014.
[33] J. J. Tan. A necessary and sufficient condition for the existence of a complete stable matching.
Journal of Algorithms, 12(1):154–178,1991.
15[34] H. Yanagisawa. Approximation algorithms for stable marriage problems. PhD thesis, Kyoto
University, Graduate School of Informatics, 2007.
16