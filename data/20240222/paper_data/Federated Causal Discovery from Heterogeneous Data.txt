PublishedasaconferencepaperatICLR2024
FEDERATED CAUSAL DISCOVERY FROM HETEROGE-
NEOUS DATA
LokaLi1, IgnavierNg2, GongxuLuo1, BiweiHuang3,
GuangyiChen1,2, TongliangLiu1, BinGu1, KunZhang1,2
1MohamedbinZayedUniversityofArtificialIntelligence
2CarnegieMellonUniversity
3UniversityofCaliforniaSanDiego
{longkang.li, kun.zhang}@mbzuai.ac.ae
ABSTRACT
Conventionalcausaldiscoverymethodsrelyoncentralizeddata, whichisincon-
sistent with the decentralized nature of data in many real-world situations. This
discrepancyhasmotivatedthedevelopmentoffederatedcausaldiscovery(FCD)
approaches. However,existingFCDmethodsmaybelimitedbytheirpotentially
restrictive assumptions of identifiable functional causal models or homogeneous
data distributions, narrowing their applicability in diverse scenarios. In this pa-
per,weproposeanovelFCDmethodattemptingtoaccommodatearbitrarycausal
modelsandheterogeneousdata.Wefirstutilizeasurrogatevariablecorresponding
totheclientindextoaccountforthedataheterogeneityacrossdifferentclients.We
thendevelopafederatedconditionalindependencetest(FCIT)forcausalskeleton
discoveryandestablishafederatedindependentchangeprinciple(FICP)todeter-
minecausaldirections. Theseapproachesinvolveconstructingsummarystatistics
as a proxy of the raw data to protect data privacy. Owing to the nonparametric
properties,FCITandFICPmakenoassumptionaboutparticularfunctionalforms,
therebyfacilitatingthehandlingofarbitrarycausalmodels. Weconductextensive
experimentsonsyntheticandrealdatasetstoshowtheefficacyofourmethod.The
codeisavailableathttps://github.com/lokali/FedCDH.git.
1 INTRODUCTION
Causal discovery aims to learn the causal structure from observational data, attracting significant
attention from fields such as machine learning and artificial intelligence (Nogueira et al., 2021),
healthcare(Shenetal.,2020),economics(Zhang&Chan,2006),manufacturing(Vukovic´ &Thal-
mann,2022)andneuroscience(Tuetal.,2019). Recently,ithasbeenfacingnewopportunitiesand
challengesfromtherapidgrowthofdatavolume.Oneofthekeychallengesisdatadecentralization.
Traditionally, causal discovery is conducted at a centralized site where all data is gathered in one
location. However,inreal-worldscenarios,dataisoftendistributedacrossmultipleparties,suchas
the healthcare data across various hospitals (Kidd et al., 2022). Consequently, there has been in-
creasinginterestinfederatedcausaldiscovery(FCD),whichaimstouncovertheunderlyingcausal
structureofdecentralizeddatawithprivacyandsecurityconcerns.
Existing FCD methods from observational data can be generally classified as continuous-
optimization-based, constraint-based, and score-based methods. Some continuous-optimization-
basedmethodsextendNOTEARS(Zhengetal.,2018)withfederatedstrategies,suchasNOTEARS-
ADMM (Ng & Zhang, 2022) that relies on the ADMM (Boyd et al., 2011) optimization method,
FedDAG(Gaoetal.,2022)thatemploysFedAvg(McMahanetal.,2017)technique,andFED-CD
(Abyaneh et al., 2022) that utilizes belief aggregation. These methods might suffer from various
technicalissues,includingconvergence(Weietal.,2020;Ngetal.,2022),nonconvexity(Ngetal.,
2023), and sensitivity to data standardization (Reisach et al., 2021). As for score-based methods,
DARLIS (Ye et al., 2022) utilizes the distributed annealing (Arshad & Silaghi, 2004) strategy to
search for the optimal graph, while PERI (Mian et al., 2023) aggregates the results of the local
greedyequivalentsearch(GES)(Chickering,2002)andchoosestheworst-caseregretforeachitera-
tion. Oneconstraint-basedmethod,FEDC2SL(Wangetal.,2023),extendesχ2testtothefederated
1
4202
beF
02
]GL.sc[
1v14231.2042:viXraPublishedasaconferencepaperatICLR2024
Table1:Thecomparisonofrelatedworksaboutfederatedcausaldiscoveryfromobservationaldata.
OurFedCDHmethodcouldhandlearbitraryfunctionalcausalmodelsandheterogeneousdata.
Data CausalModel Identifiability Federated
Method Category Distribution Assumption1 Requirement Strategy
NOTEARS-ADMM(Ng&Zhang,2022) Optimization-based Homogeneous LinearGaussian,EV Yes ADMM
NOTEARS-MLP-ADMM(Ng&Zhang,2022) Optimization-based Homogeneous NonlinearAdditiveNoise Yes ADMM
FedDAG(Gaoetal.,2022) Optimization-based Heterogeneous NonlinearAdditiveNoise Yes FedAvg
Fed-CD(Abyanehetal.,2022) Optimization-based Heterogeneous NonlinearAdditiveNoise Yes BeliefAggregation
DARLIS(Yeetal.,2022) Score-based Homogeneous GeneralizedLinear No DistributedAnnealing
PERI(Mianetal.,2023) Score-based Homogeneous LinearGaussian,NV No Voting
FedPC(Huangetal.,2022) Constraint-based Homogeneous LinearGaussian,NV No Voting
FedCDH(Ours) Constraint-based Heterogeneous ArbitraryFunctions No SummaryStatistics
version, however, this method is restrictive on discrete variables and therefore not applicable for
any continuous variables. Other constraint-based methods, such as FedPC (Huang et al., 2022),
aggregate the skeletons and directions of the Peter-Clark (PC) algorithm (Spirtes et al., 2000) by
each client via a voting mechanism. However, as shown in Table 1, most of these methods heav-
ily rely on either identifiable functional causal models or homogeneous data distributions. These
assumptions may be overly restrictive and difficult to be satisfied in real-world scenarios, limiting
theirdiverseapplicability. Forinstance,distributionshiftsmayoftenoccurintherealworldacross
differentclientsowingtodifferentinterventions,collectionconditions,ordomains,resultinginthe
presenceofheterogeneousdata.PleaserefertoAppendixA2forfurtherdiscussionofrelatedworks,
includingthoseofcausaldiscovery,heterogeneousdataandFCD.
In this paper, we propose FedCDH, a novel constraint-based approach for Federated Causal
Discovery from Heterogeneous data. The primary innovation of FedCDH lies in using summary
statistics as a proxy for raw data during skeleton discovery and direction determination in a fed-
erated fashion. Specifically, to address heterogeneous data, we first introduce a surrogate variable
corresponding to the client or domain index, allowing our method to model distribution changes.
UnlikeexistingFCDmethodsthatonlyleveragethedatafromdifferentclientstoincreasethetotal
samplesize,wedemonstratehowsuchdataheterogeneityacrossdifferentclientsbenefitstheidenti-
ficationofcausaldirectionsandhowtoexploitit. Furthermore,weproposeafederatedconditional
independence test (FCIT) for causal skeleton discovery, incorporating random features (Rahimi &
Recht,2007)toapproximatethekernelmatrixwhichfacilitatestheconstructionofthecovariance
matrix. Additionally, we develop a federated independent change principle (FICP) to determine
causaldirections,exploitingthecausalasymmetry. FICPalsoemploysrandomfeaturestoapprox-
imate the embeddings of heterogeneous conditional distributions for representing changing causal
models. It is important to note that FCIT and FICP are non-parametric, making no assumption
aboutspecificfunctionalforms,thusfacilitatingthehandlingofarbitrarycausalmodels. Toevalu-
ateourmethod, weconductextensiveexperimentsonsyntheticdatasetsincludinglinearGaussian
models and general functional models, and real-world dataset including fMRI Hippocampus (Pol-
dracketal.,2015)andHKStockMarketdatasets(Huangetal.,2020). Thesignificantperformance
improvementsoverotherFCDmethodsdemonstratethesuperiorityofourapproach.
2 REVISITING CAUSAL DISCOVERY FROM HETEROGENEOUS DATA
Inthissection,wewillfirstlyprovideanoverviewofcausaldiscoveryandsomecommonassump-
tions, then we will introduce the characterizations of conditional independence and independent
change. Thispaperaimsatextendingthosetechniquesfromthecentralizedtothefederatedsetting.
1)CausalDiscoverywithChangingCausalModels.
ConsiderdobservablerandomvariablesdenotedbyV=(V ,...,V )andK clients,andoneclient
1 d
correspondstooneuniquedomain. Inthispaper,wefocusonhorizontally-partitioneddata(Samet
& Miri, 2009), where each client holds a different subset of the total data samples while all the
clients share the same set of features. Let k be the client index, and ℧ be the domain index,
where k,℧∈{1,...,K}. Each client has n samples, in total there are n samples, denoted by
k
1LinearGaussianmodelwithequalnoisevariance(EV)(Peters&Bu¨hlmann,2014)andnonlinearadditive
noisemodel(Hoyeretal.,2008)areidentifiable,whilelinearGaussianmodelwithnon-equalnoisevariance
(NV)isnotidentifiable.Generalizedlinearmodelandarbitraryfunctionalmodelarecertainlynotidentifiable.
2PublishedasaconferencepaperatICLR2024
n=(cid:80)K
n . The task of federated causal discovery is to recover the causal graph G given the
k=1 k
decentralizeddatamatrixV∈Rn×d.
When the data is homogeneous, the causal process for each variable V can be represented by the
i
following structural causal model (SCM): V =f (PA ,ϵ ), where f is the causal function, PA is
i i i i i i
theparentsofV ,ϵ isanoisetermwithnon-zerovariance,andweassumetheϵ ’saremutuallyin-
i i i
dependent. Whenthedataisheterogeneous,theremustbesomecausalmodelschangingacrossdif-
ferentdomains. Thechangesmaybecausedbythevariationofcausalstrengthsornoisevariances.
Therefore,weformulatethecausalprocessforheterogeneousdataas:V =f (PA ,ϵ ,θ (℧),ψ˜(℧)),
i i i i i
where℧isregardedasanobservedrandomvariablereferredasthedomainindex, thefunctionf
i
orthedistributionofthenoiseϵ isdifferentorchangingacrossdifferentdomains,bothψ˜(℧)and
i
θ (℧)areunobserveddomain-changingfactorsrepresentedasthefunctionsofvariable℧,ψ˜(℧)is
i
thesetof”pseudoconfounders”thatinfluencethewholesetofvariablesandweassumethereareL
suchconfounders(ψ˜(℧)={ψ (℧)}L ,theminimumvalueforLcanbe0meaningthatthereisno
l l=1
suchlatentconfounderinthegraph,whilethemaximumvaluecanbeC2 = d(d+1),meaningthat
d 2
each pair of observed variables has a hidden confounder), θ (℧) denotes the effective parameters
i
ofV inthemodel,andweassumethatθ (℧)isspecifictoV andisindependentofθ (℧)forany
i i i j
i̸=j. ψ˜(℧)andθ (℧)input℧whichisapositiveintegerandoutputarealnumber. LetG bethe
i obs
underlyingcausalgraphoverV,andG betheaugmentedgraphoverV∪ψ˜(℧)∪{θ (℧)}d .For
aug i i=1
causaldiscoverywithchangingcausalmodels,wefollowpreviousworksuchasCD-NOD(Huang
etal.,2020)andmakethefollowingassumptions.
Assumption1(PseudoCausalSufficiency). Thereisnoconfounderinthedatasetofonedomain,
butweallowthechangesofdifferentcausalmodulesacrossdifferentdomainstobedependent.
Assumption2(MarkovandFaithfulness). ThejointdistributionoverV ∪ψ˜(℧)∪{θ (℧)}d is
i i=1
MarkovandfaithfultoG .
aug
Toremovethepotentialinfluencefromconfounders
and recover causal relations across different do-
℧
mains, causal discovery could be conducted on the
augmented graph G instead of G . While ℧
aug obs
ψ˜(℧)∪{θ i(℧)}d i=1areunobservedvariables,thedo- !!(℧) !"(℧)
main index ℧ is observed variable. Therefore, ℧ is
$ℓ(℧)
introduced as the surrogate variable (Huang et al.,
! !
2020)forcausaldiscoveryfromheterogeneousdata. ! ! # $
# $
An illustration is given in Figure 1, where the aug-
(a) (b)
mentedgraphwiththeunobserveddomain-changing
variablesψ˜(℧)andθ i(℧)couldbesimplifiedbyan Figure1: Anillustrationwherethecausalmod-
augmentedgraphwithjustasurrogatevariable℧. If elsofvariablesV andV arechangingacrossdo-
i j
there is an edge between surrogate variable ℧ and mains. (a) the graph with unobserved domain-
o cab us se arv le md ov da er lia rb ell ae teV di o ton VG a iu sg c, hth ae nn gii nt gm ae ca rn os ssth da it fft eh re
-
c sih man pg lii fin eg dfa gc rato pr hs wψ iℓ t( h℧ t) h, eθ si u( r℧ ro) ga an td evθ aj r( i℧ ab); le(b ℧) .the
i
entdomains,inotherwords,thedatadistributionof
V isheterogeneousacrossdomains.
i
2)CharacterizationofConditionalIndependence. LetX,Y,Z berandomvariablesorsetsof
randomvariables,withthedomainsX,Y,Z,respectively.Defineameasurableandpositivedefinite
kernelk ,anddenotethecorrespondingreproducingkernelHilbertspace(RKHS)H . Similarly,
X X
wedefinek ,H ,k andH . Oneofthemostusedcharacterizationsofconditionalindependence
Y Y Z Z
(CI)is: X ⊥⊥ Y|Z ifandonlyifP = P P ,orequivalentlyP = P . Another
XY|Z X|Z Y|Z X|Y,Z X|Z
characterizationofCIisgivenintermsofthepartialcross-covarianceoperatoronRKHS.
Lemma1(CharacterizationofCIwithPartialCross-covariance(Fukumizuetal.,2007)). LetX¨ ≜
(X,Z),k ≜ k k ,andH betheRKHScorrespondingtok . AssumethatH ⊂ L2 ,H ⊂
X¨ X Z X¨ X¨ X X Y
L2,H ⊂ L2. Further assume that k k is a characteristic kernel on (X ×Z)×Y, and that
Y Z Z X¨ Y
H
Z
+ R (the direct sum of two RHKSs) is dense in L2(P Z). Let Σ
X¨Y|Z
be the partial cross-
covarianceoperator,then
Σ =0 ⇐⇒ X ⊥⊥Y|Z. (1)
X¨Y|Z
3PublishedasaconferencepaperatICLR2024
Based on the above lemma, we further consider a different characterization of CI which enforces
the uncorrelatedness of functions in suitable spaces, which may be intuitively more appealing.
More details about the interpretation of Σ , the definition of characteristic kernel, and the
X¨Y|Z
uncorrelatedness-basedcharacterizationofCI,areputinAppendixA3.1.
3) Characterization of Independent Change. The Hilbert-Schmidt Independence Criterion
(HSIC)(Grettonetal.,2007)isastatisticalmeasureusedtoassesstheindependencebetweentwo
randomvariablesintheRKHS.WeusethenormalizedHSICtoevaluatetheindependenceoftwo
changingcausalmodels. ThevalueofthenormalizedHSICrangesfrom0to1,andasmallervalue
indicates that the two changing causal models are more independent. Let △ˆ be the normal-
X→Y
ized HSIC between P(X) and P(Y|X), and △ˆ be the normalized HSIC between P(Y) and
Y→X
P(X|Y). Then,wecandeterminethecausaldirectionbetweenX andY withthefollowinglemma.
Lemma 2 (Independent Change Principle (Huang et al., 2020)). Let X and Y be two random
observed variables. Assume that both X and Y have changing causal models (both of them are
adjacentto℧inG ). ThenthecausaldirectionbetweenX andY canbedeterminedaccording
aug
tothefollowingrules
i) If△ˆ <△ˆ ,outputthedirectionX→Y,
X→Y Y→X
ii) If△ˆ >△ˆ ,outputthedirectionY→X.
X→Y Y→X
Moredetailsaboutthedefinitionandformulationof△ˆ and△ˆ areinAppendixA3.2. It
X→Y X→Y
is important to note that: once the Gaussian kernel is utilized, the kernel-based conditional inde-
pendencetest(Zhangetal.,2012)andthekernel-basedindependentchangeprincipal(Huangetal.,
2020)assumesmoothnessfortherelationshipofcontinuousvariables.
3 FEDERATED CAUSAL DISCOVERY FROM HETEROGENEOUS DATA
Inthissection,wewillexplainourproposedFedCDHmethodindetails. Anoverallframeworkof
FedCDHisgiveninFigure2. Twokeysubmodulesofourmethodarefederatedconditionalinde-
pendenttest(FCIT;Theorem4andTheorem5)andfederatedindependentchangeprinciple(FICP;
Theorem 6), which are presented in Section 3.1 and Section 3.2, respectively. We then illustrate
howtoconstructthesummarystatisticsandhowtoimplementFCITandFICPwithsummarystatis-
tics(Theorem8)inSection3.3. Lastbutnotleast,wediscussthecommunicationcostsandsecure
computationsinSection3.4. Fortheproofsoftheoremsandlemmas,pleaserefertoAppendixA4.
3.1 FEDERATEDCONDITIONALINDEPENDENTTEST(FCIT)
1)NullHypothesis. Considerthenullandalternativehypotheses
H :X ⊥⊥Y|Z, H :X⊥̸⊥Y|Z. (2)
0 1
AccordingtoEq. 1,wecanmeasureconditionalindependencebasedontheRKHSs. Therefore,we
equivalentlyrewritetheabovehypothesismoreexplicitlyas
H :∥Σ ∥2 =0, H :∥Σ ∥2 >0. (3)
0 X¨Y|Z HS 1 X¨Y|Z HS
NotethatthecomputationformsofHilbert-SchmidtnormandFrobeniusnormarethesame,andthe
differenceisthattheHilbert-SchmidtnormisdefinedininfiniteHilbertspacewhiletheFrobenius
norm is defined in finite Euclidean space. We here consider the squared Frobenius norm of the
empiricalpartialcross-covariancematrixasanapproximationforthehypotheses,givenas
H :∥C ∥2 =0, H :∥C ∥2 >0, (4)
0 X¨Y|Z F 1 X¨Y|Z F
whereC =1 (cid:80)n [(A¨ −E(A¨|Z))T(B −E(B|Z))]correspondstothepartialcross-covariance
X¨Y|Z n i=1 i i
matrix with n samples, C ∈Rh×h, A¨=f(X¨)∈Rn×h, B=g(Y)∈Rn×h, {fj(X¨)|h }∈F ,
X¨Y|Z j=1 X¨
{gj(Y)|h }∈F . n and h denote the number of total samples of all clients and the number
j=1 Y
4PublishedasaconferencepaperatICLR2024
Summary Statistics
Total Sample Size & Global Covariance Tensor
Federated Conditional Federated Independent
Independence Test Change Principle
Server (FCIT) (FICP)
Sample Size & Local Sample Size & Local Sample Size & Local Skeleton Discovery Skeleton Discovery Direction Determination Direction Determination
Covariance Tensor Covariance Tensor Covariance Tensor Step 1 ℧ Step 2 ℧ Step 1 ℧ Step 2 ℧
… 𝑉# 𝑉! 𝑉" 𝑉# 𝑉! 𝑉" 𝑉# 𝑉! 𝑉" 𝑉# 𝑉! 𝑉"
Graph Initialization Ground-truth Graph
Local Data Local Data Local Data ℧ 𝜓(℧)
Client 1 Client 2 Client K 𝑉# 𝑉! 𝑉" 𝑉# 𝑉! 𝑉"
Figure2: OverallframeworkofFedCDH. Left: Theclientswillsendtheirsamplesizesandlocal
covariancetensorstotheserver, forconstructingthesummarystatistics. Thefederatedcausaldis-
coverywillbeimplementedontheserver.RightTop:Relyingonthesummarystatistics,wepropose
two submodules: federated conditional independence test and federated independent change prin-
ciple,forskeletondiscoveryanddirectiondetermination. RightBottom: AnexampleofFCDwith
threeobservedvariablesisillustrated,wherethecausalmodulesrelatedtoV andV arechanging.
2 3
of hidden features or mapping functions, respectively. Since X¨≜(X,Z), then for each function
fj:X¨(cid:55)→F , the input is X¨∈Rn×2 and the output fj(X¨)∈Rn. For each function gk:Y(cid:55)→F , the
X¨ Y
inputisY∈Rn andtheoutputgk(Y)∈Rn. NoticethatF andF arefunctionspaces,whichare
√ X¨ Y
settobethesupportoftheprocess 2cos(w·+b),wfollowsstandardGaussiandistribution,and
bfollowsuniformdistributionfrom[0,2π]. Wechoosethesespecificspacesbecauseinthispaper
weuserandomfeaturestoapproximatethekernels. E(A¨|Z)andE(B|Z)couldbenon-linearfunc-
tionsofZ whicharedifficulttoestimate. Therefore,wewouldliketoapproximatethemwithlinear
functions. Let q(Z)∈Rn×h, {qj(Z)|h }∈F , F shares a similar function space with F . We
j=1 Z Z Y
couldestimateE(fj|Z)withthelinearridgeregressionsolutionuTq(Z)andestimateE(gj|Z)with
j
vTq(Z)undermildconditions(Sutherland&Schneider,2015). Nowwegivethefollowinglemma.
j
Lemma3(CharacterizationofConditionalIndependence). Letfj andgj bethefunctionsdefined
forthevariablesX¨ andY,respectively.ThenX ⊥⊥Y|Zisapproximatedbythefollowingcondition
E(f˜g˜)=0, ∀f˜∈F and ∀g˜∈F , (5)
X¨|Z Y|Z
whereF ={f˜|f˜j=fj−uTq(Z), fj∈F }andF ={g˜|g˜j=gj−vTq(Z), gj∈F }.
X¨|Z j X¨ Y|Z j Y
Letγ beasmallridgeparameter. AccordingtoEq. 1andEq. 5,byridgeregression,weobtain
C =C −C (C +γI)−1C . (6)
X¨Y|Z X¨Y X¨Z ZZ ZY
2)TestStatisticandNullDistribution. Inordertoensuretheconvergencetoanon-degeneratedis-
tribution,wemultiplytheempiricalestimateoftheFrobeniusnormbyn,andsetitastheteststatistic
T =n∥C ∥2. LetK˜ bethecentralizedkernelmatrix,givenbyK˜ ≜HR RT H,
CI X¨Y|Z F X¨|Z X¨|Z X¨|Z X¨|Z
where H=I−111T and R ≜f˜(X¨)=f(X¨)−uTq(Z) which can be seen as the residual after
n X¨|Z
kernel ridge regression. Here, I refers to the n×n identity matrix and 1 denotes the vector of n
ones. WenowdefineK˜ similarly. Letλ andλ betheeigenvaluesofK˜ andK˜ ,
Y|Z X¨|Z Y|Z X¨|Z Y|Z
respectively. Let {α ,...,α } denote i.i.d. standard Gaussian variables, and thus {α2,...,α2}
1 L 1 L
denotei.i.d. χ2variables. Consideringni.i.d. samplesfromthejointdistributionP ,wehave
1 X¨YZ
Theorem4(FederatedConditionalIndependentTest). UnderthenullhypothesisH (X andY are
0
conditionallyindependentgivenZ),theteststatistic
T ≜n∥C ∥2, (7)
CI X¨Y|Z F
5PublishedasaconferencepaperatICLR2024
hastheasymptoticdistribution
L
Tˆ ≜ 1 (cid:88) λ λ α2 .
CI n2 X¨|Z,i Y|Z,j ij
i,j=1
Althoughthedefinedteststatisticsareequivalenttothatofkernel-basedconditionalindependence
test(KCI)(Zhangetal.,2012),theasymptoticdistributionsareindifferentforms. Pleasenotethat
thelargesamplepropertiesareneededwhenderivingtheasymptoticdistributionTˆ above,andthe
CI
proofisshowninAppendixA4.2.
Given that X ⊥⊥ Y|Z, we could introduce the independence between R and R , which
X¨|Z Y|Z
leadstotheseparationbetweenλ andλ . Weshowthatthisseparatedformcouldhelpto
X¨|Z,i Y|Z,j
approximatethenulldistributionintermsofadecomposablestatistic,suchasthecovariancematrix.
We approximate the null distribution with a two-parameter Gamma distribution, which is related
to the mean and variance. Under the hypothesis H and given the sample D, the distribution of
0
Tˆ can be approximated by the Γ(kˆ,θˆ) distribution: P(t) = (tkˆ−1 ·e−t/θˆ )/(θkˆ ·Γ(kˆ)), where
CI
kˆ = E2(Tˆ |D)/Var(Tˆ |D),andθˆ= Var(Tˆ |D)/E(Tˆ |D). Weproposetoapproximatethe
CI CI CI CI
nulldistributionwiththemeanandvarianceinthefollowingtheorem.
Theorem5(NullDistributionApproximation). UnderthenullhypothesisH (X andY arecondi-
0
tionallyindependentgivenZ),wehave
E(Tˆ |D)=tr(C )·tr(C ),
CI X¨|Z Y|Z
(8)
Var(Tˆ |D)=2∥C ∥2 ·∥C ∥2,
CI X¨|Z F Y|Z F
whereC =1RT HHR ,C =1RT HHR ,andtr(·)meansthetraceoperator.
X¨|Z n X¨|Z X¨|Z Y|Z n Y|Z Y|Z
FortestingtheconditionalindependenceX ⊥⊥ Y|Z,inthispaper,weonlydealwiththescenarios
where X and Y each contain a single variable while Z could contain a single variable, multiple
variables,orbeempty. WhenZ isempty,thetestbecomesthefederatedunconditionalindependent
test(FUIT),asaspecialcase. WeprovidemoredetailsaboutFUITinAppendixA5.
3.2 FEDERATEDINDEPENDENTCHANGEPRINCIPLE(FICP)
As described in Lemma 2, we can use independent change principle (ICP) to evaluate the depen-
dence between two changing causal models. However, existing ICP (Huang et al., 2020) heavily
relies on the kernel matrix to calculate the normalized HSIC. It may be challenging for decentral-
izeddatabecausetheoff-diagonalentriesofkernelmatrixrequiretherawdatafromdifferentclients,
whichviolatesthedataprivacyinfederatedlearning. Motivatedbythat,weproposetoestimatethe
normalizedHSICwiththefollowingtheorem.
Theorem6(FederatedIndependentChangePrinciple). Inordertocheckwhethertwocausalmodels
changeindependentlyacrossdifferentdomains,wecanestimatethedependenceby
∥C∗ ∥2 ∥C∗ ∥2
△ˆ = X,Y˜ F , △ˆ = Y,X˜ F , (9)
X→Y tr(C∗)·tr(C∗) Y→X tr(C∗)·tr(C∗)
X Y˜ Y X˜
where Y˜≜(Y|X), X˜≜(X|Y), C∗ and C∗ are specially-designed covariance matrices, and
X,Y˜ Y,X˜
C∗,C∗,C∗ andC∗ arespecially-designedvariancematrices.
X Y X˜ Y˜
3.3 IMPLEMENTINGFCITANDFICPWITHSUMMARYSTATISTICS
MoredetailsaregivenabouthowtoimplementFCITandFICPwithsummarystatistics. Theproce-
duresattheclientsandtheserverareshowninAlgorithm1. Eachclientneedstocalculateitslocal
samplesizeandcovariancetensor,whichareaggregatedintosummarystatisticsattheserver.
Thesummarystatisticscontaintwoparts: totalsamplesizenandcovariancetensorC . Withthe
T
summary statistics as a proxy, we can substitute the raw data at each client for FCD. The global
6PublishedasaconferencepaperatICLR2024
Algorithm1FedCDH: FederatedCausalDiscoveryfromHeterogeneousData
Input: datamatrixD
k
∈Rnk×dateachclient,k,℧∈{1,...,K}
Output: acausalgraphG
Clientexecutes:
1: (SummaryStatisticsCalculation) Foreachclientk,usethelocaldataD ktogetthesamplesize
n andcalculatethecovariancetensorC ,andsendthemtotheserver.
k Tk
Serverexecutes:
2: (SummaryStatisticsConstruction) Construct the summary statistics by summing up the local
samplesizesandthelocalcovariancetensors:
n=(cid:80)K
n ,C
=(cid:80)K
C .
k=1 k T k=1 Tk
3: (AugmentedGraphInitialization) BuildacompletelyundirectedgraphG 0ontheextendedvari-
ablesetV ∪{℧},whereV denotestheobservedvariablesand℧issurrogatevariable.
4: (FederatedConditionalIndependenceTest) Conduct the federated conditional independence
testbasedonthesummarystatistics,forskeletondiscoveryonaugmentedgraphanddirection
determinationwithonechangingcausalmodule. Intheend,getanintermediategraphG .
1
5: (FederatedIndependentChangePrinciple) Conduct the federated independent change princi-
plebasedonthesummarystatistics,fordirectiondeterminationwithtwochangingcausalmod-
ules. Ultimately,outputthecausalgraphG.
statisticsaredecomposablebecausetheycouldbeobtainedbysimplysummingupthelocalones,
suchasn=(cid:80)K
n andC
=(cid:80)K
C . Specifically,weincorporatetherandomFourierfeatures
k=1 k T k=1 Tk
(Rahimi & Recht, 2007), because they have shown competitive performances to approximate the
continuous shift-invariant kernels. According to the following Lemma, we could derive a decom-
posablecovariancematrixfromanindecomposablekernelmatrixviarandomfeatures.
Lemma7(EstimatingCovarianceMatrixfromKernelMatrix). Assumingthereareni.i.d. samples
forthecentralizedkernelmatricesK˜ ,K˜ ,K˜ andthecovariancematrixC ,wehave
x y x,y x,y
tr(K˜ )≈tr(ϕ˜ (x)ϕ˜ (y)T)=tr(ϕ˜ (y)Tϕ˜ (x))=ntr(C ),
x,y w w w w x,y
(10)
tr(K˜ K˜ )≈tr(ϕ˜ (x)ϕ˜ (x)Tϕ˜ (y)ϕ˜ (y)T)=∥ϕ˜ (x)Tϕ˜ (y)∥2 =n2∥C ∥2,
x y w w w w w w x,y
wherex,y∈Rn,K˜ ,K˜ ,K˜ ∈Rn×n,C ∈Rh×h,ϕ˜ (x)∈Rn×histhecentralizedrandomfea-
x y x,y x,y w
(cid:113)
ture,ϕ˜ (x)=Hϕ (x),ϕ (x)≜ 2[cos(w x+b ),...,cos(w x+b )]T andϕ (x)∈Rn×h,and
w w w h 1 1 h h w
similarlyforϕ˜ (y)andϕ (y). wisdrawnfromP(w)andbisdrawnuniformlyfrom[0,2π].
w w
Inthispaper,weuserandomfeaturestoapproximatetheGaussiankernelforcontinuousvariables
and the delta kernel for discrete variables such as the surrogate variable ℧. It is important to note
thatthissurrogatevariable℧isessentiallyadiscretevariable(morespecifically,acategoricalvari-
able, with no numerical order among different values), and a common approach to deal with such
discrete variables is to use delta kernel. Notice that C denotes the covariance matrix for vari-
x,y
ablesetsxandy,whichissample-wisedecomposablebecauseC
=(cid:80)K
C ,whereC
x,y k=1 xk,yk xk,yk
corresponds to the local covariance matrix of variable sets x and y at the k-th client. Here,
k k
we have x k,y k∈Rnk,C xk,yk∈Rh×h. In the augmented graph, there are d′=d+1 variables (d ob-
served variables and one surrogate variable), thus we could construct a global covariance tensor
C ∈Rd′×d′×h×hbysummingupthelocalonesC ∈Rd′×d′×h×h.
T Tk
Theorem8(SufficiencyofSummaryStatistics). Thesummarystatistics,consistingoftotalsample
sizenandcovariancetensorC ,aresufficienttorepresentallthestatisticsforFCD,includingT
T CI
inEq. 7,E(Tˆ |D)andVar(Tˆ |D)inEq. 8,and△ˆ and△ˆ inEq. 9.
CI CI X→Y Y→X
Accordingtotheabovetheorem, withthetotalsamplesizenandtheglobalcovariancetensorC
T
attheserver,itissufficienttoconductFCITandFICPintheFCDprocedures. Moredetailsabout
skeletondiscoveryanddirectiondeterminationruleswillbegiveninAppendixA6.
3.4 COMMUNICATIONCOSTSANDSECURECOMPUTATIONS
Weproposetoconstructsummarystatisticswithoutdirectlysharingtherawdata,whichhasalready
preservedthedataprivacytosomeextent. TheoriginalsamplesizeofrawdataisinRn×d′,where
7PublishedasaconferencepaperatICLR2024
Figure3:ResultsofsyntheticdatasetonlinearGaussianmodel. Byrows,weevaluatevaryingnum-
berofvariablesd, varyingnumberofclientsK, andvaryingnumberofsamplesn . Bycolumns,
k
weevaluateSkeletonF (↑),SkeletonSHD(↓),DirectionF (↑)andDirectionSHD(↓).
1 1
we assume n ≫ d′,h. The constructed covariance tensor is in dimension Rd′×d′×h×h, which
couldsignificantlyreducethecommunicationcostswhenthesamplesizenislargeenoughandthe
hiddendimensionhissmallenough. Furthermore,ifeachclientisrequiredtonotdirectlysharethe
localsummarystatistics,onecanincorporatesomestandardsecurecomputationtechniques,suchas
secure multiparty computation (Cramer et al., 2015), which allows different clients to collectively
computeafunctionovertheirinputswhilekeepingthemprivate,orhomomorphicencryption(Acar
et al., 2018), which enables complex mathematical operations to process encrypted data without
compromising the encryption. Please refer to Goryczka & Xiong (2015) for more about secure
computation. Itisworthnotingthatsomesecurecomputationtechniquescanintroducesignificant
computationoverhead.Tofurtherenhanceprivacyprotectionandcomputationalefficiency,itwould
bebeneficialtofurtherimproveourproposedmethodandweleaveitforfutureexplorations.
4 EXPERIMENTS
Toevaluatetheefficacyofourproposedmethod,weconductextensiveexperimentsonbothsynthetic
and real-world datasets. For the synthetic datasets, we consider the linear Gaussian model and
general functional model to show that our method can handle arbitrary functional causal models.
We ensure that all synthetic datasets have some changing causal models, meaning that they are
heterogeneousdata. Toshowthewideapplicabilityofourmethod,weruntworeal-worlddatasets,
fMRIHippocampus(Poldracketal.,2015)andHKStockMarketdatasets(Huangetal.,2020).
SyntheticDatasets. ThetrueDAGsaresimulatedbyErdo¨s-Re´nyimodel(Erdo˝setal.,1960)with
the number of edges equal to the number of variables. We randomly select 2 variables out of d
variablestobechangingacrossclients.Forthechangingcausalmodel,wegenerateaccordingtothe
SCM:V =(cid:80) σˆkf (V )+γˆkϵ ,whereV ∈PA isthedirectcauseofV . Thecausalstrength
i Vj∈PAi ij i j i j i i
σˆk andtheparameterγˆk changeacrossdifferentclientwithindexk,whichareuniformlysampled
ij
from U(0.5,2.5) and U(1,3), respectively. We separately generate the data for each domain with
different causal models and then combine them together. For the fixed causal model, we generate
(cid:80)
according to V = σˆ f (V )+ϵ . We consider the linear Gaussian model with non-equal
i Vj∈PAi ij i j i
8PublishedasaconferencepaperatICLR2024
noise variances and the general functional model. For linear Gaussian model, f (V )=V and ϵ
i j j i
aresampledfromGaussiandistributionwithanon-equalvariancewhichisuniformlysampledfrom
U(1,2). For general functional model, f is randomly chosen from linear, square, sinc, and tanh
i
functions,andϵ followsuniformdistributionU(−0.5,0.5)orGaussiandistributionN(0,1).
i
WecompareourFedCDHmethodwithotherFCDbaselines,suchasNOTEARS-ADMM(forlinear
case) (Ng & Zhang, 2022), NOTEARS-MLP-ADMM (for non-linear case) (Ng & Zhang, 2022),
FedDAG (Gao et al., 2022) and FedPC (Huang et al., 2022). We consider these baselines mainly
becauseoftheirpubliclyavailableimplementations. Weevaluateboththeundirectedskeletonand
the directed graph, denoted by “Skeleton” and “Direction” in the Figures. We use the structural
Hammingdistance(SHD),F score,precision,andrecallasevaluationcriteria.Weevaluatevariable
1
d ∈ {6,12,18,24,30} while fixing other variables such as K=10 and n =100. We set client
k
K∈{2,4,8,16,32} while fixing others such as d=6 and n =100. We let the sample size in one
k
clientn ∈{25,50,100,200,400}whilefixingothervariablessuchasd=6andK=10. Following
k
the setting of previous works such as (Ng & Zhang, 2022), we set the sample size of each client
to be equal, although our method can handle both equal and unequal sample size per client. For
each setting, we run 10 instances with different random seeds and report the means and standard
deviations. TheresultsofF scoreandSHDaregiveninFigure3andFigureA3fortwomodels,
1
where our FedCDH method generally outperforms the other methods. Although we need large
sample properties in the proof of Theorem 4, in practice we only have finite samples. According
to the experiment of varying samples, we can see that with more samples the performance of our
method is getting better. More analysis including the implementation details, the results of the
precisionandrecall,theanalysisofcomputationaltime,andthehyperparameterstudy,thestatistical
significancetest,andtheevaluationongraphdensityareprovidedinAppendixA7.
Real-worldDatasets. Weevaluateourmethodandthebaselinesontworeal-worlddataset,fMRI
Hippocampus(Poldracketal.,2015)andHKStockMarketdatasets(Huangetal.,2020). (i)fMRI
Hippocampus dataset contains signals from d=6 separate brain regions: perirhinal cortex (PRC),
parahippocampalcortex(PHC),entorhinalcortex(ERC),subiculum(Sub),CA1,andCA3/Dentate
Gyrus (DG) in the resting states on the same person in 84 successive days. The records for each
daycanberegardedasonedomain,andthereare518samplesforeachdomain. Weselectn =100
k
samplesforeachdayandselectK∈{4,8,16,32,64}daysforevaluatingvaryingnumberofclients.
WeselectK=10daysandselectn ∈{25,50,100,200,400}samplesforevaluatingvaryingnumber
k
ofsamples. (ii)HKStockMarketdatasetcontainsd=10majorstocksinHongKongstockmarket,
which records the daily closing prices from 10/09/2006 to 08/09/2010. Here one day can be also
seen as one domain. We set the number of clients to be K∈{2,4,6,8,10} while randomly select
n =100 samples for each client. All other settings are following previous one by default. More
k
datasetinformation,implementationdetails,resultsandanalysisareprovidedinAppendixA8.
5 DISCUSSION AND CONCLUSION
Discussion. (i)Strengths: Firstofall,byformulatingoursummarystatistics,therequirementfor
communication between the server and clients is restricted to only one singular instance, thereby
substantially reducing the communication times. This is a marked improvement over other base-
linemethodsthatnecessitateiterativecommunications. Additionally, theutilizationofasurrogate
variable enhances our capability to handle heterogeneous data. Furthermore, leveraging the non-
parametriccharacteristicsofourproposedFCITandFICP,ourFedCDHmethodcanadeptlymanage
arbitraryfunctionalcausalmodels. (ii)Limitations: Firstly,theefficiencyofoursummarystatistics
inreducingcommunicationcostsmaynotbeconsiderablewhenthesamplesizenissmallorthehid-
dendimensionhislarge. Secondly,ourmethodisdesignedspecificallyforhorizontally-partitioned
federateddata,henceitcannotbedirectlyappliedtovertically-partitionedfederateddata.
Conclusion. Thispaperhasputforthanovelconstraint-basedfederatedcausaldiscoverymethod
called FedCDH, demonstrating broad applicability across arbitrary functional causal models and
heterogeneous data. We construct the summary statistics as a stand-in for raw data, ensuring the
protectionofdataprivacy. WefurtherproposeFCITandFICPforskeletondiscoveryanddirection
determination. The extensive experiments, conducted on both synthetic and real-world datasets,
underscorethesuperiorperformanceofourmethodoverotherbaselinemethods.Forfutureresearch,
wewillenhanceourmethodtoaddressmorecomplexscenarios,suchasvertically-partitioneddata.
9PublishedasaconferencepaperatICLR2024
ACKNOWLEDGEMENT
This project is partially supported by NSF Grant 2229881, the National Institutes of Health
(NIH)underContractR01HL159805,andgrantsfromAppleInc.,KDDIResearchInc., QurisAI,
MBZUAI,andInfiniteBrainTechnology.
REFERENCES
Amin Abyaneh, Nino Scherrer, Patrick Schwab, Stefan Bauer, Bernhard Scho¨lkopf, and Arash
Mehrjou. Fed-cd: Federatedcausaldiscoveryfrominterventionalandobservationaldata. arXiv
preprintarXiv:2211.03846,2022.
Abbas Acar, Hidayet Aksu, A Selcuk Uluagac, and Mauro Conti. A survey on homomorphic en-
cryption schemes: Theory and implementation. ACM Computing Surveys (Csur), 51(4):1–35,
2018.
MuhammadArshadandMariusCSilaghi. Distributedsimulatedannealing. DistributedConstraint
ProblemSolvingandReasoninginMulti-AgentSystems,112,2004.
MarcusBendtsen. Regimeawarelearning. InConferenceonProbabilisticGraphicalModels, pp.
1–12.PMLR,2016.
StephenBoyd,NealParikh,EricChu,BorjaPeleato,JonathanEckstein,etal. Distributedoptimiza-
tionandstatisticallearningviathealternatingdirectionmethodofmultipliers. Foundationsand
Trends®inMachinelearning,3(1):1–122,2011.
Vince D Calhoun, Robyn Miller, Godfrey Pearlson, and Tulay Adalı. The chronnectome: time-
varyingconnectivitynetworksasthenextfrontierinfmridatadiscovery. Neuron,84(2):262–274,
2014.
Chandler Squires. causaldag: creation, manipulation, and learning of causal models.
https://github.com/uhlerlab/causaldag,2018.
RongChen,KrishnamoorthySivakumar,andHillolKargupta. Learningbayesiannetworkstructure
fromdistributeddata.InProceedingsofthe2003SIAMInternationalConferenceonDataMining,
pp.284–288.SIAM,2003.
DavidMaxwellChickering.Optimalstructureidentificationwithgreedysearch.Journalofmachine
learningresearch,3(Nov):507–554,2002.
RonaldCramer,IvanBjerreDamga˚rd,etal. Securemultipartycomputation. CambridgeUniversity
Press,2015.
JJDaudin. Partialassociationmeasuresandanapplicationtoqualitativeregression. Biometrika,67
(3):581–590,1980.
DoritDorandMichaelTarsi. Asimplealgorithmtoconstructaconsistentextensionofapartially
orientedgraph. TechnicialReportR-185,CognitiveSystemsLaboratory,UCLA,1992.
PaulErdo˝s,Alfre´dRe´nyi,etal. Ontheevolutionofrandomgraphs. Publ.Math.Inst.Hung.Acad.
Sci,5(1):17–60,1960.
KenjiFukumizu,ArthurGretton,XiaohaiSun,andBernhardScho¨lkopf. Kernelmeasuresofcondi-
tionaldependence. Advancesinneuralinformationprocessingsystems,20,2007.
ErdunGao,JunjiaChen,LiShen,TongliangLiu,MingmingGong,andHowardBondell. Feddag:
Federateddagstructurelearning. TransactionsonMachineLearningResearch,2022.
Slawomir Goryczka and Li Xiong. A comprehensive comparison of multiparty secure additions
with differential privacy. IEEE transactions on dependable and secure computing, 14(5):463–
477,2015.
10PublishedasaconferencepaperatICLR2024
Kui Xiang Gou, Gong Xiu Jun, and Zheng Zhao. Learning bayesian network structure from dis-
tributed homogeneous data. In Eighth acis international conference on software engineering,
artificialintelligence,networking,andparallel/distributedcomputing(snpd2007),volume3,pp.
250–254.IEEE,2007.
Arthur Gretton, Kenji Fukumizu, Choon Teo, Le Song, Bernhard Scho¨lkopf, and Alex Smola. A
kernel statistical test of independence. Advances in neural information processing systems, 20,
2007.
Patrik Hoyer, Dominik Janzing, Joris M Mooij, Jonas Peters, and Bernhard Scho¨lkopf. Nonlinear
causaldiscoverywithadditivenoisemodels. Advancesinneuralinformationprocessingsystems,
21,2008.
BiweiHuang,KunZhang,andBernhardScho¨lkopf. Identificationoftime-dependentcausalmodel:
Agaussianprocesstreatment. InTwenty-Fourthinternationaljointconferenceonartificialintel-
ligence,2015.
Biwei Huang, Kun Zhang, Jiji Zhang, Joseph Ramsey, Ruben Sanchez-Romero, Clark Glymour,
andBernhardScho¨lkopf. Causaldiscoveryfromheterogeneous/nonstationarydata. TheJournal
ofMachineLearningResearch,21(1):3482–3534,2020.
Jianli Huang, Kui Yu, Xianjie Guo, Fuyuan Cao, and Jiye Liang. Towards privacy-aware causal
structurelearninginfederatedsetting. arXivpreprintarXiv:2211.06919,2022.
BrianKidd,KunboWang,YanxunXu,andYangNi. Federatedlearningforsparsebayesianmod-
els with applications toelectronic health records and genomics. In PACIFIC SYMPOSIUM ON
BIOCOMPUTING 2023: Kohala Coast, Hawaii, USA, 3–7 January 2023, pp. 484–495. World
Scientific,2022.
PhillipLippe,TacoCohen,andEfstratiosGavves.Efficientneuralcausaldiscoverywithoutacyclic-
ityconstraints. InternationalConferenceonLearningRepresentations,2022.
Lars Lorch, Scott Sussex, Jonas Rothfuss, Andreas Krause, and Bernhard Scho¨lkopf. Amortized
inferenceforcausalstructurelearning. AdvancesinNeuralInformationProcessingSystems,35:
13104–13118,2022.
Brendan McMahan, Eider Moore, Daniel Ramage, Seth Hampson, and Blaise Aguera y Arcas.
Communication-efficientlearningofdeepnetworksfromdecentralizeddata. InArtificialintelli-
genceandstatistics,pp.1273–1282.PMLR,2017.
OsmanMian,DavidKaltenpoth,MichaelKamp,andJillesVreeken. Nothingbutregrets—privacy-
preservingfederatedcausaldiscovery. InInternationalConferenceonArtificialIntelligenceand
Statistics,pp.8263–8278.PMLR,2023.
Yongchan Na and Jihoon Yang. Distributed bayesian network structure learning. In 2010 IEEE
InternationalSymposiumonIndustrialElectronics,pp.1607–1611.IEEE,2010.
IgnavierNgandKunZhang.Towardsfederatedbayesiannetworkstructurelearningwithcontinuous
optimization.InInternationalConferenceonArtificialIntelligenceandStatistics,pp.8095–8111.
PMLR,2022.
IgnavierNg,Se´bastienLachapelle,NanRosemaryKe,SimonLacoste-Julien,andKunZhang. On
the convergence of continuous constrained optimization for structure learning. In International
ConferenceonArtificialIntelligenceandStatistics,2022.
Ignavier Ng, Biwei Huang, and Kun Zhang. Structure learning with continuous optimization: A
soberlookandbeyond. arXivpreprintarXiv:2304.02146,2023.
AnaRitaNogueira,Joa˜oGama,andCarlosAbreuFerreira. Causaldiscoveryinmachinelearning:
Theoriesandapplications. JournalofDynamics&Games,8(3):203,2021.
JonasPetersandPeterBu¨hlmann. Identifiabilityofgaussianstructuralequationmodelswithequal
errorvariances. Biometrika,101(1):219–228,2014.
11PublishedasaconferencepaperatICLR2024
RussellAPoldrack, TimothyOLaumann, OluwasanmiKoyejo, BrendaGregory, AshleighHover,
Mei-YenChen,KrzysztofJGorgolewski,JeffreyLuci,SungJunJoo,RyanLBoyd,etal. Long-
term neural and physiological phenotyping of a single human. Nature communications, 6(1):
8885,2015.
Ali Rahimi and Benjamin Recht. Random features for large-scale kernel machines. Advances in
neuralinformationprocessingsystems,20,2007.
AlexanderReisach,ChristofSeiler,andSebastianWeichwald.BewareofthesimulatedDAG!causal
discovery benchmarks may be easy to game. In Advances in Neural Information Processing
Systems,2021.
BasilSaeed,SnigdhaPanigrahi,andCarolineUhler. Causalstructurediscoveryfromdistributions
arisingfrommixturesofdags.InInternationalConferenceonMachineLearning,pp.8336–8345.
PMLR,2020.
SaeedSametandAliMiri.Privacy-preservingbayesiannetworkforhorizontallypartitioneddata.In
2009InternationalConferenceonComputationalScienceandEngineering,volume3,pp.9–16.
IEEE,2009.
XinpengShen,SisiMa,PrashanthiVemuri,andGyorgySimon. Challengesandopportunitieswith
causal discovery algorithms: application to alzheimer’s pathophysiology. Scientific reports, 10
(1):1–12,2020.
ShoheiShimizu, PatrikOHoyer, AapoHyva¨rinen, AnttiKerminen, andMichaelJordan. Alinear
non-gaussianacyclicmodelforcausaldiscovery. JournalofMachineLearningResearch,7(10),
2006.
Peter Spirtes. An anytime algorithm for causal inference. In International Workshop on Artificial
IntelligenceandStatistics,pp.278–285.PMLR,2001.
PeterSpirtesandKunZhang. Causaldiscoveryandinference: conceptsandrecentmethodological
advances. InAppliedinformatics,volume3,pp.1–28.SpringerOpen,2016.
PeterSpirtes, ClarkNGlymour, RichardScheines, andDavidHeckerman. Causation, prediction,
andsearch. MITpress,2000.
EricVStrobl, KunZhang, andShyamVisweswaran. Approximatekernel-basedconditionalinde-
pendencetestsforfastnon-parametriccausaldiscovery. JournalofCausalInference,7(1),2019.
Danica J Sutherland and Jeff Schneider. On the error of random fourier features. arXiv preprint
arXiv:1506.02785,2015.
Ruibo Tu, Kun Zhang, Bo Bertilson, Hedvig Kjellstrom, and Cheng Zhang. Neuropathic pain
diagnosis simulator for causal discovery algorithm evaluation. Advances in Neural Information
ProcessingSystems,32,2019.
Matej Vukovic´ and Stefan Thalmann. Causal discovery in manufacturing: A structured literature
review. JournalofManufacturingandMaterialsProcessing,6(1):10,2022.
ZhaoyuWang,PingchuanMa,andShuaiWang. Towardspracticalfederatedcausalstructurelearn-
ing. arXivpreprintarXiv:2306.09433,2023.
DennisWei,TianGao,andYueYu. DAGswithnofears: Acloserlookatcontinuousoptimization
forlearningBayesiannetworks. InAdvancesinNeuralInformationProcessingSystems,2020.
RobertFWoolson. Wilcoxonsigned-ranktest. Wileyencyclopediaofclinicaltrials,pp.1–3,2007.
Eric P Xing, Wenjie Fu, and Le Song. A state-space mixed membership blockmodel for dynamic
networktomography. TheAnnalsofAppliedStatistics,4(2):535–566,2010.
Qiang Yang, Yang Liu, Yong Cheng, Yan Kang, Tianjian Chen, and Han Yu. Federated learning.
SynthesisLecturesonArtificialIntelligenceandMachineLearning,13(3):1–207,2019.
12PublishedasaconferencepaperatICLR2024
Qiaoling Ye, Arash A Amini, and Qing Zhou. Distributed learning of generalized linear causal
networks. arXivpreprintarXiv:2201.09194,2022.
Yue Yu, Jie Chen, Tian Gao, and Mo Yu. Dag-gnn: Dag structure learning with graph neural
networks. InInternationalConferenceonMachineLearning,pp.7154–7163.PMLR,2019.
YueYu,TianGao,NaiyuYin,andQiangJi. Dagswithnocurl: Anefficientdagstructurelearning
approach. InInternationalConferenceonMachineLearning,pp.12156–12166.PMLR,2021.
Kun Zhang and Lai-Wan Chan. Extensions of ica for causality discovery in the hong kong stock
market. InInternationalConferenceonNeuralInformationProcessing, pp.400–409.Springer,
2006.
KunZhangandAapoHyvarinen. Ontheidentifiabilityofthepost-nonlinearcausalmodel. arXiv
preprintarXiv:1205.2599,2012.
Kun Zhang, Jonas Peters, Dominik Janzing, and Bernhard Scho¨lkopf. Kernel-based conditional
independencetestandapplicationincausaldiscovery. arXivpreprintarXiv:1202.3775,2012.
Kun Zhang, Biwei Huang, Jiji Zhang, Bernhard Scho¨lkopf, and Clark Glymour. Discovery and
visualizationofnonstationarycausalmodels. arXivpreprintarXiv:1509.08056,2015.
XunZheng,BryonAragam,PradeepKRavikumar,andEricPXing.Dagswithnotears:Continuous
optimization for structure learning. Advances in Neural Information Processing Systems, 31,
2018.
FangtingZhou, KejunHe, andYangNi. Causaldiscoverywithheterogeneousobservationaldata.
InUncertaintyinArtificialIntelligence,pp.2383–2393.PMLR,2022.
13PublishedasaconferencepaperatICLR2024
Appendixfor
“FederatedCausalDiscoveryfromHeterogeneousData”
Appendixorganization:
A1SummaryofSymbols 15
A2RelatedWorks 15
A3DetailsabouttheCharacterization 16
A3.1 CharacterizationofConditionalIndependence . . . . . . . . . . . . . . . . . . . . 16
A3.2 CharacterizationofIndependentChange . . . . . . . . . . . . . . . . . . . . . . . 18
A4Proofs 18
A4.1 ProofofLemma3 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19
A4.2 ProofofTheorem4 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19
A4.3 ProofofTheorem5 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21
A4.4 ProofofTheorem6 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22
A4.5 ProofofLemma7 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 23
A4.6 ProofofTheorem8 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24
A5DetailsaboutFederatedUnconditionalIndependenceTest 24
A5.1 NullHypothesis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25
A5.2 NullDistributionApproximation . . . . . . . . . . . . . . . . . . . . . . . . . . . 25
A6DetailsaboutSkeletonDiscoveryandDirectionDetermination 25
A6.1 SkeletonDiscovery. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25
A6.2 DirectionDetermination. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26
A7DetailsabouttheExperimentsonSyntheticDatasets 28
A7.1 ImplementationDetails . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28
A7.2 AnalysisofF andSHD . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28
1
A7.3 ResultsofPrecisionandRecall . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29
A7.4 ResultsofComputationalTime . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29
A7.5 HyperparameterStudy . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 30
A7.6 StatisticalSignificanceTest . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31
A7.7 EvaluationonDenseGraph . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31
A7.8 Evaluationonthepowerofconditionalindependencetest . . . . . . . . . . . . . . 32
A7.9 Evaluationontheorderofdomainindices . . . . . . . . . . . . . . . . . . . . . . 32
A8DetailsabouttheExperimentsonReal-worldDataset 33
14PublishedasaconferencepaperatICLR2024
A8.1 DetailsaboutfMRIHippocampusDataset . . . . . . . . . . . . . . . . . . . . . . 33
A8.2 DetailsaboutHKStockMarketDataset . . . . . . . . . . . . . . . . . . . . . . . 34
A1 SUMMARY OF SYMBOLS
Inordertoimprovethereadabilityofourpaper,wesummarizethemostimportantsymbolsandtheir
meaningsthroughoutthepaper,asshowninTableA1.
TableA1: Summaryofsymbols
Symbol Meaning Symbol Meaning
d thenumberofobservedvariables. n thetotalsamplesizeofallclients.
K thenumberofclients. V thedatamatrix,V∈Rn×d.
k theclientindex,k∈{1,...,K}. nk thesamplesizeofk-thclient.
℧ domainindex,℧∈{1,...,K}. Vi thei-thvariable,i∈{1,...,d}.
fi(·) thecausalfunctionofvariableVi. PAi theparentsofVi.
ϵi thenoisetermofVi. ψ˜ asetof“pseudoconfounders”.
θi theeffectiveparameterofVi. L thenumberof“pseudoconfounders”.
G,Gobs thecausalgraphwithdvariables. Gaug theaugmentedgraphwithd+1variables.
X,Y,Z asetofrandomvariables. kX,kY,kZ thepositivedefinitekernels.
X,Y,Z thedomainsforthevariables. HX,HY,HZ thereproducingkernelHilbertspaces.
X¨ X¨≜(X,Z). △ˆ thenormalizedHSIC.
Σ thecross-covarianceoperatorininfinitedimension. C thecross-covariancematrixinfinitedimension.
h thenumberofhiddenfeatures/mappingfunctions. f(·),g(·),q(·) themappingfunctions.
F thefunctionspaces. u,v theregressioncoefficients.
A¨ A¨=f(X¨)∈Rn×h. B B=g(Y)∈Rn×h.
γ theridgeparameter. I theidentitymatrix.
K˜ thecentralizedkernelmatrix. H thematrixforcentralization,H=I−111T.
n
TCI theteststatisticforconditionalindependence. R theresidualforridgeregression.
α thestandardGaussianvariable. α2 theχ2variable.
1
λ thenonzeroeigenvalues. Tˆ CI theasymptoticstatistic.
kˆ,θˆ theparametersforGammadistributionΓ(kˆ,θˆ). C∗ thespecially-designedcovariancematrix.
tr(·) thetraceoperator. d′ d′=d+1(plusonesurrogatevariable).
CT globalcovariancetensor,CT ∈Rd′×d′×h×h. CTk localcovariancetensor,CTk∈Rd′×d′×h×h.
w thecoefficientsforrandomfeatures. b theinterceptsforrandomfeatures.
A2 RELATED WORKS
CausalDiscovery. Ingeneral,therearemainlythreecategoriesofmethodsforcausaldiscovery
(CD) from observed data (Spirtes & Zhang, 2016): constraint-based methods, score-based meth-
ods and function-based methods. Constraint-based methods utilize the conditional independence
test (CIT) to learn a skeleton of the directed acyclic graph (DAG), and then orient the edges upon
the skeleton. Such methods contain Peter-Clark (PC) algorithm (Spirtes & Zhang, 2016) and Fast
CausalInference(FCI)algorithm(Spirtes,2001). SometypicalCITmethodsincludekernel-based
independentconditionaltest(Zhangetal.,2012)andapproximatekernel-basedconditionalindepen-
denttest(Strobletal.,2019). Score-basedmethodsuseascorefunctionandagreedysearchmethod
tolearnaDAGwiththehighestscorebysearchingallpossibleDAGsfromthedata,suchasGreedy
Equivalent Search (GES) (Chickering, 2002). Within the score-based category, there is a continu-
ousoptimization-basesubcategoryattractingincreasingattention. NOTEARS(Zhengetal.,2018)
firstly reformulates the DAG learning process as a continuous optimization problem and solves it
using gradient-based method. NOTEARS is designed under the assumption of the linear relations
betweenvariables. SubsequentworkshaveextendedNOTEARStohandlenonlinearcasesviadeep
neural networks, such as DAG-GNN (Yu et al., 2019) and DAG-NoCurl (Yu et al., 2021). ENCO
(Lippeetal.,2022)presentsanefficientDAGdiscoverymethodfordirectedacycliccausalgraphs
utilizingbothobservationalandinterventionaldata. AVCI(Lorchetal.,2022)inferscausalstruc-
ture by performing amortized variational inference over an arbitrary data-generating distribution.
Thesecontinuous-optimization-basedmethodsmightsufferfromvarioustechnicalissues,including
convergence (Wei et al., 2020; Ng et al., 2022), nonconvexity (Ng et al., 2023), and sensitivity to
15PublishedasaconferencepaperatICLR2024
datastandardization(Reisachetal.,2021). Function-basedmethodsrelyonthecausalasymmetry
property, includingthelinearnon-Gaussionmodel(LiNGAM)(Shimizuetal.,2006), theadditive
noisemodel(Hoyeretal.,2008),andthepost-nonlinearcausalmodel(Zhang&Hyvarinen,2012).
Causal Discovery from Heterogeneous Data. Most of the causal discovery methods mentioned
aboveusuallyassumethatthedataisindependentlyandidenticallydistributed(i.i.d.). However,in
practical scenarios, distribution shift is possibly occurring across datasets, which can be changing
acrossdifferentdomainsorovertime,asfeaturedbyheterogeneousornon-stationarydata(Huang
etal.,2020). Totackletheissueofchangingcausalmodels, onemaytrytofindcausalmodelson
slidingwindowsfornon-stationarydata(Calhounetal.,2014),andthencomparethem. Improved
versionsincludetheregimeawarelearningalgorithmtolearnasequenceofBayesiannetworksthat
model a system with regime changes (Bendtsen, 2016). Such methods may suffer from high esti-
mationvarianceduetosamplescarcity, largetypeIIerrors, andalargenumberofstatisticaltests.
Some methods aim to estimate the time-varying causal model by making use of certain types of
smoothnessofthechange(Huangetal.,2015),buttheydonotexplicitlylocatethechangingcausal
modules. Several methods aim to model time-varying time-delayed causal relations (Xing et al.,
2010),whichcanbereducedtoonlineparameterlearningbecausethedirectionofthecausalrela-
tionsisgiven(i.e.,thepastinfluencesthefuture). Moreover,mostofthesemethodsassumelinear
causalmodels,limitingtheirapplicabilitytocomplexproblemswithnonlinearcausalrelations. In
particular, a nonparametric constraint-based method to tackle this causal discovery problem from
non-stationaryorheterogeneousdata,calledCD-NOD(Huangetal.,2020),wasrecentlyproposed,
wherethesurrogatevariablewasintroduced,writtenassmoothfunctionsoftimeordomainindex.
Thefirstmodel-basedmethodwasproposedforheterogeneousdatainthepresenceofcycliccausal-
ityandconfounders,namedCHOD(Zhouetal.,2022). Saeedetal. (Saeedetal.,2020)provideda
graphicalrepresentationviathemixtureDAGofdistributionsthatariseasmixturesofcausalDAGs.
FederatedCausalDiscovery. Atwo-stepprocedurewasadopted(Gouetal.,2007)tolearnaDAG
from horizontally partitioned data, which firstly estimated the structures independently using each
client’s local dataset, and secondly applied further conditional independence test. Instead of us-
ing statistical test in the second step, a voting scheme was used to pick those edges identified by
more than half of the clients (Na & Yang, 2010). These methods leverage only the final graphs
independently estimated from each local dataset, which may lead to suboptimal performance as
the information exchange may be rather limited. Furthermore, (Samet & Miri, 2009) developed a
privacy-preservingmethodbasedonsecuremultipartycomputation,butwaslimitedtothediscrete
case. Forverticallypartitioneddata,(Yangetal.,2019)constructedanapproximationtothescore
functioninthediscretecaseandadoptedsecuremultipartycomputation. (Chenetal.,2003)devel-
opedafour-stepprocedurethatinvolvestransmittingasubsetofsamplesfromeachclienttoacentral
site, which may lead to privacy concern. NOTEARS-ADMM (Ng & Zhang, 2022) and Fed-DAG
(Gaoetal.,2022)wereproposedforthefederatedcausaldiscovery(FCD)basedoncontinuousopti-
mizationmethods.Fed-PC(Huangetal.,2022)wasdevelopedasafederatedversionofclassicalPC
algorithm,however,itwasdevelopedforhomogeneousdata,whichmayleadtopoorperformanceon
heterogeneousdata. DARLIS(Yeetal.,2022)utilizesthedistributedannealing(Arshad&Silaghi,
2004)strategytosearchfortheoptimalgraph,whilePERI(Mianetal.,2023)aggregatestheresults
of the local greedy equivalent search (GES) (Chickering, 2002) and chooses the worst-case regret
for each iteration. Fed-CD (Abyaneh et al., 2022) was proposed for both observational and inter-
ventional data based on continuous optimization. FEDC2SL (Wang et al., 2023) extended χ2 test
tothefederatedversion, however, thismethodisrestrictiveondiscretevariablesandthereforenot
applicableforanycontinuousvariables. Noticethatmostoftheseabove-mentionedmethodsheav-
ily rely on either identifiable functional causal models or homogeneous data distributions. These
assumptions may be overly restrictive and difficult to be satisfied in real-world scenarios, limiting
theirdiverseapplicability.
A3 DETAILS ABOUT THE CHARACTERIZATION
A3.1 CHARACTERIZATIONOFCONDITIONALINDEPENDENCE
Inthissection,wewillprovidemoredetailsabouttheinterpretationofΣ asformulatedinEq.
X¨Y|Z
13,thedefinitionofcharacteristickernelasshowninLemma9,whichishelpfultounderstandthe
16PublishedasaconferencepaperatICLR2024
Lemma1inthemainpaper. Wethenprovidetheuncorrelatedness-basedcharacterizationofCIin
Lemma10.
Firstofall,fortherandomvector(X,Y)onX ×Y,thecross-covarianceoperatorfromH toH
Y X
isdefinedbytherelation
⟨f,Σ g⟩ =E [f(X)g(Y)]−E [f(X)]E [g(Y)], (11)
XY HX XY X Y
forallf ∈H andg ∈H . Furthermore,wedefinethepartialcross-covarianceoperatoras
X Y
Σ =Σ −Σ Σ−1Σ . (12)
XY|Z XY XZ ZZ ZY
If Σ is not invertible, use the right inverse instead of the inverse. We can intuitively interpret
ZZ
theoperatorΣ asthepartialcross-covariancebetween{f(X),∀f∈H }and{g(Y),∀g∈H }
XY|Z X Y
given{q(Z),∀q∈H }.
Z
Lemma 9 (Characteristic Kernel (Fukumizu et al., 2007)). A kernel K is characteristic, if the
X
conditionE X∼P X[f(X)]=E X∼Q X[f(X)](∀f∈H X)impliesP X=Q X,whereP X andQ X aretwo
probabilitydistributionsofX. GaussiankernelandLaplaciankernelarecharacteristickernels.
AsshowninLemma1,ifweusecharacteristickernelanddefineX¨ ≜(X,Z),thecharacterization
ofCIcouldberelatedtothepartialcross-covarianceasΣ =0 ⇐⇒ X ⊥⊥Y|Z,where
X¨Y|Z
Σ =Σ −Σ Σ−1Σ . (13)
X¨Y|Z X¨Y X¨Z ZZ ZY
Similarly, we can intuitively interpret the operator Σ as the partial cross-covariance between
X¨Y|Z
{f(X¨),∀f∈H }and{g(Y),∀g∈H }given{q(Z),∀q∈H }.
X¨ Y Z
Based on Lemma 1, we further consider a different characterization of CI which enforces the
uncorrelatedness of functions in suitable spaces, which may be intuitively more appealing. De-
note the probability distribution of X as P and the joint distribution of (X,Y) as P . Let
X XY
L2 be the space of square integrable functions of X and L2 be that of (X,Y). Specifically,
X XY
L2 ={f(X)|E(f2)<∞},andlikewiseforL2 . Particularly,considerthefollowingconstrained
X XY
L2spaces:
S ≜{f ∈L2 |E(f|Z)=0},
X¨ X¨
S ≜{g ∈L2 |E(g|Z)=0}, (14)
Y¨ Y¨
S′ ≜{g′|g′ =g(Y)−E(g|Z),g ∈L2}.
Y|Z Y
TheycanbeconstructedfromthecorrespondingL2spacesvianonlinearregression. Fromexample,
foranyfunctionf ∈L2 ,thecorrespondingfunctionf′isgivenby:
XZ
f′(X¨)=f(X¨)−E(f|Z)=f(X¨)−β∗(Z), (15)
f
whereβ∗(Z)∈L2 istheregressionfunctionoff(X¨)onZ. Then,wecanthenrelatethedifferent
f Z
characterizationofCIfromLemma1totheuncorrelatednessinthefollowinglemma.
Lemma10(CharacterizationofCIbasedonPartialAssociation(Daudin,1980)). Eachofthefol-
lowingconditionsareequivalenttoX ⊥⊥Y|Z
(i.)E(fg)=0,∀f ∈S and ∀g ∈S ,
X¨ Y¨
(ii.)E(fg′)=0,∀f ∈S and ∀g′ ∈S′ ,
X¨ Y|Z
(16)
(iii.)E(fg˜)=0,∀f ∈S and ∀g˜∈L2,
X¨ Y¨
(iv.)E(fg˜′)=0,∀f ∈S and ∀g˜′ ∈L2.
X¨ Y
When(X,Y,Z)arejointlyGaussian,theindependenceisequivalenttotheuncorrelatedness,inother
words,X ⊥⊥Y|Zisequivalenttothevanishingofthepartialcorrelationcoefficientρ . Wecan
XY|Z
regardtheLemma10asasageneralizationofthepartialcorrelationbasedcharacterizationofCI.
17PublishedasaconferencepaperatICLR2024
Forexample,condition(i)meansthatany”residual”functionof(X,Z)givenZisuncorrelatedwith
thatof(Y,Z)givenZ.HerewecanobservethesimilaritybetweenLemma1andLemma10,except
theonlydifferencethatLemma10considersallfunctionsinL2spaces,whileLemma1exploitsthe
spacescorrespondingtosomecharacteristickernels. Ifwerestrictthefunctionf andg′incondition
(ii)tothespacesH andH ,respectively,Lemma10isthenreducedtoLemma1.
X¨ Y
BasedonthetwolemmasmentionedaboveplustheLemma1,wecouldfurtherderiveLemma3in
ourmainpaper.
A3.2 CHARACTERIZATIONOFINDEPENDENTCHANGE
InLemma2ofthemainpaper,weprovidetheindependentchangeprinciple(ICP)toevaluatethe
dependencebetweentwochangingcausalmodels. Here,wegivemoredetailsaboutthedefinition
andtheassignedvalueofnormalizedHSIC.Asmallervaluemeansbeingmoreindependent.
Definition1(NormalizedHSIC(Fukumizuetal.,2007)). GivenvariablesU andV,HSICprovides
ameasurefortestingtheirstatisticalindependence. AnestimatorofnormalizedHSICisgivenas
tr(M˜ M˜ )
HSICN = U V , (17)
UV tr(M˜ )tr(M˜ )
U V
where M˜ and M˜ are the centralized Gram matrices, M˜ ≜ HM H, M˜ ≜ HM H,
U V U U V V
H = I − 111T, I is n×n identity matrix and 1 is vector of n ones. How to construct M
n U
andM willbeexplainedinthecorrespondingcasesbelow. Tocheckwhethertwocausalmodules
V
changeindependentlyacrossdifferentdomains,thedependencebetweenP(X)andP(Y|X)andthe
dependencebetweenP(Y)andP(X|Y)onthegivendatacanbegivenby
tr(M˜ M˜ ) tr(M˜ M˜ )
X Y|X Y X|Y
△ = , △ = . (18)
X→Y tr(M˜ )tr(M˜ ) Y→X tr(M˜ )tr(M˜ )
X Y|X Y X|Y
According to CD-NOD (Huang et al., 2020), instead of working with conditional distribution
P(X|Y) and P(Y|X), we could use the ”joint distribution” P(X,Y), which is simpler, for esti-
mation. HereweuseY insteadofY toemphasizethatinthisconstructeddistributionX andY are
notsymmetric. Then,thedependencevalueslistedinEq. 18couldbeestimatedby
tr(M˜ M˜ ) tr(M˜ M˜ )
△ˆ = X YX , △ˆ = Y XY , (19)
X→Y tr(M˜ )tr(M˜ ) Y→X tr(M˜ )tr(M˜ )
X YX Y XY
whereM˜
X
≜HM XH,M
X
≜µˆ X|℧·µˆT X|℧.Similarly,wedefineM˜ Y,M
Y
andµˆ Y|℧.According
to(Huangetal.,2020),wehave
µˆ X|℧ ≜ϕ(℧)(C℧℧+γI)−1C℧X, (20)
where µˆ X|℧ ≜ ϕ(℧)(C℧℧ + γI)−1C℧X, µˆ X|℧,ϕ(℧) ∈ Rn×h, γ is a small ridge parameter, ϕ
represents the feature map, and ℧ is the surrogate variable indicating different domains or clients.
Similarly,wedefineM˜ Y,M
Y
andµˆ Y|℧.
µˆ Y|℧ ≜ϕ(℧)(C℧℧+γI)−1C℧Y. (21)
Moreover,M˜
YX
≜HM YXH,M
YX
≜µˆ YX|℧·µˆT YX|℧. Similarly,wedefineM˜ XY,M
XY
and
µˆ .
XY
µˆ YX|℧ ≜ϕ(℧)(C℧℧+γI)−1C℧,(Y,X)
(22)
µˆ XY|℧ ≜ϕ(℧)(C℧℧+γI)−1C℧,(X,Y),
Eq. 19asformulatedaboveishelpfultofurtherderiveTheorem5inourmainpaper.
A4 PROOFS
Here,weprovidetheproofsofthetheoremsandlemmas,includingLemma3,Theorem4,Theorem
5,Theorem6,Lemma7,andTheorem8inourmainpaper.
18PublishedasaconferencepaperatICLR2024
A4.1 PROOFOFLEMMA3
Proof: We define the covariance matrix in the null hypothesis as C = 1 (cid:80)n [(A¨ −
X¨Y|Z n i=1 i
E(A¨|Z))T(B −E(B|Z))]whichcorrespondstothepartialcross-covariancematrixwithnsamples,
i
C ∈Rh×h, A¨=f(X¨)∈Rn×h, B=g(Y)∈Rn×h, {fj(X¨)|h }∈F , {gj(Y)|h }∈F . Notice
X¨Y|Z j=1 X¨ j=1 Y
thatF andF arefunctionspaces. nandhdenotethenumberoftotalsamplesofallclientsand
X¨ Y
thenumberofhiddenfeaturesormappingfunctions,respectively.
Notice that E(A¨|Z) and E(B|Z) could be non-linear functions of Z which may be difficult to
estimate. therefore, we would like to approximate them with linear functions. Let q(Z)∈Rn×h,
{qj(Z)|h }∈F . WecouldestimateE(fj|Z)withtheridgeregressionoutputuTq(Z)underthe
j=1 Z j
mildconditionsgivenbelow.
Lemma 11. (Sutherland & Schneider, 2015) Consider performing ridge regression of fj on Z.
Assume that (i) (cid:80)n fj = 0, fj is defined on the domain of X¨; (ii) the empirical kernel matrix
i=1 i
of Z, denoted by K , only has finite entries (i.e., ∥K ∥ < ∞); (iii) the range of Z is compact,
Z Z ∞
Z ⊂RdZ. Thenwehave
(cid:104) (cid:105) c
P |Eˆ(fj|Z)−uTq(Z)|≥ϵ ≤ 0e−hϵ2c1, (23)
j ϵ2
whereEˆ(fj|Z)istheestimateofE(fj|Z)byridgeregression,c andc arebothconstantsthatdo
0 1
notdependonthesamplesizenorthenumberofhiddendimensionsormappingfunctionsh.
Theexponentialratewithrespecttohintheabovelemmasuggestswecanapproximatetheoutput
ofridgeregressionwithasmallnumberofhiddenfeatures. Moreover,wecouldsimilarlyestimate
(cid:104) (cid:105)
E(gj|Z)withvTq(Z),becausewecouldguaranteethatP |Eˆ(gj|Z)−vTq(Z)|≥ϵ → 0forany
j j
fixedϵ>0atanexponentialratewithrespecttoh.
SimilartotheL2 spacesincondition(ii)ofLemma10,wecanconsiderthefollowingconditionto
approximateconditionalindependence:
E(f˜g˜)=0,∀f˜∈F˜ and ∀g˜∈F˜ , where
X¨|Z Y|Z
F˜ ={f˜|f˜j =fj −E(fj|Z),fj ∈F }, (24)
X¨|Z X¨
F˜ ={g˜|g˜j =gj −E(gj|Z),gj ∈F }.
Y|Z Y
AccordingtoEq.23,wecouldestimateE(fj|Z)andE(gj|Z)byuTq(Z)andvTq(Z),respectively.
j j
Thus,wecanreformulatethefunctionspacesas
F˜ ={f˜|f˜j =fj −uTq(Z),fj ∈F },
X¨|Z j X¨
(25)
F˜ ={g˜|g˜j =gj −vTq(Z),gj ∈F }.
Y|Z j Y
Proofends. !(℧) !(℧)
! "
$(℧)
ℓ
A4.2 PROOFOFTHEOREM4
Proof: Assume"that there are n"i.i.d. samples for
! "
X,Y,Z. LetK˜ bethecentralizedkernelmatrix,
X¨|Z
given by K˜ ≜R˜ (a) R˜T =HR RT H, #(%)
X¨|Z X¨|Z X¨|Z X¨|Z X¨|Z
where R ≜f˜(X¨)=f(X¨)−uTq(Z) which
X¨|Z
can be seen as the residual after ridge
r Ke ˜gress ≜io R˜n.
R˜T
S =im Hila Rrly, RW Te Hcould defi ann de -,
$̈|"
'()̈) *(+) -,
!|"
Y|Z Y|Z Y|Z Y|Z Y|Z
R ≜g˜(Y)=g(Y)−(vbT)q(Z). Accordingly,
Y|Z
weletK˜ ≜R˜ R˜T =HR RT H. We FigureA1: GiventhatX ⊥⊥ Y|Z,wecould
X¨Y|Z X¨|Z Y|Z X¨|Z Y|Z
introduce the independence between R
set the test statistic as T =n∥C ∥2, where X¨|Z
CI X¨Y|Z F andR .
C ≜R˜T R˜ =1RT HHR . Y|Z
X¨Y|Z X¨|Z Y|Z n X¨|Z Y|Z
19PublishedasaconferencepaperatICLR2024
Letλ andλ betheeigenvaluesofK˜ and
X¨|Z Y|Z X¨|Z
K˜ , respectively. Furthermore, we define the EVD decomposition K˜ = V Λ VT ,
Y|Z X¨|Z X¨|Z X¨|Z X¨|Z
whereΛ isthediagonalmatrixcontainingnon-negativeeigenvaluesλ .Similarly,wedefine
X¨|Z X¨|Z,i
K˜ = V Λ VT witheigenvaluesλ . Letψ = [ψ ,ψ ,...,ψ ] ≜
Y|Z Y|Z Y|Z Y|Z Y|Z,i X¨|Z X¨|Z,1 X¨|Z,2 X¨|Z,n
V Λ1/2 andϕ =[ϕ ,ϕ ,...,ϕ ]≜V Λ1/2 .
Y|Z Y|Z Y|Z Y|Z,1 Y|Z,2 Y|Z,n Y|Z Y|Z
On the other hand, consider eigenvalues λ∗ and eigenfunctions u of the kernel k
X¨|Z,i X¨|Z,i X¨|Z
w.r.t. theprobablitymeasurewiththedensityP(x¨), i.e., λ∗ andu satisfy(cid:82) k (x¨,x¨′)·
X¨|Z,i X¨|Z,i X¨|Z
u (x¨)·P(x¨)dx¨ = λ∗ ·u (x¨′), where we assume that u have unit variance, i.e.,
X¨|Z,i X¨|Z,i X¨|Z,i X¨|Z,i
E[u2 (X¨)] = 1. Similarly,wedefinek ,λ∗ ,andu∗ . Let{α ,...,α }denotei.i.d.
X¨|Z,i Y|Z Y|Z,i Y|Z,i 1 n2
standardGaussianvariables,andthus{α2,...,α2 }denotei.i.d. χ2variables.
1 n2 1
Lemma 12 (Kernel-based Conditional Independence Test (Zhang et al., 2012)). Under the null
hypothesisthatX andY areconditionalindependentgivenZ,wehavethattheteststatisticT ≜
CI
1 tr(K˜ K˜ ) have the same asymptotic distribution as Tˆ ≜ 1 (cid:80)n2 λ˜ · α2, where λ˜
n X¨|Z Y|Z CI n k=1 k k k
are eigenvalues of wwT, w = [w ,...,w ], with the vector w obtained by stacking M =
1 n t t
[ψ (X¨ ),ψ (X¨ ),...,ψ (X¨ )]T ·[ϕ (Y ),ϕ (Y ),...,ϕ (Y )].
X¨|Z,1 t X¨|Z,2 t X¨|Z,n t Y|Z,1 t Y|Z,2 t Y|Z,n t
Intheabovelemma,theirteststatisticisequivalenttoours,duetothefactthat
1 1
tr(K˜ K˜ )= tr(R˜ (R˜T R˜ R˜T ))
n X¨|Z Y|Z n X¨|Z X¨|Z Y|Z Y|Z
1
= tr((R˜T R˜ R˜T )R˜ )
n X¨|Z Y|Z Y|Z X¨|Z
= 1 ∥R˜T R˜ ∥2 (26)
n X¨|Z Y|Z F
1
= ∥nC ∥2
n X¨Y|Z F
=n∥C ∥2.
X¨Y|Z F
However,theirasymptoticdistributionisdifferentfromours.Basedontheirasymptoticdistribution,
wecouldgofurther. ThefirsttworowsofEq. 26holdtruebecauseofthecommutativepropertyof
trace,namely,tr(AB) = BA,refertoLemma6formoredetails. Accordingtotheformulationof
R˜ andR˜ ,wehave
X¨|Z Y|Z
(cid:40)
f(X¨)=uTq(Z)+R
X¨|Z
(27)
g(Y)=vTq(Z)+R .
Y|Z
Based on the above formulations, we could easily draw the causal graph as shown in Fig. A1.
In particular, considering that X and Y are conditionally independent given Z, we could further
determinethatR andR areindependent,namely,wehave
X¨|Z Y|Z
X ⊥⊥Y|Z ⇐⇒ R ⊥⊥R . (28)
X¨|Z Y|Z
As f(X¨) and g(Y) are uncorrelated, then E(w ) = 0. Furthermore, the covariance is Σ =
t
Cov(w ) = E(w wT),wherew isdefinedinthesamewayasinLemma12. IfR ⊥⊥ R ,
t t t X¨|Z Y|Z
fork ̸=iorl̸=j,wedenotethenon-diagonal(ND)entriesofΣase ,where
ND
(cid:113)
e =E[ λ∗ λ∗ λ∗ λ∗ u u u u ]
ND X¨|Z,i Y|Z,j X¨|Z,k Y|Z,l X¨|Z,i Y|Z,j X¨|Z,k Y|Z,l
(cid:113)
= λ∗ λ∗ λ∗ λ∗ E[u u ]E[u u ] (29)
X¨|Z,i Y|Z,j X¨|Z,k Y|Z,l X¨|Z,i X¨|Z,k Y|Z,j Y|Z,l
=0.
WethendenotethediagonalentriesofΣase ,where
D
e =λ∗ λ∗ E[u2 ]E[u2 ]
D X¨|Z,i Y|Z,j X¨|Z,i Y|Z,j
(30)
=λ∗ λ∗ ,
X¨|Z,i Y|Z,j
20PublishedasaconferencepaperatICLR2024
which are eigenvalues of Σ. According to (Zhang et al., 2012), 1λ converge in probability
n X¨|Z,i
λ∗ . Substituting all the results into the asymptotic distribution in Lemma 12, we can get the
X¨|Z
updatedasymptoticdistribution
β
Tˆ ≜ 1 (cid:88) λ λ α2 as β =n→∞. (31)
CI n2 X¨|Z,i Y|Z,j ij
i,j=1
whereβ isthenumberofnonzeroeigenvaluesλ ofthekernelmatricesK˜ .
X¨|Z X¨|Z
Consequently,T andTˆ havethesameasymptoticdistribution. Proofends.
CI CI
A4.3 PROOFOFTHEOREM5
Proof: Firstofall,sinceα2 followtheχ2 distributionwithonedegreeoffreedom,thuswehave
ij
E(α2 ) = 1 and Var(α2 ) = 2. According to the asymptotic distribution in Theorem 4 and the
ij ij
derivationofLemma7,wehave
E(Tˆ |D)= 1 (cid:88) λ λ
CI n2 X¨|Z,i Y|Z,j
i,j
1 (cid:88) (cid:88)
= λ λ
n2 X¨|Z,i Y|Z,j
i j
1
= tr(K˜ )tr(K˜ ) (32)
n2 X¨|Z Y|Z
1
= tr(R˜ R˜T )tr(R˜ R˜T )
n2 X¨|Z X¨|Z Y|Z Y|Z
1
= tr(n·C )tr(n·C )
n2 X¨|Z Y|Z
=tr(C )tr(C ),
X¨|Z Y|Z
where R˜ and R˜ are defined in the proof of Theorem 3 above. Therefore, E(Tˆ |D) =
X¨|Z Y|Z CI
tr(C )tr(C ).
X¨|Z Y|Z
Furthermore,α2 areindependentvariablesacrossiandj,andnoticethattr(K˜2 )=(cid:80) λ2 ,
ij X¨|Z i X¨|Z,i
andsimilarlytr(K˜2 )=(cid:80) λ2 . BasedontheasymptoticdistributioninTheorem4,wehave
Y|Z i Y|Z,i
Var(Tˆ |D)= 1 (cid:88) λ2 λ2 Var(α2 )
CI n4 X¨|Z,i Y|Z,j ij
i,j
2 (cid:88) (cid:88)
= λ2 λ2 (33)
n4 X¨|Z,i Y|Z,j
i j
2
= tr(K˜2 )tr(K˜2 ).
n4 X¨|Z Y|Z
Additionally,accordingtothesimilarruleasinEq. 26,wehave
tr(K˜2 )=tr(R˜ R˜T R˜ R˜T )
X¨|Z X¨|Z X¨|Z X¨|Z X¨|Z
=tr(R˜T R˜ R˜T R˜ )
X¨|Z X¨|Z X¨|Z X¨|Z
=∥R˜T R˜ ∥2 (34)
X¨|Z X¨|Z F
=∥n·C ∥2
X¨|Z F
=n2∥C ∥2.
X¨|Z F
21PublishedasaconferencepaperatICLR2024
Similarly, we have tr(K˜2 ) = n2∥C ∥2. Substituting the results into the above formula-
Y|Z Y|Z F
tion about variance, we have 2 tr(K˜2 )tr(K˜2 ) = 2 · n2∥C ∥2 · n2∥C ∥2. Thus,
n4 X¨|Z Y|Z n4 X¨|Z F Y|Z F
Var(Tˆ |D)=2·∥C ∥2 ·∥C ∥2. Proofends.
CI X¨|Z F Y|Z F
A4.4 PROOFOFTHEOREM6
Proof: According to the above-mentioned formulations, we have M˜ X ≜ HM XH = µ˜ˆ X|℧ ·
µ˜ˆT X|℧, µ˜ˆ X|℧ ≜ H ·µˆ X|℧. Basedontherulesofestimatingcovariancematrixfromkernelmatrix
inLemma6,wehave
tr(M˜ X)=tr(µ˜ˆ X|℧·µ˜ˆT X|℧)
=tr(µ˜ˆT X|℧·µ˜ˆ X|℧) (35)
=tr((Hϕ(℧)(C℧℧+γI)−1C℧X)T(Hϕ(℧)(C℧℧+γI)−1C℧X)) (36)
=tr(C X℧(C℧℧+γI)−1ϕ(℧)TH ·Hϕ(℧)(C℧℧+γI)−1C℧X))
1
= ntr(C X℧(C℧℧+γI)−1C℧℧(C℧℧+γI)−1C℧X) (37)
1
= tr(C∗). (38)
n X
Eq. 35isobtainedduetothetracepropertyoftheproductofthematrices, asshowninLemma6.
Eq. 36issubstitutingfromEq. 20. HereweuseEq. 38forsimplenotation. Wecanseethatitcan
berepresentedwithsomecombinationsofdifferentcovariancematrices. Similarly,wehave
1 1
tr(M˜ Y)= ntr(C Y℧(C℧℧+γI)−1C℧℧(C℧℧+γI)−1C℧Y)= ntr(C Y∗). (39)
RegardingthecentralizedGrammatricesforjointdistribution,similarlywehave
1 1
tr(M˜ YX)= ntr(C (Y,X),℧(C℧℧+γI)−1C℧℧(C℧℧+γI)−1C℧,(Y,X))= ntr(C Y∗ ˜),
(40)
1 1
tr(M˜ XY)= ntr(C (X,Y),℧(C℧℧+γI)−1C℧℧(C℧℧+γI)−1C℧,(X,Y))= ntr(C X∗ ˜),
wheretr(M˜ )=tr(M˜ ). Furthermore,basedonLemma6andEq. 22,wehave
YX XY
tr(M˜ XM˜ YX)=tr(µ˜ˆ X|℧µ˜ˆT X|℧·µ˜ˆ YX|℧µ˜ˆT YX|℧)
=tr(µ˜ˆT X|℧µ˜ˆ YX|℧µ˜ˆT YX|℧·µ˜ˆ X|℧) (41)
=∥µ˜ˆT X|℧µ˜ˆ YX|℧∥2
F
=∥(Hϕ(℧)(C℧℧+γI)−1C℧X)T(Hϕ(℧)(C℧℧+γI)−1C℧,(Y,X))∥2
F
(42)
=∥C X℧(C℧℧+γI)−1ϕ(℧)TH ·Hϕ(℧)(C℧℧+γI)−1C℧,(Y,X)∥2
F
1
=∥ nC X℧(C℧℧+γI)−1C℧℧(C℧℧+γI)−1C℧,(Y,X)∥2
F
(43)
1
= ∥C∗ ∥2. (44)
n2 X,Y˜ F
Eq. 41isobtainedduetothetracepropertyoftheproductofthematrices, asshowninLemma6.
Eq. 41issubstitutingfromEq. 20andEq. 22. HereweuseEq. 44forsimplenotation. Wecansee
that it can be represented with some combinations of different covariance matrices. Similarly, we
have
1
tr(M˜ YM˜ XY)=∥ nC Y℧(C℧℧+γI)−1C℧℧(C℧℧+γI)−1C℧,(X,Y)∥2
F
(45)
1
= ∥C∗ ∥2.
n2 Y,X˜ F
22PublishedasaconferencepaperatICLR2024
SubstitutingtheequationsaboveintoEq. 19,wehave
∥C∗ ∥2 ∥C∗ ∥2
△ˆ = X,Y˜ F , △ˆ = Y,X˜ F . (46)
X→Y tr(C∗)·tr(C∗) Y→X tr(C∗)·tr(C∗)
X Y˜ Y X˜
Proofends.
A4.5 PROOFOFLEMMA7
Proof: Firstofall, weincorporaterandomFourierfeaturestoapproximatethekernels, because
theyhaveshowncompetitiveperformancestoapproximatethecontinuousshift-invariantkernels.
Lemma 13 (Random Features (Rahimi & Recht, 2007)). For a continuous shift-invariant kernel
K(x,y)onR,wehave:
(cid:90)
K(x,y)= p(w)ejw(x−y)dw =E [ζ (x)ζ (y)], (47)
w w w
R
whereζ (x)ζ (y)isanunbiasedestimateofK(x,y)whenwisdrawnfromp(w).
w w
Sinceboththeprobabilitydistributionp(w)andthekernelentryK(x,y)arereal,theintegralinEq.
47 converges when the complex exponentials are replaced with cosines. Therefore, we may get a
real-valuesmappingby:
K(x,y)≈ϕ (x)Tϕ (y),
w w
(cid:114)
2
ϕ (x)≜ [cos(w x+b ),...,cos(w x+b )]T,
w h 1 1 h h (48)
(cid:114)
2
ϕ (y)≜ [cos(w y+b ),...,cos(w y+b )]T,
w h 1 1 h h
wherewisdrawnfromp(w)andbisdrawnuniformlyfrom[0,2π]. x,y,w,b∈R,andtherandom-
izedfeaturemapϕ : R → Rh. Thepreciseformofp(w)reliesonthetypeoftheshift-invariant
w
kernelwewouldliketoapproximate. Hereinthispaper,wechoosetoapproximateGaussiankernel
as one of the characteristic kernels, and thus set the probability distribution p(w) to the Gaussian
one. BasedonEq. 48,wehave
tr(K˜ )≈tr(ϕ˜ (x)ϕ˜ (y)T), (49)
x,y w w
wherex,y∈Rn,K˜ ∈Rn×n,ϕ˜ (x)∈Rn×h isthecentralizedrandomfeature,ϕ˜ (x)=Hϕ (x).
x,y w w w
Furthermore,benefitingfromthecommutativepropertyofthetraceoftheproductoftwomatrices,
wehave
tr(ϕ˜ (x)ϕ˜ (y)T)=tr(ϕ˜ (y)Tϕ˜ (x)), (50)
w w w w
Since each random feature is centralized, meaning the zero mean for each feature, therefore, we
have:
1 1
tr(ϕ˜ (y)Tϕ˜ (x))=tr( C )= tr(C ), (51)
w w n x,y n x,y
whereC isthecovariancematrixforvariablexandy,C ∈ Rh×h,histhenumberofhidden
x,y x,y
features.
Forthesecondformulation,wehave
tr(K˜ K˜ )=tr[ϕ˜ (x)ϕ˜ (x)Tϕ˜ (y)ϕ˜ (y)T]
x y w w w w
=tr[ϕ˜ (x)(ϕ˜ (x)Tϕ˜ (y)ϕ˜ (y)T)]
w w w w
=tr[(ϕ˜ (x)Tϕ˜ (y)ϕ˜ (y)T)ϕ˜ (x)]
w w w w
=tr[ϕ˜ (x)Tϕ˜ (y)ϕ˜ (y)Tϕ˜ (x)] (52)
w w w w
=∥ϕ˜ (x)Tϕ˜ (y)∥2
w w F
=∥nC ∥2
x,y F
=n2∥C ∥2.
x,y F
23PublishedasaconferencepaperatICLR2024
TogetherwithEq. 49,Eq. 50,Eq. 51andEq. 52formulatedabove,wecouldprovetheLemma7in
themainpaper. Proofends.
A4.6 PROOFOFTHEOREM8
Proof. Thesummarystatisticscontaintwoparts: totalsamplesizenandcovariancetensorC ∈
T
Rd′×d′×h×h. Let Cij ∈ Rh×h be the (i,j)-th entry of the covariance tensor, which denotes the
T
covariancematrixofthei-thandthej-thvariable.
With the summary statistics as a proxy, we can substitute the raw data at each client. During the
procedures of causal discovery, the needed statistics include T in Theorem 4, E(Tˆ |D) and
CI CI
Var(Tˆ |D)inTheorem5,and△ˆ and△ˆ inTheorem6.
CI X→Y Y→X
1)BasedontheEq. (7)inthemainpaper,wehave
C =C −C (C +γI)−1C
X¨Y|Z X¨Y X¨Z ZZ ZY
=C −C (C +γI)−1C (53)
(X,Z),Y (X,Z),Z ZZ ZY
=(C +C )−(C +C )(C +γI)−1C
XY ZY XZ ZZ ZZ ZY
Inthispaper,weconsiderthescenarioswhereX andY aresinglevariables,andZ maybeasingle
variable,asetofvariables,orempty. AssumingthatZ containsLvariables. Wehave
L L L L
(cid:88) (cid:88) (cid:88)(cid:88)
C = C , C = C , C = C , (54)
ZY ZiY XZ XZi ZZ ZiZj
i=1 i=1 i=1j=1
whereC ,C ,C ,andC aretheentriesofthecovariancetensorC . AccordingtoTheo-
XY ZiY XZi ZiZj T
rem3,T ≜n∥C ∥2. Therefore,thesummarystatisticsaresufficienttorepresentT .
CI X¨Y|Z F CI
2)SimilartoEq. 53,wehave
C =(C +2C +C )(C +C )(C +γI)−1(C +C ) (55)
X¨|Z XX XZ ZZ XZ ZZ ZZ XZ ZZ
C =C −C (C +γI)−1C . (56)
Y|Z YY YZ ZZ ZY
Substituting Eq. 54 into Eq. 55 and Eq. 56, we can also conclude that the covariance tensor
is sufficient to represent C and C . In other words, the summary statistics are sufficient to
X¨|Z Y|Z
representE(Tˆ |D)andVar(Tˆ |D).
CI CI
3)AsshowninsectionA4.3,wehave
∥C∗ ∥2 ∥C∗ ∥2
△ˆ = X,Y˜ F , △ˆ = Y,X˜ F , (57)
X→Y tr(C∗)·tr(C∗) Y→X tr(C∗)·tr(C∗)
X Y˜ Y X˜
whereeachcomponentscanberepresentedassomecombinationsofcovariancematrices,asshown
inEq. 37, Eq. 39, Eq. 40, Eq. 43, andEq. 45. Therefore, thesummarystatisticsaresufficientto
represent△ˆ and△ˆ .
X→Y Y→X
4) To sum up, we could conclude that: The summary statistics, consisting of total sample size n
and covariance tensor C , are sufficient to represent all the statistics needed for federated causal
T
discovery.
Proofends.
A5 DETAILS ABOUT FEDERATED UNCONDITIONAL INDEPENDENCE TEST
Here, weprovidemoredetailsaboutthefederatedunconditionalindependencetest(FUIT),where
the conditioning set Z is empty. Generally, this method follows similar theorems for federated
conditionalindependenttest(FCIT).
24PublishedasaconferencepaperatICLR2024
A5.1 NULLHYPOTHESIS
Considerthenullandalternativehypothesis
H :X ⊥⊥Y, H :X⊥̸⊥Y. (58)
0 1
SimilartoFCIT,weconsiderthesquaredFrobeniusnormoftheempiricalcovariancematrixasan
approximation,givenas
H :∥C ∥2 =0, H :∥C ∥2 >0. (59)
0 X¨Y F 1 X¨Y F
In this unconditional case, we set the test statistics as T ≜ n∥C ∥2, and give the following
UI X¨Y F
theorem.
Theorem14(FederatedUnconditionalIndependentTest). UnderthenullhypothesisH (X andY
0
areindependent),theteststatistic
T ≜n∥C ∥2, (60)
UI XY F
hastheasymptoticdistribution
L
Tˆ ≜ 1 (cid:88) λ λ α2 ,
UI n2 X,i Y,j ij
i,j=1
whereλ andλ aretheeigenvaluesofK˜ andK˜ ,respectively. Here,theproofissimilartothe
X Y X Y
proofofTheorem3,thuswereferthereaderstosectionA4.2formoredetails.
A5.2 NULLDISTRIBUTIONAPPROXIMATION
Wealsoapproximatethenulldistributionwithatwo-parameterGammadistribution,whichisrelated
tothemeanandvariance. UnderthehypothesisH andgiventhesampleD,thedistributionofTˆ
0 CI
canbeapproximatedbytheΓ(κ,θ)distribution. Hereweprovidethetheoremfornulldistribution
approximation.
Theorem15(NullDistributionApproximation). UnderthenullhypothesisH (X andY areinde-
0
pendent),wehave
E(Tˆ |D)=tr(C )·tr(C ),
UI X Y
(61)
Var(Tˆ |D)=2∥C ∥2 ·∥C ∥2,
UI X F Y F
Here, the proof is similar to the proof of Theorem 4, thus we refer the readers to section A4.3 for
moredetails.
A6 DETAILS ABOUT SKELETON DISCOVERY AND DIRECTION
DETERMINATION
In this section, we will introduce how we do the skeleton discovery and direction determination
duringtheprocessoffederatedcausaldiscovery. Allthosestepsareconductedontheserverside.
Ourstepsaresimilartothepreviousmethod, suchasCD-NOD(Huangetal.,2020), thecoredif-
ferencearethatwedevelopandutilizeourproposedfederatedconditionalindependenttest(FCIT)
andfederatedindependentchangeprinciple(FICP).
A6.1 SKELETONDISCOVERY.
Wefirstconductskeletondiscoveryontheaugmentedgraph. Theextrasurrogatevariableisintro-
ducedinordertodealwiththedataheterogeneityacrossdifferentclients.
Lemma16. GiventheAssumptions1,2and3inthemainpaper,foreachV ∈V,V and℧arenot
i i
adjacentinthegraphifandonlyiftheyareindependentconditionalonsomesubsetof{V |j ̸=i}.
j
25PublishedasaconferencepaperatICLR2024
Proof. IfV ’scausalmoduleisinvariant,whichmeansthatP(V |PA )remainsthesameforevery
i i i
valueof℧,thenV ⊥⊥ ℧|PA . Thus,ifV and℧arenotindependentconditionalonanysubsetof
i i i
other variables, V ’s module changes with ℧, which is represented by an edge between V and ℧.
i i
Conversely,weassumethatifV ’smodulechanges,whichentailsthatV and℧arenotindependent
i i
givenPA ,thenV and℧arenotindependentgivenanyothersubsetofV\{V }. Proofends.
i i i
Lemma17. GiventheAssumptions1,2and3inthemainpaper,foreveryV ,V ∈ V,V andV
i j i j
are not adjacent if and only if they are independent conditional on some subset of {V |l ̸= i,l ̸=
l
j}∪{℧}.
Proof. The ”if” direction shown based on the faithfulness assumption on G and the fact that
aug
{ψ (℧)}L ∪{θ (℧)}d is a deterministic function of ℧. The ”only if” direction is proven by
l l=1 i i=1
making use of the weak union property of conditional independence repeatedly, the fact that all
{ψ (℧)}L and{θ (℧)}d aredeterministicfunctionof℧, theabovethreeassumptions, andthe
l l=1 i i=1
propertiesofmutualinformation. Pleasereferto(Zhangetal.,2015)formorecompleteproof.
Withthegiventhreeassumptionsinthemainpaper,wecandoskeletondiscovery.
i) Augmentedgraphinitialization. Firstofall, buildacompletelyundirectedgraphonthe
extendedvariablesetV ∪{℧},whereV denotestheobservedvariablesand℧issurrogate
variable.
ii) Changing module detection. For each edge ℧−V , conduct the federated conditional
i
independence test or federated unconditional independent test. If they are conditionally
independentorindependent,removetheedgebetweenthem. Otherwise,keeptheedgeand
orient℧→V .
i
iii) Skeletondiscovery. Moreover,foreachedgeV −V ,alsoconductthefederatedindepen-
i j
dencetest orfederatedunconditionalindependent test. If theyareconditionally indepen-
dentorindependent,removetheedgebetweenthem.
Intheprocedures,howobservedvariablesdependonsurrogatevariable℧isunknownandusually
nonlinear,thusitiscrucialtouseageneralandnon-parametricconditionalindependenttestmethod,
whichshouldalsosatisfythefederatedlearningconstraints. Here,weutilizeourproposedFCIT.
A6.2 DIRECTIONDETERMINATION.
Afterobtainingtheskeleton,wecangoonwiththecausaldirectiondetermination. Byintroducing
thesurrogatevariable℧,itdoesnotonlyallowustoinfertheskeleton,butalsofacilitatethedirection
determinations. ForeachvariableV whosecausalmoduleischanging(i.e.,℧−V ),insomeways
i i
wemightdeterminethedirectionsofeveryedgeincidenttoV . AssumeanothervariableV which
i j
isadjacenttoV ,thenwecandeterminethedirectionsviathefollowingrules.
i
i) Direction determination with one changing module. When V ’s causal module is not
j
changing, wecansee℧−V −V formsanunshieldedtriple. Forpracticepurposes, we
i j
cantakethedirectionbetween℧andV as℧→V ,sincewelet℧bethesurrogatevariable
i i
to indicate whether this causal module is changing or not. Then we can use the standard
orientationrules(Spirtesetal.,2000)forunshieldedtriplestoorienttheedgebetweenV
i
andV . (1)If℧andV areindependentconditionalonsomesubsetof{V |l̸=j}whichis
j i l
excludingV ,thenthetripleformsaV-structure,thuswehave℧→V ←V . (2)If℧and
j i j
V areindependentconditionalonsomesubsetof{V |l̸=i}∪{V }whichisincludingV ,
i l j j
thenwehave℧→V →V . Intheprocedure,weapplyourproposedFCIT.
i j
ii) Directiondeterminationwithtwochangingmodules. WhenV ’scausalmoduleischang-
j
ing,wecanseethereisaspecialconfounder℧betweenV −V . Firstofall,asmentioned
i j
above, we can still orient ℧ → V and ℧ → V . Then, inspired by that P(cause) and
i j
P(effect|cause) change independently, we can identify the direction between V and V
i j
accordingtoLemma1,andweapplyourproposedFICP.
26PublishedasaconferencepaperatICLR2024
(a) PrecisionandrecallonlinearGaussianmodel.
(b) Precisionandrecallongeneralfunctionalmodel.
FigureA2: Resultsofthesyntheticdataseton(a)linearGaussianmodeland(b)generalfunctional
model. Byrowsineachsubfigure, weevaluatevaryingnumberofvariablesd, varyingnumberof
clientsK,andvaryingnumberofsamplesn . Bycolumnsineachsubfigure,weevaluateSkeleton
k
Precision(↑),SkeletonRecall(↑),DirectionPrecision(↑)andDirectionRecall(↑).
27PublishedasaconferencepaperatICLR2024
A7 DETAILS ABOUT THE EXPERIMENTS ON SYNTHETIC DATASETS
Moredetailsaboutthesyntheticdatasetsareexplainedinthissection,includingtheimplementation
detailsinsectionA7.1,theresultsanalysisofF andSHDinsectionA7.2,thecompleteresultsof
1
precisionandrecallinsectionA7.3,thecomputationaltimeanalysisinsectionA7.4,thehyperpa-
rameterstudyonthenumberofhiddenfeatureshinsectionA7.5,thestatisticalsignificancetestfor
theresultsinsectionA7.6,andtheevaluationondensegraphinsectionA7.7.
A7.1 IMPLEMENTATIONDETAILS
Weprovidetheimplementationdetailsofourmethodandotherbaselinemethods.
• FedDAG(Gaoetal.,2022):Codesareavailableattheauthor’sGithubrepositoryhttps:
//github.com/ErdunGAO/FedDAG. Thehyperparametersaresetbydefault.
• NOTEARS-ADMM and NOTEARS-MLP-ADMM (Ng & Zhang, 2022): Codes are
available at the author’s Github repository https://github.com/ignavierng/
notears-admm. Thehyperparametersaresetbydefault,e.g.,wesetthethresholdlevel
to0.1forpost-processing.
• FedPC (Huang et al., 2022): Although there is no public implementation provided by
the author, considering that it is the only constraint-based method among all the existing
worksforfederatedcausaldiscovery,westillcomparedwithit. Wereproduceditbasedon
the Causal-learn package https://github.com/py-why/causal-learn. Im-
portantly,wefollowthepaper,setthevotingrateas30%andsetthesignificancelevelto
0.05.
• FedCDH(Ours): Our method is developed based on the CD-NOD (Huang et al., 2020)
and KCI (Zhang et al., 2012) which are publicly available in the Causal-learn package
https://github.com/py-why/causal-learn. Wesetthehyperparameterhto
5, andsetthesignificancelevelforFCITto0.05. Oursourcecodehasbeenappendedin
theSupplementaryMaterials.
For NOTEARS-ADMM, NOTEARS-MLP-ADMM, and FedDAG, the output is a directed acyclic
graph (DAG), while FedPC and our FedCDH may output a completed partially directed acyclic
graph (CPDAG). To ease comparisons, we use the simple orientation rules (Dor & Tarsi, 1992)
implementedbyCausal-DAG(ChandlerSquires,2018)toconvertaCPDAGintoaDAG.Weeval-
uateboththeundirectedskeletonandthedirectedgraph,denotedby“Skeleton”and“Direction”as
shownintheFigures.
A7.2 ANALYSISOFF
1
ANDSHD
WehaveprovidedtheresultsofF andSHDinthemainpaperasshowninFigure3andFigureA3,
1
hereweprovidefurtherdiscussionsandanalysis.
The results of linear Gaussian model are given in Figure 3 and those of general functional model
areprovidedinFigureA3. Accordingtotheresults,weobservethatourFedCDHmethodgenerally
outperformsallotherbaselinesacrossdifferentcriteriaandsettings. Accordingtotheresultsofour
methodonbothofthetwomodels,whendincreases,theF scoredecreasesandtheSHDincreases
1
for skeletons and directions, indicating that FCD with more variables might be more challenging.
Onthecontrary,whenK andn increase,theF scoregrowsandtheSHDreduces,suggestingthat
k 1
morejointclientsorsamplescouldcontributetobetterperformancesforFCD.
InlinearGaussianmodel,NOTEARS-ADMMandFedPCgenerallyoutperformFedDAG.Therea-
son may be that the front two methods were proposed for linear model while the latter one was
speciallyproposedfornonlinearmodel. Ingeneralfunctionalmodel,FedPCobtainedtheworstper-
formancecomparedtoothermethodsindirectionF score,possiblyduetoitsstrongassumptionson
1
linearmodelandhomogeneousdata. FedDAGandNOTEARS-MLP-ADMMrevealedpoorresults
regardingSHD,thereasonsmaybetwo-fold: theyassumenonlinearidentifiablemodel,whichmay
notwellhandlethegeneralfunctionalmodel;andbothofthemarecontinuous-optimization-based
methods,whichmightsufferfromvariousissuessuchasconvergenceandnonconvexity.
28PublishedasaconferencepaperatICLR2024
Figure A3: Results of synthetic dataset on general functional model. By rows, we evaluate vary-
ing number of variables d, varying number of clients K, and varying number of samples n . By
k
columns,weevaluateSkeletonF (↑),SkeletonSHD(↓),DirectionF (↑)andDirectionSHD(↓).
1 1
A7.3 RESULTSOFPRECISIONANDRECALL
Inthemainpaper, wehaveonlyprovidedtheresultsofF scoreandSHD,duetothespacelimit.
1
Here, we provide more results and analysis of the precision and the recall. The results of average
andstandarddeviationareexhibitedinFigureA2. Accordingtotheresults,wecouldobservethat
ourFedCDHmethodgenerallyoutperformedallotherbaselinemethods,regardingtheprecisionof
bothskeletonanddirection.
Moreover, in the linear Gaussian model, NOTEARS-ADMM generally achieved the best perfor-
mance regarding the recall although it performed poorly in precision, the reason might be that
NOTEARS-ADMM assumed homogeneous data distribution, which might face challenges in the
scenarioswithheterogeneousdata. Inthegeneralfunctionalmodel,whenevaluatingvaryingnum-
bersofclientsK andsamplesn ,FedDAGperformedthebestwithrespecttotherecall,however,
k
neitherFedDAGnorNOTEARS-MLP-ADMMobtainedsatisfactoryresultsintheprecision,therea-
sonmightbethatbothofthemarecontinuous-optimization-basedmethods,whichmightpotentially
sufferfromvariousissuessuchasconvergenceandnonconvexity.
A7.4 RESULTSOFCOMPUTATIONALTIME
Existingworksaboutfederatedcausaldiscoveryrarelyevaluatethecomputationaltimewhencon-
ductingexperiments. Actually,itisusuallydifficulttomeasuretheexactcomputationaltimeinreal
life,becauseofsomefacts,suchastheparalleledcomputationforclients,thecommunicationtime
costs between the clients and the server, and so on. However, the computational time is a signif-
icant factor to measure the effectiveness of a federated causal discovery method to be utilized in
practical scenarios. Therefore, in this section, for making fair comparisons, we evaluate the com-
putationaltimeforeachmethod,assumingthatthereisnoparalleledcomputation(meaningthatwe
recordthecomputationaltimeateachclientandserverandthensimplyaddthemup)andnoextra
communicationcost(indicatingzerotimecostforcommunication).
Weevaluatedifferentsettingsasmentionedabove,includingvaryingnumberofvariablesd,varying
number of clients K, and varying number of samples n . We generate data according to linear
k
29PublishedasaconferencepaperatICLR2024
Table A2: Results of computational time for varying number of variables d, varying number of
clientsK,andvaryingnumberofsamplesn . Wereporttheaverageandstandarddeviationover10
k
runs. ThisisthesyntheticdatasetbasedonlinearGaussianmodel.
DataSizes Methods
d K n FedPC NOTEARS-ADMM FedDAG FedCDH(Ours)
k
6 3.87±1.97s 14.10±1.89s 136.92±21.50s 8.14±2.47s
12 32.01±3.54s 28.33±2.46s 321.84±65.94s 62.69±7.77s
18 10 100 39.58±4.75s 35.13±2.89s 398.27±149.51s 98.57±9.23s
24 84.05±7.64s 40.01±2.94s 715.80±268.93s 172.11±18.18s
30 94.03±9.48s 56.35±3.91s 1441.13±519.04s 232.35±26.67s
2 0.72±0.24s 7.04±0.64s 50.38±11.29s 3.88±1.49s
4 2.07±0.73s 9.07±0.77s 85.08±15.68s 5.24±1.74s
6 8 100 3.64±1.54s 10.80±0.78s 114.81±29.67s 8.01±2.32s
16 5.79±2.59s 19.40±2.51s 342.34±62.28s 12.60±2.98s
32 14.08±4.44s 30.56±2.88s 714.06±137.31s 20.30±4.37s
25 0.48±0.10s 13.06±1.91s 125.77±20.64s 3.75±1.29s
50 1.47±0.64s 13.75±2.51s 127.25±20.38s 5.74±1.61s
6 10 100 3.87±1.97s 14.10±1.89s 136.92±21.50s 8.14±2.47s
200 16.52±3.63s 14.68±2.23s 138.67±31.91s 13.78±3.75s
400 51.10±6.87s 15.90±2.54s 140.37±34.42s 22.86±4.55s
Gaussianmodel.Foreachsetting,werun10instances,reporttheaverageandthestandarddeviation
ofthecomputationaltime. TheresultsareexhibitedinTableA2.
Accordingtotheresults,wecouldobservethatamongthefourFCDmethods,FedDAGistheleast
efficient method with the largest time cost, because it uses a two-level structure to handle the het-
erogeneousdata: thefirstlevellearnstheedgesanddirectionsofthegraphandcommunicateswith
theservertogetthemodelinformationfromotherclients,whilethesecondlevelapproximatesthe
mechanismamongvariablesandpersonallyupdatesonitsowndatatoaccommodatethedatahetero-
geneity. Meanwhile, FedPC,NOTEARS-ADMMandourFedCDHarecomparable. Inthesetting
of varying variables, our method exhibited unsatisfactory performance among the three methods,
becausetheothertwomethods,FedPCandNOTEARS-ADMM,aremainlyforhomogeneousdata.
However, inthecaseofvaryingvariables, NOTEARS-ADMMisthemostineffectivemethod, be-
causewiththeincreasingofclients,moreparameters(oneclientcorrespondstoonesubadjacency
matrix which needs to be updated) should get involved in the optimization process, therefore, the
totalprocessingtimecanalsoincreasebyalargemargin. Inthescenarioofvaryingsamples,FedPC
istheslowestoneamongthethreemethods.
A7.5 HYPERPARAMETERSTUDY
Weconductexperimentsonthehyperparameter,suchasthenumberofmappingfunctionsorhidden
featuresh. Regardingtheexperimentsinthemainpaper,wesethto5bydefault. Hereinthissec-
tion,weseth ∈ {5,10,15,20,25,30},d = 6,K = 10,n = 100andevaluatetheperformances.
k
WegeneratedataaccordingtolinearGaussianmodel. WeusetheF score,theprecision,therecall
1
andtheSHDforbothskeletonanddirection. Wealsoreporttheruntime. Werun10instancesand
reporttheaveragevalues. TheexperimentalresultsaregiveninTableA3.
Accordingtotheresults,wecouldobservethatwiththenumberofhiddenfeatureshincreasing,the
performanceofthedirectionisobviouslygettingbetter,whiletheperformanceoftheskeletonmay
fluctuatealittlebit.
Theoretically, the more hidden features or a larger h we consider, the better performance of how
closelytherandomfeaturesapproximatethekernelsshouldbe.Whenthenumberofhiddenfeatures
approaches infinity, the performance of random features and that of kernels should be almost the
same. Andtheempiricalresultsseemtobeconsistentwiththetheory,wherealargehcanleadtoa
higherF scoreandprecisionforthedirectedgraph.
1
30PublishedasaconferencepaperatICLR2024
Table A3: Hyperparameter study on the number of hidden features h. We evaluate the F score,
1
precision,recall,andSHDofbothskeletonanddirection. Wereporttheaverageover10runs. This
isthesyntheticdatasetbasedonlinearGaussianmodel.
Metrics Skeleton Direction
Time↓
h F 1↑ Precision↑ Recall↑ SHD↓ F 1↑ Precision↑ Recall↑ SHD↓
5 0.916 0.980 0.867 0.9 0.721 0.765 0.683 2.0 8.14s
10 0.916 0.980 0.867 0.9 0.747 0.810 0.700 2.0 8.87s
15 0.907 0.980 0.850 1.0 0.762 0.818 0.717 1.8 10.57s
20 0.889 0.980 0.833 1.2 0.767 0.833 0.717 1.8 12.72s
25 0.896 0.980 0.833 1.1 0.789 0.838 0.750 1.6 20.93s
30 0.896 0.980 0.833 1.1 0.825 0.873 0.783 1.4 37.60s
TableA4: TestresultofstatisticalsignificanceofourFedCDHmethodcomparedwithotherbase-
line methods. We report the p values via Wilcoxon signed-rank test (Woolson, 2007). This is the
syntheticdatasetbasedonlinearGaussianmodel.
Parameters [FedCDHvs.FedPC] [FedCDHvs.NOTEARS-ADMM] [FedCDHvs.FedDAG]
d k n S-F1 S-SHD D-F1 D-SHD S-F1 S-SHD D-F1 D-SHD S-F1 S-SHD D-F1 D-SHD
6 10 100 0.00 0.05 0.01 0.12 0.00 0.01 0.11 0.10 0.00 0.01 0.01 0.01
12 10 100 0.00 0.01 0.01 0.01 0.00 0.00 0.15 0.00 0.00 0.00 0.11 0.00
18 10 100 0.00 0.01 0.00 0.01 0.00 0.00 0.03 0.00 0.00 0.00 0.02 0.00
24 10 100 0.01 0.01 0.00 0.01 0.00 0.00 0.01 0.00 0.01 0.01 0.01 0.00
30 10 100 0.00 0.01 0.00 0.01 0.00 0.00 0.01 0.00 0.00 0.00 0.00 0.00
6 2 100 0.00 0.00 0.01 0.01 0.01 0.00 0.21 0.01 0.00 0.00 0.03 0.00
6 4 100 0.00 0.01 0.00 0.01 0.01 0.01 0.01 0.00 0.00 0.01 0.01 0.00
6 8 100 0.00 0.00 0.01 0.02 0.02 0.01 0.03 0.02 0.00 0.00 0.09 0.00
6 16 100 0.00 0.01 0.01 0.02 0.00 0.00 0.10 0.03 0.00 0.00 0.07 0.00
6 32 100 0.00 0.00 0.00 0.00 0.00 0.00 0.04 0.01 0.00 0.00 0.03 0.00
6 10 25 0.00 0.00 0.01 0.01 0.01 0.01 0.26 0.02 0.00 0.00 0.03 0.00
6 10 50 0.00 0.01 0.01 0.00 0.01 0.00 0.99 0.03 0.00 0.00 0.02 0.00
6 10 200 0.00 0.01 0.01 0.02 0.00 0.00 0.03 0.02 0.00 0.00 0.11 0.01
6 10 400 0.00 0.01 0.01 0.01 0.01 0.00 0.03 0.01 0.00 0.01 0.01 0.00
Moreover, the computational time is also increasing. When h is smaller than 20, the runtime in-
creasessteadily. Whenhisgreaterthan20,theruntimegoesuprapidly. Importantly,wecouldsee
thatevenwhenhissmall,suchash=5,thegeneralperformanceofourmethodisstillrobustand
competitive.
A7.6 STATISTICALSIGNIFICANCETEST
Inordertoshowthestatisticalsignificanceofourmethodcomparedwithotherbaselinemethodson
thesyntheticlinearGaussianmodel,wereportthepvaluesviaWilcoxonsigned-ranktest(Woolson,
2007),asshowninTableA4. Foreachbaselinemethod,weevaluatefourcriteria: SkeletonF1(S-
F1),SkeletonSHD(S-SHD),DirectionF1(D-F1),andDirectionSHD(D-SHD).
Wesetthesignificancelevelto0.05. Thosepvalueshigherthan0.05areunderlined. Fromthere-
sults,wecanseethattheimprovementsofourmethodarestatisticallysignificantat5%significance
levelingeneral.
A7.7 EVALUATIONONDENSEGRAPH
AsshowninFigure3inthemainpaper,thetrueDAGsaresimulatedusingtheErdo¨s–Re´nyimodel
(Erdo˝setal.,1960)withthenumberofedgesequaltothenumberofvariables. Hereweconsidera
moredensegraphwiththenumberofedgesaretwotimesthenumberofvariables.
we evaluate on synthetic linear Gaussian model and general functional model, and record the F
1
scoreandSHDforbothskeletonanddirectedgraphs. Allothersettingsarefollowingtheprevious
onesbydefault.
31PublishedasaconferencepaperatICLR2024
FigureA4:WeevaluateonsyntheticlinearGaussianmodel(TopRow)andgeneralfunctionalmodel
(BottomRow)whenthenumberofedgesaretwotimesthenumberofvariables. Bycolumns, we
evaluateSkeletonF (↑),SkeletonSHD(↓),DirectionF (↑)andDirectionSHD(↓).
1 1
AccordingtotheresultsasshowninFigureA4,wecanseethatourmethodsstilloutperformedother
baselinesinvaryingnumberofvariables. Interestingly,whenthegeneratedgraphismoredense,the
performanceofFedPCwillobviouslygodownforvariousnumberofvariables.
A7.8 EVALUATIONONTHEPOWEROFCONDITIONALINDEPENDENCETEST
Hereweaddedanewsetofexperimentstocomparethepowerofourproposedfederatedconditional
independencetestandthecentralizedconditionalindependencetest(i.e., kernel-basedconditional
independencetest(Zhangetal.,2012)).
We followed the previous paper (Zhang et al., 2012) and used the post-nonlinear model (Zhang
& Hyvarinen, 2012) to generate data. Assume there are four variables W,X,Y, and Z. X =
gˆ(fˆ(W) + ϵ ), Y = gˆ(fˆ(W) + ϵ ), and Z is independent from both X and Y. fˆand gˆ are
X Y
functionsrandomlychosenfromlinear,square,sinandtanfunctions.ϵ ,ϵ ,W andZaresampled
X Y
from either uniform distribution U(−0.5,0.5) or Gaussian distribution N(0,1). ϵ and ϵ are
X Y
randomnoises. Inthiscase,XandYaredependentduetothesharedcomponentofW. SinceZ is
independentfrombothX andY,therefore,wehaveX⊥̸⊥ Y|Z. Herewesetthesignificancelevel
to0.05,andthetotalsamplesizevariesfrom200,400,600,800to1000. ForfederatedCIT,weset
thenumberofclientsto10,therefore,eachclienthas20,40,60,80,or100samples. Werun1000
simulations and record the power of the two tests. From the result in Figure A5, we can see that
the power of our federated CIT is almost similar to that of centralized CIT. Particularly, when the
samplesizereaches1000,bothofthetwotestsachievepowerwithmorethan95%.
A7.9 EVALUATIONONTHEORDEROFDOMAININDICES
In this section, we aim to find out whether the order of domain indices will impact the results.
Theoretically, there should be no impact on the results when it takes different values because this
domainindex℧isessentiallyadiscretevariable(morespecifically,acategoricalvariable,withno
numericalorderamongdifferentvalues),acommonapproachtodealwithsuchdiscretevariableis
tousedeltakernel(basedonKroneckerdeltafunction),andthereforeitisreasonabletouserandom
featurestoapproximatethedeltakernelfordiscretevariables.
Empirically, we have added one new set of experiments to evaluate whether the order of domain
indiceswillimpacttheresults. WehaveonesetofdomainindicesandrunourFedCDHonthesyn-
thetic linear Gaussian model with varying number variables d ∈ {6,12,18,24,30} while keeping
K = 10andn = 100,othersettingsarethesameasthoseinourmainpaper. Then,werandomly
k
shuffletheindicesfordifferentdomains,denotedby“FedCDH+Shuffle”.
32PublishedasaconferencepaperatICLR2024
1.0
0.8
0.6
0.4
0.2 Federated CIT
Centralized CIT
0.0
200 300 400 500 600 700 800 900 1000
Number of samples n
FigureA5: Comparisonregardingthepoweroftestbetweenfederateconditionalindependencetest
andthecentralizedconditionalindependencetest.
1.00 30 1.00 30
0.75 0.75
20 20 0.50 0.50
10 10
0.25 0.25
0.00 0 0.00 0
10 20 30 10 20 30 10 20 30 10 20 30
Number of variables d Number of variables d Number of variables d Number of variables d
FedCDH+Shuffle FedCDH
FigureA6: EvaluationontheorderofdomainindicesonlinearGaussianmodel. Weevaluatevary-
ingnumberofvariablesd. Bycolumns,weevaluateSkeletonF (↑),SkeletonSHD(↓),Direction
1
F (↑)andDirectionSHD(↓).
1
As shown in Figure A6, the results turned out that: the performances between the two sets of dif-
ferentdomainindicesarequitesimilar,andwemayconcludethatithasnoobviousimpactonthe
resultswhenthedomainindicestakedifferentvalues.
A8 DETAILS ABOUT THE EXPERIMENTS ON REAL-WORLD DATASET
A8.1 DETAILSABOUTFMRIHIPPOCAMPUSDATASET
WeevaluateourmethodandthebaselinesonfMRIHippocampus(Poldracketal.,2015).Thedirec-
tionsofanatomicalgroundtruthare: PHC→ERC,PRC→ERC,ERC→DG,DG→CA1,CA1
→Sub,Sub→ERCandERC→CA1. Generally,wefollowasimilarsettingastheexperimentson
syntheticdatasets. Foreachofthem,weusethestructuralHammingdistance(SHD),theF score
1
as evaluation criteria. We measure both the undirected skeleton and the directed graph. Here, we
considervaryingnumberofclientsK andvaryingnumberofsamplesineachclientn .
k
The results of F score and SHD is given in Figure A7. According to the results, we could ob-
1
serve that our FedCDH method generally outperformed all other baseline methods, across all the
criterialisted. Thereasoncouldbethatourmethodisspecificallydesignedforheterogeneousdata
whilesomebaselinemethodsassumehomogeneitylikeFedPCandNOTEARS-MLP-ADMM,fur-
thermore, ourmethodcanhandlearbitraryfunctionalcausalmodels, differentfromsomebaseline
methods that assume linearity such as FedPC. Compared with our method, FedDAG performed
muchworse,thereasonmightbeitsnatureofthecontinuousoptimization,whichmightsufferfrom
variousissuessuchasconvergenceandnonconvexity.
33
F
notelekS
1
rewoP
DHS
notelekS
F
noitceriD
1
DHS
noitceriDPublishedasaconferencepaperatICLR2024
Real data
FigureA7: Resultsofreal-worlddatasetfMRIHippocampus(Poldracketal.,2015). Byrows,we
evaluatevaryingnumberofclientsK andvaryingnumberofsamplesn . Bycolumns,weevaluate
k
SkeletonF (↑),SkeletonSHD(↓),DirectionF (↑)andDirectionSHD(↓).
1 1
15 15 0.6 0.6
10 10
0.4 5 0.4 5
0 0
2.5 5.0 7.5 10.0 2.5 5.0 7.5 10.0 2.5 5.0 7.5 10.0 2.5 5.0 7.5 10.0
Number of clients K Number of clients K Number of clients K Number of clients K
FedPC NOTEARS-MLP-ADMM FedDAG FedCDH
FigureA8:Resultsofreal-worlddatasetHKStockMarket(Huangetal.,2020).Weevaluatevarying
number of clients K, and we evaluate Skeleton F (↑), Skeleton SHD (↓), Direction F (↑) and
1 1
DirectionSHD(↓).
A8.2 DETAILSABOUTHKSTOCKMARKETDATASET
We also evaluate on HK stock market dataset (Huang et al., 2020) (See Page 41 for more details
about thedataset). The HKstock datasetcontains 10major stocks, which are dailyclosing prices
from 10/09/2006 to 08/09/2010. The 10 stocks are Cheung Kong Holdings (1), Wharf (Holdings)
Limited(2), HSBCHoldingsplc(3), HongKongElectricHoldingsLimited(4), HangSengBank
Ltd (5), Henderson Land Development Co. Limited (6), Sun Hung Kai Properties Limited (7),
Swire Group (8), Cathay Pacific Airways Ltd (9), and Bank of China Hong Kong (Holdings) Ltd
(10). Amongthesestocks,3,5,and10belongtoHangSengFinanceSub-index(HSF),1,8,and9
belong toHang SengCommerce andIndustry Sub-index(HSC), 2, 6, and7 belong toHang Seng
PropertiesSub-index(HSP),and4belongstoHangSengUtilitiesSub-index(HSU).
Hereonedaycanbealsoseenasonedomain. WesetthenumberofclientstobeK∈{2,4,6,8,10}
while randomly select n =100 samples for each client. All other settings are following previous
k
onesbydefault.TheresultsareprovidedinFigureA8.Accordingtotheresults,wecaninferthatour
FedCDHmethodalsooutperformedtheotherbaselinemethods,acrossthedifferentcriteria.Similar
totheanalysisabove,ourmethodistailoredforheterogeneousdata,incontrasttobaselinemethods
likeFedPCandNOTEARS-MLP-ADMM,whichassumehomogeneity. Additionally,ourapproach
is capable of handling arbitrary functional causal models, setting it apart from baseline methods
likeFedPCthatassumelinearity. Whencomparedtoourmethod,FedDAGexhibitedsignificantly
poorerperformance. Thiscouldbeattributedtoitsrelianceoncontinuousoptimization,whichmay
encounterchallengessuchasconvergenceandnonconvexity.
34
F
notelekS
1 DHS
notelekS
F
noitceriD
1 DHS
noitceriD