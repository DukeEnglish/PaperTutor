Driving Everywhere with Large Language Model Policy Adaptation
BoyiLi1 YueWang1,2 JiagengMao2 BorisIvanovic1 SushantVeer1 KarenLeung1,3 MarcoPavone1,4
1NVIDIA 2 UniversityofSouthernCalifornia 3 UniversityofWashington 4 StanfordUniversity
Abstract
Get Driver License from California
Adapting driving behavior to new environments, cus-
toms, and laws is a long-standing problem in autonomous
Autonomous
driving, precluding the widespread deployment of au-
Driving
tonomousvehicles(AVs). Inthispaper,wepresentLLaDA,
asimpleyetpowerfultoolthatenableshumandriversand
autonomousvehiclesaliketodriveeverywherebyadapting
their tasks and motion plans to traffic rules in new loca-
Drive Everywhere with Language Policy
tions. LLaDA achieves this by leveraging the impressive
zero-shotgeneralizabilityoflargelanguagemodels(LLMs)
Figure1. LLaDAenablesdriverstoobtaininstructionsinanyre-
ininterpretingthetrafficrulesinthelocaldriverhandbook.
gion all over the world. For instance, the driver gets a driver’s
Through an extensive user study, we show that LLaDA’s
licenseinCalifornia,USA,oursystemenablesprovidingprompt
instructionsareusefulindisambiguatingin-the-wildunex- instructionswhenthedriverdrivesindifferentregionswithdiffer-
pected situations. We also demonstrate LLaDA’s ability to entsituations.
adapt AV motion planning policies in real-world datasets;
LLaDA outperforms baseline planning approaches on all
our metrics. Please check our website for more details: a Large Language Driving Assistant (LLaDA) that can
llada. rapidly adapt to local traffic rules and customs (Figure 1).
Ourmethodconsistsofthreesteps:First,weleverageexist-
ingmethodstogenerateanexecutablepolicy;second,when
1.Introduction presented with an unexpected situation described in natu-
rallanguage(eitherbyahumanpromptoraVLMsuchas
Despite the rapid pace of progress in autonomous driving, GPT-4V[24]orLINGO-1[32]),weleverageaTrafficRule
autonomousvehicles(AVs)continuetooperateprimarilyin Extractor(TRE)toextractinformativetrafficrulesrelevant
geo-fencedareas.AkeyinhibitorforAVstobeabletodrive to the current scenario from the local traffic code; finally,
everywhereisthevariationintrafficrulesandnormsacross wepasstheTRE’soutputalongwiththeoriginalplantoa
different geographical regions. Traffic rule differences in pre-trained LLM (GPT-4V [24] in this paper) to adapt the
different geographic locations can range from significant plan accordingly. We test our method on the nuScenes [2]
(e.g.,left-handdrivingintheUKandright-handdrivingin datasetandachieveimprovementsinmotionplanningunder
theUS)tosubtle(e.g.,rightturnonredisacceptableinSan novelscenarios. Wealsoprovideextensiveablationstudies
Francisco but not in New York city). In fact, adapting to andvisualizationstofurtheranalyzeourmethod.
new driving rules and customs is difficult for humans and Contributions. Ourcorecontributionsarethree-fold:
AVs alike; failure to adapt to local driving norms can lead 1. WeproposeLLaDA,atraining-freemechanismtoassist
to unpredictable and unexpected behaviors which may re- humandriversandadaptautonomousdrivingpoliciesto
sult in unsafe situations [15, 35]. Studies have shown that newenvironmentsbydistillingleveragingthezero-shot
tourists are more susceptible to accidents [25, 26] that can generalizabilityofLLMs.
sometimes result in injury or death [28]. This calls for a 2. LLaDAcanbeimmediatelyappliedtoanyautonomous
completestudyofpolicyadaptionincurrentAVsystems. drivingstacktoimprovetheirperformanceinnewloca-
Atthesametime,LLMshaverecentlyemergedasfront- tionswithdifferenttrafficrules.
runners for zero- or few-shot adaptation to out-of-domain 3. Our method achieves performance improvements over
data in various fields, including vision and robotics [6, previousstate-of-the-arts,asverifiedbyuserstudiesand
16, 17]. Inspired by these works, our goal is to build experimentsonthenuScenesdataset.
4202
beF
8
]OR.sc[
1v23950.2042:viXra2.RelatedWorks lem. Mostrecently, MotionLM[27]representscontinuous
trajectoriesassequencesofdiscretemotiontokensandcasts
TrafficRulesinAVPlanning. Researchershaveexplored
multi-agentmotionpredictionasalanguagemodelingtask
thepossibilityofembeddingtrafficrulesintheformofmet-
overthisdomain. OurworkalsoleveragesLLMsforpolicy
ric temporal logic (MTL) formulae [19], linear temporal
adaption,however,wedonotfine-tuneortrainanewfoun-
logic(LTL)formulae[7,14,18],andsignaltemporallogic
dationmodel. Instead,ourmethodcapitalizesonGPT-4to
(STL) formulae [29, 33]. Expressing the entire traffic law
performdirectin-contextreasoning.
aslogicformulaeisnotscalableduetothesheernumberof
Inparallel,therehasbeenaplethoraofliteratureonAV
rulesandtheexceptionsthatcanarise. Furthermore,adapt-
out-of-domain (OoD) generalization and detection [1, 8–
ingtotrafficrulesinanewregionstillrequiresthecumber-
10, 12, 13, 22, 30]. However, the vast majority of such
some encoding of new traffic rules in a machine-readable
works focus on low-level tasks (e.g., transferring percep-
format. This challenge was highlighted in [20], where the
tionmodelstodatafromdifferentsensorconfigurations[1],
use of a natural language description of traffic rules was
adaptingpredictionmethodstobehaviorsfromdifferentre-
proposedasapotentialsolution. Thereisadearthoflitera-
gions[13],etc.) andlessonhigher-levelsemanticgeneral-
tureondirectlyusingthetrafficrulehandbookinitsnatural
ization[6],whichourworkfocuseson.
languageformfordrivingadaptationtonewlocations,and
itispreciselywhatweaimtoachieveinthispaper. 3. Driving Everywhere with Large Language
LLMs for Robotic Reasoning. Recently, many works
ModelPolicyAdaptation
have adopted LLMs to tackle task planning in robotics.
ThesemethodsgenerallyleverageLLMs’zero-shotgener- In this section, we will introduce our method, LLaDA, for
alizationandreasoningabilitytodesignafeasibleplanfor adapting motion plans to traffic rules in new geographical
robotstoexecute.Ofnote,PaLM-E[4]developsanembod- areasanddiscussallitsbuildingblocks.
ied multi-modal language model to solve a broad range of LLaDA receives four inputs, all in the form of natu-
tasksincludingroboticplanning,visualquestionanswering, ral language: (i) a nominal execution plan, (ii) the traffic
andcaptioning; thislargemodelservesasafoundationfor codeofthecurrentlocation,(iii)adescriptionofthecurrent
robotic tasks. VLP [5] further enables visual planning for scene from the ego’s perspective, and (iv) a description of
complexlong-horizontasksbypretrainingoninternet-scale any“unexpected”scenariothatmaybeunfolding. LLaDA
videos and images. Code-As-Policies [17] re-purposes a ingests these four inputs and outputs a motion plan – also
code-writingLLMtogeneraterobotpolicycodegivennat- representedinnaturallanguage–thataddressesthescenario
ural language commands; it formulates task planning as byleveragingthelocaltrafficrules. Thenominalexecution
an in-context code generation and function call problem. plan can be generated by a human driver. Similarly, the
ITP [16] further proposes a simple framework to perform scene description and the unexpected scenario description
interactive task planning with language models, improv- canbegeneratedbyahumanoraVLM.Theuniquetraffic
ing upon Code-As-Policies. Inspired by these works, our code in the current location is the text of the entire driver
methodalsoleveragesLLMsforautonomousdriving.How- handbookthatdescribestherulesoftheroadforthatloca-
ever,thekeydifferenceisthatourmethodfocusesonpolicy tion. Undernormalcircumstances,theunexpectedsituation
adaptationviaLLMsratherthanthewholesalereplacement inputdefaultstonormal status;however,ifsomething
ofmoduleswithLLMs. out-of-the-ordinaryunfolds,suchastheegovehiclegetting
LLMs for Autonomous Driving. Most autonomous honkedorflashedat,oriftheegodrivernoticessomething
driving pipelines consist of perception, prediction, plan- unusual in the environment (e.g., an animal on the road),
ning, and control, which have been significantly advanced theappropriatetextdescriptionofthescenariocanbesup-
by machine learning and deep neural networks in recent pliedtoLLaDA.TomaketheroleofLLaDAmoreconcrete,
years. Despite such tremendous progress, both percep- consider an example: An AV is operating in New York
tion and planning are generally non-adaptive, preventing City (NYC) and the nominal motion plan for the vehicle
AVs from generalizing to any in-the-wild domain. Recent istoturn rightatasignalized intersection
works leverage foundation models to provide autonomous with a red light. The AV was honked at by
driving pipelines with common sense reasoning ability. cross trafficwhichisunexpected. LLaDAwilltake
Wangetal.[31]proposesamethodtoextractnuancedspa- theseinputsalongwithNYC’sdrivermanualandadaptthe
tial(pixel/patch-aligned)featuresfromTransformerstoen- motion plan to no right turn on a red light
able the encapsulation of both spatial and semantic fea- because NYC traffic law prohibits right turns on red [23].
tures. GPT-Driver [21] finetunes GPT-3.5 to enable mo- In the remainder of this section, we will discuss the build-
tion planning and provide chain-of-thought reasoning for ingblocksofLLaDA,illustratedinFigure2.
autonomous driving. DriveGPT4 [34] further formulates TrafficRuleExtractor. Passingtheentiredriverhand-
driving as an end-to-end visual question answering prob- booktotheLLMissuperfluousasweonlyneedthetrafficUnique traffic code in current location
New York City Driving Handbook
Scene Description Unexpected Situation
“Stopped at a red light on the rightmost “someone honks at me”
lane, starting to turn right.”
Traffic Rule Extractor
Environment Plan (TRE) LLM Planner New Plan
“Turn right” “As per NYC traffic rules, even if you are
in the rightmost lane, you should not
turn right on a red light; wait until the
light turns green to proceed safely.”
Figure2. OverviewofLLaDA.Inthisillustration,thedriverlearnedhowtodriveinCaliforniabutnowneedstodriveinNewYorkCity.
However, the road situation, traffic code, and unexpected situations are different. In our system, we consider three inputs: initial plan
(“Turnright”),uniquetrafficcodeincurrentlocation(NewYorkCityDrivingHandbook),andunexpectedsituation(“someonehonksat
me”). WewillfeedthesethreeinputsintoaTrafficRuleExtractor(TRE),whichaimstoorganizeandfiltertheinputsandfeedtheoutput
intothefrozenLLMstoobtainthefinalnewplan.Inthispaper,wesetGPT-4asourdefaultLLM.
Collect Information “Continue driving safely, ignore the honk unless it's an
emergency vehicle or you're causing obstruction.”
background = "The condition: The driver get the
license from {}, but now in {} so we make sure the
Plan difference in {} and notify the drivers what they need New Plan
“Turn right”
to do.".format(‘California’, ‘Germany’, ‘Germany’)
request = “{}, {}”.format(plan, unexpected situation)
response_format = 'Please output the instructions LLM Planner
Unexpected about what should the driver do in one sentence less (GPT-4)
Situation than 20 words.'
“Someone honks at me” prompt = background + '\nThe driver says:' + request
+ '\n' + response_format
prompt
Find Keywords
Process Guidelines with Keywords
prompt = "Extract less than 3 common traffic-related
phrases from the given sentence, each phrase # Split the content into paragraphs
contains 1 or 2 words: {}".format(prompt) paragraphs = user_guidelines.split("\n\n")
# Search for keywords in each paragraph
keywords for paragraph in paragraphs:
for keyword in keywords:
“Turn right”, “honk” if keyword.lower() in paragraph.lower():
LLMs (GPT-4)
# Case-insensitive search
matching_paragraphs.append(paragraph)
processed_guidelines = ''
# Find the paragraphs containing the keywords
Unique traffic code for paragraph in matching_paragraphs:
in current location processed_guidelines +=
paragraph + '\n' + "_" * 50 + '\n'
Germany Driving Handbook
Figure3. DetailsofTrafficRuleExtractor(TRE).Asisshowninthefigure,wefirstorganizetheinformation(suchaslocations,“Turn
right”and“someonehonksatme”)intoaprompt. ThenwefeedtheprompttofindtheoneortwokeywordsusingGPT-4. Toguarantee
thesearchquality,eachkeywordcontainsoneortwowords.Thenwefindthekeyparagraphsthatcontainextractedkeywordsintheunique
trafficcode. Inthisway,wecouldfilteroutthenecessaryinformationandonlyorganizethevaluablematerialintoGPT-4toobtainthe
finalnewplan.
rules relevant to the current scenario that the vehicle finds wordsinthetrafficcodeofthecurrentlocation, whichare
itselfin. Infact,extraneousinformationofthetrafficcode furtherusedtoextractparagraphsthatcomprisethesekey-
can hurt the LLM Planner’s performance. To achieve this words. We use Traffic Rule Extractor (TRE) to identify
task-relevant trafficruleextractionweusetheTrafficRule the most relevant keywords and paragraph extraction; see
Extractor(TRE).TREusesthenominalexecutionplanand Figure 3 for an illustration of TRE’s operation. We could
the description of the unexpected scenario to extract key- observe that TRE is simple yet efficient in extracting keyparagraphs from the unique traffic code, it first generates 5.Experiments
a prompt and finds keywords in the organized prompt us-
5.1.ImplementationDetails
ingGPT-4. Thenwefindthekeywordsintheuniquetraffic
code in the current location. By organizing the processed SinceLLaDAtakesadvantageoflargepre-trainedlanguage
guidelinesandprompt,wecanobtainanewplanaccurately models, our method is training-free and easily be applied
by using GPT-4 twice. After obtaining the relevant para- to any existing driving system. LLaDA could be run with
graph, we input the organized information from TRE into a single CPU. In this paper, we assume the driver obtains
anLLM(GPT-4)toobtainthefinalnewplan,referredtoas driver’slicensefromCaliforniaasthedefaultsetting.
theLLMPlanner.
5.2.LLaDAExamples
4.ApplicationsofLLaDA
We show a full set of functions of LLaDA in Figure 7.
LLaDAenablesthesystemtoprovidethemostupdatedin-
LLaDA is a general purpose tool for seamlessly adapting
structions based on local traffic rules, we show the basic
driving policies to traffic rules in novel locations. We see
functions of LLaDA and display how it works when the
twomainapplicationsthatcanbenefitfromLLaDA:
drivers are in different places, in diverse unexpected situ-
Traffic Rule Assistance for Tourists. Standalone, ations, or with diverse plans under various environments.
LLaDA can serve as a guide for human drivers in new lo- We could observe that LLaDA is robust to distinct condi-
cations. We envision an interface wherein a human driver, tions. We also notice that without the driving handbook,
when encountered with an unexpected scenario, can query themodelcannotprovideaccurateinformation. Weassume
LLaDAinnaturallanguageviaaspeech-to-textmoduleon this is because GPT-4 may not be able to provide detailed
how to resolve it. As described in Section 3, LLaDA can instructionswithoutthecontextorcomplexprompttuning,
takethisnaturallanguagedescriptionofthescene, theun- whileLLaDAcouldsuccessfullyalleviatethisproblemand
expectedscenario,andthenominalexecutionplanandpro- generatereasonableinstructionswithemphasisonthespe-
vide a new plan which adheres to the local traffic laws. It cificlocaltrafficruleanddriver’srequest.
is worth pointing out that in its current form, LLaDA can-
not provide plan corrections unless queried by the human 5.3.InferenceonRandomNuscenes/NuplanVideos
driver. This limits its usability to scenarios where the hu-
Nuscenes [2] and Nuplan [3] datasets are two of the most
man driver becomes aware that they are in an unexpected
used dataset for autonomous driving. Nuscenes is the first
scenario. ExtendingLLaDAtoautomaticallyprovideplan
datasettocarrythefullautonomousvehiclesensorsuiteand
correctionsrequiresthedevelopmentofanunexpectedsce-
Nuplanistheworld’sfirstclosed-loopML-basedplanning
nariodetectorandtranslator,whichisbeyondthescopeof
benchmark for autonomous driving. However, Nuscenes
thiscurrentworkandwillbeexploredaspartofourfuture
only contains 12 simple instructions such as “accelerate”
work. We conducted a survey to garner human feedback
and Nuplan only has 74 instructions (scenario types) such
abouttheusefulnessandaccuracyofLLaDAinsomechal-
as“acceleratingatstopsignnocrosswalk”,whichmaynot
lenging traffic rule scenarios – the results are discussed in
provideconstructiveandefficientinstructionsfordriversin
Section5.
differentlocations. LLaDAcouldsuccessfullyaddressthis
AV Motion Plan Adaptation. We can also leverage
problemandcanbeappliedtorandomvideos.Wefirstshow
LLaDA’s traffic law adaptation ability in an AV planning
Nuscenes example in Figure 5. We also show Nuplan ex-
stacktoautomaticallyadaptAVplanstotherulesofanew
amples in Figure 6. It is obvious that LLaDA works for
geographical location. This can be achieved by interfac-
random videos under diverse scenarios, achieving driving
ing LLaDA with any motion planner capable of generat-
everywherewithlanguagepolicy.
inghigh-levelsemanticdescriptionsofitsmotionplan(e.g.,
GPT-driver[21])andaVLM(e.g.,GPT-4V)thatcantrans-
5.4.ChallengingSituations
latethesceneandtheunexpectedscenariointotheirrespec-
tive textual descriptions. LLaDA then adapts the nominal TofurtherverifytheefficiencyofLLaDA,weconsidersev-
executionplanandcommunicatesittoadownstreamplan- eral challenging cases and compare the results with and
ner that updates the low-level waypoint trajectory for the without our approach. Also, since GPT-4 could translate
AV. Our approach for using LLaDA to adapt AV motion differentlanguagesatthemeanwhile,LLaDAisabletopro-
plansissummarizedinFigure4. Wedemonstratetheben- cessdifferentlanguageinputsandoutputthecorresponding
efitsthatLLaDAcandelivertoAVplanninginourexperi- instructions(Seerow5). WedisplaytheresultsinTable1.
mentswhereanominalplannertrainedinSingaporeisde- Forexample1,inNYCthereisnoright-turnonred,while
ployed in Boston; more details regarding the experiments thisisallowedinSanFrancisco. Forexample2,LLaDAis
areprovidedinSection5. abletopointoutsomethingrelatingtoRettungsgasse(moveFigure4.CombiningLLaDAwithGPT-DriverformotionplanningonthenuScenesdataset.
Plan Unique Traffic Code Unexpected Situation Outputs (New Plan)
Singapore normal status Slow down, signal, and carefully change to nuscenes
Driving Handbook the left lane if it's safe and unoccupied.
Stay in your lane, slow down, and safely
found trash on the road navigate around the trash without
changing lanes or stopping
Change to the left lane
Continue driving straight at a consistent
normal status speed, observing local speed limits and
traffic signs.
a car suddenly appears Slow down, check mirrors, and prepare to
brake if necessary.
Go straight with constant speed
Signal in good time, keep to the left in
normal status Singapore, and do not swing out to the
right while turning left.
a car suddenly appears Slow down, signal your intention, and turn
left only when it's safe to do so.
Turn left with constant speed
Figure5. InferenceonarandomNuscenesvideoinSingapore. Sincedifferentfrommostcountries, Singaporehasaright-handtraffic
system, whichrequiresdistinctbehaviorincomparisonwithCalifornia’s(left-handtrafficsystem). Forexample, when“Turnleftwith
constantspeed”and“normalstatus”,LLaDAsuggestthedriverto“keeptotheleftinSingapore”.
to the right). This is because in the US the rule is that ev- coming traffic. Both should mention checking for pedes-
eryone pulls over to the right, but this is not standard in trians. Forexample5,sincethedriverisontheAutobahn,
Germany. For example 3, LLaDA is able to point out that wherebeingintheleftlanetypicallyrequiresdrivingatvery
we are not allowed to pass on the right in Europe and that high speeds compared to American or many other coun-
wemergebacktotheright-mostlanewhen tries’highwayspeedlimits. OntheGermanAutobahn,the
absence of a speed limit means that drivers instead adopt
6.Evaluator-basedAssessmentQuestionnaire different ”speed zones” per lane, with the leftmost being
the fastest and the rightmost being the slowest. For ex-
Here we show the corresponding questionnaire that has ample 6, Amish communities exist in the US and Canada
been mentioned in Section 5.6 of the paper. We list the (primarilyinthenortheastUSA),andtheyfrequentlyhave
questions in this Google Form. done with overtake. For horse-pulledcarriagesonroads.Sooursystemsuccessfully
example 4, our system could point out that an unprotected providetheinstructionstogiveright-of-waytohorses.
rightinEngland(left-drivingsystem)requirescheckingthe
traffic coming at you as you will have to cut through up-Plan Unique Traffic Code Unexpected Situation Outputs (New Plan)
Nevada Ensure to yield to pedestrians and any nuplan
normal status cross traffic before proceeding through
Driving Handbook
the intersection.
a car suddenly stopped The driver should stop, yield to the
stopped car, and proceed when it's safe.
Go straight on intersection
normal status Pull up to the stop line and stop at a red
light.
The driver should stop at the red light and
the road is kind of wet maintain a safe distance due to the wet
road conditions.
On stopping traffic light
Wait for a green light, then proceed
normal status straight, yielding to pedestrians and any
traffic already in the intersection.
Slow down, turn on your headlights, and
it suddenly started raining proceed with caution through the
intersection.
Go straight on traffic light intersection
Figure6.InferenceonarandomNuplanvideoinLasVegas.Forthiscase,weselectNevadadrivinghandbook,theillustrationshowsthat
LLaDAworksverywellinNuplanandcanprovideaccuratenewplanwithvariousunexpectedsituations.
Example OriginalLocation TargetLocation Plan UnexpectedSituation Outputs(NewPlan)
1 SanFrancisco NYC Turnrightonred normalstatus DonotturnrightonredinNYCunlessasignpermittingitisposted.
NYC SanFrancisco Turnrightonred normalstatus Stopcompletely,yieldforpedestriansand
turnrightifthere’sno”NoTurnonRed”sign.
2 California Germany Drivestraightonthehighway anemergencyvehicleisapproachingfrombehind Movetotherightandallowtheemergencyvehicletopass.
3 NYC London Drivestraightonthehighway thecarinfrontdrivesveryslowly, Overtaketheslowcarsafelyfromtherightlane,
weareinthemiddlelaneofa3lanehighway asovertakingontheleftisillegalinLondon.
4 California Singapore Unprotectedright normalstatus Yieldtoallothertrafficandpedestriansbeforemakingyourrightturn.
5 California Germany Drivestraightonthehighway,intheleftmostlane Ikeepgettinghonkedatbycarsbehindme Movetotherightlane,theleftmostlaneinGermanyisforovertakingandfastervehicles.
6 California Ontario Drivingonaruraltwo-laneroad there’sahorsepullingacarriage Thedrivershouldslowdown,passthecarriagecautiously,andgiveplentyofspacetothehorse.
Table1. Inferenceonvariouschallengingexamples. WecomparetheoutputswithandwithoutLLaDA,anditisobviousthatLLaDA
significantlyimprovestheplanandsuccessfullyhandlesvariousdifficulttasksunderdiversescenariosandenvironments.
6.1.Evaluator-basedAssessment. and visual quality. Here we show the corresponding ques-
tionnairethathasbeenmentioned: welistthequestionsin
Tofurthervalidatetheusefulnessofvideosgeneratedwith thisGoogleForm.
LLaDA,weconductedanevaluator-basedassessment. We
provided location, scenario, unexpected situation, relevant
6.2.ComparisononMotionPlanning
local law as conditions, and LLaDA output as driving as-
sistantinstructions. Hereistherelevantlocallawthatindi- WeconductexperimentsonthenuScenesdatasettovalidate
cates what we want to pay attention to while driving. We the effectiveness of LLaDA in motion planning. nuScenes
asked two questions to 24 participants about each of the 8 consists of perception and trajectory data collected from
cases. 54.2%participantshavemorethan10yearsofdriv- Singapore and Boston, which have different traffic rules
ingexperienceand20.8%participantshave5-10yearsdriv- (e.g., driving side difference). Specifically, we first utilize
ingexperience. Also,75%participantsarefromtheUnited GPT-Driver[21]togenerateaninitialdrivingtrajectoryfor
States. Inourassessment,weasktwoquestions: “Doesthe aparticulardrivingscenario,andthenweleverageLLaDA
instructionfollowtherelevantlocallaw?” and“Howuseful togenerateguidelinesforGPT-Drivertore-generateanew
is the instruction?”. The results show that 70.3% partici- planneddrivingtrajectory. SinceLLaDAprovidescountry-
pantsthinktheinstructionsstrictlyfollowtherelevantlocal specific guidelines, we fine-tuned the GPT-Driver on the
law, and 82.8% participants find the instructions are very SingaporesubsetofthenuScenesdatasetandevaluatedthe
orextremelyhelpfulforthem. ThishighlightsthatLLaDA performances of GPT-Driver and LLaDA on the Boston
bringsaboutasignificantenhancementintheperformance subset of the nuScenes validation set. We follow [11, 21]
of baseline video diffusion models in both the alignment andleverageL2error(inmeters)andcollisionrate(inper-Plan Unique Traffic Code Unexpected Situation Outputs (New Plan)
Without California Proceed with caution and ensure
Go straight someone honks at me pedestrians have the right-of-way before
Driving Handbook continuing straight.
a car suddenly appears Yield to the car, proceed with caution
when it's safe to go straight.
California If honked at while going straight in
someone honks at me California, continue cautiously, ensuring
Driving Handbook you have the right-of-way.
a car suddenly appears The driver should slow down, yield to the
car, and proceed when it's safe.
When turning left normal status Choose either lane, proceed with caution,
and exit in the lane you entered.
a pedestrian suddenly The driver should stop and yield to the
pedestrian before completing the left
appears turn.
normal status Signal, check blind spots, merge into the
left lane, and turn when safe.
New York Ensure you're in the correct lane for going
Go straight someone honks at me straight and yield to any drivers on your
Driving Handbook right.
The driver should yield the right-of-way to
a car suddenly appears
the other car.
Stay in the left lane and yield to the driver
normal status
on your right before proceeding straight.
Germany a pedestrian suddenly The driver must show special
When turning left consideration towards the pedestrian and
Driving Handbook appears wait if necessary.
Before turning left, ensure to signal,
normal status check for oncoming traffic, and do not
impede rail-borne vehicles.
Accelerate Germany normal status In Germany, accelerate smoothly and obey
Driving Handbook posted speed limits.
Maintain your speed, check mirrors for
someone honks at me safety, and don't react aggressively to the
honking.
someone honks at me while Maintain your speed, ensure you're in the
correct lane, and continue following the
I have followed the rules rules.
Slow down, turn on headlights, and
it rains heavily increase distance from other vehicles due
to heavy rain.
there are some trash on Slow down and proceed with caution due
to potential danger ahead as indicated by
the road the warning signs.
Accelerate at stop sign Germany Driving a pedestrian suddenly The driver should immediately slow down
no crosswalk Handbook appears and allow the pedestrian to cross safely.
Immediately signal, check for other road
Change to left lane users, and safely move to the left lane
while avoiding the pedestrian.
Immediately brake and yield to the
Start U turn pedestrian before proceeding with the
U-turn.
Waiting for pedestrians Immediately brake and yield to the
pedestrian before proceeding with the
to cross U-turn.
Start unprotected The driver must stop and allow the
cross turn pedestrian to cross the road safely.
Figure7. WeshowafewexamplesofLLaDAtohelpdriversdriveeverywherewithlanguagepolicy. WeshowLLaDAcouldhelpthe
driversobtainpromptnotificationandcorrecttheircorrespondingbehaviorsindifferentcountrieswithdiverseplansanddiverseunexpected
situations. Also,itisobviousthatLLMcannotprovideaccurateinstructionbasedoneachlocationwithoutthebackgroundofthetraffic
code.
snoitcnuF
cisaB
secalp
tnereffid
nI
detcepxenu
esreviD
nalp
esrevid
htiW
snoitautisFigure8. VisualizationofthemotionplanningresultsonthenuScenesBostonsubset. Groundtruthtrajectoriesareingreen. Trajectories
generatedbyGPT-Driverareinred.Re-plannedtrajectoriesbyLLaDAareinpurple.
centage) as evaluation metrics. The average L2 error is structionssuggest“cometoacompletestopattheredlight”
computed by measuring each waypoint’s distance in the or ”wait until it turns green”. In case “it rains heavily”,
planned and ground-truth trajectories. It reflects the prox- where all the instructions suggest “turn on the headlight”
imity of a planned trajectory to a human driving trajec- and ”reduce speed”. In case “A pedestrian walks across
tory. The collision rate is computed by placing an ego- the street”, where all the instructions suggest “yield to the
vehicleboxoneachwaypointoftheplannedtrajectoryand pedestrian”. We didn’t notice any potentially harmful in-
thencheckingforcollisionswiththegroundtruthbounding structions that might cause dangerous behavior, which en-
boxesofotherobjects.Itreflectsthesafetyofaplannedtra- sures user safety by directing them toward appropriate be-
jectory. Wefollowthecommonpracticeinpreviousworks havior.
andevaluatethemotionplanningresultinthe3-secondtime
6.4.CombiningwithGPT-4V
horizon. Table 2 shows the motion planning results. With
theguidelinesprovidedbyLLaDA,GPT-Drivercouldadapt Our approach can be combined with different systems to
its motion planning capability from Singapore to Boston improve the functionality to provide accurate information
andreduceplanningerrors. for humans. In this section, we study the case by com-
bining LLaDA with GPT-4V. GPT-4V is the vision branch
6.3.AblationStudyonPotentialSafetyIssues of GPT-4 which can output corresponding captions to de-
scribe the scenes based on a visual input. We randomly
There might be concerns that since LLaDA is based on
pick two scenes from Youtube 1 and ask GPT-4V to pro-
LLMs, it might generate prompts that might provide dan-
vide additional captions, we add these additional captions
gerous instructions. To alleviate this concern, we evaluate
to the user’s request. We show an example in Figure 9,
LLaDA on three different critical cases with diverse coun-
it could be observed that LLaDA could process the infor-
triesandunexpectedsituations: 1)whenfacingastopsign,
mationGPT-4Vverywellandprovideaccurateinstructions
whetherLLaDAsuggests“stop”ornot. 2)Whenfacingthe
basedongivencaptions.
redlight,whetherLLaDAsuggests“stop”/specificsafeno-
tificationsornot. 3)Whenitrainsheavily,whetherLLaDA 7.Conclusion,Limitations,andFutureWork
suggests “slow down” or not. 4) When a pedestrian walks
acrossthestreet, whetherLLaDAsuggeststo“yieldtothe Conclusion. Inthiswork, weproposedLLaDA,anLLM-
pedestrian” or not. For each case, we evaluate 50 random powered framework that adapts nominal motion plans by
examples and report the average score of each case. For a human driver or an AV to local traffic rules of that re-
each example, if the answer will cause potentially danger- gion. The modularity of LLaDA facilitates its use for hu-
ous behavior, we will treat it as an error. We observe that mandriverassistanceaswellasAVplanadaptation. Toour
LLaDAachieves0%errorrateforall4cases. Incase“stop
1Source:https : / / www . youtube . com / watch ? v =
sign”, where all the instructions suggest “Wait at the stop
Boh66Pjjiq0 and https://www.youtube.com/watch?
sign until it’s safe”. In case “red light”, where all the in- v=xn_mSqTrOUoL2(m)↓ Collision(%)↓
Method
1s 2s 3s Avg. 1s 2s 3s Avg.
GPT-Driver[21] 0.27 0.59 1.04 0.63 0.22 0.45 1.07 0.58
GPT-Driver[21]+DELLRe-Planning(Ours) 0.27 0.58 1.02 0.62 0.22 0.41 1.04 0.56
Table2. Motionplanningresults. WiththeguidelinesprovidedbyDELL,GPT-Drivercouldadaptitsmotionplanningcapabilityfrom
SingaporetoBostonandreduceplanningerrors.
Random youtube
Plan GPT-4V Scene Description Unique Traffic Code Unexpected Situation Outputs (New Plan)
China normal status Continue straight in the left lane, obeying
A bridge stretches ahead with Driving Handbook local speed limits and traffic signals.
light traffic, leading towards a
modern city skyline under a a car suddenly appears Slow down, check your mirrors, and yield
clear sky. from right to the car coming from the right.
Already in the left lane and go straight
Continue driving straight at a consistent
normal status speed, observing local speed limits and
Driving steadily, a car traffic signs.
approaches a well-lit tunnel,
bordered by concrete walls, a big truck suddenly Slow down, maintain distance from the
under a clear blue sky. appears truck, and proceed with caution.
Go straight with constant speed
A bustling city street in Netherlands normal status The driver should turn left at a constant
Amsterdam is (cid:195)lled with Driving Handbook speed.
pedestrians, vehicles, and
cyclists, with the prominent "De the weather turns cloudy Turn left at a constant speed, be cautious
Bijenkorf" department store in due to cloudy weather.
Draai linksaf met constante snelheid the background.
Construction workers operate normal status T arh oe u d nr div .er should slow down and turn
machinery amid roadwork while
pedestrians navigate the busy Slow down, signal, check mirrors and blind
surrounding streets of a a car suddenly appears spots, then carefully turn around when
European city. safe.
Vertragen en omdraaien
Figure 9. Combining LLaDA with GPT-4V and inference on random YouTube scenes. In the first two rows, we show the scenes of
Chongqing in China. In the rest two rows, we show the scenes of the crowded Amsterdam Center in Netherlands. As for the plans,
weinputDutchinsteadofEnglishtoverifythecapabilityofLLaDAtointeractwithdriversfromvariousculturesautomaticallywithout
mentioningthelanguagetypeoftheinput.“Draailinksafmetconstantesnelheid”represents“Turnleftwithconstantspeed”and“Vertragen
enomdraaien”represents“decelerateandturnaround”. WeaskedthesystemtooutputEnglishinstructions,wenoticedthatthesystem
extractskeywordsinEnglishandisabletoprovideaccurateplans.
knowledge,LLaDAisthefirsttoproposetrafficrule-based points towards the need to develop an AV-specific founda-
adaptationviaLLMs. Ourresultsshowthathumandrivers tionmodelthatcanprovideAV-centricscenedescriptions.
findLLaDAtobehelpfulfordrivinginnewlocations,and BroaderImpact.
LLaDA also improves the performance of AV planners in Asahumandriverassistant,wehopethatLLaDAwould
newlocations. reduce the number of road accidents induced by tourists
Limitations. ThoughLLaDAprovidesvariousbenefits, oblivious of the local traffic rules. As a policy adapter for
it also suffers from two limitations: First, since LLaDA AVs,weexpectLLaDAtopavethewaytowardseasiertraf-
requires running an LLM in the control loop, the runtime fic rule adaptation for AVs allowing them to expand their
for LLaDA is not yet conducive for closed-loop use in an operationsbeyondgeo-fencedregions.
AV planning stack – this limitation is shared by all LLM- FutureWork. Forfuturework,therearevariousdirec-
basedmotionplanners. Second,asdiscussedinourresults tions we are excited to pursue: First, we will explore im-
earlier, LLaDAissensitivetothequalityofscenedescrip- proving GPT-4V’s scene descriptions by fine-tuning it on
tions. Although GPT-4V can provide such descriptions, AV datasets. Second, we will explore the development of
theyaresometimesnotsufficientlyaccurate.Thislimitation anunexpectedscenariodetectorwhichwillallowustouseLLaDA only when it is needed, thereby significantly alle- ference on Machine Learning (ICML), pages 3145–3153.
viating the computational burden involved in running an PMLR,2020.
LLM-based module in the control loop. Finally, we will [10] Dan Hendrycks, Steven Basart, Mantas Mazeika, Moham-
worktowardsfurnishingsafetycertificatesfortheLLMout- madreza Mostajabi, Jacob Steinhardt, and Dawn Song.
putsbyleveragingrecentdevelopmentsinuncertaintyquan- Scalingout-of-distributiondetectionforreal-worldsettings.
arXivpreprintarXiv:1911.11132,2019. 2
tificationandcalibrationtechniquesforML,suchasconfor-
[11] ShengchaoHu,LiChen,PenghaoWu,HongyangLi,Junchi
malpredictionandgeneralizationtheory.
Yan,andDachengTao. St-p3: End-to-endvision-basedau-
tonomous driving via spatial-temporal feature learning. In
References
EuropeanConferenceonComputerVision(ECCV),2022. 6
[12] Masha Itkina and Mykel Kochenderfer. Interpretable self-
[1] Alexander Amini, Tsun-Hsuan Wang, Igor Gilitschenski,
aware neural networks for robust trajectory prediction. In
WilkoSchwarting,ZhijianLiu,SongHan,SertacKaraman,
Conference on Robot Learning, pages 606–617. PMLR,
andDanielaRus. Vista2.0: Anopen,data-drivensimulator
2023. 2
formultimodalsensingandpolicylearningforautonomous
[13] BorisIvanovic,JamesHarrison,andMarcoPavone.Expand-
vehicles. InProceedingsoftheInternationalConferenceon
ingthedeploymentenvelopeofbehaviorpredictionviaadap-
RoboticsandAutomation(ICRA),pages2419–2426.IEEE,
tivemeta-learning.InProceedingsoftheIEEEInternational
2022. 2
ConferenceonRoboticsandAutomation(ICRA),2023. 2
[2] HolgerCaesar,VarunBankiti,AlexHLang,SourabhVora,
[14] JesperKarlssonandJanaTumova. Intention-awaremotion
VeniceErinLiong,QiangXu,AnushKrishnan,YuPan,Gi-
planning with road rules. In Proceedings of the Interna-
ancarlo Baldan, and Oscar Beijbom. nuscenes: A multi-
tional Conference on Automation Science and Engineering
modal dataset for autonomous driving. In Proceedings of
(CASE),pages526–532.IEEE,2020. 2
the IEEE/CVF conference on computer vision and pattern
[15] Markus Koppenborg, Peter Nickel, Birgit Naber, Andy
recognition,pages11621–11631,2020. 1,4
Lungfiel, andMichaelHuelke. Effectsofmovementspeed
[3] Holger Caesar, Juraj Kabzan, Kok Seang Tan, Whye Kit
and predictability in human–robot collaboration. Human
Fong,EricWolff,AlexLang,LukeFletcher,OscarBeijbom,
FactorsandErgonomicsinManufacturing&ServiceIndus-
andSammyOmari. nuplan: Aclosed-loopml-basedplan-
tries,27(4):197–209,2017. 1
ning benchmark for autonomous vehicles. arXiv preprint
[16] BoyiLi,PhilippWu,PieterAbbeel,andJitendraMalik. In-
arXiv:2106.11810,2021. 4
teractivetaskplanningwithlanguagemodels.arXivpreprint
[4] Danny Driess, Fei Xia, Mehdi S. M. Sajjadi, Corey
arXiv:2310.10645,2023. 1,2
Lynch,AakankshaChowdhery,BrianIchter,AyzaanWahid,
[17] Jacky Liang, Wenlong Huang, Fei Xia, Peng Xu, Karol
Jonathan Tompson, Quan Vuong, Tianhe Yu, Wenlong
Hausman,BrianIchter,PeteFlorence,andAndyZeng.Code
Huang, Yevgen Chebotar, Pierre Sermanet, Daniel Duck-
aspolicies:Languagemodelprogramsforembodiedcontrol.
worth,SergeyLevine,VincentVanhoucke,KarolHausman,
InarXivpreprintarXiv:2209.07753,2022. 1,2
Marc Toussaint, Klaus Greff, Andy Zeng, Igor Mordatch,
[18] SebastianMaierhofer,Anna-KatharinaRettinger,EvaChar-
andPeteFlorence. PaLM-E:Anembodiedmultimodallan-
lotte Mayer, and Matthias Althoff. Formalization of inter-
guagemodel. InInt.Conf.Mach.Learn.,2023. 2
state traffic rules in temporal logic. In Proceedings of the
[5] Yilun Du, Mengjiao Yang, Pete Florence, Fei Xia, Ayzaan
IEEE Intelligent Vehicles Symposium (IV), pages 752–759.
Wahid, Brian Ichter, Pierre Sermanet, Tianhe Yu, Pieter
IEEE,2020. 2
Abbeel, Joshua B. Tenenbaum, Leslie Kaelbling, Andy
[19] KumarManasandAdrianPaschke.Legalcompliancecheck-
Zeng, and Jonathan Tompson. Video language planning,
ingofautonomousdrivingwithformalizedtrafficruleexcep-
2023. 2
tions. In Proceedings of the Workshop on Logic Program-
[6] Amine Elhafsi, Rohan Sinha, Christopher Agia, Edward ming and Legal Reasoning in conjunction with 39th Inter-
Schmerling,IssaADNesnas,andMarcoPavone. Semantic national Conference on Logic Programming (ICLP), 2022.
anomalydetectionwithlargelanguagemodels. Autonomous 2
Robots,pages1–21,2023. 1,2
[20] KumarManas,StefanZwicklbauer,andAdrianPaschke.Ro-
[7] KlemensEsterle, LuisGressenbuch, andAloisKnoll. For- bust traffic rules and knowledge representation for conflict
malizing traffic rules for machine interpretability. In Pro- resolutioninautonomousdriving.InProceedingsofthe16th
ceedingsoftheConnectedandAutomatedVehiclesSympo- InternationalRuleChallengeand6thDoctoralConsortium
sium(CAVS),pages1–7.IEEE,2020. 2 @RuleML+RR,2022. 2
[8] Alec Farid, Sushant Veer, Boris Ivanovic, Karen Leung, [21] Jiageng Mao, Yuxi Qian, Hang Zhao, and Yue Wang.
and Marco Pavone. Task-relevant failure detection for tra- GPT-Driver: Learning to drive with GPT. arXiv preprint
jectory predictors in autonomous vehicles. arXiv preprint arXiv:2310.01415,2023. 2,4,6,9
arXiv:2207.12380,2022. 2 [22] Rowan McAllister, Gregory Kahn, Jeff Clune, and Sergey
[9] Angelos Filos, Panagiotis Tigkas, Rowan McAllister, Levine. Robustness to out-of-distribution inputs via task-
NicholasRhinehart,SergeyLevine,andYarinGal. Canau- aware generative uncertainty. In Proceedings of the Inter-
tonomousvehiclesidentify,recoverfrom,andadapttodis- national Conference on Robotics and Automation (ICRA),
tribution shifts? In Proceedings of the International Con- pages2083–2089.IEEE,2019. 2[23] NewYorkCityDepartmentofTransportation. Rightturnon
redinstatenisland.https://portal.311.nyc.gov/
article/?kanumber=KA-01354. 2
[24] OpenAI. Gpt-4technicalreport,2023. 1
[25] Andreas Psarras, Theodore Panagiotidis, and Andreas An-
dronikidis.Covid-19,tourismandroadtrafficaccidents:Ev-
idencefromgreece. JournalofTransportationSafety&Se-
curity,pages1–21,2023. 1
[26] JaumeRossello´ andOscarSaenz-deMiera. Roadaccidents
andtourism:thecaseofthebalearicislands(spain).Accident
Analysis&Prevention,43(3):675–683,2011. 1
[27] AriSeff,BrianCera,DianChen,MasonNg,AurickZhou,
Nigamaa Nayakanti, Khaled S. Refaat, Rami Al-Rfou, and
BenjaminSapp. Motionlm: Multi-agentmotionforecasting
aslanguagemodeling,2023. 2
[28] Bay City News Service and Embarcadero Staff. Aus-
tralian tourist charged with manslaughter in wrong-
way crash that killed two La Honda residents.
https://www.paloaltoonline.com/news/
2023/09/07/australian-tourist-charged-
with-manslaughter-in-wrong-way-crash-
that-killed-two-la-honda-residents, 2023.
1
[29] SushantVeer,KarenLeung,RyanCosner,YuxiaoChen,Pe-
terKarkus,andMarcoPavone. Recedinghorizonplanning
withrulehierarchiesforautonomousvehicles.arXivpreprint
arXiv:2212.03323,2022. 2
[30] SushantVeer,ApoorvaSharma,andMarcoPavone. Multi-
predictorfusion: Combininglearning-basedandrule-based
trajectory predictors. arXiv preprint arXiv:2307.01408,
2023. 2
[31] Tsun-Hsuan Wang, Alaa Maalouf, Wei Xiao, Yutong Ban,
Alexander Amini, Guy Rosman, Sertac Karaman, and
Daniela Rus. Drive anywhere: Generalizable end-to-end
autonomous driving with multi-modal foundation models.
arXivpreprintarXiv:2310.17642,2023. 2
[32] Wayve. Lingo-1: Exploring natural language for au-
tonomous driving. https://wayve.ai/thinking/
lingo - natural - language - autonomous -
driving/,2023. 1
[33] WeiXiao,NoushinMehdipour,AnneCollin,AmitaiYBin-
Nun,EmilioFrazzoli,RadboudDuintjerTebbens,andCalin
Belta. Rule-basedoptimalcontrolforautonomousdriving.
InProceedingsACM/IEEEInt.Conf.onCyber-PhysicalSys-
tems,pages143–154,2021. 2
[34] ZhenhuaXu,YujiaZhang,EnzeXie,ZhenZhao,YongGuo,
Kenneth KY Wong, Zhenguo Li, and Hengshuang Zhao.
Drivegpt4: Interpretableend-to-endautonomousdrivingvia
large language model. arXiv preprint arXiv:2310.01412,
2023. 2
[35] Yu Zhang, Sarath Sreedharan, Anagha Kulkarni, Tathagata
Chakraborti,HankzHankuiZhuo,andSubbaraoKambham-
pati.Planexplicabilityandpredictabilityforrobottaskplan-
ning. InProceedingsoftheIEEEInternationalConference
onRoboticsandAutomation(ICRA),2017. 1