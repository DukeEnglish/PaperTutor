PersonalizedUS: Interpretable Breast Cancer Risk Assessment with Local
Coverage Uncertainty Quantification
AlekFro¨hlich1*,ThiagoRamos2*,GustavoCabello3,IsabelaBuzatto3,RafaelIzbicki2,Daniel
Tiezzi3
1UFSC,Floriano´polis,Brazil
2UFSCar,Sa˜oCarlos,Brazil
3USP,Ribeira˜oPreto,Brazil
alek.frohlich@posgrad.ufsc.br,thiagorr@ufscar.br,gustavocabello@usp.br,ipcarlotti@hcrp.usp.br,rizbicki@ufscar.br,
dtiezzi@usp.br
Abstract Breast US has several advantages compared to other imag-
ing modalities, including relatively lower cost, lack of ion-
Correctly assessing the malignancy of breast lesions identi-
izing radiation, and real-time evaluation capabilities (Feig
fied during ultrasound examinations is crucial for effective
2010).
clinicaldecision-making.However,thecurrent“goldenstan-
Despitetheseadvantages,interpretingUSexamsishard.
dard” relies on manual BI-RADS scoring by clinicians, of-
ten leading to unnecessary biopsies and a significant men- The evaluation involves inspecting image features such as
tal health burden on patients and their families. In this pa- lesion size, shape, and margins for signs of malignancy,
per,weintroducePersonalizedUS,aninterpretablemachine and relies heavily on the operator’s experience (Sivarajah,
learningsystemthatleveragesrecentadvancesinconformal Brown, and Chetlen 2020). Radiologists ultimately decide
predictiontoprovidepreciseandpersonalizedriskestimates whetherthefindingsarebenign,needfollow-up,orrequire
withlocalcoverageguaranteesandsensitivity,specificity,and a biopsy according to the Breast Imaging Reporting and
predictive values above 0.9 across various threshold levels.
DataSystem(BI-RADS)(Mendelsonetal.2013).Although
Inparticular,weidentifymeaningfullesionsubgroupswhere
theBI-RADSstandardizedthedescriptionoflesionsandre-
distribution-free,model-agnosticconditionalcoverageholds,
ports,ithasnotablelimitations.Inparticular,themostrecent
with approximately 90% of our prediction sets containing
versionofferslittleguidanceonhowtosubdivideBI-RADS
onlythegroundtruthinmostlesionsubgroups,thusexplic-
itlycharacterizingforwhichpatientsthemodelismostsuit- 4findingsintosubcategories(a,b,andc),withriskranging
ablyapplied.Moreover,wemakeavailableacuratedtabular from5%to95%,andoverlooksclinicalandDoppler-based
datasetof1936biopsiedbreastlesionsfromarecentobser- features known to be important for malignancy prediction
vational multicenter study and benchmark the performance (Pfob et al. 2022). These gaps contribute to the method’s
ofseveralstate-of-the-artlearningalgorithms.Wealsoreport intra-readervariabilityandfalsepositiverate(Lazarusetal.
a successful case study of the deployed system in the same 2006;Niuetal.2020).Notably,incorporatingUSinbreast
multicentercontext.Concreteclinicalbenefitsincludeuptoa
cancerscreeningleadstoanadditional4-8%ofpatientsun-
65%reductioninrequestedbiopsiesamongBI-RADS4aand
dergoing biopsy as compared to mammography alone, yet
4blesions,withminimaltonomissedcancercases.
only7-8%ofUS-guidedbreastbiopsiesarefoundtobema-
lignant(Yangetal.2020;Corsettietal.2011).
Introduction
Themaingoalsofourworkwereto:
Breastcanceristhemostdiagnosedcancerandtheleading
• Improve upon the current BI-RADS standard by reduc-
cause of cancer-related deaths among women worldwide,
ingthenumberoffalsepositiveswithoutcompromising
with 2.3 million new cases and 666,000 deaths reported in
cancercases;
2022(Brayetal.2024).Whilescreeningmammographyis
• Provide an interpretable model that can be safely moni-
widelyusedtoincreaseearlydiagnosis—whentreatmentis
toredbymedicaldoctorswithsuitabletraininginAI;
more effective and less costly (Prager et al. 2018)—it has
limitations,particularlyahighfalsepositiverate,leadingto • Give personalized uncertainty quantification for model
recalls, short interval follow-ups, and unnecessary biopsies predictionswithstrongtheoreticalguaranteesundermin-
(Hubbardetal.2011).Arecentstudyestimatedthat,after10 imalassumptions;
yearsofannualscreeninginwomenaged40-59years,61% • Provideanintuitiveinterfacefordoctorstointeractwith
of individuals would experience at least one false positive themodel.
recallandupto9%atleastonefalsepositivebreastbiopsy
Toaddressthesechallenges,wepresentasolutionthatin-
(Hoetal.2022).
tegratestraditionalstatisticalmethodswithmodernAItech-
Breast ultrasound (US) is broadly used as a diagnostic
niques, with a strong emphasis on uncertainty quantifica-
toolcomplementinginconclusivemammograms,evaluating
tion. Concretely, we developed PersonalizedUS, an inter-
palpablefindings,andguidingbreastbiopsies(Berg2008).
pretableandaccuratelogisticregressionmodeldeployedin
*Theseauthorscontributedequally. the form of an easy-to-use web application. The key inno-
4202
guA
82
]GL.sc[
1v85451.8042:viXraFigure1:PersonalizedUSpipeline:StartingwithasuspiciousbreastlesionidentifiedbyUS,clinical,BI-RADS,andDoppler
featuresarefedintoalogisticregressionmodeltoestimatemalignancyrisk.Themostinfluentialfeaturesarehighlighted.The
lesion is then fed into a decision tree, whose leaves reflect difficulty levels with respect to the prediction model. Finally, a
predictionsetwithalocalconditionalcoverageguarantee,ensuringthatlesionswithinmorechallengingleavesareassociated
withmoreuncertainpredictions.
vation lies in the novel use of Locart, a recently developed and is applied to binary classification for the first time
conformal prediction method that leverages feature space here.
partitions to provide personalized confidence intervals/sets
thatapproachconditionalcoverage.Thisrepresentsasignif- RelatedWork
icant advance in applying distribution-free, model-agnostic
There has been considerable interest in developing clinical
uncertainty quantification tools to the medical field, as Lo-
predictionmodelstoestimatetheriskofmalignancyofsus-
cartdeliverslocalizeduncertaintyestimatesthatalignmore
piciousbreastlesionsidentifiedbyultrasound.Earlycontri-
closely with the goals of precision medicine embodied by
butionshavefocusedonfeatureextractionandclassicalma-
clinicalpredictionmodels.
chinelearning/statisticaltechniques(Shenetal.2007;Prab-
ContributionsOverview hakarandPoonguzhali2017),whereasrecentworkhascon-
centrated around deep neural network-based computer vi-
• PersonalizedUS: We introduce PersonalizedUS, an in-
sionapproaches(Kimetal.2021;Qietal.2019;Shenetal.
terpretable machine learning system designed to accu-
2021,2023).
rately assess the malignancy risk of breast lesions de-
Unfortunately,suchattemptshaveoftenbeenplaguedby
tected by ultrasound imaging. By integrating a logis-
atleastoneofthefollowingissues:(i)lackofinterpretabil-
tic regression model with modern conformal prediction
ity, (ii) lack of transparency/reproducibility, and (iii) lack
techniques, PersonalizedUS offers precise and person-
ofgoodsoftwaredevelopmentprinciples.Inparticular,few
alized risk estimates that improve upon the current BI-
systemsgothroughthefullsoftwaredevelopmentandmain-
RADS standard, significantly reducing the number of
tenancecycleandactuallybecomeaccessibletodoctors,and
falsepositiveswithoutmissingcancercases.
those that do are often based on black-box models such as
• NovelUseofConformalPrediction:WeadapttheLo- deepconvolutionalnets(deHondetal.2022;Rudin2019).
cart method, a recent approach from conformal pre- Moreover, most prediction models found on the literature
diction that guarantees local conditional coverage. The are either poorly developed or poorly reported (Steyerberg
methodwasoriginallydevelopedforregressionproblems 2019;Collinsetal.2024).We stress that model interpretability is a crucial, non- sensitivity specificity
negotiable requirement for prediction models in healthcare 1.0
(deHondetal.2022;Rudin2019;Steyerberg2019).While 0.8
complexmodelssuchasdeepneuralnetsmayachieveslight 0.6
improvementsinpredictiveperformance,thesegainsareof- 0.4
ten marginal when compared to the transparency offered 0.2
bysimplermodels(Hastie,Tibshirani,andFriedman2009;
0.0
Doshi-Velez and Kim 2017). Logistic regression is often
ppv npv
highlightedasareliableandinterpretablemodel(Steyerberg 1.0
2019),whereeachcoefficientcanbedirectlyinterpretedas 0.8
the contribution of a specific variable to the risk of cancer. 0.6
This is significantly more direct than existing methods for
0.4
interpretingneuralnetworks(Rudin2019;Lipton2018).
0.2
Interpretability is not only about understanding the
0.0
model’s mechanisms but also about quantifying the con- 0.0 0.2 0.4 0.6 0.8 1.0 0.0 0.2 0.4 0.6 0.8 1.0
fidence in its predictions. Conformal prediction (Shafer (a)Performancemetrics.
and Vovk 2008; Vovk, Gammerman, and Shafer 2005; An-
1.0
gelopoulos,Batesetal.2023)isamethodthatprovidesvalid
measures of uncertainty for predictions in a variety of ma- 0.8
chine learning tasks,ensuring that the coverage probability
ofpredictionintervals/setsisguaranteedunderminimalas- 0.6
sumptions.
Inthefieldofhealthcare,conformalpredictionhasshown 0.4
significant promise (Vazquez and Facelli 2022). For in-
0.2
stance,Csillagetal.(2023)employedconformalprediction Perfectly calibrated
Classifier
tosegmentandpredictthevolumeofamnioticfluidfromfe- 0.0
talMRIs.Likewise,Papadopoulos,Gammerman,andVovk 0.0 0.2 0.4 0.6 0.8 1.0
Predicted Probability
(2009)utilizedthismethodfordiagnosingacuteabdominal
pain. Furthermore, Olsson et al. (2022) applied conformal (b)Calibrationcurve.
predictionforthediagnosisandgradingofprostatebiopsies.
Figure2:Resultsofriskestimationonthecalibrationset:(a)
Recent advances in conformal prediction have concen-
Classificationmetricsand(b)Calibrationcurve.
trated on improving local coverage properties, tailoring
predictive intervals or sets to the specific characteristics
of the data (Romano, Patterson, and Candes 2019; Lei
and Wasserman 2012; Izbicki, Shimizu, and Stern 2020, hortofpatients(Buzattoetal.2024).Theretrospectiveco-
2022; Cabezas et al. 2024). These enhancements make hortincludedallpatientsfromHCRP-USP(2014-2021)and
distribution-free, model-agnostic uncertainty quantification MATER(2019-2021)whounderwentdiagnosticultrasound
tools more closely aligned with the precision medicine followed by core needle or excisional biopsy, whereas the
objectives that clinical prediction models seek to achieve prospective cohort comprised similar patients from HCRP-
(Steyerberg2019). USP,MATER,HospitaldeAmordeBarretos,andHospital
deAmordeCampoGrande,startingin2021andisstillon-
Notation going.
Throughout the paper we will make use of the following TheinclusioncriteriawerebreastlesionsclassifiedasBI-
notation.Theset{(X ,Y )}n willdenoteanindependent RADS at least 3 identifed by ultrasound and submitted to
i i i=1
and identically distributed (i.i.d.) sample of pairs of breast percutaneous core needle biopsy and/or excisional biopsy.
lesion data X ⊂ X ⊂ RD and their associated malig- ExclusioncriteriawerelesionsclassifedasBI-RADS2,le-
i
nancy Y ∈ {0,1} (benign or malignant, respectively). We sion, size greater than 30mm, age less than 18 years old,
i
define [n] = {1,...,n}. Data indices will be partitioned pathologiesnotprimaryfromthebreastandlesionssubmit-
into I = [n ], I = [n + n ] \ [n ], and ted exclusively to fine-needle aspiration cytology. The full
train train cal train cal train
I = [n]\[n +n ], where n +n +n = n detailscanbeseenin(Buzattoetal.2024,Methodology).
test train cal train cal test
and n train,n cal,n test > 0. Any model p (cid:98) will always be In this paper, we introduced minor modifications to the
trained on {(X i,Y i)} i∈Itrain, have its output calibrated on dataset. Specifically, we used a slightly updated version of
{(X i,Y i)} i∈Ical,andevaluatedon{(X i,Y i)} i∈Itest. the dataset and excluded entries with missing data for the
variables “palpable”, “age”, and “ri” instead of performing
Dataset
imputations. We also retained the original BI-RADS cate-
TheBreastLesionDatasetiscomprisedofn=1936breast gories of “shape” and “margins” without collapsing them.
lesions and contains both clinical, BI-RADS, and Doppler Theresultingdatasetwasthendividedintotraining(n =
train
features. The lesions come from a recent multicenter ob- 513), calibration (n = 1059), and test (n = 364)
cal test
servationalstudywitharetrospectiveandaprospectiveco- subsets. The training dataset consists solely of retrospec-
noitroporP
devresbOtive data, while the test dataset comprises only prospective ing decision tree (see Figure 4) partitions the lesion space
data.Thecalibrationdatasetincludesamixofboth,withits into distinct subgroups, reflecting the model’s varying dif-
larger size being necessary to support the local conformal ficulty in assessing these lesions. Surprisingly, our model
prediction method, which requires sufficient data per sub- captures well-known patterns that expert physicians recog-
group(Angelopoulos,Batesetal.2023). nize in US exams, such as circumscribed lesions in young
Prospective and retrospective patients have similar ages, patients, spiculated lesions with high vascularization, and
withmeanagesof51.95±13.58and51.44±15.18years,re- other less-defined subgroups that are more challenging for
spectively.Bothgroupshavesimilarlesionsize,withmeans doctorstomanage.
of16.70±6.99mmintheprospectiveand16.74±6.85mmin Locartcalibratestheriskassessmentmodellocallywithin
retrospective.Theproportionofpalpablelesionsislowerin each partition using standard conformal prediction tech-
theprospectivegroup,at55.12%,comparedto64.17inthe niques (Angelopoulos, Bates et al. 2023). This approach
retrospective. The resistance index (RI) is also slight lower generates personalized confidence sets for each prediction,
intheprospectivegroup,withameanof0.39±0.38,com- giving clinicians both a risk estimate and a clear measure
paredto0.48±0.41intheretrospective.Irregularshapesare of uncertainty. As demonstrated by Theorems 1 and 2, and
the most common in both groups, being more prevalent in shown empirically in Table 2, the method achieves condi-
theprospectivegroupat61.17%comparedto51.80%.Cir- tionalcoverage,unlikestandardconformalpredictionmeth-
cumscribed margins are more frequent in the retrospective odsthatonlyprovidemarginalizedcoverage.
data,representing36.51%.Orientationismostlyparallelin
ThesourcecodeforPersonalizedUS,alongwithitsdocu-
bothgroups,withaslighthigherproportionintheprospec-
mentation,willbepublishedinapublicrepositoryafterthe
tivegroupat73.82%comparedto67.19%intheretrospec-
anonymousreviewprocess.Thewebapplicationwillalsobe
tive.
accessiblefollowingthereview.
A table summarizing these statistics will be provided in
the supplementary material. The resulting Breast Lesion
Datasetwillbeavailableasacsvfile. Methodology
RiskAssessmentModel
PersonalizedUS
We introduce PersonalizedUS, an interpretable machine In our study, we trained a logistic regression model to as-
learning system for assessing the malignancy of breast le- sessthemalignancyofbreastlesionsidentifiedduringultra-
sions identified by ultrasound. The system combines regu- sound examinations. Logistic regression was chosen for its
larizedlogisticregressionwithmodernconformalprediction simplicityandinterpretability,makingithighlysuitablefor
tools to deliver accurate (see Table 1 and Figure 2) and in- healthcareapplications(Steyerberg2019).
terpretable predictions with personalized uncertainty quan- The model was developed on the training set follow-
tification. ing a grid search procedure based on 5-fold cross vali-
The system is deployed as an intuitive web application dation for optimizing the regularization parameter C ∈
(see Figure 1) for specialist physicians at four Brazilian {0.01,0.1.,...,100}.Themodelwiththelowestlog-losswas
breastcancerreferencecenters:HCRP-USP,MATER,Hos- chosen as the best model. The model was implemented in
pitaldeAmordeBarretos,andHospitaldeAmordeCampo scikit-learn, with the the categorical features “mar-
Grande. The platform allows clinicians to input patient- gins”and“shape”beingone-hotencodedandthenumerical
specificdata,receiveinterpretableriskassessments,andex- features“age”,“size”,and“ri”beingstandardized.
plorethedetaileduncertaintymeasuresinreal-time.Thein-
terface is designed to be user-friendly, ensuring that even
Baselines
those with minimal technical expertise can effectively uti-
lizethetool.
To provide a robust evaluation of our logistic regression
Twousecasesofthesystemaredescribedin“Scopeand
model, we compared its performance against several other
PromiseforSocialImpact”,alongwithexpectedsocialben-
widely-used machine learning algorithms, including deci-
efits in terms of facilitated access to medical resources and
sion trees, Naive Bayes, k-nearest neighbors (KNN), XG-
reducedmentalhealthburdenamongwomenwithsuspected
Boost,neuralnetworks,AdaBoost,randomforest,andsup-
breastcancer(DragasetandLindstrom2003).
port vector machines (SVM). Each model was trained and
A key innovation in our work is the adaptation of Lo-
evaluatedunderthesameexperimentalconditionstoensure
cart (Cabezas et al. 2024), a conformal prediction method
afaircomparison.
designed for achieving local conditional coverage, to the
The results are summarized in Table 1. Our logistic re-
binary classification setting of malignancy prediction. This
gression model achieved a competitive performance, with
novelapproachinvolvesfittingadecisiontreeregressortoa
a strong balance between sensitivity (0.900) and speci-
modifiedcalibrationdataset:
ficity(0.888).Althoughsomemorecomplexmodelsshowed
slightlyhighermetrics,thedifferencesweremarginal.These
D :={(X ,r )|i∈I },
res i i cal resultssuggestthattherearenosignificantadvantagesinus-
wherer representtheclassificationresidualsfromthelogis- ing more complex models at the cost of the interpretability
i
ticmodelonthecalibrationset{(X ,Y )} .Theresult- offeredbylogisticregression.
i i i∈IcalModel Sensitivity Specificity PPV NPV overD res,1.Specifically,foreachelementX j ofthepar-
tition,thequantileq wasdeterminedas:
Logistic 0.900 0.888 0.897 0.892 j
DT 0.770 0.947 0.940 0.793 q =Quantile (r : (X ,r )∈D , X ∈X ),
j,1−α 1−α˜ i i i res,1 i j
NB 0.687 0.975 0.967 0.743
KNN 0.903 0.894 0.902 0.896 where
⌈(k +1)·α⌉
XGB 0.865 0.871 0.878 0.857 α˜ = j ,
NN 0.885 0.904 0.908 0.880 |k j|
AB 0.818 0.908 0.905 0.822
is the adjusted significance level of α ∈ (0,1) (An-
RF 0.900 0.878 0.888 0.891
gelopoulos,Batesetal.2023)and
SVM 0.898 0.896 0.903 0.891
k :=|{(X ,r )∈D |X ∈X }|
j i i res,1 i j
Table1:ComparisonoflearningalgorithmsovertheBreast
LesionDataset. isthenumberofpatientsinD res,1thatarealsoinX j.
5. Personalized quantification of uncertainty. Given a
testlesion X , i ∈ I ,we checkwhichelement X of
i test j
PersonalizedUncertaintyQuantification thepartitionitbelongs,thenwedefineitspredictionset
as
In this section, we present a novel method to construct in-
terpretable and adaptive prediction sets for the predictions
C (x)={ℓ∈{0,1}:p(y =ℓ|X =x)≥1−q }.
locart (cid:98) j,1−α
of our risk model. Concretely, we adapt the Locart method
tothebinaryclassificationsettingofmalignancyprediction The theoretical foundations for this method are estab-
(Cabezasetal.2024). lishedin(Cabezasetal.2024)andexplainednext.
Themethodisdesignedtopartitionthelesionspaceina
Theorem 1 (Theorem 2 in Cabezas et al. (2024)). Let
waythatreflectsthevaryingdifficultyofmalignancypredic-
{X ,...,X }beafinitepartitionofthelesionspace.Given
tion with respect to our machine learning model. Standard 1 K
conformal prediction methods are then applied to these lo- an exchangeable sequence (X i,y i)n i=+ 11 and a miscoverage
cal partitions, thereby providing local coverage guarantees levelα∈(0,1),thefollowingholds:
for individual predictions. The details of this approach are P[Y ∈C (X )|X ∈X ]≥1−α,
outlinednext. n+1 locart n+1 n+1 j (cid:98)
1. Calculating residuals. Let p (cid:98)be the malignancy predic- for all j = 1,...,K where α˜ = ⌈(kj |+ kj1 |)·α⌉ and k j :=
tion model. For each i ∈ I cal, we began by calculating |{i∈[n]|X
i
∈X j}|.
theresidualsoverthecalibrationset:
Thetheoremguaranteesthat,givenafinitepartitionofthe
(cid:26)
1−pˆ(Y =1|X ), if y =1, feature space, the probability that the prediction for a new
r = i i
i 1−pˆ(Y =0|X ), if y =0. sample falls within the local prediction band—conditioned
i i
on the sample belonging to one of these partitions—is at
2. Creatingresidualdataset.AnewdatasetD wasthen least1−α.
res
created by combining the calibration data D with the The core idea behind the in this approach model is that,
cal
residualsr ,thatis: by leveraging the partition learned from the decision tree,
i
wecanachievelocalconditionalcoverage.Infact,Cabezas
D res :={(X i,r i)|i∈I cal}. et al. (2024) show that this local method for uncertainty
quantificationachievesasymptoticcoverage.
Then, we split this dataset in two subsets: D and
res,0
D ,suchthat,D =D ∪D . Theorem2. Givenalesionx∈X,letX(x)betheelement
res,1 res res,0 res,1
ofthelearnedpartitiongivenbyLocartwhichxbelongsto.
3. Learningpatientsubgroups.Wetrainedadecisiontree
Undercertainregularityconditions,Locarthasconditional
regressorT(cid:98)overD res,0.Thisdecisiontreeinducedapar-
validity,thatis
titionofthefeaturespacewithsizeK:
lim P[Y ∈C (X )|X ∈X(x)]=
n+1 locart n+1 n+1
n→∞
K
(cid:91) P[Y ∈C(X )|X =x],
X = X . n+1 n+1 n+1
i
i=1 whereC(·)isthetheoreticaloptimalconfidenceset.
Weexpectthispartitiontoeffectivelycaptureandreflect
In summary, integrating Locart into PersonalizedUS
thevaryingcomplexityofcancerpredictionswithineach
marksasignificantstepforwardinuncertaintyquantification
lesionsubgroup,ensuringthattheriskmodel’slocalbe-
forbreastcancerriskassessment.Thisapproachensuresthat
haviorisaccuratelyrepresented.
each prediction comes with a locally adaptive confidence
4. Calculatingquantilesforeachsubgroup.Givenamis- interval, enhancing both the reliability and interpretability
coveragelevelα∈(0,1),foreachpartitionlearnedfrom ofthemodel,ultimatelymakingitamoreeffectivetoolfor
D , we calculated an adjusted coverage quantile α˜ clinicaldecision-making.
res,0LearningLesionSubgroups
1.00 BIRADS 1.00 Class
3 0
4a 1
Following the steps outlined in the previous section, we 0.80 4 4b c 0.80
5
fitted a decision tree regressor to the residual dataset. 0.60 6 0.60
The tree model was developed on the basis of a grid 0.40 0.40
search procedure via 5-fold cross-validation for optimiz- 0.20 0.20
ingthestructuralparameters“max depth” ∈ [3,4,5,6]and 0.00 4 5 6 9 11 12 13 15 16 0.00 4 5 6 9 11 12 13 15 16
Lesion Subgroups Lesion Subgroups
“min samples leaf”∈[70,80,90,100].Themodelwiththe
1.00
lowest mean squared error was chosen as the best model. 50.00
0.80 Themodelwasimplementedinscikit-learn,withthe 40.00
0.60 categorical features “shape” and “margins” being ordinal- 30.00
encoded. 0.40 20.00
0.20 10.00
Evaluation 0.00 4 5 6 Les9 ion S1 u1 bgr1 o2 ups13 15 16 0.00 4 5 6 Les9 ion S1 u1 bgr1 o2 ups13 15 16
RiskEstimation Figure3:LesionsubgroupsanalysisofBIRADScategories,
malignancy,predictiveaccuracy,andsubgroupsize.
The selected logistic regression model was then evaluated
onthecalibrationsettodetermineitsperformance.Wecom-
paredthemodel’sriskestimatestotheactualoutcomesand
with α = 0.1, grouping by leaf. Also, we show a stacked
calculated key performance metrics, including sensitivity
plotofsetsizesinFigure5.
(recallofclass1),specificity(recallofclass0),positivepre-
As we can see from the first column of Table 2 and Fig-
dictive value (precision of class 1), and negative predictive
ure5,theaveragesetsizewascloseto1formostleaves,ex-
value(precisionofclass0),theresultingcurvescanbeseen
ceptforleaves11and12.Thispatternisalsoevidentinthe
inFigure2alongwiththemodel’scalibrationcurve.Wealso
last column of Table 2, where lesions within leaves 11 and
evaluated the Area Under the ROC curve (0.958), the Area
12 were considerably more challenging for our risk model
Under the Precision-Recall Curve (0.960), the and log-loss
to assess. This behavior is expected, as Locart groups le-
(0.268).
sions based on their relative difficulty for the malignancy
prediction model. Therefore, leaves 11 and 12 contain the
LesionSubgroupEvaluation
morechallenginglesions,enablingtighterpredictivesetsin
TwomedicaldoctorswithspecializedtraininginAI(IBand theremainingleaves.Notably,thesetwo“hard”leavesrep-
DT) evaluated the resulting tree structure depicted in Fig- resent only 20% of the test set, suggesting that our model
ure4.Accordingtotheirexpertassessment,themodelsuc- reliablypredictsmalignancyfor80%ofthedataset,which,
cessfullycapturespatternsthatphysicianscommonlyrecog- like the entire dataset, consists solely of suspicious lesions
nize in ultrasound exams, such as circumscribed lesions in thatwerebiopsied.Finally,theobservedfluctuationofupto
youngpatients,spiculatedlesionswithhighvascularization, 10% in empirical coverage falls within the expected range,
and otherless-defined subgroupsthat aremore challenging given the sample size of approximately 100 points per leaf
tomanage. (Angelopoulos,Batesetal.2023).
As illustrated in Figure 3, these patterns are also evident
in the distribution of BI-RADS categories and malignancy Avg.SetSize Emp.Cov.(%) TruthOnly(%)
across subgroups. The leftmost groups predominantly fea- Leaf
turebenignBI-RADS3and4alesions,whiletherightmost
4 0.96 96.43 96.43
groupscontainmostBI-RADS4c,5,andmalignantlesions,
5 0.97 94.59 94.59
which are generally easier to predict. The middle groups,
6 0.97 97.44 97.44
however,aremoremixed,consistingmainlyofBI-RADS4
9 1.00 95.65 95.65
and 5 lesions with varying levels of malignancy. These le-
11 1.55 89.29 33.93
sions proved especially challenging for our logistic regres-
12 1.41 94.87 53.85
sionmodel.
13 0.97 89.19 89.19
UncertaintyQuantificationEvaluation 15 0.93 90.48 90.48
16 1.00 100.00 100.00
Predictionsetsgenerated byLocartwereevaluated accord-
ing to three criteria: (i) average set size, (ii) comparison
Table2:Evaluationofourlocalconformalpredictiontool.
between theoretical and empirical coverage, and (iii) pro-
portion of prediction sets containing only the ground truth.
A successful application of conformal prediction to binary
ScopeandPromiseforSocialImpact
classification is expected to often produce singleton sets,
with empirical coverage close to 1 − α. A successful ap- Two significant social issues arise from false positive US
plication of Locart further requires that these metrics hold evaluations: (i) an increased burden on the healthcare sys-
conditionallytoX ∈ X forj ∈ I .Assuch,inTable2 tem, particularly on pathologists, which delays timely ac-
j J test
we show the result of applying the three evaluation criteria cess to treatment for those in need, and (ii) the substantial
noitroporP
snoitciderP
tcerroC
noitroporP
snoiseL
fo rebmuNFigure 4: Decision tree regressor trained for predicting the classification residuals of our logistic regression model over the
calibrationset.
sessed risks as determined by our model. Even though this
Prediction Set Size
0 approachwouldn’treducetheoverallloadonthehealthcare
50 1 2 system, it would help ensure that high-risk patients receive
40 priorityaccesstomedicalresources.
To evaluate the effectiveness of our system in differenti-
30 atingbetweenbenignandmalignantbreastmasses,wefur-
ther analysed its test set performance by considering only
20 BI-RADS 4a and 4b lesions. Using an approach similar to
that of Buzatto et al. (2024), we selected a threshold that
10
maximizedthenegativepredictivevaluewhileensuringthe
positivepredictivevaluedidnotfallbelowthatofBI-RADS
0 4 5 6 9 11 12 13 15 16
Lesion Subgroups 4b(Yoonetal.2011).Ifthemodel’srecommendationswere
followed, only 64 out of 196 biopsies would be requested,
Figure5:Stackedplotof(local)averagesetsizes.
representingareductionofmorethan65%.Moreover,with
the optimized threshold (t = 0.223), the model wouldn’t
missanycancercasesamongBI-RADS4aand4blesions.
mental health impact on patients and their families, espe-
ciallyinunderservedcommunities(DragasetandLindstrom
ConclusionandFollow-upWork
2003). This section discusses two potential applications of
our prediction model aimed at optimizing the biopsy refer- This paper introduces PersonalizedUS, an interpretable AI
ral process to ensure it prioritizes those who really need it, system for predicting malignancy of breast lesions identi-
andalleviatethestressandanxietyexperiencedbypatients fied by US. The system combines logistic regression with
andtheirfamilies. newconformalpredictionmethodstoprovideaccuratepre-
Thefirst,moststraightforwardapplicationofourmodelis dictionswithindividualizeduncertaintyquantification.
to assist radiologists in differentiating between benign and Thesystemisdeployedasawebapplicationforspecial-
malignantlesions.Inthisscenario,thephysicianwouldini- ists at four Brazilian breast cancer reference centers. The
tially evaluate the US exam and then, specially for lesions siteallowsdoctorstoenterpatientdata,receiveinterpretable
classifiedasBI-RADS4aand4b,useourmachinelearning risk estimates, and explore uncertainty quantification. We
system for a second opinion, if desired. In cases where the explored two use cases of the system, along with expected
model is highly confident the lesion is benign, the radiol- social benefits in terms of facilitated access to medical re-
ogist would be prompted to carefully reconsider whether a sources and reduced mental health burden among women
biopsyreferralisnecessary. withsuspectedbreastcancer.
Another, less intrusive application of our prediction A novelty in our work is the use of Locart, a conformal
modelistorankpatientsawaitingbiopsybasedontheiras- prediction method designed for achieving local conditional
tnuoCcoverage.Thismethodpartitionsthelesionspace,reflecting Chen,Y.;andNeville,J.,eds.,Thirty-SeventhAAAIConfer-
themodel’svaryingdifficultyinassessingtheselesions.Our enceonArtificialIntelligence,AAAI2023,Thirty-FifthCon-
treecaptureswell-knownpatternsthatspecialistsrecognize ferenceonInnovativeApplicationsofArtificialIntelligence,
in US exams, such as circumscribed lesions in young pa- IAAI2023,ThirteenthSymposiumonEducationalAdvances
tients,spiculatedlesionswithhighvascularization,andother inArtificialIntelligence,EAAI2023,Washington,DC,USA,
less-definedsubgroupsthatareharderfordoctorstomanage. February7-14,2023,15494–15502.AAAIPress.
de Hond, A. A. H.; Leeuwenberg, A. M.; Hooft, L.; Kant,
FacilitationofFollow-upWork Locart’smodel-agnostic
I. M. J.; Nijman, S. W. J.; van Os, H. J. A.; Aardoom,
nature allows our logistic regression model to be easily re-
J.J.;Debray,T.P.A.;Schuit,E.;vanSmeden,M.;Reitsma,
placed by more complex models, such as neural networks,
J. B.; Steyerberg, E. W.; Chavannes, N. H.; and Moons, K.
without affecting the personalized uncertainty quantifica-
G. M. 2022. Guidelines and quality criteria for artificial
tion. Also, we will make both our data and code publicly
intelligence-based prediction models in healthcare: a scop-
availableafterthereviewprocess.
ingreview. npjDigitalMedicine,5(1).
Doshi-Velez, F.; and Kim, B. 2017. Towards a rigorous
References
science of interpretable machine learning. arXiv preprint
Angelopoulos,A.N.;Bates,S.;etal.2023. Conformalpre- arXiv:1702.08608.
diction:Agentleintroduction. FoundationsandTrends®in
Dragaset,S.;andLindstrom,T.C.2003. Thementalhealth
MachineLearning,16(4):494–591.
ofwomenwithsuspectedbreastcancer:therelationshipbe-
Berg, W. A. 2008. Combined Screening With Ultrasound tween social support, anxiety, coping and defence in main-
and Mammography vs Mammography Alone in Women at taining mental health. Journal of Psychiatric and Mental
Elevated Risk of Breast Cancer. JAMA, 299(18): 2151– HealthNursing,10(4):401–409.
2163. Feig, S. 2010. Cost-Effectiveness of Mammography, MRI,
Bray,F.;Laversanne,M.;Sung,H.;Ferlay,J.;Siegel,R.L.; and Ultrasonography for Breast Cancer Screening. Radio-
Soerjomataram,I.;andJemal,A.2024.Globalcancerstatis- logicClinicsofNorthAmerica,48(5):879–891.
tics2022:GLOBOCANestimatesofincidenceandmortal- Hastie, T.; Tibshirani, R.; and Friedman, J. 2009. The el-
ityworldwidefor36cancersin185countries.CA:ACancer ements of statistical learning: data mining, inference, and
JournalforClinicians. prediction. SpringerScience&BusinessMedia.
Buzatto, I. P. C.; Recife, S. A.; Miguel, L.; Bonini, R. M.; Ho, T.-Q. H.; Bissell, M. C. S.; Kerlikowske, K.; Hubbard,
Onari, N.; Faim, A. L. P. A.; Silvestre, L.; Carlotti, D. P.; R. A.; Sprague, B. L.; Lee, C. I.; Tice, J. A.; Tosteson, A.
Fro¨hlich,A.;andTiezzi,D.G.2024. Machinelearningcan N. A.; and Miglioretti, D. L. 2022. Cumulative Probabil-
reliablypredictmalignancyofbreastlesionsbasedonclin- ity of False-Positive Results After 10 Years of Screening
icalandultrasonographicfeatures. BreastCancerResearch With Digital Breast Tomosynthesis vs Digital Mammogra-
andTreatment. phy. JAMANetworkOpen,5(3):e222440.
Cabezas,L.;Otto,M.P.;Izbicki,R.;andStern,R.B.2024. Hubbard,R.A.;Kerlikowske,K.;Flowers,C.I.;Yankaskas,
RegressionTreesforFastandAdaptivePredictionIntervals. B. C.; Zhu, W.; and Miglioretti, D. L. 2011. Cumulative
arXivpreprintarXiv:2402.07357. Probability of False-Positive Recall or Biopsy Recommen-
dation After 10 Years of Screening Mammography: A Co-
Collins, G. S.; Moons, K. G. M.; Dhiman, P.; Riley, R. D.;
hortStudy. AnnalsofInternalMedicine,155(8):481.
Beam, A. L.; Van Calster, B.; Ghassemi, M.; Liu, X.; Re-
itsma,J.B.;vanSmeden,M.;Boulesteix,A.-L.;Camaradou, Izbicki, R.; Shimizu, G.; and Stern, R. 2020. Flexible
J. C.; Celi, L. A.; Denaxas, S.; Denniston, A. K.; Glocker, distribution-free conditional predictive bands using density
B.;Golub,R.M.;Harvey,H.;Heinze,G.;Hoffman,M.M.; estimators. InInternationalConferenceonArtificialIntelli-
Kengne,A.P.;Lam,E.;Lee,N.;Loder,E.W.;Maier-Hein,
genceandStatistics,3068–3077.PMLR.
L.;Mateen,B.A.;McCradden,M.D.;Oakden-Rayner,L.; Izbicki,R.;Shimizu,G.;andStern,R.B.2022. Cd-splitand
Ordish,J.;Parnell,R.;Rose,S.;Singh,K.;Wynants,L.;and hpd-split: Efficient conformal regions in high dimensions.
Logullo,P.2024. TRIPOD+AIstatement:updatedguidance JournalofMachineLearningResearch,23(87):1–32.
for reporting clinical prediction models that use regression Kim, S.-Y.; Choi, Y.; Kim, E.-K.; Han, B.-K.; Yoon, J. H.;
ormachinelearningmethods. BMJ,e078378. Choi, J. S.; and Chang, J. M. 2021. Deep learning-based
Corsetti, V.; Houssami, N.; Ghirardi, M.; Ferrari, A.; computer-aided diagnosis in screening breast ultrasound to
Speziani,M.;Bellarosa,S.;Remida,G.;Gasparotti,C.;Gal- reducefalse-positivediagnoses. ScientificReports,11(395).
ligioni,E.;andCiatto,S.2011. Evidenceoftheeffectofad- Lazarus,E.;Mainiero,M.B.;Schepps,B.;Koelliker,S.L.;
junct ultrasound screening in women with mammography- andLivingston,L.S.2006. BI-RADSLexiconforUSand
negative dense breasts: Interval breast cancers at 1year Mammography: Interobserver Variability and Positive Pre-
follow-up. EuropeanJournalofCancer,47(7):1021–1026. dictiveValue. Radiology,239(2):385–391.
Csillag,D.;Paes,L.M.;Ramos,T.;Romano,J.V.;Schuller, Lei,J.;andWasserman,L.2012. DistributionFreePredic-
R.;deBeauclairSeixas,R.;Oliveira,R.I.;andOrenstein,P. tionBands. arXiv:1203.5422.
2023.AmnioML:AmnioticFluidSegmentationandVolume Lipton, Z. C. 2018. The mythos of model interpretability.
PredictionwithUncertaintyQuantification. InWilliams,B.; CommunicationsoftheACM,61(10):36–43.Mendelson,E.;Bo¨hm-Ve´lez,M.;Berg,W.;etal.2013.ACR Shafer, G.; and Vovk, V. 2008. A Tutorial on Conformal
BI-RADSUltrasound. AmericanCollegeofRadiology. Prediction. JournalofMachineLearningResearch,9(3).
Niu, S.; Huang, J.; Li, J.; Liu, X.; Wang, D.; Zhang, R.; Shen,W.-C.;Chang,R.-F.;Moon,W.K.;Chou,Y.-H.;and
Wang, Y.; Shen, H.; Qi, M.; Xiao, Y.; Guan, M.; Liu, H.; Huang,C.-S.2007. BreastUltrasoundComputer-AidedDi-
Li,D.;Liu,F.;Wang,X.;Xiong,Y.;Gao,S.;Wang,X.;and agnosis Using BI-RADS Features. Academic Radiology,
Zhu,J.2020.Applicationofultrasoundartificialintelligence 14(8):928–939.
in the differential diagnosis between benign and malignant Shen, Y.; Park, J.; Yeung, F.; Goldberg, E.; Heacock,
breastlesionsofBI-RADS4A. BMCCancer,20(1). L.; Shamout, F.; and Geras, K. J. 2023. Leveraging
Olsson, H.; Kartasalo, K.; Mulliqi, N.; Capuccini, M.; Ru- Transformers to Improve Breast Cancer Classification and
usuvuori, P.; Samaratunga, H.; Delahunt, B.; Lindskog, C.; RiskAssessmentwithMulti-modalandLongitudinalData.
Janssen, E.; Blilie, A.; ISUP Prostate Imagebase Expert arXiv:2311.03217.
Panel; Egevad, L.; Spjuth, O.; and Eklund, M. 2022. Es- Shen, Y.; Shamout, F. E.; Oliver, J. R.; Witowski, J.; Kan-
timating diagnostic uncertainty in artificial intelligence as- nan,K.;Park,J.;Wu,N.;Huddleston,C.;Wolfson,S.;Mil-
sisted pathology using conformal prediction. Nature Com- let, A.; Ehrenpreis, R.; Awal, D.; Tyma, C.; Samreen, N.;
munications,13(1). Gao, Y.; Chhor, C.; Gandhi, S.; Lee, C.; Kumari-Subaiya,
Papadopoulos,H.;Gammerman,A.;andVovk,V.2009.Re- S.;Leonard,C.;Mohammed,R.;Moczulski,C.;Altabet,J.;
liable diagnosis of acute abdominal pain with conformal Babb, J.; Lewin, A.; Reig, B.; Moy, L.; Heacock, L.; and
prediction. International journal of engineering intelligent Geras, K. J. 2021. Artificial intelligence system reduces
systemsforelectricalengineeringandcommunications,17: false-positive findings in the interpretation of breast ultra-
127–137. soundexams. NatureCommunications,12(1).
Pfob,A.;Sidey-Gibbons,C.;Barr,R.G.;Duda,V.;Alwafai, Sivarajah,R.T.;Brown,K.;andChetlen,A.2020.“Icansee
Z.; Balleyguier, C.; Clevert, D.-A.; Fastner, S.; Gomez, C.; clearly now.” fundamentals of breast ultrasound optimiza-
Goncalo, M.; Gruber, I.; Hahn, M.; Hennigs, A.; Kapetas, tion. ClinicalImaging,64:124–135.
P.; Lu, S.-C.; Nees, J.; Ohlinger, R.; Riedel, F.; Rutten, Steyerberg,E.W.2019.ClinicalPredictionModels:APrac-
M.;Schaefgen,B.;Schuessler,M.;Stieber,A.;Togawa,R.; tical Approach to Development, Validation, and Updating.
Tozaki, M.; Wojcinski, S.; Xu, C.; Rauch, G.; Heil, J.; and SpringerInternationalPublishing. ISBN9783030163990.
Golatta, M. 2022. The importance of multi-modal imag-
Vazquez, J.; and Facelli, J. C. 2022. Conformal Prediction
ingandclinicalinformationforhumansandAI-basedalgo-
in Clinical Medical Sciences. Journal of healthcare infor-
rithmstoclassifybreastmasses(INSPiRED003):aninter-
maticsresearch,6(3):241—252.
national, multicenter analysis. European Radiology, 32(6):
Vovk,V.;Gammerman,A.;andShafer,G.2005. Algorith-
4101–4115.
miclearninginarandomworld,volume29. Springer.
Prabhakar,T.;andPoonguzhali,S.2017. Automaticdetec-
Yang, L.; Wang, S.; Zhang, L.; Sheng, C.; Song, F.; Wang,
tion and classification of benign and malignant lesions in
P.; and Huang, Y. 2020. Performance of ultrasonography
breast ultrasound images using texture morphological and
screening for breast cancer: a systematic review and meta-
fractalfeatures. 201710thBiomedicalEngineeringInterna-
analysis. BMCCancer,20(1).
tionalConference(BMEiCON),1–5.
Yoon, J. H.; Kim, M. J.; Moon, H. J.; Kwak, J. Y.; and
Prager,G.W.;Braga,S.;Bystricky,B.;Qvortrup,C.;Crisc-
Kim, E.-K. 2011. Subcategorization of Ultrasonographic
itiello,C.;Esin,E.;Sonke,G.S.;Martinez,G.;Frenel,J.-S.;
BI-RADS Category 4: Positive Predictive Value and Clini-
Karamouzis, M.; Strijbos, M.; Yazici, O.; Bossi, P.; Baner-
calFactorsAffectingIt. UltrasoundinMedicine&Biology,
jee, S.; Troiani, T.; Eniu, A.; Ciardiello, F.; Tabernero, J.;
37(5):693–699.
Zielinski,C.C.;Casali,P.G.;Cardoso,F.;Douillard,J.-Y.;
Jezdic,S.;McGregor,K.;Bricalli,G.;Vyas,M.;andIlbawi,
A.2018. Globalcancercontrol:respondingtothegrowing
burden,risingcostsandinequalitiesinaccess. ESMOOpen,
3(2):e000285.
Qi,X.;Zhang,L.;Chen,Y.;Pi,Y.;Chen,Y.;Lv,Q.;andYi,
Z.2019.Automateddiagnosisofbreastultrasonographyim-
agesusingdeepneuralnetworks. MedicalImageAnalysis,
52:185–198.
Romano,Y.;Patterson,E.;andCandes,E.2019.Conformal-
ized Quantile Regression. In Wallach, H.; Larochelle, H.;
Beygelzimer,A.;d'Alche´-Buc,F.;Fox,E.;andGarnett,R.,
eds., Advances in Neural Information Processing Systems,
volume32.CurranAssociates,Inc.
Rudin,C.2019.Stopexplainingblackboxmachinelearning
modelsforhighstakesdecisionsanduseinterpretablemod-
elsinstead. NatureMachineIntelligence,1(5):206–215.