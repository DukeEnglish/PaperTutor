PixelsDB: Serverless and Natural-Language-Aided Data Analytics
with Flexible Service Levels and Prices
HaoqiongBian DongyangGeng
RenminUniversityofChina RenminUniversityofChina
bianhq@ruc.edu.cn gengdongyang@ruc.edu.cn
HaoyangLi AnastasiaAilamaki
RenminUniversityofChina EPFL
lihaoyang.cs@ruc.edu.cn anastasia.ailamaki@epfl.ch
ABSTRACT highelasticityofserverlesscomputingwhilenotcompromisingthe
Serverlessqueryprocessinghasbecomeincreasinglypopulardue scalabilityandcost-efficiencyonsustainedworkloads,ourprevi-
toitsadvantages,includingautomatedhardwareandsoftwareman- ousworkproposedahybridqueryenginenamedPixels-Turbo[7].
agement,highelasticity,andpay-as-you-gopricing.Foruserswho Itprocessesqueriesinanauto-scaledVMclusterbydefaultand
arenotsystemexperts,serverlessqueryprocessinggreatlyreduces invokescloudfunctions(CFs)toaccelerateworkloadspikeswhen
thecostofowningadataanalyticsystem.However,itisstillasig- theVMclustercannotscaleoutintime.Inthispaper,weenhance
nificantchallengefornon-expertuserstotransformtheircomplex Pixels-Turbo by allowing users to control whether adaptive CF
andevolvingdataanalyticneedsintoproperSQLqueriesandselect accelerationisenabled.Forurgentqueries,enablingCFaccelera-
aserverlessqueryenginethatdeliverssatisfactoryperformance tionensuresimmediatequeryexecutionbutresultsinapotentially
andpriceforeachtypeofquery. higherprice.Fornon-urgentqueries,userscandisableCFacceler-
ThispaperpresentsPixelsDB,anopen-sourcedataanalyticsys- ationandgivetheVMclusterampletimetoscaleproperly,thus
temthatallowsuserswholacksystemorSQLexpertisetoexplore improvingcostefficiency.Thisprovidesuserstheflexibilitytose-
dataefficiently.ItallowsuserstogenerateanddebugSQLqueries lectasatisfactoryservicelevel(intermsofpendingtime)andprice
usinganaturallanguageinterfacepoweredbyfine-tunedlanguage fromarangeofchoices,justlikepurchasingproductsinastore.
models.Thequeriesarethenexecutedbyaserverlessqueryen- Althoughflexibleservicelevelsandpricessignificantlyimprove
ginethatoffersvaryingpricesfordifferentservicelevelsonquery theusabilityandcostefficiencyofaserverlessqueryengine,there
urgency.Theservicelevelsarenativelysupportedbydedicatedar- isanothersignificantchallengefornon-professionaluserstotrans-
chitecturedesignandheterogeneousresourceschedulingthatcan formcomplexandevolvingdataanalyticneedsintocorrectand
applycost-efficientresourcestoprocessnon-urgentqueries.We efficientSQLqueries.Thedatabasecommunityhasbeendedicated
envisionthatthecombinationofaserverlessparadigm,anatural- tosolvingthisproblemthroughconversationaldataanalyticsor
language-aidedinterface,andflexibleservicelevelsandpriceswill text-to-SQLforyears[8].Recently,languagemodelsrepresentedby
substantiallyimprovetheuserexperienceindataanalysis. GPT-3.5/4haverapidlyemergedandevolved,greatlyimprovingthe
qualityofcodegeneration.Forexample,theopen-sourcelanguage
modelbuiltbyCodeS[9]cantranslatenaturallanguagequestions
1 INTRODUCTION
intoexecutableSQLqueriesinasingleturnwithanaccuracyof
Serverless query processing, also known as Query-as-a-Service
over80%.Thisprovidesnewopportunitiesfornatural-language-
(QaaS),hasbecomethenewparadigmofanalyticalqueryprocess-
aideddataanalysis.Webelievenaturallanguageassistancecan
inginthecloud.Incontrasttotraditional‘serverful‘queryengines,
significantlyimproveusers’dataanalysisexperience.
serverlessqueryengineslikeAWSAthena[1]andBigQuery[5]
Thispaperpresentsanopen-sourcedataanalyticsystemnamed
automatelaborioustaskssuchasresourceprovisioningandcluster
PixelsDB(https://github.com/pixelsdb/pixels).Itcombinesserver-
scaling.Thisallowsuserstorunquerieswithouttheburdenofsys-
lessqueryprocessing,text-to-SQLtranslation,andflexibleservice
temmanagement.Moreover,usersarebilledonaper-querybasis
levelsandpricestoaddresstheaforementionedpainpoints,i.e.,sys-
accordingtothenumberofprocessingunitsused(e.g.,Redshift-
temmanagement,SQLwriting,andservicelevelandpriceflexibility,
serverless[3])oramountofdatascanned(e.g.,AWSAthena[1]
foruserswithoutsystemandSQLexpertise.Furthermore,amajor
andBigQuery[5])bythequeries.Inaword,foruserswhoarenot
intellectualcontributioninthispaperistoproposeanapproach
systemexperts,serverlessqueryprocessinggreatlyreducesthe
tonativelysupportingvaryingservicelevels(intermsofquery
effortrequiredtoownanduseadataanalyticsystem.
urgency)andpricesthrougharchitecturedesignandheterogeneous
However,existingserverlessqueryenginesareonlycost-efficient
resourcescheduling.Thisconformstousers’naturalclassification
inprocessingburstyandlow-volumeworkloads,astheyarebuilt
ofinteractiveandnon-interactivequeries.Itallowsthesystemto
uponserverlesscomputinginfrastructures(e.g.,cloudfunctionsor
schedulecost-efficientresourcestoexecutenon-urgentqueriesand
microvirtualmachines)thataretailoredforephemeralcomputing
providespotentialopportunitiesforbatchqueryoptimization.
tasks[7,10,11].Forsustainedworkloads,theseserverlessqueryen-
ginesarelessscalableand1-2ordersofmagnitudemoreexpensive
2 SYSTEMOVERVIEW
thanMPP(massivelyparallelprocessing)queryenginesrunningin
provisionedVM(virtualmachine)clusters[7].Tobenefitfromthe AsshowninFigure1,thewholesystemiscomposedofthreeparts.HaoqiongBian,DongyangGeng,HaoyangLi,andAnastasiaAilamaki
Figure1:OverviewoftheuserinterfaceandsystemarchitectureofPixelsDB.
(1)Pixels-Roverprovidestheuserinterfacedemonstratedin (3)CodeSprovideshigh-qualitytext-to-SQLtranslation,which
this paper. It applies a browser-server architecture. Its backend hasshownstate-of-the-artperformanceonchallengingtext-to-SQL
connectstothetext-to-SQLserviceandtheserverlessqueryengine. benchmarkssuchasSpider[6]andBIRD[4].ItexposesaREST
The user first logs in to Pixels-Rover, views the schema of the APItoPixels-Rover.Whenevertheusersubmitsanaturallanguage
authorizeddatabases,andselectsadatabasetoanalyze.Then,the question,Pixels-Rover’sbackendcompilesaJSONmessagecontain-
user’sanalyticquestionstypedintheTranslator aresenttothe ingthequestionandtheschemaelements(e.g.,tableandcolumn
text-to-SQLserviceforSQLtranslation.Eachquerytranslatedby names)oftheuser’sselecteddatabaseandsendsittoCodeS.Then,
thetext-to-SQLserviceisdisplayedasacodeblockbelowtheuser’s CodeStranslatesthequestionintoanSQLqueryandrespondsto
question.Theusercaneditthequeryinthecodeblockandsubmit Pixels-Rover.Unlikemulti-round-prompting-basedtext-to-SQLsys-
it with a desired service level (and corresponding price) to the tems,CodeSfollowsasingle-turninteractionparadigm.Therefore,
serverlessqueryengine.Pixels-Roverprovidesthreeservicelevels: theuser’squestionisdirectlytranslatedtoanSQLqueryinasingle
(a)Immediate,whichstartstoexecutethequeryimmediately;(b) round-trip.Ifthetranslatedqueryisnotsatisfactory,theusercan
Relaxed,whichstartstoexecutethequeryinaconfigurablegrace rephrasethequestionordirectlyeditthequeryinPixels-Rover.We
period;and(c)Best-of-effort,whichexecutesthequeryatbesteffort believethat,givenitshighaccuracy,asingle-turntext-to-SQLtrans-
withnoguarantee.Thestatusandresultofeachsubmittedquery lationismoreefficientthanmulti-roundprompting-basedmethods
areshownintheQueryResult areaandarelinkedtotheorigin fordataanalysts.Notethatthetext-to-SQLserviceinPixelsDBis
queryinthetranslator. plug-able,thuswecanupgradeorreplaceitindependently.
(2)Pixels-Turboisresponsibleforserverlessqueryprocessing
andprovidingflexibleservicelevelsandprices.Thearchitectureof
3 KEYTECHNOLOGIES
thePixels-TurboisshowninFigure1.Thesolidanddottedarrows
Inthissection,weintroducethekeytechnologiesbehindPixelsDB,
aretherequiredandoptionalstepstoprocessaquery.TheQuery
including how queries are executed on heterogeneous comput-
Server providesaRESTAPItoreceivequeriesfromclients(e.g.,
inginfrastructureswithvaryingelasticityandcost-efficiency(Sec-
Pixels-Rover)andinteractswiththeCoordinatortofetchdatabase
tion3.1),howflexibleservicelevelsandpricesareimplemented
schemaandschedulethequeriestoexecuteatspecifiedservice
ontheaforementionedqueryruntime(Section3.2),andhowNL
levels.ThecoordinatorrunsinasmallVM,whichistheonlylong-
questionsaretranslatedtoSQLqueries(Section3.3).
runningcomponentinthequeryengine.Itisresponsibleformanag-
ingmetadata,parsingqueries,coordinatingqueryexecutiontasks,
andcollectingthequeryresultsandstatistics(e.g.,executiontime 3.1 QueryExecution
andresourceconsumption).TheVMclusterandtheCFServiceare Virtualmachine(VM)andcloudfunction(CF)arethetwomajor
thetwocomputingresourcesthatPixels-Turboadaptivelyusesto typesofcomputingservicesinthecloud.AsdiscussedinSection2,
executequeries.TheVMclusterismorecost-efficientforprocess- VMismorecost-efficientbutlesselasticthanCF.Therefore,they
ingstableworkloadsbutrequires1-2minutestoscaleforworkload canbecomplementaryinsupportingelasticandcost-efficientquery
changes.WhereastheCFserviceismoreelastic(e.g.,createhun- processing.InPixels-Turbo,theCoordinatorcandynamicallycreate
dredsofworkersin1second)buthas9-24xhigherresourceunit CFWorkerstoexecutethenewcomingquerieswhentheVMcluster
prices[7].BasetablesandCF-producedintermediateresultsare doesnothaveenoughresourcesandcannotscaleoutintime.This
storedincloudobjectstorage,suchasAWSS3.Inthispaper,we isdonebypushingdowntheexpensiveoperators(e.g.,tablescans,
modifythecoordinatortoprovideinterfacesforthequeryserverto joins,andaggregations)fromthetop-levelplanofthenewcoming
checkthesystem’sloadstatus(i.e.,queryconcurrency)andspecify queryintoasub-plan.TheephemeralCFworkersarethenlaunched
whetherCFcanbeenabledtoexecuteaquery. toexecutethesub-planandreturnitsresultasamaterializedview
tothetop-levelplanrunningintheVMcluster.Thus,thequeryPixelsDB:ServerlessandNatural-Language-AidedDataAnalyticswithFlexibleServiceLevelsandPrices
isexecutedwithoutfurtheroverloadingtheVMcluster,andthis helpstheVMclusteravoidunnecessaryscaling-in2andproduces
istransparenttousers.After1-2minutes,whentheVMcluster verylittleextracosts.Inthedemo,wesetthepriceofbest-of-effort
scalestoanappropriatecapacity,CFwillnolongerparticipatein queriesto10%oftheimmediatequeries,i.e.,$0.5/TB-scan.
processingthecomingqueries.Moredetailsaboutqueryexecution Notethateachservicelevelonlyspecifiestheupperboundon
inCFsarediscussedinSection4ofourpriorpaper[7]. querypendingtime.Evenforarelaxedorbest-of-effortquery,it
AsshowninFigure1,theVMclusterisauto-scaledfollowing maybeexecutedimmediatelyiftheVMclusterisavailable.
workloadchanges(althoughitmayhave1-2minutesoflag).This
is done by monitoring the query concurrency in the VM clus- 3.3 Text-to-SQL
ter. When the query concurrency is higher than a configurable
Inadditiontoitsefficientsingle-turntranslation,wechoseCodeS
highwatermark (e.g., 5), the coordinator triggers a scaling-out
becauseitisanopen-sourcelanguagemodelwithouttheriskof
eventtocreateandaddmoreworkerstotheVMcluster.When databreachesandhighcosts.WhenreceivingaJSONmessagefrom
theaveragequeryconcurrencywithinaperiodislowerthana theclient,CodeSidentifiestheschemaelementsmostrelatedtothe
configurablelowwatermark(e.g.,0.75),thecoordinatortriggersa user’squestion(a.k.a.,“schemapruning”)andserializesthemwith
scaling-ineventtoreleasesomeVMworkersgracefully.Weob- thequestionintoasinglesequence,whichisthenfedintoadecoder-
servedthisauto-scalingmethodiseffectivefortypicalanalytical onlygenerationlanguagemodeltogeneratethecorrespondingSQL
workloadssuchasTPC-HandInternetloganalysis[7]. query.TheschemapruningstageenablesCodeStoadeptlyhandle
Inthispaper,wemodifyPixels-TurbotoexposeanAPIforthe tablesofanywidth,includingthosewiththousandsofcolumns,
clienttospecifywhetherCFisenabledtoprocessaquery.IfCF withoutbeingconstrainedbycontexttruncation.Thisensuresthe
isenabled,Pixels-TurboisallowedtodynamicallyinvokeCFto robustnessofCodeS.MoredetailsofCodeSarediscussedin[9].
processthequerywhentheVMclusterisoverloaded,thusensuring
immediateexecutionofthequery.However,ahighercostwillincur 4 DEMONSTRATION
ifCFisinvolved.IfCFisdisabled,thequeryisforcedtoexecutein
Afterlogginginthroughauthentication,theusercanseethemain
VMsandwillwaitinaqueueiftheVMclusterisoverloaded,thus
userinterfaceofPixelsDBshowninFigure2.Itiscomposedof
leadingtoalowercostbutapotentiallylongerpendingtime.
threecomponents:schemabrowser(i.e.,Schemas),translator,and
queryresult.Thefollowingsubsectionsdemonstratehowusers
3.2 FlexibleServiceLevelsandPrices
interactwiththesecomponentstododataanalysis.
Inthispaper,weaddtheQueryServerintoPixels-Turboforquery
servingandscheduling.Itprovidesthreeservicelevelsandcorre- 4.1 BrowseDatabaseSchema
spondingpricesforeachquerysubmission.
Theschemasoftheauthorizeddatabasesaredisplayedintheleft
(1)Immediate.Atthisservicelevel,thequeryserverreceives
sidebarfortheschemabrowser.Wecanexplorethehierarchical
thequeryfromtheclientandimmediatelysubmitsittothecoordi-
viewofeachtableanddatabase,anddisplayacolumn’sdatatype
nator.Thequeryserveralsotellsthecoordinatortoenableadaptive
byhoveringoverit.Thesidebarcanbecollapsedorexpandedby
CFaccelerationforthisquerythroughtheAPIdiscussedinSec-
clickingthetogglebutton inthetopbanneroftheinterface.
tion3.1.Thus,thisservicelevelguaranteesimmediateexecutionbut
ahigherpriceupperbound,astheexpensiveCFsmaybeinvolved
4.2 FormandSubmitaQuery
inqueryexecution.Inthedemo,wesetthepriceofimmediate
queriestobethesameasAWSAthena1,whichis$5/TB-scan[2]. Wefirstselectthedatabasetoanalyzeinthedrop-downboxatthe
(2)Relaxed.Atthisservicelevel,thequeryserversubmitsthe
lowerleftoftheTranslator.Then,wetypeinouranalyticquestion
querywithCFdisabled,ifthequeryconcurrencyinVMsisbelow
inthemessageboxandclickSend.Eachquestionistranslatedtoan
SQLqueryanddisplayedasacodeblockbelowthequestion.When
thehighwatermarkdiscussedinSection3.1.Otherwise,thequery
wehoverovertheSQLcodeblock,asshownbythelastqueryin
isqueuedinthequeryserverbeforeaconfigurablegraceperiod
Figure2,wecanseeadynamiceditbutton andadynamicsubmit
(e.g.,5minutes)expires,givingtimefortheVMclustertoscaleout.
button ontherightofthecodeblock.
Givenagraceperiodlongerthanthetimerequiredtoscaleoutthe
Ifwewanttocorrectminorerrorsinthequery,wecanmake
VMcluster,relaxedquerieswillnotoverloadtheVMcluster.As
thecodeblockwritablebyclickingtheeditbutton.Afterediting
CFisdisabled,themonetarycostofrelaxedquerieswouldbe1-
thequery,wecanclickthedynamiccancelbutton ontheright
2ordersofmagnitudelowerthanthatoftheimmediatequeries
ofthecodeblocktoresetthequeryorclickthedynamicconfirm
executedinCFs[7].Inthedemo,wesetthepriceofrelaxedqueries
button toacceptthemodification.Wecanalsorephraseanew
to20%oftheimmediatequeries,i.e.,$1/TB-scan.
questionifweareunsatisfiedwiththetranslatedquery.Thus,the
(3)Best-of-effort.Atthisservicelevel,thequeryserveronly
text-to-SQLservicewilllikelyprovideamoreaccuratetranslation.
schedulesthequeryforexecutionwhenthequeryconcurrencyin
Whenwearesatisfiedwiththequery,wecanclickthesubmit
VMsisbelowthelowwatermarkdiscussedinSection3.1.Thereis
button,andasubmissionform(showninFigure3)willpopupas
noguaranteeonthependingtime.Namely,best-of-effortqueries
atranslucentfloatinglayeronthewebpage.Inthisform,wecan
areonlyexecutedwhentheVMclusterislikelytoscalein.This
selecttheservicelevelandsettheresult-sizelimitforthequery.By
1Intheexperimentsof[7],weshowthatthepure-CFqueryexecutioninPixels-Turbo 2Forexample,scaling-inrightbeforethenextworkloadspike.Wetriedtoavoidthis
hasacomparablemonetarycostasAWSAthena[1]andRedshift-Serverless[3]. byalazy-scaling-inpolicyin[7].HaoqiongBian,DongyangGeng,HaoyangLi,andAnastasiaAilamaki
Figure2:MainuserinterfaceofPixelsDB(providedbyPixels-Rover).
natural classification of interactive and non-interactive queries.
Thisallowsthesystemtoscheduleresourceswithdifferentlevels
ofelasticityandcostefficiencytoexecutedifferenttypesofqueries.
Italsoprovidesopportunitiesforbatchqueryoptimization.
Figure3:Thesubmissionformofaquery.
REFERENCES
[1] 2024.AmazonAthena. https://aws.amazon.com/athena/
clickingthesubmitbutton onthisform,wesubmitthequeryto [2] 2024.AmazonAthenaPricing. https://aws.amazon.com/athena/pricing/
Pixels-Turbo,andthequerywillbescheduledforexecution. [3] 2024. AmazonRedshiftServerless. https://aws.amazon.com/redshift/redshift-
serverless/
[4] 2024.BIRD-SQL:ABigBenchforLarge-ScaleDatabaseGroundedText-to-SQLs.
4.3 CheckQueryStatusandResult https://bird-bench.github.io/
[5] 2024.GoogleBigQuery. https://cloud.google.com/bigquery
Afterthequeryissubmitted,anexpendableblockthatdisplays
[6] 2024.Spider1.0:YaleSemanticParsingandText-to-SQLChallenge. https://yale-
thequery’sstatusandresultwillappearintheQueryResultarea. lily.github.io/spider
All blocks are arranged in ascending order from top to bottom [7] BianHaoqiong,ShaTiannan,andAnastasiaAilamaki.2023.UsingCloudFunc-
tionsasAcceleratorforElasticDataAnalytics.InSIGMOD.
accordingtoquerysubmissiontime.Weusethebackgroundcolors [8] HyeonjiKim,Byeong-HoonSo,Wook-ShinHan,andHongraeLee.2020.Natural
, ,and fortheblocksofbest-of-effort,relaxed,andimmediate LanguagetoSQL:WhereAreWeToday?PVLDB13,10(2020).
[9] HaoyangLi,JingZhang,HanbingLiu,JuFan,XiaokangZhang,JunZhu,Renjie
queries,respectively.Wecandouble-clickaquery’scodeblockin
Wei,HongyanPan,CuipingLi,andHongChen.2024.CodeS:TowardsBuilding
thetranslatortohighlightitsstatus-and-resultblock,orviceversa. Open-sourceLanguageModelsforText-to-SQL.InSIGMOD.
Therearefourquerystatuses:pending(i.e.,waitingtoexecute), [10] IngoMüller,RenatoMarroquín,andGustavoAlonso.2020.Lambada:Interactive
DataAnalyticsonColdDataUsingServerlessCloudInfrastructure.InSIGMOD.
running(i.e.,executing),finished,andfailed.Ifthequeryisfinished,
[11] MatthewPerron,RaulCastroFernandez,DavidDeWitt,MichaelCafarella,and
wecanexpandtheblocktoviewitsresultandexecutionstatistics SamuelMadden.2023. Cackle:AnalyticalWorkloadCostandPerformance
(i.e.,pendingtime,executiontime,andmonetarycost).Ifthequery StabilityWithElasticPools.InSIGMOD.
isfailed,wecanexpanditsblocktoviewtheerrormessage.To
expandorrestorethecorrespondingarea,wecanclickthezoom
buttonattheupperrightofthetranslatororqueryresult.
5 CONCLUSION
This paper presents a data analytic system named PixelsDB. It
demonstrateshowserverlessqueryprocessing,text-to-SQLtrans-
lation,andflexibleservicelevelsandpricescanbeintegratedto
improvetheuserexperienceofclouddatawarehouses(lakes).The
differentlevelsofquerypendingtimeinPixelsDBconformtousers’